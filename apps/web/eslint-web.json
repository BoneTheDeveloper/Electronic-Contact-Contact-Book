[{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\.eslintrc.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\__tests__\\middleware.flow.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'beforeEach' is defined but never used.","line":1,"column":36,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":46},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'NextRequest' is defined but never used.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[245,248],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[245,248],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[680,683],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[680,683],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[933,936],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[933,936],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1205,1208],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1205,1208],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":42,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1464,1467],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1464,1467],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":50,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1804,1807],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1804,1807],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2066,2069],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2066,2069],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2343,2346],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2343,2346],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2630,2633],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2630,2633],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":85,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3037,3040],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3037,3040],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from 'vitest'\nimport { NextRequest } from 'next/server'\nimport { middleware } from '../middleware'\n\ndescribe('Middleware - Flow Tests', () => {\n  const createMockRequest = (pathname: string, user: any = null) => ({\n    nextUrl: { pathname },\n    cookies: {\n      get: vi.fn((name: string) => {\n        if (name === 'auth' && user) {\n          return { value: JSON.stringify(user) }\n        }\n        return undefined\n      }),\n    },\n    url: 'http://localhost:3000',\n  })\n\n  it('should redirect root to login for unauthenticated users', () => {\n    const request = createMockRequest('/')\n    const response = middleware(request as any)\n\n    expect(response.headers.get('location')).toContain('/login')\n  })\n\n  it('should redirect authenticated root to role dashboard', () => {\n    const request = createMockRequest('/', { role: 'teacher' })\n    const response = middleware(request as any)\n\n    expect(response.headers.get('location')).toContain('/teacher/dashboard')\n  })\n\n  it('should redirect authenticated users away from login page', () => {\n    const request = createMockRequest('/login', { role: 'admin' })\n    const response = middleware(request as any)\n\n    expect(response.headers.get('location')).toContain('/admin/dashboard')\n  })\n\n  it('should protect admin routes from unauthenticated users', () => {\n    const request = createMockRequest('/admin/dashboard')\n    const response = middleware(request as any)\n\n    expect(response.headers.get('location')).toContain('/login')\n    expect(response.headers.get('location')).toContain('redirect=%2Fadmin%2Fdashboard')\n  })\n\n  it('should protect teacher routes from unauthenticated users', () => {\n    const request = createMockRequest('/teacher/schedule')\n    const response = middleware(request as any)\n\n    expect(response.headers.get('location')).toContain('/login')\n  })\n\n  it('should block non-admin users from admin routes', () => {\n    const request = createMockRequest('/admin/dashboard', { role: 'teacher' })\n    const response = middleware(request as any)\n\n    expect(response.headers.get('location')).toContain('/teacher/dashboard')\n  })\n\n  it('should block non-teacher users from teacher routes', () => {\n    const request = createMockRequest('/teacher/schedule', { role: 'admin' })\n    const response = middleware(request as any)\n\n    expect(response.headers.get('location')).toContain('/admin/dashboard')\n  })\n\n  it('should allow authenticated users to access their role routes', () => {\n    const request = createMockRequest('/teacher/schedule', { role: 'teacher' })\n    const response = middleware(request as any)\n\n    // Should proceed without redirect\n    expect(response.headers.get('location')).toBeNull()\n  })\n\n  it('should handle corrupted auth cookie gracefully', () => {\n    const request = {\n      nextUrl: { pathname: '/admin/dashboard' },\n      cookies: {\n        get: vi.fn(() => ({ value: 'invalid-json' })),\n      },\n      url: 'http://localhost:3000',\n    }\n    const response = middleware(request as any)\n\n    expect(response.headers.get('location')).toContain('/login')\n  })\n})\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\__tests__\\shared-types.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Parent' is defined but never used.","line":6,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Teacher' is defined but never used.","line":6,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":39}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Shared Types Tests - Verify type consistency across apps\n */\n\nimport { describe, it, expect } from 'vitest'\nimport type { Student, Parent, Teacher, Invoice } from '@school-management/shared-types'\n\ndescribe('Shared Types - Shape Validation', () => {\n  it('should have correct Student type shape', () => {\n    const student: Student = {\n      id: '1',\n      name: 'Test Student',\n      classId: 'class-1',\n      parentId: 'parent-1'\n    }\n    expect(student.id).toBeDefined()\n    expect(student.name).toBeDefined()\n  })\n\n  it('should have correct Invoice type with optional dueDate', () => {\n    const invoice: Invoice = {\n      id: 'inv-1',\n      studentId: 'student-1',\n      amount: 1000,\n      status: 'pending',\n      dueDate: null // Test optional/null handling\n    }\n    expect(invoice.dueDate).toBeNull()\n  })\n})\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\__tests__\\type-check.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\(auth)\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\(auth)\\login\\__tests__\\page.flow.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\(auth)\\login\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":65,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1932,1935],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1932,1935],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\n/**\n * Login Page\n *\n * REAL authentication using Supabase Auth\n *\n * Login identifiers:\n * - Admin: admin_code (AD001) or email\n * - Teacher: employee_code (TC001) or email\n * - Student: student_code (ST2024001) or email\n * - Parent: phone number or email\n */\n\nimport { useState, Suspense, useEffect } from 'react'\nimport Link from 'next/link'\nimport { AuthBrandingPanel } from '@/components/auth-branding-panel'\nimport { login, logout } from '@/lib/auth'\n\nfunction LoginForm() {\n  const [isPending, setIsPending] = useState(false)\n  const [error, setError] = useState<string | undefined>()\n  const [currentUser, setCurrentUser] = useState<{ name: string; role: string } | null>(null)\n  const [role, setRole] = useState<'teacher' | 'admin'>(() => {\n    if (typeof window !== 'undefined') {\n      const saved = sessionStorage.getItem('loginRole')\n      return (saved === 'admin' || saved === 'teacher') ? saved : 'teacher'\n    }\n    return 'teacher'\n  })\n  const [showPassword, setShowPassword] = useState(false)\n  // Preserve form values across submissions\n  const [identifier, setIdentifier] = useState('')\n  const [password, setPassword] = useState('')\n\n  // Check for existing session\n  useEffect(() => {\n    async function checkSession() {\n      try {\n        const res = await fetch('/api/auth/session')\n        if (res.ok) {\n          const data = await res.json()\n          if (data.user) {\n            setCurrentUser({ name: data.user.name, role: data.user.role })\n          }\n        }\n      } catch {\n        // Ignore errors\n      }\n    }\n    checkSession()\n  }, [])\n\n  // Handle form submission\n  const handleSubmit = (e: React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault()\n    setError(undefined)\n    setIsPending(true)\n\n    const formData = new FormData()\n    formData.set('identifier', identifier)\n    formData.set('password', password)\n\n    // Login is a server action\n    login(formData as any).then((result) => {\n      setIsPending(false)\n      if (result && 'error' in result) {\n        setError(result.error)\n      }\n    }).catch(() => {\n      setIsPending(false)\n    })\n  }\n\n  // Save role to sessionStorage when it changes\n  useEffect(() => {\n    if (typeof window !== 'undefined') {\n      sessionStorage.setItem('loginRole', role)\n    }\n  }, [role])\n\n  // Get placeholder and label based on role\n  const getLoginConfig = () => {\n    if (role === 'teacher') {\n      return {\n        label: 'Mã giáo viên Hoặc email',\n        placeholder: 'TC001'\n      }\n    }\n    return {\n      label: 'Mã quản trị viên Hoặc email',\n      placeholder: 'AD001'\n    }\n  }\n\n  const loginConfig = getLoginConfig()\n\n  return (\n    <>\n      {/* Left Branding Panel */}\n      <AuthBrandingPanel />\n\n      {/* Right Login Panel */}\n      <div className=\"w-full lg:w-1/2 flex items-center justify-center p-8 bg-white overflow-y-auto\">\n        <div className=\"w-full max-w-md\">\n          {/* Header */}\n          <div className=\"mb-10\">\n            <h2 className=\"text-4xl font-black text-gray-900 mb-2 tracking-tight\">\n              Đăng nhập\n            </h2>\n            <p className=\"text-gray-500 font-medium\">\n              Vui lòng đăng nhập vào cổng thông tin của bạn.\n            </p>\n\n            {/* Show existing session info */}\n            {currentUser && (\n              <div className=\"mt-4 p-4 bg-amber-50 border border-amber-200 rounded-xl\">\n                <p className=\"text-sm text-amber-800 font-medium mb-2\">\n                  Bạn đang đăng nhập sebagai <strong>{currentUser.name}</strong> ({currentUser.role === 'teacher' ? 'Giáo viên' : currentUser.role === 'admin' ? 'Quản trị viên' : currentUser.role})\n                </p>\n                <form action={logout}>\n                  <button\n                    type=\"submit\"\n                    className=\"text-sm font-bold text-amber-900 hover:text-amber-700 underline\"\n                  >\n                    Đăng xuất để đổi tài khoản →\n                  </button>\n                </form>\n              </div>\n            )}\n          </div>\n\n          {/* Role Toggle */}\n          <div className=\"bg-gray-100 p-1.5 rounded-2xl flex mb-8\">\n            <button\n              type=\"button\"\n              onClick={() => setRole('teacher')}\n              className={`flex-1 py-3 rounded-xl text-sm font-bold flex items-center justify-center gap-2 transition-all ${\n                role === 'teacher'\n                  ? 'bg-[#0284C7] text-white shadow-lg'\n                  : 'text-gray-400 hover:text-gray-600'\n              }`}\n            >\n              Giáo viên\n            </button>\n            <button\n              type=\"button\"\n              onClick={() => setRole('admin')}\n              className={`flex-1 py-3 rounded-xl text-sm font-bold flex items-center justify-center gap-2 transition-all ${\n                role === 'admin'\n                  ? 'bg-[#0284C7] text-white shadow-lg'\n                  : 'text-gray-400 hover:text-gray-600'\n              }`}\n            >\n              Quản trị viên\n            </button>\n          </div>\n\n          {/* Login Form */}\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\n\n            {/* Code/Email Input */}\n            <div>\n              <label className=\"block text-xs font-black text-gray-400 uppercase tracking-widest mb-2 ml-1\">\n                {loginConfig.label}\n              </label>\n              <div className=\"relative\">\n                {/* User icon */}\n                <span className=\"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400\">\n                  <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                    <path d=\"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2\" />\n                    <circle cx=\"12\" cy=\"7\" r=\"4\" />\n                  </svg>\n                </span>\n                <input\n                  id=\"identifier\"\n                  name=\"identifier\"\n                  type=\"text\"\n                  autoComplete=\"username\"\n                  required\n                  value={identifier}\n                  onChange={(e) => setIdentifier(e.target.value)}\n                  placeholder={loginConfig.placeholder}\n                  className=\"w-full pl-12 pr-4 py-4 bg-gray-50 border-2 border-gray-100 rounded-2xl focus:border-sky-500 focus:bg-white focus:outline-none focus:ring-4 focus:ring-sky-500/10 transition-all font-semibold text-gray-900 placeholder-gray-400\"\n                />\n              </div>\n            </div>\n\n            {/* Password Input */}\n            <div>\n              <label className=\"block text-xs font-black text-gray-400 uppercase tracking-widest mb-2 ml-1\">\n                Mật khẩu\n              </label>\n              <div className=\"relative\">\n                {/* Lock icon */}\n                <span className=\"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400\">\n                  <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                    <rect x=\"3\" y=\"11\" width=\"18\" height=\"11\" rx=\"2\" ry=\"2\" />\n                    <path d=\"M7 11V7a5 5 0 0 1 10 0v4\" />\n                  </svg>\n                </span>\n                <input\n                  id=\"password\"\n                  name=\"password\"\n                  type={showPassword ? 'text' : 'password'}\n                  autoComplete=\"current-password\"\n                  required\n                  value={password}\n                  onChange={(e) => setPassword(e.target.value)}\n                  placeholder=\"••••••••\"\n                  className=\"w-full pl-12 pr-12 py-4 bg-gray-50 border-2 border-gray-100 rounded-2xl focus:border-sky-500 focus:bg-white focus:outline-none focus:ring-4 focus:ring-sky-500/10 transition-all font-semibold text-gray-900 placeholder-gray-400\"\n                />\n                {/* Show/Hide password toggle */}\n                <button\n                  type=\"button\"\n                  onClick={() => setShowPassword(!showPassword)}\n                  className=\"absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors\"\n                >\n                  {showPassword ? (\n                    // Eye slash icon (hide)\n                    <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                      <path d=\"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24\" />\n                      <line x1=\"1\" y1=\"1\" x2=\"23\" y2=\"23\" />\n                    </svg>\n                  ) : (\n                    // Eye icon (show)\n                    <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                      <path d=\"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z\" />\n                      <circle cx=\"12\" cy=\"12\" r=\"3\" />\n                    </svg>\n                  )}\n                </button>\n              </div>\n            </div>\n\n            {/* Submit Button */}\n            <button\n              type=\"submit\"\n              disabled={isPending}\n              className=\"w-full py-5 bg-[#0284C7] hover:bg-[#0369a1] disabled:bg-gray-400 text-white font-black text-lg rounded-2xl shadow-xl transition-all transform hover:-translate-y-1 disabled:transform-none flex items-center justify-center gap-3\"\n            >\n              {isPending ? 'ĐANG XỬ LÝ...' : 'ĐĂNG NHẬP HỆ THỐNG'}\n              {!isPending && (\n                <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"3\">\n                  <path d=\"M5 12h14M12 5l7 7-7 7\" />\n                </svg>\n              )}\n            </button>\n\n            {/* Forgot Password Link & Error Message */}\n            <div className=\"flex justify-between items-center mt-3\">\n              {error && (\n                <p className=\"text-sm font-semibold text-red-600\">\n                  {error}\n                </p>\n              )}\n              <button\n                type=\"button\"\n                className=\"text-xs font-bold text-[#0284C7] hover:underline ml-auto\"\n              >\n                Quên mật khẩu?\n              </button>\n            </div>\n          </form>\n\n          {/* Footer */}\n          <div className=\"mt-12 pt-8 border-t border-gray-100 flex justify-between items-center text-gray-400\">\n            <p className=\"text-xs font-bold uppercase tracking-widest\">\n              ECONTACT v1.0.2\n            </p>\n            <div className=\"flex gap-4\">\n              <Link href=\"#\" className=\"hover:text-sky-500 transition-colors\">\n                <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                  <circle cx=\"12\" cy=\"12\" r=\"10\" />\n                  <path d=\"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3\" />\n                  <line x1=\"12\" y1=\"17\" x2=\"12.01\" y2=\"17\" />\n                </svg>\n              </Link>\n            </div>\n          </div>\n        </div>\n      </div>\n    </>\n  )\n}\n\nexport default function LoginPage() {\n  return (\n    <Suspense fallback={\n      <div className=\"w-full h-screen flex items-center justify-center bg-gray-100\">\n        <div className=\"text-gray-500\">Loading...</div>\n      </div>\n    }>\n      <LoginForm />\n    </Suspense>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\admin\\attendance\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\admin\\classes\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Mail' is defined but never used.","line":4,"column":40,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":44}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { getClassById, getStudentsByClass } from '@/lib/supabase/queries'\nimport { notFound } from 'next/navigation'\nimport { StudentTable } from '@/components/admin/StudentTable'\nimport { Users, MapPin, GraduationCap, Mail } from 'lucide-react'\n\nexport default async function ClassDetailPage({\n  params,\n}: {\n  params: Promise<{ id: string }>\n}) {\n  const { id } = await params\n  const classData = await getClassById(id)\n\n  if (!classData) {\n    notFound()\n  }\n\n  const students = await getStudentsByClass(id)\n\n  return (\n    <div className=\"space-y-8 p-8\">\n      {/* Page Header */}\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h1 className=\"text-2xl font-extrabold text-slate-800\">\n            {classData.name} - Danh sách học sinh\n          </h1>\n          <p className=\"text-slate-500 text-sm\">\n            Giáo viên: {classData.teacher} • Phòng: {classData.room}\n          </p>\n        </div>\n        <button className=\"px-5 py-2.5 bg-[#0284C7] text-white rounded-xl font-bold text-sm hover:bg-[#0369a1]\">\n          Thêm học sinh\n        </button>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-4 gap-8\">\n        {/* Class Info Sidebar */}\n        <div className=\"bg-white rounded-3xl border border-slate-100 p-6 space-y-6\">\n          <div className=\"flex items-center gap-3 pb-6 border-b border-slate-100\">\n            <div className=\"p-3 bg-blue-50 text-blue-600 rounded-2xl\">\n              <GraduationCap className=\"h-6 w-6\" />\n            </div>\n            <div>\n              <h2 className=\"text-lg font-black text-slate-800\">{classData.name}</h2>\n              <p className=\"text-xs text-slate-400\">Khối {classData.grade}</p>\n            </div>\n          </div>\n\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center gap-3\">\n              <Users className=\"h-5 w-5 text-slate-400\" />\n              <div>\n                <p className=\"text-xs text-slate-400\">Sĩ số</p>\n                <p className=\"text-sm font-bold text-slate-800\">{classData.studentCount} học sinh</p>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-3\">\n              <MapPin className=\"h-5 w-5 text-slate-400\" />\n              <div>\n                <p className=\"text-xs text-slate-400\">Phòng học</p>\n                <p className=\"text-sm font-bold text-slate-800\">{classData.room}</p>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-3\">\n              <GraduationCap className=\"h-5 w-5 text-slate-400\" />\n              <div>\n                <p className=\"text-xs text-slate-400\">GVCN</p>\n                <p className=\"text-sm font-bold text-slate-800\">{classData.teacher}</p>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"pt-4 border-t border-slate-100 space-y-3\">\n            <button className=\"w-full px-4 py-2.5 bg-[#0284C7] text-white rounded-xl font-bold text-sm hover:bg-[#0369a1]\">\n              Chỉnh sửa lớp\n            </button>\n            <button className=\"w-full px-4 py-2.5 bg-slate-100 text-slate-700 rounded-xl font-bold text-sm hover:bg-slate-200\">\n              Điểm danh nhanh\n            </button>\n          </div>\n        </div>\n\n        {/* Students Table */}\n        <div className=\"lg:col-span-3\">\n          <StudentTable students={students} />\n        </div>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\admin\\classes\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\admin\\dashboard\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingUp' is defined but never used.","line":5,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\n  Users,\n  GraduationCap,\n  DollarSign,\n  TrendingUp,\n  Calendar,\n  Download,\n  Plus,\n} from 'lucide-react'\nimport Link from 'next/link'\nimport { StatsGrid } from '@/components/admin/StatsGrid'\nimport { AttendanceBoxes } from '@/components/admin/AttendanceBoxes'\nimport { FeeCollectionChart } from '@/components/admin/FeeCollectionChart'\nimport { ActivityLogTable } from '@/components/admin/ActivityLogTable'\nimport { GradeDistribution } from '@/components/admin/GradeDistribution'\nimport { SupportRequests } from '@/components/admin/SupportRequests'\nimport {\n  getDashboardStats,\n  getAttendanceStats,\n  getFeeStats,\n  getActivities,\n  getGradeDistribution,\n} from '@/lib/supabase/queries'\n\nexport default async function AdminDashboard() {\n  const [stats, attendance, fees, activities, gradeDist] = await Promise.all([\n    getDashboardStats().catch(() => ({ students: 0, parents: 0, teachers: 0, attendance: '0%', feesCollected: '0₫', revenue: 0, pendingPayments: 0 })),\n    getAttendanceStats('week').catch(() => ({ excused: 0, unexcused: 0, tardy: 0 })),\n    getFeeStats('1').catch(() => ({ percentage: 0, paidAmount: '0₫', remainingAmount: '0₫', totalAmount: '0₫', paidStudents: 0, totalStudents: 0 })),\n    getActivities().catch(() => []),\n    getGradeDistribution().catch(() => []),\n  ])\n\n  const statCards = [\n    {\n      label: 'Học sinh',\n      value: stats.students.toLocaleString('vi-VN'),\n      change: '+2.5%',\n      icon: Users,\n      color: 'bg-blue-50 text-sky-600',\n    },\n    {\n      label: 'Phụ huynh',\n      value: stats.parents.toLocaleString('vi-VN'),\n      change: '+1.8%',\n      icon: Users,\n      color: 'bg-teal-50 text-teal-600',\n    },\n    {\n      label: 'Giáo viên',\n      value: stats.teachers.toString(),\n      change: 'Ổn định',\n      icon: GraduationCap,\n      color: 'bg-purple-50 text-purple-600',\n    },\n    {\n      label: 'Chuyên cần',\n      value: stats.attendance,\n      change: '-0.8%',\n      icon: Calendar,\n      color: 'bg-orange-50 text-orange-600',\n    },\n    {\n      label: 'Thu học phí',\n      value: stats.feesCollected,\n      change: '+12%',\n      icon: DollarSign,\n      color: 'bg-green-50 text-green-600',\n    },\n  ]\n\n  return (\n    <div className=\"space-y-8 p-8\">\n      {/* Page Header with Actions */}\n      <div className=\"flex flex-col items-end justify-between gap-4 md:flex-row md:items-center\">\n        <div></div>\n        <div className=\"flex items-center gap-3\">\n          <button className=\"flex items-center gap-2 rounded-xl border border-slate-200 bg-white px-5 py-2.5 font-bold text-sm text-slate-700 transition-colors hover:bg-slate-50\">\n            <Download width={16} height={16} />\n            Xuất báo cáo\n          </button>\n          <Link\n            href=\"/admin/notifications\"\n            className=\"flex items-center gap-2 rounded-xl bg-[#0284C7] px-5 py-2.5 font-bold text-sm text-white shadow-lg shadow-blue-100 transition-colors hover:bg-[#0369a1]\"\n          >\n            <Plus width={16} height={16} strokeWidth={3} />\n            Thông báo mới\n          </Link>\n        </div>\n      </div>\n\n      {/* Stats Grid */}\n      <StatsGrid stats={statCards} />\n\n      {/* Main Content Grid */}\n      <div className=\"grid grid-cols-1 gap-8 lg:grid-cols-3\">\n        {/* Left Column - 2/3 width */}\n        <div className=\"lg:col-span-2 space-y-8\">\n          {/* Two Charts Side by Side */}\n          <div className=\"grid grid-cols-1 gap-6 md:grid-cols-2\">\n            {/* Attendance Boxes */}\n            <AttendanceBoxes initialData={attendance} />\n\n            {/* Fee Collection */}\n            <FeeCollectionChart initialData={fees} />\n          </div>\n\n          {/* Activity Log Table */}\n          <ActivityLogTable activities={activities} />\n        </div>\n\n        {/* Right Column - 1/3 width */}\n        <div className=\"space-y-8\">\n          {/* Grade Distribution */}\n          <GradeDistribution data={gradeDist} />\n\n          {/* Support Requests */}\n          <SupportRequests />\n        </div>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\admin\\grades\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\admin\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\admin\\loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\admin\\notifications\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Bell' is defined but never used.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":14}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NotificationManagement } from '@/components/admin/notifications/NotificationManagement'\nimport { Bell, Send } from 'lucide-react'\n\nexport default async function NotificationsPage() {\n  return (\n    <div className=\"space-y-8 p-8\">\n      {/* Page Header */}\n      <div className=\"flex flex-col items-end justify-between gap-4 md:flex-row md:items-center\">\n        <div>\n          <h1 className=\"text-2xl font-extrabold text-slate-800\">Thông báo</h1>\n          <p className=\"text-sm text-slate-500\">\n            Gửi và quản lý thông báo hệ thống\n          </p>\n        </div>\n        <button className=\"flex items-center gap-2 rounded-xl bg-[#0284C7] px-5 py-2.5 font-bold text-sm text-white shadow-lg shadow-blue-100 transition-all hover:bg-[#0369a1]\">\n          <Send className=\"h-4 w-4\" />\n          Thông báo mới\n        </button>\n      </div>\n\n      {/* Notification Management */}\n      <NotificationManagement />\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\admin\\payments\\invoice-tracker\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\admin\\payments\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileText' is defined but never used.","line":2,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { PaymentsManagement } from '@/components/admin/payments/PaymentsManagement'\nimport { Plus, FileText, Download } from 'lucide-react'\n\nexport default async function PaymentsPage() {\n  return (\n    <div className=\"space-y-8 p-8\">\n      {/* Page Header */}\n      <div className=\"flex flex-col items-end justify-between gap-4 md:flex-row md:items-center\">\n        <div>\n          <h1 className=\"text-2xl font-extrabold text-slate-800\">Học phí & Tài chính</h1>\n          <p className=\"text-sm text-slate-500\">\n            Quản lý thu học phí và theo dõi công nợ\n          </p>\n        </div>\n        <div className=\"flex items-center gap-3\">\n          <button className=\"flex items-center gap-2 rounded-xl border border-slate-200 bg-white px-5 py-2.5 font-bold text-sm text-slate-700 shadow-sm transition-all hover:bg-slate-50\">\n            <Download className=\"h-4 w-4\" />\n            Xuất báo cáo\n          </button>\n          <button className=\"flex items-center gap-2 rounded-xl bg-[#0284C7] px-5 py-2.5 font-bold text-sm text-white shadow-lg shadow-blue-100 transition-all hover:bg-[#0369a1]\">\n            <Plus className=\"h-4 w-4\" strokeWidth={3} />\n            Tạo hóa đơn\n          </button>\n        </div>\n      </div>\n\n      {/* Payments Management */}\n      <PaymentsManagement />\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\admin\\users\\UsersPageClient.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\admin\\users\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used.","line":3,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { getUserById } from '@/lib/supabase/queries'\nimport { notFound } from 'next/navigation'\nimport { Mail, Shield, Calendar, User } from 'lucide-react'\n\nexport default async function UserDetailPage({\n  params,\n}: {\n  params: Promise<{ id: string }>\n}) {\n  const { id } = await params\n  const user = await getUserById(id)\n\n  if (!user) {\n    notFound()\n  }\n\n  const getRoleColor = (role: string) => {\n    switch (role) {\n      case 'admin':\n        return 'bg-purple-100 text-purple-700'\n      case 'teacher':\n        return 'bg-blue-100 text-blue-700'\n      case 'parent':\n        return 'bg-green-100 text-green-700'\n      case 'student':\n        return 'bg-orange-100 text-orange-700'\n      default:\n        return 'bg-gray-100 text-gray-700'\n    }\n  }\n\n  const getInitials = (name: string) => {\n    return name\n      .split(' ')\n      .slice(0, 2)\n      .map((n) => n[0])\n      .join('')\n      .toUpperCase()\n  }\n\n  return (\n    <div className=\"space-y-8 p-8\">\n      {/* Page Header */}\n      <div>\n        <h1 className=\"text-2xl font-extrabold text-slate-800\">Chi tiết Người dùng</h1>\n        <p className=\"text-slate-500 text-sm\">\n          Thông tin chi tiết và quản lý tài khoản\n        </p>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n        {/* User Profile Card */}\n        <div className=\"bg-white rounded-3xl border border-slate-100 p-8\">\n          <div className=\"flex flex-col items-center text-center\">\n            <div className=\"w-24 h-24 rounded-full bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center text-white font-bold text-3xl mb-4\">\n              {getInitials(user.name)}\n            </div>\n            <h2 className=\"text-xl font-bold text-slate-800 mb-1\">{user.name}</h2>\n            <span className={`px-3 py-1 rounded-full text-xs font-bold uppercase ${getRoleColor(user.role)}`}>\n              {user.role}\n            </span>\n          </div>\n\n          <div className=\"mt-8 space-y-4\">\n            <div className=\"flex items-center gap-3\">\n              <Mail className=\"h-5 w-5 text-slate-400\" />\n              <div>\n                <p className=\"text-xs text-slate-400\">Email</p>\n                <p className=\"text-sm font-medium text-slate-700\">{user.email}</p>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-3\">\n              <Shield className=\"h-5 w-5 text-slate-400\" />\n              <div>\n                <p className=\"text-xs text-slate-400\">Trạng thái</p>\n                <p className=\"text-sm font-medium text-slate-700\">\n                  {user.status === 'active' ? 'Hoạt động' : 'Không hoạt động'}\n                </p>\n              </div>\n            </div>\n            {user.classId && (\n              <div className=\"flex items-center gap-3\">\n                <User className=\"h-5 w-5 text-slate-400\" />\n                <div>\n                  <p className=\"text-xs text-slate-400\">Lớp</p>\n                  <p className=\"text-sm font-medium text-slate-700\">{user.classId}</p>\n                </div>\n              </div>\n            )}\n          </div>\n\n          <div className=\"mt-8 space-y-3\">\n            <button className=\"w-full px-4 py-2.5 bg-[#0284C7] text-white rounded-xl font-bold text-sm hover:bg-[#0369a1]\">\n              Chỉnh sửa\n            </button>\n            <button className=\"w-full px-4 py-2.5 bg-red-50 text-red-600 rounded-xl font-bold text-sm hover:bg-red-100\">\n              Khóa tài khoản\n            </button>\n          </div>\n        </div>\n\n        {/* Activity & Settings */}\n        <div className=\"lg:col-span-2 space-y-6\">\n          <div className=\"bg-white rounded-3xl border border-slate-100 p-8\">\n            <h3 className=\"text-lg font-bold text-slate-800 mb-6\">Hoạt động gần đây</h3>\n            <div className=\"space-y-4\">\n              <div className=\"flex items-start gap-4 pb-4 border-b border-slate-100\">\n                <div className=\"w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-bold text-sm\">\n                  {getInitials(user.name)}\n                </div>\n                <div className=\"flex-1\">\n                  <p className=\"text-sm font-medium text-slate-800\">Đăng nhập vào hệ thống</p>\n                  <p className=\"text-xs text-slate-400\">2 giờ trước</p>\n                </div>\n              </div>\n              <div className=\"flex items-start gap-4 pb-4 border-b border-slate-100\">\n                <div className=\"w-10 h-10 rounded-full bg-green-100 text-green-600 flex items-center justify-center font-bold text-sm\">\n                  {getInitials(user.name)}\n                </div>\n                <div className=\"flex-1\">\n                  <p className=\"text-sm font-medium text-slate-800\">Cập nhật thông tin cá nhân</p>\n                  <p className=\"text-xs text-slate-400\">1 ngày trước</p>\n                </div>\n              </div>\n              <div className=\"flex items-start gap-4\">\n                <div className=\"w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center font-bold text-sm\">\n                  {getInitials(user.name)}\n                </div>\n                <div className=\"flex-1\">\n                  <p className=\"text-sm font-medium text-slate-800\">Tài khoản được tạo</p>\n                  <p className=\"text-xs text-slate-400\">1 tuần trước</p>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"bg-white rounded-3xl border border-slate-100 p-8\">\n            <h3 className=\"text-lg font-bold text-slate-800 mb-6\">Cài đặt quyền</h3>\n            <div className=\"space-y-4\">\n              <label className=\"flex items-center justify-between p-4 bg-slate-50 rounded-xl cursor-pointer hover:bg-slate-100\">\n                <div>\n                  <p className=\"text-sm font-medium text-slate-800\">Quyền xem báo cáo</p>\n                  <p className=\"text-xs text-slate-400\">Cho phép xem các báo cáo thống kê</p>\n                </div>\n                <input type=\"checkbox\" defaultChecked className=\"w-5 h-5 rounded\" />\n              </label>\n              <label className=\"flex items-center justify-between p-4 bg-slate-50 rounded-xl cursor-pointer hover:bg-slate-100\">\n                <div>\n                  <p className=\"text-sm font-medium text-slate-800\">Quyền quản lý người dùng</p>\n                  <p className=\"text-xs text-slate-400\">Cho phép thêm/sửa/xóa người dùng</p>\n                </div>\n                <input type=\"checkbox\" className=\"w-5 h-5 rounded\" />\n              </label>\n              <label className=\"flex items-center justify-between p-4 bg-slate-50 rounded-xl cursor-pointer hover:bg-slate-100\">\n                <div>\n                  <p className=\"text-sm font-medium text-slate-800\">Quyền gửi thông báo</p>\n                  <p className=\"text-xs text-slate-400\">Cho phép gửi thông báo hệ thống</p>\n                </div>\n                <input type=\"checkbox\" defaultChecked className=\"w-5 h-5 rounded\" />\n              </label>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\admin\\users\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'UsersManagementServer' is defined but never used.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Plus' is defined but never used.","line":3,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Upload' is defined but never used.","line":3,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AddUserModal' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ImportExcelModal' is defined but never used.","line":4,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":40}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { getUsers } from '@/lib/supabase/queries'\nimport { UsersManagementServer } from '@/components/admin/users/UsersManagementServer'\nimport { Plus, Upload } from 'lucide-react'\nimport { AddUserModal, ImportExcelModal } from '@/components/admin/users/modals'\nimport { UsersPageClient } from './UsersPageClient'\n\n// Server Component - fetch data server-side with caching\nexport default async function UsersPage() {\n  // Fetch users server-side\n  const users = await getUsers()\n\n  return (\n    <UsersPageClient initialUsers={users} />\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\api\\attendance\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'date' is assigned a value but never used.","line":28,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":13},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1528,1531],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1528,1531],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":37,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1634,1637],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1634,1637],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":40,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1738,1741],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1738,1741],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":48,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1947,1950],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1947,1950],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":49,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2029,2032],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2029,2032],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":50,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2108,2111],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2108,2111],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2188,2191],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2188,2191],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":53,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2318,2321],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2318,2321],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\n\ninterface AttendanceRecord {\n  id: string\n  studentName: string\n  classId: string\n  date: string\n  status: 'present' | 'absent' | 'late' | 'excused'\n  notes?: string\n}\n\n// Mock data\nconst mockAttendance: AttendanceRecord[] = [\n  { id: '1', studentName: 'Nguyễn Văn An', classId: '10A1', date: '15/01/2026', status: 'present' },\n  { id: '2', studentName: 'Trần Thị Bình', classId: '10A1', date: '15/01/2026', status: 'present' },\n  { id: '3', studentName: 'Lê Văn Cường', classId: '10A1', date: '15/01/2026', status: 'late', notes: 'Đi muộn 15 phút' },\n  { id: '4', studentName: 'Phạm Thị Dung', classId: '10A1', date: '15/01/2026', status: 'absent', notes: 'Ốm đau' },\n  { id: '5', studentName: 'Hoàng Văn Em', classId: '10A2', date: '15/01/2026', status: 'present' },\n  { id: '6', studentName: 'Đỗ Thị Gái', classId: '10A2', date: '15/01/2026', status: 'excused', notes: 'Có phép gia đình' },\n  { id: '7', studentName: 'Vũ Văn Hùng', classId: '10A2', date: '15/01/2026', status: 'present' },\n  { id: '8', studentName: 'Ngô Thị Hoa', classId: '10A3', date: '15/01/2026', status: 'present' },\n]\n\nexport async function GET(request: Request) {\n  const { searchParams } = new URL(request.url)\n  const classId = searchParams.get('classId')\n  const status = searchParams.get('status')\n  const date = searchParams.get('date')\n  const search = searchParams.get('search')\n\n  let filteredAttendance = [...mockAttendance]\n\n  if (classId) {\n    filteredAttendance = filteredAttendance.filter((a: any) => a.classId === classId)\n  }\n  if (status) {\n    filteredAttendance = filteredAttendance.filter((a: any) => a.status === status)\n  }\n  if (search) {\n    filteredAttendance = filteredAttendance.filter((a: any) =>\n      a.studentName.toLowerCase().includes(search.toLowerCase())\n    )\n  }\n\n  // Calculate statistics\n  const stats = {\n    total: filteredAttendance.length,\n    present: filteredAttendance.filter((a: any) => a.status === 'present').length,\n    absent: filteredAttendance.filter((a: any) => a.status === 'absent').length,\n    late: filteredAttendance.filter((a: any) => a.status === 'late').length,\n    excused: filteredAttendance.filter((a: any) => a.status === 'excused').length,\n    rate: filteredAttendance.length > 0\n      ? Math.round((filteredAttendance.filter((a: any) => a.status === 'present').length / filteredAttendance.length) * 100)\n      : 0,\n  }\n\n  return NextResponse.json({\n    success: true,\n    data: filteredAttendance,\n    stats,\n    total: filteredAttendance.length,\n  })\n}\n\nexport async function POST(request: Request) {\n  const body = await request.json()\n  const newRecord: AttendanceRecord = {\n    id: Date.now().toString(),\n    ...body,\n  }\n  mockAttendance.push(newRecord)\n\n  return NextResponse.json({\n    success: true,\n    data: newRecord,\n    message: 'Điểm danh đã được ghi nhận',\n  }, { status: 201 })\n}\n\nexport async function PATCH(request: Request) {\n  const body = await request.json()\n  const { id, ...updates } = body\n\n  const index = mockAttendance.findIndex(a => a.id === id)\n  if (index === -1) {\n    return NextResponse.json({\n      success: false,\n      message: 'Không tìm thấy bản ghi điểm danh',\n    }, { status: 404 })\n  }\n\n  mockAttendance[index] = { ...mockAttendance[index], ...updates }\n\n  return NextResponse.json({\n    success: true,\n    data: mockAttendance[index],\n    message: 'Cập nhật điểm danh thành công',\n  })\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\api\\auth\\session\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\api\\auth\\user\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\api\\classes\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'request' is defined but never used. Allowed unused args must match /^_/u.","line":33,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\nimport { getClasses } from '@/lib/supabase/queries'\n\nexport async function GET(request: Request) {\n  try {\n    const classes = await getClasses()\n\n    const { searchParams } = new URL(request.url)\n    const grade = searchParams.get('grade')\n\n    let filteredClasses = classes\n    if (grade) {\n      filteredClasses = filteredClasses.filter((c: { grade: string | null }) => c.grade === grade)\n    }\n\n    return NextResponse.json({\n      success: true,\n      data: filteredClasses,\n      total: filteredClasses.length,\n    })\n  } catch (error) {\n    return NextResponse.json(\n      {\n        success: false,\n        error: error instanceof Error ? error.message : 'Failed to fetch classes'\n      },\n      { status: 500 }\n    )\n  }\n}\n\n// TODO: Implement POST for creating classes\nexport async function POST(request: Request) {\n  return NextResponse.json(\n    {\n      success: false,\n      error: 'Not implemented - use Supabase directly or implement class creation'\n    },\n    { status: 501 }\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\api\\cron\\retry-notifications\\route.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":49,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":49,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1428,1478],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":64,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":64,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1874,1922],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":68,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":68,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2009,2081],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":93,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2700,2703],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2700,2703],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":100,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":100,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2879,2961],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":109,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":109,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3157,3160],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3157,3160],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":125,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":125,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3487,3490],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3487,3490],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":137,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":137,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3719,3722],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3719,3722],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":168,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":168,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4504,4611],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":183,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":183,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4931,4998],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":184,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":184,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5017,5020],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5017,5020],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Email Retry Cron Job\n * GET /api/cron/retry-notifications\n *\n * Retries failed email deliveries for notifications\n * Run every 5 minutes via Vercel Cron or similar service\n *\n * Required environment variables:\n * - CRON_SECRET: Secret to authenticate cron requests\n *\n * NOTE: @ts-nocheck is used due to TypeScript type inference issues with\n * Supabase client for notification tables. The types are correctly defined\n * in types/supabase.ts and the database schema matches. Runtime behavior is correct.\n */\n\n// @ts-nocheck\nimport { NextResponse } from 'next/server';\nimport { createClient } from '@/lib/supabase/server';\n\nexport const dynamic = 'force-dynamic';\n\nconst MAX_RETRIES = 3;\nconst RETRY_DELAY_MS = 1000; // 1 second delay between retries\n\n/**\n * GET /api/cron/retry-notifications\n * Cron job endpoint for retrying failed email deliveries\n */\nexport async function GET(request: Request) {\n  // Verify cron secret for security\n  const authHeader = request.headers.get('authorization');\n  const expectedAuth = `Bearer ${process.env.CRON_SECRET}`;\n\n  if (!process.env.CRON_SECRET) {\n    console.error('[Cron] CRON_SECRET not set');\n    return NextResponse.json(\n      { error: 'Server configuration error' },\n      { status: 500 }\n    );\n  }\n\n  if (authHeader !== expectedAuth) {\n    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n  }\n\n  const supabase = await createClient();\n\n  try {\n    console.log('[Cron] Starting email retry job...');\n\n    // Get failed email deliveries with retry_count < MAX_RETRIES\n    const { data: failedLogs, error: fetchError } = await supabase\n      .from('notification_logs')\n      .select('*')\n      .eq('channel', 'email')\n      .eq('status', 'failed')\n      .lt('retry_count', MAX_RETRIES);\n\n    if (fetchError) {\n      throw fetchError;\n    }\n\n    if (!failedLogs || failedLogs.length === 0) {\n      console.log('[Cron] No failed emails to retry');\n      return NextResponse.json({ success: true, retried: 0, skipped: 0 });\n    }\n\n    console.log(`[Cron] Found ${failedLogs.length} failed emails to retry`);\n\n    let retried = 0;\n    let skipped = 0;\n    const errors: string[] = [];\n\n    // Process each failed log with delay\n    for (const log of failedLogs) {\n      try {\n        // Check if we should retry this log (exponential backoff)\n        const shouldRetry = shouldRetryLog(log);\n\n        if (!shouldRetry) {\n          skipped++;\n          continue;\n        }\n\n        // Attempt retry\n        await retryEmailDelivery(log);\n        retried++;\n\n        // Delay between retries to avoid rate limiting\n        if (retried < failedLogs.length) {\n          await sleep(RETRY_DELAY_MS);\n        }\n      } catch (error: any) {\n        const errorMsg = `Retry failed for log ${log.id}: ${error.message}`;\n        console.error(`[Cron] ${errorMsg}`);\n        errors.push(errorMsg);\n      }\n    }\n\n    console.log(`[Cron] Retry job completed: ${retried} retried, ${skipped} skipped`);\n\n    return NextResponse.json({\n      success: true,\n      retried,\n      skipped,\n      total: failedLogs.length,\n      errors: errors.length > 0 ? errors : undefined,\n    });\n  } catch (error: any) {\n    console.error('[Cron] Email retry job error:', error);\n\n    return NextResponse.json(\n      {\n        success: false,\n        error: error.message || 'Unknown error',\n      },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * Determine if a log should be retried based on retry count and time\n */\nfunction shouldRetryLog(log: any): boolean {\n  // Always retry if under max attempts\n  if (log.retry_count < MAX_RETRIES) {\n    return true;\n  }\n\n  return false;\n}\n\n/**\n * Retry email delivery for a specific log entry\n */\nasync function retryEmailDelivery(log: any): Promise<void> {\n  const supabase = await createClient();\n\n  // Increment retry count\n  const newRetryCount = (log.retry_count || 0) + 1;\n\n  try {\n    // Get notification details\n    const { data: notification } = await supabase\n      .from('notifications')\n      .select('*')\n      .eq('id', log.notification_id)\n      .single();\n\n    if (!notification) {\n      throw new Error('Notification not found');\n    }\n\n    // Get recipient email\n    const { data: profile } = await supabase\n      .from('profiles')\n      .select('email, full_name')\n      .eq('id', log.recipient_id)\n      .single();\n\n    if (!profile?.email) {\n      throw new Error('Recipient email not found');\n    }\n\n    // TODO: Integrate with email service (Resend/SendGrid)\n    // For now, just log the retry\n    console.log(\n      `[Cron] Email retry ${newRetryCount} for ${profile.email}: ${notification.title}`\n    );\n\n    // Update log as sent (placeholder - real implementation would send email)\n    await supabase\n      .from('notification_logs')\n      .update({\n        status: 'sent',\n        sent_at: new Date().toISOString(),\n        retry_count: newRetryCount,\n        error_message: null,\n      })\n      .eq('id', log.id);\n\n    console.log(`[Cron] Successfully retried email for log ${log.id}`);\n  } catch (error: any) {\n    // Update log as failed again\n    await supabase\n      .from('notification_logs')\n      .update({\n        status: 'failed',\n        failed_at: new Date().toISOString(),\n        error_message: error.message?.substring(0, 500) || 'Unknown error',\n        retry_count: newRetryCount,\n      })\n      .eq('id', log.id);\n\n    throw error;\n  }\n}\n\n/**\n * Sleep for specified milliseconds\n */\nfunction sleep(ms: number): Promise<void> {\n  return new Promise((resolve) => setTimeout(resolve, ms));\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\api\\fee-assignments\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\api\\fee-assignments\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FeeAssignment' is defined but never used.","line":4,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'request' is defined but never used. Allowed unused args must match /^_/u.","line":7,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":34},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[545,548],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[545,548],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":129,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4222,4225],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4222,4225],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { getFeeAssignments, getFeeItems } from '@/lib/supabase/queries'\nimport { createClient } from '@/lib/supabase/server'\nimport type { FeeAssignment } from '@/lib/types'\n\n// GET /api/fee-assignments - List all fee assignments\nexport async function GET(request: NextRequest) {\n  try {\n    const assignments = await getFeeAssignments()\n    const feeItems = await getFeeItems()\n\n    // Enrich assignments with fee item details\n    const enrichedAssignments = assignments.map((assignment: any) => ({\n      ...assignment,\n      feeItemDetails: assignment.feeItems.map((feeId: string) => {\n        const fee = feeItems.find((f: { id: string }) => f.id === feeId)\n        return fee || { id: feeId, name: 'Unknown', amount: 0 }\n      })\n    }))\n\n    return NextResponse.json({\n      success: true,\n      data: enrichedAssignments\n    })\n  } catch (error) {\n    return NextResponse.json(\n      {\n        success: false,\n        error: error instanceof Error ? error.message : 'Failed to fetch fee assignments'\n      },\n      { status: 500 }\n    )\n  }\n}\n\n// POST /api/fee-assignments - Create a new fee assignment (wizard flow)\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json()\n    const {\n      name,\n      targetGrades,\n      targetClasses,\n      feeItems,\n      startDate,\n      dueDate,\n      reminderDays,\n      reminderFrequency\n    } = body\n\n    // Validation - Required fields\n    if (!name || typeof name !== 'string' || name.trim() === '') {\n      return NextResponse.json(\n        { success: false, error: 'Invalid or missing assignment name' },\n        { status: 400 }\n      )\n    }\n\n    if (!targetClasses || !Array.isArray(targetClasses) || targetClasses.length === 0) {\n      return NextResponse.json(\n        { success: false, error: 'Invalid or missing target classes (must be a non-empty array)' },\n        { status: 400 }\n      )\n    }\n\n    if (!feeItems || !Array.isArray(feeItems) || feeItems.length === 0) {\n      return NextResponse.json(\n        { success: false, error: 'Invalid or missing fee items (must be a non-empty array)' },\n        { status: 400 }\n      )\n    }\n\n    // Validate fee items exist\n    const allFeeItems = await getFeeItems()\n    const validFeeItems = feeItems.filter((id: string) => allFeeItems.some((f: { id: string }) => f.id === id))\n    if (validFeeItems.length === 0) {\n      return NextResponse.json(\n        { success: false, error: 'No valid fee items provided' },\n        { status: 400 }\n      )\n    }\n\n    // Validate dates\n    if (startDate && isNaN(Date.parse(startDate))) {\n      return NextResponse.json(\n        { success: false, error: 'Invalid start date format' },\n        { status: 400 }\n      )\n    }\n\n    if (dueDate && isNaN(Date.parse(dueDate))) {\n      return NextResponse.json(\n        { success: false, error: 'Invalid due date format' },\n        { status: 400 }\n      )\n    }\n\n    // Validate reminder frequency\n    if (reminderFrequency && !['once', 'daily', 'weekly'].includes(reminderFrequency)) {\n      return NextResponse.json(\n        { success: false, error: 'Invalid reminder frequency (must be once, daily, or weekly)' },\n        { status: 400 }\n      )\n    }\n\n    // Calculate total students and amount\n    const totalStudents = targetClasses.length * 35 // Average 35 students per class\n    const feeItemsTotal = allFeeItems\n      .filter((f: { id: string }) => validFeeItems.includes(f.id))\n      .reduce((sum: number, f: { amount: number }) => sum + f.amount, 0)\n    const totalAmount = feeItemsTotal * totalStudents\n\n    // Insert into Supabase\n    const supabase = await createClient()\n    const { data, error } = await supabase\n      .from('fee_assignments')\n      .insert({\n        name: name.trim(),\n        target_grades: targetGrades || [],\n        target_classes: targetClasses,\n        fee_items: validFeeItems,\n        start_date: startDate || new Date().toISOString().split('T')[0],\n        due_date: dueDate || '',\n        reminder_days: reminderDays || 7,\n        reminder_frequency: reminderFrequency || 'weekly',\n        total_students: totalStudents,\n        total_amount: totalAmount,\n        status: 'draft'\n      } as any) // Type cast to bypass Supabase type inference issue\n      .select()\n      .single()\n\n    if (error) {\n      return NextResponse.json(\n        { success: false, error: error.message },\n        { status: 500 }\n      )\n    }\n\n    return NextResponse.json({\n      success: true,\n      data: data\n    })\n  } catch (error) {\n    return NextResponse.json(\n      {\n        success: false,\n        error: error instanceof Error ? error.message : 'Failed to create fee assignment'\n      },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\api\\fee-items\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'createClient' is defined but never used.","line":3,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { getFeeItems } from '@/lib/supabase/queries'\nimport { createClient } from '@/lib/supabase/server'\nimport type { FeeItem } from '@/lib/types'\n\n// Helper function to get fee item by ID\nasync function getFeeItemById(id: string): Promise<FeeItem | undefined> {\n  const items = await getFeeItems()\n  return items.find((item: FeeItem) => item.id === id)\n}\n\n// GET /api/fee-items/[id] - Get a specific fee item\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params\n    const item = await getFeeItemById(id)\n\n    if (!item) {\n      return NextResponse.json(\n        { success: false, error: 'Fee item not found' },\n        { status: 404 }\n      )\n    }\n\n    return NextResponse.json({\n      success: true,\n      data: item\n    })\n  } catch (error) {\n    return NextResponse.json(\n      {\n        success: false,\n        error: error instanceof Error ? error.message : 'Failed to fetch fee item'\n      },\n      { status: 500 }\n    )\n  }\n}\n\n// PUT /api/fee-items/[id] - Update a fee item\nexport async function PUT(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params\n    const body = await request.json()\n    const { name, code, type, amount, semester, status } = body\n\n    // Verify fee item exists\n    const existingItem = await getFeeItemById(id)\n    if (!existingItem) {\n      return NextResponse.json(\n        { success: false, error: 'Fee item not found' },\n        { status: 404 }\n      )\n    }\n\n    // Validation for type field\n    if (type && !['mandatory', 'voluntary'].includes(type)) {\n      return NextResponse.json(\n        { success: false, error: 'Invalid type (must be mandatory or voluntary)' },\n        { status: 400 }\n      )\n    }\n\n    // Validation for semester field\n    if (semester && !['1', '2', 'all'].includes(semester)) {\n      return NextResponse.json(\n        { success: false, error: 'Invalid semester (must be 1, 2, or all)' },\n        { status: 400 }\n      )\n    }\n\n    // Validation for status field\n    if (status && !['active', 'inactive'].includes(status)) {\n      return NextResponse.json(\n        { success: false, error: 'Invalid status (must be active or inactive)' },\n        { status: 400 }\n      )\n    }\n\n    // Mock update - in real implementation, update database\n    const updatedItem: FeeItem = {\n      ...existingItem,\n      name: name?.trim() || existingItem.name,\n      code: code?.trim().toUpperCase() || existingItem.code,\n      type: type || existingItem.type,\n      amount: amount !== undefined ? Number(amount) : existingItem.amount,\n      semester: semester || existingItem.semester,\n      status: status || existingItem.status\n    }\n\n    // In real implementation, save to database\n    return NextResponse.json({\n      success: true,\n      data: updatedItem\n    })\n  } catch (error) {\n    return NextResponse.json(\n      {\n        success: false,\n        error: error instanceof Error ? error.message : 'Failed to update fee item'\n      },\n      { status: 500 }\n    )\n  }\n}\n\n// DELETE /api/fee-items/[id] - Delete a fee item\nexport async function DELETE(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params\n    // Verify fee item exists\n    const existingItem = await getFeeItemById(id)\n    if (!existingItem) {\n      return NextResponse.json(\n        { success: false, error: 'Fee item not found' },\n        { status: 404 }\n      )\n    }\n\n    // Mock delete - in real implementation, delete from database\n    // Check if fee item is in use before allowing deletion\n    // For now, just return success\n\n    return NextResponse.json({\n      success: true,\n      message: 'Fee item deleted successfully'\n    })\n  } catch (error) {\n    return NextResponse.json(\n      {\n        success: false,\n        error: error instanceof Error ? error.message : 'Failed to delete fee item'\n      },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\api\\fee-items\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FeeItem' is defined but never used.","line":2,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":35},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'request' is defined but never used. Allowed unused args must match /^_/u.","line":32,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { getFeeItems, type FeeItem } from '@/lib/supabase/queries'\n\n// GET /api/fee-items - List all fee items with optional filters\nexport async function GET(request: NextRequest) {\n  const { searchParams } = new URL(request.url)\n  const semester = searchParams.get('semester')\n  const type = searchParams.get('type') // 'mandatory' or 'voluntary'\n\n  try {\n    const items = await getFeeItems({\n      semester: semester || undefined,\n      type: (type as 'mandatory' | 'voluntary') || undefined\n    })\n\n    return NextResponse.json({\n      success: true,\n      data: items\n    })\n  } catch (error) {\n    return NextResponse.json(\n      {\n        success: false,\n        error: error instanceof Error ? error.message : 'Failed to fetch fee items'\n      },\n      { status: 500 }\n    )\n  }\n}\n\n// POST /api/fee-items - Create a new fee item (TODO: Not implemented in Supabase queries yet)\nexport async function POST(request: NextRequest) {\n  return NextResponse.json(\n    {\n      success: false,\n      error: 'Not implemented - use Supabase directly or implement fee item creation'\n    },\n    { status: 501 }\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\api\\grades\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2062,2065],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2062,2065],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2161,2164],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2161,2164],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2264,2267],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2264,2267],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2370,2373],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2370,2373],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2597,2600],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2597,2600],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2693,2696],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2693,2696],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2770,2773],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2770,2773],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":58,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2847,2850],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2847,2850],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":59,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2924,2927],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2924,2927],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":60,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3001,3004],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3001,3004],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\n\ninterface GradeRecord {\n  id: string\n  studentName: string\n  classId: string\n  subject: string\n  midterm: number\n  final: number\n  average: number\n  letterGrade: 'A' | 'B' | 'C' | 'D' | 'F'\n}\n\n// Mock data - Middle school grades 6-9 (THCS)\nconst mockGrades: GradeRecord[] = [\n  { id: '1', studentName: 'Nguyễn Văn An', classId: '6A1', subject: 'Toán', midterm: 8.5, final: 9.0, average: 8.8, letterGrade: 'A' },\n  { id: '2', studentName: 'Trần Thị Bình', classId: '6A1', subject: 'Toán', midterm: 7.5, final: 8.0, average: 7.8, letterGrade: 'B' },\n  { id: '3', studentName: 'Lê Văn Cường', classId: '6A1', subject: 'Toán', midterm: 6.5, final: 7.0, average: 6.8, letterGrade: 'C' },\n  { id: '4', studentName: 'Phạm Thị Dung', classId: '6A1', subject: 'Toán', midterm: 5.5, final: 6.0, average: 5.8, letterGrade: 'C' },\n  { id: '5', studentName: 'Hoàng Văn Em', classId: '6A2', subject: 'Toán', midterm: 9.0, final: 9.5, average: 9.3, letterGrade: 'A' },\n  { id: '6', studentName: 'Đỗ Thị Gái', classId: '6A2', subject: 'Toán', midterm: 8.0, final: 8.5, average: 8.3, letterGrade: 'A' },\n  { id: '7', studentName: 'Vũ Văn Hùng', classId: '6A2', subject: 'Toán', midterm: 4.5, final: 5.0, average: 4.8, letterGrade: 'D' },\n  { id: '8', studentName: 'Ngô Thị Hoa', classId: '6A3', subject: 'Toán', midterm: 3.5, final: 4.0, average: 3.8, letterGrade: 'F' },\n  { id: '9', studentName: 'Nguyễn Văn An', classId: '6A1', subject: 'Văn', midterm: 7.0, final: 7.5, average: 7.3, letterGrade: 'B' },\n  { id: '10', studentName: 'Trần Thị Bình', classId: '6A1', subject: 'Văn', midterm: 8.0, final: 8.5, average: 8.3, letterGrade: 'A' },\n]\n\nexport async function GET(request: Request) {\n  const { searchParams } = new URL(request.url)\n  const classId = searchParams.get('classId')\n  const subject = searchParams.get('subject')\n  const letterGrade = searchParams.get('letterGrade')\n  const search = searchParams.get('search')\n\n  let filteredGrades = [...mockGrades]\n\n  if (classId) {\n    filteredGrades = filteredGrades.filter((g: any) => g.classId === classId)\n  }\n  if (subject) {\n    filteredGrades = filteredGrades.filter((g: any) => g.subject === subject)\n  }\n  if (letterGrade) {\n    filteredGrades = filteredGrades.filter((g: any) => g.letterGrade === letterGrade)\n  }\n  if (search) {\n    filteredGrades = filteredGrades.filter((g: any) =>\n      g.studentName.toLowerCase().includes(search.toLowerCase())\n    )\n  }\n\n  // Calculate statistics\n  const stats = {\n    totalStudents: filteredGrades.length,\n    averageScore: filteredGrades.reduce((sum: number, g: any) => sum + g.average, 0) / filteredGrades.length || 0,\n    gradeA: filteredGrades.filter((g: any) => g.letterGrade === 'A').length,\n    gradeB: filteredGrades.filter((g: any) => g.letterGrade === 'B').length,\n    gradeC: filteredGrades.filter((g: any) => g.letterGrade === 'C').length,\n    gradeD: filteredGrades.filter((g: any) => g.letterGrade === 'D').length,\n    gradeF: filteredGrades.filter((g: any) => g.letterGrade === 'F').length,\n  }\n\n  return NextResponse.json({\n    success: true,\n    data: filteredGrades,\n    stats,\n    total: filteredGrades.length,\n  })\n}\n\nexport async function POST(request: Request) {\n  const body = await request.json()\n\n  // Validate classId is for grades 6-9\n  if (body.classId) {\n    const gradeMatch = body.classId.match(/^(\\d+)/)\n    if (gradeMatch) {\n      const grade = gradeMatch[1]\n      if (!['6', '7', '8', '9'].includes(grade)) {\n        return NextResponse.json({\n          success: false,\n          message: 'Khối lớp không hợp lệ (chỉ hỗ trợ lớp 6-9)',\n        }, { status: 400 })\n      }\n    }\n  }\n\n  // Calculate average and letter grade\n  const average = (body.midterm + body.final) / 2\n  let letterGrade: 'A' | 'B' | 'C' | 'D' | 'F' = 'F'\n  if (average >= 9) letterGrade = 'A'\n  else if (average >= 8) letterGrade = 'B'\n  else if (average >= 7) letterGrade = 'C'\n  else if (average >= 5) letterGrade = 'D'\n\n  const newGrade: GradeRecord = {\n    id: Date.now().toString(),\n    ...body,\n    average,\n    letterGrade,\n  }\n  mockGrades.push(newGrade)\n\n  return NextResponse.json({\n    success: true,\n    data: newGrade,\n    message: 'Điểm số đã được ghi nhận',\n  }, { status: 201 })\n}\n\nexport async function PATCH(request: Request) {\n  const body = await request.json()\n  const { id, midterm, final, ...updates } = body\n\n  const index = mockGrades.findIndex(g => g.id === id)\n  if (index === -1) {\n    return NextResponse.json({\n      success: false,\n      message: 'Không tìm thấy bản ghi điểm số',\n    }, { status: 404 })\n  }\n\n  // Recalculate average and letter grade\n  const avg = ((midterm ?? mockGrades[index].midterm) + (final ?? mockGrades[index].final)) / 2\n  let letterGrade: 'A' | 'B' | 'C' | 'D' | 'F' = 'F'\n  if (avg >= 9) letterGrade = 'A'\n  else if (avg >= 8) letterGrade = 'B'\n  else if (avg >= 7) letterGrade = 'C'\n  else if (avg >= 5) letterGrade = 'D'\n\n  mockGrades[index] = {\n    ...mockGrades[index],\n    ...updates,\n    ...(midterm !== undefined && { midterm }),\n    ...(final !== undefined && { final }),\n    average: avg,\n    letterGrade,\n  }\n\n  return NextResponse.json({\n    success: true,\n    data: mockGrades[index],\n    message: 'Cập nhật điểm số thành công',\n  })\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\api\\health\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\api\\invoices\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'notes' is assigned a value but never used.","line":45,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":45,"endColumn":36}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { getInvoices } from '@/lib/supabase/queries'\nimport type { Invoice } from '@/lib/types'\n\n// GET /api/invoices/[id] - Get a specific invoice\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params\n    const invoices = await getInvoices()\n    const invoice = invoices.find((inv: Invoice) => inv.id === id)\n\n    if (!invoice) {\n      return NextResponse.json(\n        { success: false, error: 'Invoice not found' },\n        { status: 404 }\n      )\n    }\n\n    return NextResponse.json({\n      success: true,\n      data: invoice\n    })\n  } catch (error) {\n    return NextResponse.json(\n      {\n        success: false,\n        error: error instanceof Error ? error.message : 'Failed to fetch invoice'\n      },\n      { status: 500 }\n    )\n  }\n}\n\n// PUT /api/invoices/[id] - Update invoice (e.g., confirm payment)\nexport async function PUT(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params\n    const body = await request.json()\n    const { status, paidDate, notes } = body\n\n    // Verify invoice exists\n    const invoices = await getInvoices()\n    const existingInvoice = invoices.find((inv: Invoice) => inv.id === id)\n\n    if (!existingInvoice) {\n      return NextResponse.json(\n        { success: false, error: 'Invoice not found' },\n        { status: 404 }\n      )\n    }\n\n    // Validation for status field\n    if (status && !['paid', 'pending', 'overdue'].includes(status)) {\n      return NextResponse.json(\n        { success: false, error: 'Invalid status (must be paid, pending, or overdue)' },\n        { status: 400 }\n      )\n    }\n\n    // If marking as paid, require paidDate\n    if (status === 'paid' && !paidDate) {\n      return NextResponse.json(\n        { success: false, error: 'paidDate is required when marking invoice as paid' },\n        { status: 400 }\n      )\n    }\n\n    // Mock update - in real implementation, update database\n    const updatedInvoice: Invoice = {\n      ...existingInvoice,\n      status: status || existingInvoice.status,\n      paidDate: status === 'paid' ? (paidDate || new Date().toISOString().split('T')[0]) : existingInvoice.paidDate\n    }\n\n    // In real implementation, save to database and log payment confirmation\n    return NextResponse.json({\n      success: true,\n      data: updatedInvoice,\n      message: status === 'paid' ? 'Payment confirmed successfully' : 'Invoice updated successfully'\n    })\n  } catch (error) {\n    return NextResponse.json(\n      {\n        success: false,\n        error: error instanceof Error ? error.message : 'Failed to update invoice'\n      },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\api\\invoices\\export\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":33,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[966,969],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[966,969],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1079,1082],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1079,1082],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1265,1268],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1265,1268],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1381,1384],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1381,1384],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1426,1429],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1426,1429],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":79,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2362,2365],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2362,2365],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { getInvoices } from '@/lib/supabase/queries'\n\n// Export format options\ntype ExportFormat = 'csv' | 'json' | 'pdf'\n\n// POST /api/invoices/export - Export invoices report\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json()\n    const {\n      format = 'csv',\n      startDate,\n      endDate,\n      status,\n      include = ['id', 'studentName', 'amount', 'status', 'dueDate', 'paidDate']\n    } = body\n\n    // Validate format\n    const validFormats: ExportFormat[] = ['csv', 'json', 'pdf']\n    if (!validFormats.includes(format)) {\n      return NextResponse.json(\n        { success: false, error: 'Invalid format (must be csv, json, or pdf)' },\n        { status: 400 }\n      )\n    }\n\n    // Get invoices\n    let invoices = await getInvoices()\n\n    // Filter by date range (handle null/undefined dueDate)\n    if (startDate) {\n      invoices = invoices.filter((inv: any) => inv.dueDate && inv.dueDate >= startDate)\n    }\n    if (endDate) {\n      invoices = invoices.filter((inv: any) => inv.dueDate && inv.dueDate <= endDate)\n    }\n\n    // Filter by status\n    if (status && ['paid', 'pending', 'overdue'].includes(status)) {\n      invoices = invoices.filter((inv: any) => inv.status === status)\n    }\n\n    // Filter included fields\n    const filteredInvoices = invoices.map((inv: any) => {\n      const result: Record<string, any> = {}\n      include.forEach((field: string) => {\n        if (field in inv) {\n          result[field] = inv[field as keyof typeof inv]\n        }\n      })\n      return result\n    })\n\n    // TODO: Real API - Generate actual file\n    // For PDF: Use a library like jsPDF or PDFKit\n    // For CSV: Generate proper CSV with headers\n\n    let content: string\n    let contentType: string\n    let filename: string\n\n    const timestamp = new Date().toISOString().split('T')[0]\n\n    switch (format) {\n      case 'json':\n        content = JSON.stringify({\n          generatedAt: new Date().toISOString(),\n          totalRecords: filteredInvoices.length,\n          data: filteredInvoices\n        }, null, 2)\n        contentType = 'application/json'\n        filename = `invoices-${timestamp}.json`\n        break\n\n      case 'csv': {\n        // Generate CSV\n        const headers = include.join(',')\n        const rows = filteredInvoices.map((inv: any) =>\n          include.map((field: string) => {\n            const value = inv[field as keyof typeof inv]\n            // Escape quotes and wrap in quotes if contains comma\n            const stringValue = String(value ?? '')\n            if (stringValue.includes(',') || stringValue.includes('\"')) {\n              return `\"${stringValue.replace(/\"/g, '\"\"')}\"`\n            }\n            return stringValue\n          }).join(',')\n        )\n        content = [headers, ...rows].join('\\n')\n        contentType = 'text/csv'\n        filename = `invoices-${timestamp}.csv`\n        break\n      }\n\n      case 'pdf':\n        // For PDF, we'd need a PDF library\n        // TODO: Implement PDF generation with jsPDF or similar\n        return NextResponse.json(\n          {\n            success: false,\n            error: 'PDF export not yet implemented',\n            data: filteredInvoices // Return data so client can generate PDF\n          },\n          { status: 501 }\n        )\n\n      default:\n        return NextResponse.json(\n          { success: false, error: 'Unsupported format' },\n          { status: 400 }\n        )\n    }\n\n    // Return file download response\n    return new NextResponse(content, {\n      status: 200,\n      headers: {\n        'Content-Type': contentType,\n        'Content-Disposition': `attachment; filename=\"${filename}\"`,\n        'Content-Length': Buffer.byteLength(content).toString()\n      }\n    })\n\n  } catch (error) {\n    return NextResponse.json(\n      {\n        success: false,\n        error: error instanceof Error ? error.message : 'Failed to export invoices'\n      },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\api\\invoices\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[968,971],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[968,971],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1014,1017],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1014,1017],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { getInvoices, getPaymentStats, type Invoice } from '@/lib/supabase/queries'\n\n// GET /api/invoices - List invoices with filters\nexport async function GET(request: NextRequest) {\n  const { searchParams } = new URL(request.url)\n  const status = searchParams.get('status')\n  const classId = searchParams.get('class')\n  const search = searchParams.get('search')\n  const page = parseInt(searchParams.get('page') || '1')\n  const limit = parseInt(searchParams.get('limit') || '50')\n\n  try {\n    let invoices = await getInvoices()\n\n    // Filter by status\n    if (status && ['paid', 'pending', 'overdue'].includes(status)) {\n      invoices = invoices.filter((inv: Invoice) => inv.status === status)\n    }\n\n    // Filter by class (student grade field)\n    if (classId) {\n      const students = await (await import('@/lib/supabase/queries')).getStudents()\n      const classStudentIds = students\n        .filter((s: any) => s.grade === classId)\n        .map((s: any) => s.id)\n      invoices = invoices.filter((inv: Invoice) => classStudentIds.includes(inv.studentId))\n    }\n\n    // Search by student name or invoice ID\n    if (search) {\n      const searchLower = search.toLowerCase()\n      invoices = invoices.filter((inv: Invoice) =>\n        inv.studentName.toLowerCase().includes(searchLower) ||\n        inv.id.toLowerCase().includes(searchLower)\n      )\n    }\n\n    // Pagination\n    const startIndex = (page - 1) * limit\n    const endIndex = startIndex + limit\n    const paginatedInvoices = invoices.slice(startIndex, endIndex)\n\n    // Get stats\n    const stats = await getPaymentStats()\n\n    return NextResponse.json({\n      success: true,\n      data: paginatedInvoices,\n      stats,\n      pagination: {\n        page,\n        limit,\n        total: invoices.length,\n        totalPages: Math.ceil(invoices.length / limit)\n      }\n    })\n  } catch (error) {\n    return NextResponse.json(\n      {\n        success: false,\n        error: error instanceof Error ? error.message : 'Failed to fetch invoices'\n      },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\api\\notifications\\my\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":30,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[804,807],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[804,807],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":79,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1924,1927],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1924,1927],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * My Notifications API Routes\n * GET /api/notifications/my - Get current user's notifications\n * PATCH /api/notifications/my - Mark notifications as read\n */\n\nimport { NextResponse } from 'next/server';\nimport { requireAuth } from '@/lib/auth';\nimport {\n  getMyNotifications,\n  markAsRead,\n} from '@/lib/services/notification-service';\n\n/**\n * GET /api/notifications/my - Get current user's notifications\n */\nexport async function GET(request: Request) {\n  try {\n    const user = await requireAuth();\n\n    const { searchParams } = new URL(request.url);\n    const unreadOnly = searchParams.get('unreadOnly') === 'true';\n\n    const notifications = await getMyNotifications(user.id, unreadOnly);\n\n    return NextResponse.json({\n      success: true,\n      data: notifications,\n    });\n  } catch (error: any) {\n    console.error('[API] GET /api/notifications/my error:', error);\n\n    return NextResponse.json(\n      {\n        success: false,\n        message: error.message || 'Failed to fetch notifications',\n      },\n      { status: error.status || 500 }\n    );\n  }\n}\n\n/**\n * PATCH /api/notifications/my - Mark notifications as read\n */\nexport async function PATCH(request: Request) {\n  try {\n    const user = await requireAuth();\n\n    const body = await request.json();\n    const { notificationIds } = body;\n\n    if (!Array.isArray(notificationIds)) {\n      return NextResponse.json(\n        {\n          success: false,\n          message: 'notificationIds must be an array',\n        },\n        { status: 400 }\n      );\n    }\n\n    if (notificationIds.length === 0) {\n      return NextResponse.json(\n        {\n          success: false,\n          message: 'At least one notification ID is required',\n        },\n        { status: 400 }\n      );\n    }\n\n    await markAsRead(notificationIds, user.id);\n\n    return NextResponse.json({\n      success: true,\n      message: 'Notifications marked as read',\n    });\n  } catch (error: any) {\n    console.error('[API] PATCH /api/notifications/my error:', error);\n\n    return NextResponse.json(\n      {\n        success: false,\n        message: error.message || 'Failed to mark notifications as read',\n      },\n      { status: error.status || 500 }\n    );\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\api\\notifications\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used.","line":21,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1043,1046],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1043,1046],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":99,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2507,2510],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2507,2510],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used.","line":117,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":117,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":148,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":148,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3674,3677],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3674,3677],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Notification API Routes (Admin)\n * GET /api/notifications - List all notifications (admin only)\n * POST /api/notifications - Create new notification (admin only)\n * DELETE /api/notifications?id={id} - Delete notification (admin only)\n */\n\nimport { NextResponse } from 'next/server';\nimport { requireRole } from '@/lib/auth';\nimport {\n  createNotification,\n  getNotifications,\n} from '@/lib/services/notification-service';\nimport { createClient } from '@/lib/supabase/server';\n\n/**\n * GET /api/notifications - List notifications (admin only)\n */\nexport async function GET(request: Request) {\n  try {\n    const user = await requireRole('admin');\n\n    const { searchParams } = new URL(request.url);\n    const page = parseInt(searchParams.get('page') || '1');\n    const limit = parseInt(searchParams.get('limit') || '20');\n\n    const result = await getNotifications({ page, limit });\n\n    return NextResponse.json({\n      success: true,\n      data: result.data,\n      total: result.total,\n      page,\n      limit,\n    });\n  } catch (error: any) {\n    console.error('[API] GET /api/notifications error:', error);\n\n    return NextResponse.json(\n      {\n        success: false,\n        message: error.message || 'Failed to fetch notifications',\n      },\n      { status: error.status || 500 }\n    );\n  }\n}\n\n/**\n * POST /api/notifications - Create notification (admin only)\n */\nexport async function POST(request: Request) {\n  try {\n    const user = await requireRole('admin');\n\n    const body = await request.json();\n\n    // Validate required fields\n    if (!body.title?.trim() || !body.content?.trim()) {\n      return NextResponse.json(\n        {\n          success: false,\n          message: 'Title and content are required',\n        },\n        { status: 400 }\n      );\n    }\n\n    if (!body.category) {\n      return NextResponse.json(\n        {\n          success: false,\n          message: 'Category is required (announcement, emergency, reminder, system)',\n        },\n        { status: 400 }\n      );\n    }\n\n    if (!body.targetRole) {\n      return NextResponse.json(\n        {\n          success: false,\n          message: 'Target role is required (admin, teacher, parent, student, all)',\n        },\n        { status: 400 }\n      );\n    }\n\n    const notification = await createNotification(body, user.id);\n\n    return NextResponse.json(\n      {\n        success: true,\n        data: notification,\n        message: 'Notification created successfully',\n      },\n      { status: 201 }\n    );\n  } catch (error: any) {\n    console.error('[API] POST /api/notifications error:', error);\n\n    return NextResponse.json(\n      {\n        success: false,\n        message: error.message || 'Failed to create notification',\n      },\n      { status: error.status || 500 }\n    );\n  }\n}\n\n/**\n * DELETE /api/notifications?id={id} - Delete notification (admin only)\n */\nexport async function DELETE(request: Request) {\n  try {\n    const user = await requireRole('admin');\n\n    const { searchParams } = new URL(request.url);\n    const id = searchParams.get('id');\n\n    if (!id) {\n      return NextResponse.json(\n        {\n          success: false,\n          message: 'Notification ID is required',\n        },\n        { status: 400 }\n      );\n    }\n\n    const supabase = await createClient();\n\n    // Delete notification (cascade will delete recipients and logs)\n    const { error } = await supabase\n      .from('notifications')\n      .delete()\n      .eq('id', id);\n\n    if (error) {\n      throw new Error(`Failed to delete notification: ${error.message}`);\n    }\n\n    return NextResponse.json({\n      success: true,\n      message: 'Notification deleted successfully',\n    });\n  } catch (error: any) {\n    console.error('[API] DELETE /api/notifications error:', error);\n\n    return NextResponse.json(\n      {\n        success: false,\n        message: error.message || 'Failed to delete notification',\n      },\n      { status: error.status || 500 }\n    );\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\api\\payments\\[id]\\confirm\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getCurrentUser' is defined but never used.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'checkRateLimit' is defined but never used.","line":2,"column":41,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":55}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { getCurrentUser, sanitizeInput, checkRateLimit } from '@/lib/security-utils'\n\n// Payment interface\ninterface Payment {\n  id: string\n  studentId: string\n  studentName: string\n  amount: number\n  status: 'paid' | 'pending' | 'overdue'\n  dueDate: string\n  paidDate?: string\n  method?: string\n  note?: string\n}\n\n// Mock payment data (in real app, fetch from database)\nconst mockPayments: Payment[] = [\n  {\n    id: 'PAY-001',\n    studentId: '1',\n    studentName: 'Nguyễn Văn An',\n    amount: 2500000,\n    status: 'pending',\n    dueDate: '2025-10-15'\n  },\n  {\n    id: 'PAY-002',\n    studentId: '2',\n    studentName: 'Trần Thị Bình',\n    amount: 2500000,\n    status: 'paid',\n    dueDate: '2025-10-15',\n    paidDate: '2025-10-12',\n    method: 'transfer'\n  },\n  {\n    id: 'PAY-003',\n    studentId: '3',\n    studentName: 'Lê Văn Cường',\n    amount: 2500000,\n    status: 'overdue',\n    dueDate: '2025-09-30'\n  }\n]\n\n// POST /api/payments/[id]/confirm - Confirm payment receipt\nexport async function POST(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  // TODO: Add real authentication middleware before production\n  // const { user } = await getCurrentUser(request)\n  // if (!user || user.role !== 'admin') {\n  //   return NextResponse.json(\n  //     { success: false, error: 'Unauthorized' },\n  //     { status: 401 }\n  //   )\n  // }\n\n  // TODO: Add real rate limiting before production\n  // const rateLimit = await checkRateLimit(request, { windowMs: 60000, maxRequests: 10 })\n  // if (!rateLimit.allowed) {\n  //   return NextResponse.json(\n  //     { error: rateLimit.error },\n  //     { status: 429 }\n  //   )\n  // }\n\n  try {\n    const { id } = await params\n    const body = await request.json()\n    const { amount, note, method = 'cash' } = body\n\n    // Validate amount\n    if (!amount || typeof amount !== 'number' || amount <= 0) {\n      return NextResponse.json(\n        { success: false, error: 'Invalid or missing amount' },\n        { status: 400 }\n      )\n    }\n\n    // Validate method\n    if (!['cash', 'transfer', 'card'].includes(method)) {\n      return NextResponse.json(\n        { success: false, error: 'Invalid payment method' },\n        { status: 400 }\n      )\n    }\n\n    // Find payment\n    const paymentIndex = mockPayments.findIndex(p => p.id === id)\n    if (paymentIndex === -1) {\n      return NextResponse.json(\n        { success: false, error: 'Payment not found' },\n        { status: 404 }\n      )\n    }\n\n    const payment = mockPayments[paymentIndex]\n\n    // Check if already paid\n    if (payment.status === 'paid') {\n      return NextResponse.json(\n        { success: false, error: 'Payment already confirmed' },\n        { status: 400 }\n      )\n    }\n\n    // Update payment status\n    const updatedPayment: Payment = {\n      ...payment,\n      status: 'paid',\n      paidDate: new Date().toISOString().split('T')[0],\n      amount: amount || payment.amount,\n      method,\n      note: note ? sanitizeInput(note) : ''\n    }\n\n    mockPayments[paymentIndex] = updatedPayment\n\n    // TODO: Real API - Save to database and update invoice status\n\n    return NextResponse.json({\n      success: true,\n      data: updatedPayment,\n      message: 'Xác nhận thanh toán thành công'\n    })\n  } catch (error) {\n    return NextResponse.json(\n      {\n        success: false,\n        error: error instanceof Error ? error.message : 'Failed to confirm payment'\n      },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\api\\payments\\[id]\\reminder\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getCurrentUser' is defined but never used.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'checkRateLimit' is defined but never used.","line":2,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":40}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { getCurrentUser, checkRateLimit } from '@/lib/security-utils'\n\n// Payment interface\ninterface Payment {\n  id: string\n  studentId: string\n  studentName: string\n  amount: number\n  status: 'paid' | 'pending' | 'overdue'\n  dueDate: string\n  paidDate?: string\n  parentEmail?: string\n  parentPhone?: string\n}\n\n// Mock payment data\nconst mockPayments: Payment[] = [\n  {\n    id: 'PAY-001',\n    studentId: '1',\n    studentName: 'Nguyễn Văn An',\n    amount: 2500000,\n    status: 'pending',\n    dueDate: '2025-10-15',\n    parentEmail: 'parent1@school.vn',\n    parentPhone: '0901234567'\n  },\n  {\n    id: 'PAY-002',\n    studentId: '2',\n    studentName: 'Trần Thị Bình',\n    amount: 2500000,\n    status: 'paid',\n    dueDate: '2025-10-15',\n    paidDate: '2025-10-12'\n  },\n  {\n    id: 'PAY-003',\n    studentId: '3',\n    studentName: 'Lê Văn Cường',\n    amount: 2500000,\n    status: 'overdue',\n    dueDate: '2025-09-30',\n    parentEmail: 'parent3@school.vn',\n    parentPhone: '0909876543'\n  }\n]\n\n// POST /api/payments/[id]/reminder - Send payment reminder\nexport async function POST(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  // TODO: Add real authentication middleware before production\n  // const { user } = await getCurrentUser(request)\n  // if (!user || user.role !== 'admin') {\n  //   return NextResponse.json(\n  //     { success: false, error: 'Unauthorized' },\n  //     { status: 401 }\n  //   )\n  // }\n\n  // TODO: Add real rate limiting before production\n  // const rateLimit = await checkRateLimit(request, { windowMs: 60000, maxRequests: 10 })\n  // if (!rateLimit.allowed) {\n  //   return NextResponse.json(\n  //     { error: rateLimit.error },\n  //     { status: 429 }\n  //   )\n  // }\n\n  try {\n    const { id } = await params\n    const body = await request.json()\n    const { method = 'email' } = body // 'email', 'sms', or 'both'\n\n    // Validate method\n    if (!['email', 'sms', 'both'].includes(method)) {\n      return NextResponse.json(\n        { success: false, error: 'Invalid reminder method (must be email, sms, or both)' },\n        { status: 400 }\n      )\n    }\n\n    // Find payment\n    const payment = mockPayments.find(p => p.id === id)\n    if (!payment) {\n      return NextResponse.json(\n        { success: false, error: 'Payment not found' },\n        { status: 404 }\n      )\n    }\n\n    // Check if already paid\n    if (payment.status === 'paid') {\n      return NextResponse.json(\n        { success: false, error: 'Payment already paid, no reminder needed' },\n        { status: 400 }\n      )\n    }\n\n    // Prepare reminder details\n    const reminderDetails = {\n      paymentId: payment.id,\n      studentName: payment.studentName,\n      amount: payment.amount,\n      dueDate: payment.dueDate,\n      status: payment.status,\n      method,\n      sentAt: new Date().toISOString()\n    }\n\n    // TODO: Real API - Send actual email/SMS\n    // Email template would include:\n    // - Student name\n    // - Amount due\n    // - Due date\n    // - Payment methods\n    // - Contact info\n\n    // TODO: Real API - Log reminder in database\n    const reminderLog = {\n      id: `reminder-${Date.now()}`,\n      ...reminderDetails,\n      // In production, store parent contact info securely\n      recipientEmail: method === 'email' || method === 'both' ? payment.parentEmail : undefined,\n      recipientPhone: method === 'sms' || method === 'both' ? payment.parentPhone : undefined\n    }\n\n    return NextResponse.json({\n      success: true,\n      data: reminderLog,\n      message: method === 'both'\n        ? 'Đã gửi nhắc nhở qua email và SMS'\n        : method === 'email'\n        ? 'Đã gửi nhắc nhở qua email'\n        : 'Đã gửi nhắc nhở qua SMS'\n    })\n  } catch (error) {\n    return NextResponse.json(\n      {\n        success: false,\n        error: error instanceof Error ? error.message : 'Failed to send reminder'\n      },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\api\\payments\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1419,1422],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1419,1422],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":70,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1519,1522],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1519,1522],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":77,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1751,1754],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1751,1754],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":79,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1837,1840],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1837,1840],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":80,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1895,1898],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1895,1898],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":86,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2122,2125],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2122,2125],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":87,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2208,2211],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2208,2211],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\nimport type { Invoice } from '@/lib/types'\n\n// Mock data\nconst mockInvoices: Invoice[] = [\n  {\n    id: 'INV-001',\n    studentId: '1',\n    studentName: 'Nguyễn Văn An',\n    amount: 5000000,\n    status: 'paid',\n    dueDate: '15/01/2026',\n    paidDate: '10/01/2026',\n  },\n  {\n    id: 'INV-002',\n    studentId: '2',\n    studentName: 'Trần Thị Bình',\n    amount: 5000000,\n    status: 'paid',\n    dueDate: '15/01/2026',\n    paidDate: '12/01/2026',\n  },\n  {\n    id: 'INV-003',\n    studentId: '3',\n    studentName: 'Lê Văn Cường',\n    amount: 5000000,\n    status: 'pending',\n    dueDate: '20/01/2026',\n  },\n  {\n    id: 'INV-004',\n    studentId: '4',\n    studentName: 'Phạm Thị Dung',\n    amount: 5000000,\n    status: 'overdue',\n    dueDate: '10/01/2026',\n  },\n  {\n    id: 'INV-005',\n    studentId: '5',\n    studentName: 'Hoàng Văn Em',\n    amount: 5000000,\n    status: 'paid',\n    dueDate: '15/01/2026',\n    paidDate: '08/01/2026',\n  },\n  {\n    id: 'INV-006',\n    studentId: '6',\n    studentName: 'Đỗ Thị Gái',\n    amount: 5000000,\n    status: 'pending',\n    dueDate: '25/01/2026',\n  },\n]\n\nexport async function GET(request: Request) {\n  const { searchParams } = new URL(request.url)\n  const status = searchParams.get('status')\n  const search = searchParams.get('search')\n\n  let filteredInvoices = [...mockInvoices]\n\n  if (status) {\n    filteredInvoices = filteredInvoices.filter((i: any) => i.status === status)\n  }\n  if (search) {\n    filteredInvoices = filteredInvoices.filter((i: any) =>\n      i.studentName.toLowerCase().includes(search.toLowerCase()) ||\n      i.id.toLowerCase().includes(search.toLowerCase())\n    )\n  }\n\n  // Calculate statistics\n  const totalAmount = filteredInvoices.reduce((sum: number, i: any) => sum + i.amount, 0)\n  const collectedAmount = filteredInvoices\n    .filter((i: any) => i.status === 'paid')\n    .reduce((sum: number, i: any) => sum + i.amount, 0)\n  const collectionRate = totalAmount > 0 ? Math.round((collectedAmount / totalAmount) * 100) : 0\n\n  const stats = {\n    totalAmount,\n    collectedAmount,\n    pendingCount: filteredInvoices.filter((i: any) => i.status === 'pending').length,\n    overdueCount: filteredInvoices.filter((i: any) => i.status === 'overdue').length,\n    collectionRate,\n  }\n\n  return NextResponse.json({\n    success: true,\n    data: filteredInvoices,\n    stats,\n    total: filteredInvoices.length,\n  })\n}\n\nexport async function POST(request: Request) {\n  const body = await request.json()\n  const newInvoice: Invoice = {\n    id: `INV-${Date.now().toString().slice(-6)}`,\n    ...body,\n    status: 'pending',\n  }\n  mockInvoices.push(newInvoice)\n\n  return NextResponse.json({\n    success: true,\n    data: newInvoice,\n    message: 'Hóa đơn đã được tạo thành công',\n  }, { status: 201 })\n}\n\nexport async function PATCH(request: Request) {\n  const body = await request.json()\n  const { id, ...updates } = body\n\n  const index = mockInvoices.findIndex(i => i.id === id)\n  if (index === -1) {\n    return NextResponse.json({\n      success: false,\n      message: 'Không tìm thấy hóa đơn',\n    }, { status: 404 })\n  }\n\n  mockInvoices[index] = { ...mockInvoices[index], ...updates }\n\n  return NextResponse.json({\n    success: true,\n    data: mockInvoices[index],\n    message: 'Cập nhật hóa đơn thành công',\n  })\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\api\\payments\\stats\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'request' is defined but never used. Allowed unused args must match /^_/u.","line":5,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":34}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { getPaymentStats } from '@/lib/supabase/queries'\n\n// GET /api/payments/stats - Get payment statistics\nexport async function GET(request: NextRequest) {\n  try {\n    const stats = await getPaymentStats()\n\n    return NextResponse.json({\n      success: true,\n      data: stats\n    })\n  } catch (error) {\n    return NextResponse.json(\n      {\n        success: false,\n        error: error instanceof Error ? error.message : 'Failed to fetch payment statistics'\n      },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\api\\student-guardians\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1491,1494],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1491,1494],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":91,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2492,2495],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2492,2495],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'relationship' is assigned a value but never used.","line":119,"column":34,"nodeType":null,"messageId":"unusedVar","endLine":119,"endColumn":46},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":131,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3579,3582],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3579,3582],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":147,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":147,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4019,4022],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4019,4022],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":154,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":154,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4210,4213],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4210,4213],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":197,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":197,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5379,5382],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5379,5382],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\nimport { createClient } from '@/lib/supabase/server'\n\ntype ParentResult = {\n  id: string\n  name: string\n  code: string\n  phone: string\n  email: string\n}\n\ntype StudentResult = {\n  id: string\n  name: string\n  code: string\n  classId: string\n  grade: string\n  section: string\n}\n\n/**\n * GET /api/student-guardians\n * - Search parents (when ?search=...&type=parents)\n * - Search students (when ?search=...&type=students)\n */\nexport async function GET(request: Request) {\n  try {\n    const supabase = await createClient()\n    const { searchParams } = new URL(request.url)\n    const search = searchParams.get('search') || ''\n    const type = searchParams.get('type') || 'parents' // 'parents' or 'students'\n\n    if (!search || search.length < 2) {\n      return NextResponse.json({\n        success: true,\n        data: [],\n      })\n    }\n\n    if (type === 'parents') {\n      // Search parents by name, phone, or email\n      const { data, error } = await supabase\n        .from('profiles')\n        .select('id, full_name, email, phone, role')\n        .eq('role', 'parent')\n        .eq('status', 'active')\n        .or(`full_name.ilike.%${search}%,phone.ilike.%${search}%,email.ilike.%${search}%`)\n        .limit(10)\n\n      if (error) {\n        console.error('[API] Error searching parents:', error)\n        return NextResponse.json({ success: false, error: error.message }, { status: 400 })\n      }\n\n      const results: ParentResult[] = (data || []).map((p: any) => ({\n        id: p.id,\n        name: p.full_name,\n        code: p.id.slice(0, 10),\n        phone: p.phone || '',\n        email: p.email,\n      }))\n\n      return NextResponse.json({\n        success: true,\n        data: results,\n      })\n    } else {\n      // Search students by name, student_code, or class\n      const { data, error } = await supabase\n        .from('students')\n        .select(`\n          id,\n          student_code,\n          grade,\n          section,\n          class_id,\n          profiles!inner(\n            full_name,\n            status\n          )\n        `)\n        .eq('profiles.status', 'active')\n        .or(`student_code.ilike.%${search}%,profiles.full_name.ilike.%${search}%,class_id.ilike.%${search}%`)\n        .limit(10)\n\n      if (error) {\n        console.error('[API] Error searching students:', error)\n        return NextResponse.json({ success: false, error: error.message }, { status: 400 })\n      }\n\n      const results: StudentResult[] = (data || []).map((s: any) => ({\n        id: s.id,\n        name: s.profiles.full_name,\n        code: s.student_code,\n        classId: s.class_id,\n        grade: s.grade,\n        section: s.section,\n      }))\n\n      return NextResponse.json({\n        success: true,\n        data: results,\n      })\n    }\n  } catch (error) {\n    console.error('[API] Unexpected error:', error)\n    return NextResponse.json({ success: false, error: 'Internal server error' }, { status: 500 })\n  }\n}\n\n/**\n * POST /api/student-guardians\n * Create a parent-student link in student_guardians table\n */\nexport async function POST(request: Request) {\n  try {\n    const supabase = await createClient()\n    const body = await request.json()\n    const { studentId, parentId, relationship, isPrimary } = body\n\n    // Validate required fields\n    if (!studentId || !parentId) {\n      return NextResponse.json({\n        success: false,\n        error: 'studentId and parentId are required'\n      }, { status: 400 })\n    }\n\n    // Check if link already exists\n    const { data: existing } = await (supabase\n      .from('student_guardians') as any)\n      .select('*')\n      .eq('student_id', studentId)\n      .eq('guardian_id', parentId)\n      .maybeSingle()\n\n    if (existing) {\n      return NextResponse.json({\n        success: false,\n        error: 'Liên kết này đã tồn tại'\n      }, { status: 400 })\n    }\n\n    // If this is being set as primary, unmark other primary relationships for this student\n    if (isPrimary) {\n      await (supabase\n        .from('student_guardians') as any)\n        .update({ is_primary: false })\n        .eq('student_id', studentId)\n    }\n\n    // Create the link\n    const { data, error } = await (supabase\n      .from('student_guardians') as any)\n      .insert({\n        student_id: studentId,\n        guardian_id: parentId,\n        is_primary: isPrimary || false,\n      })\n      .select()\n      .single()\n\n    if (error) {\n      console.error('[API] Error creating link:', error)\n      return NextResponse.json({ success: false, error: error.message }, { status: 400 })\n    }\n\n    return NextResponse.json({\n      success: true,\n      data,\n    })\n  } catch (error) {\n    console.error('[API] Unexpected error:', error)\n    return NextResponse.json({ success: false, error: 'Internal server error' }, { status: 500 })\n  }\n}\n\n/**\n * DELETE /api/student-guardians\n * Delete a parent-student link\n */\nexport async function DELETE(request: Request) {\n  try {\n    const supabase = await createClient()\n    const { searchParams } = new URL(request.url)\n    const studentId = searchParams.get('studentId')\n    const guardianId = searchParams.get('guardianId')\n\n    if (!studentId || !guardianId) {\n      return NextResponse.json({\n        success: false,\n        error: 'studentId and guardianId are required'\n      }, { status: 400 })\n    }\n\n    const { error } = await (supabase\n      .from('student_guardians') as any)\n      .delete()\n      .eq('student_id', studentId)\n      .eq('guardian_id', guardianId)\n\n    if (error) {\n      console.error('[API] Error deleting link:', error)\n      return NextResponse.json({ success: false, error: error.message }, { status: 400 })\n    }\n\n    return NextResponse.json({\n      success: true,\n    })\n  } catch (error) {\n    console.error('[API] Unexpected error:', error)\n    return NextResponse.json({ success: false, error: 'Internal server error' }, { status: 500 })\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\api\\teacher\\assessments\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[618,621],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[618,621],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[710,713],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[710,713],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\nimport { getRegularAssessments } from '@/lib/supabase/queries'\n\nexport async function GET(request: Request) {\n  const { searchParams } = new URL(request.url)\n  const teacherId = searchParams.get('teacherId') || undefined\n  const classId = searchParams.get('classId') || undefined\n  const status = searchParams.get('status') as 'evaluated' | 'pending' | 'needs-attention' | undefined\n\n  // Filter assessments based on query params (done client-side for now)\n  let assessments = await getRegularAssessments(teacherId)\n\n  if (classId) {\n    assessments = assessments.filter((a: any) => a.classId === classId)\n  }\n  if (status) {\n    assessments = assessments.filter((a: any) => a.status === status)\n  }\n\n  return NextResponse.json({\n    success: true,\n    data: assessments,\n  })\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\api\\teacher\\classes\\[classId]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getStudentsByClass' is defined but never used.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\nimport { getStudentsByClass, getClassManagementData } from '@/lib/supabase/queries'\n\nexport async function GET(\n  request: Request,\n  { params }: { params: Promise<{ classId: string }> }\n) {\n  const { classId } = await params\n  const classData = await getClassManagementData(classId)\n\n  return NextResponse.json({\n    success: true,\n    data: classData,\n  })\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\api\\teacher\\classes\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[423,426],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[423,426],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\nimport { getTeacherClasses } from '@/lib/supabase/queries'\n\nexport async function GET(request: Request) {\n  const { searchParams } = new URL(request.url)\n  const teacherId = searchParams.get('teacherId') || undefined\n\n  const classes = await getTeacherClasses(teacherId)\n\n  // Validate that all classes are for grades 6-9 (middle school)\n  const validClasses = classes.filter((c: any) =>\n    ['6', '7', '8', '9'].includes(c.grade)\n  )\n\n  return NextResponse.json({\n    success: true,\n    data: validClasses,\n  })\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\api\\teacher\\dashboard\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[551,554],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[551,554],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":31,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1549,1552],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1549,1552],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1723,1726],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1723,1726],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1815,1818],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1815,1818],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":37,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1906,1909],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1906,1909],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2006,2009],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2006,2009],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\nimport { getTeacherStats, getLeaveRequests, getTeacherSchedule, getRegularAssessments, getTeacherClasses, getGradeReviewRequests } from '@/lib/supabase/queries'\n\nexport async function GET(request: Request) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const teacherId = searchParams.get('teacherId') || undefined\n\n    // Get classes first to find homeroom class\n    const teacherClasses = await getTeacherClasses(teacherId).catch(() => [])\n    const homeroomClass = teacherClasses.find((c: any) => c.isHomeroom)\n    const homeroomClassId = homeroomClass?.id || '6A1'  // Dynamic fallback to grade 6\n\n    const [stats, gradeReviews, leaveRequests, schedule, assessments, classes] = await Promise.all([\n      getTeacherStats(teacherId || '').catch(() => ({ teaching: 0, homeroom: 0, students: 0, pendingAttendance: 0, pendingGrades: 0, gradeReviewRequests: 0, leaveRequests: 0, todaySchedule: [] })),\n      getGradeReviewRequests(teacherId || '').catch(() => []),\n      getLeaveRequests(homeroomClassId).catch(() => []),  // Use dynamic classId\n      getTeacherSchedule(teacherId || '').catch(() => []),\n      getRegularAssessments(teacherId || '').catch(() => []),\n      Promise.resolve(teacherClasses),\n    ])\n\n    return NextResponse.json({\n      success: true,\n      data: {\n        stats: {\n          ...stats,\n          homeroomClassId,  // Dynamic class ID (6A1, 7A1, etc.)\n        },\n        gradeReviews: gradeReviews || [],\n        leaveRequests: (leaveRequests || []).filter((r: any) => r.status === 'pending'),\n        schedule: schedule || [],\n        classes: classes || [],\n        assessments: {\n          evaluated: (assessments || []).filter((a: any) => a.status === 'evaluated').length,\n          pending: (assessments || []).filter((a: any) => a.status === 'pending').length,\n          positive: (assessments || []).filter((a: any) => a.rating && a.rating >= 4).length,\n          needsAttention: (assessments || []).filter((a: any) => a.status === 'needs-attention').length,\n        },\n      },\n    })\n  } catch (error) {\n    console.error('Dashboard API error:', error)\n    return NextResponse.json({\n      success: false,\n      error: 'Failed to load dashboard data',\n      data: {\n        stats: { teaching: 0, homeroom: 0, students: 0, pendingAttendance: 0, pendingGrades: 0, gradeReviewRequests: 0, leaveRequests: 0, todaySchedule: [] },\n        gradeReviews: [],\n        leaveRequests: [],\n        classes: [],\n        schedule: [],\n        assessments: { evaluated: 0, pending: 0, positive: 0, needsAttention: 0 },\n      },\n    }, { status: 500 })\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\api\\teacher\\homeroom\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getStudentsByClass' is defined but never used.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\nimport { getStudentsByClass, getHomeroomClassData } from '@/lib/supabase/queries'\n\nexport async function GET(request: Request) {\n  const { searchParams } = new URL(request.url)\n  const classId = searchParams.get('classId') || '6A1'\n\n  const homeroomData = await getHomeroomClassData(classId)\n\n  return NextResponse.json({\n    success: true,\n    data: homeroomData,\n  })\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\api\\teacher\\leave-requests\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getLeaveRequests' is defined but never used.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'classId' is assigned a value but never used.","line":6,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":16},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[509,512],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[509,512],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\nimport { getLeaveRequests, getLeaveApprovalRequests } from '@/lib/supabase/queries'\n\nexport async function GET(request: Request) {\n  const { searchParams } = new URL(request.url)\n  const classId = searchParams.get('classId') || '10A1'\n  const status = searchParams.get('status') as 'pending' | 'approved' | 'rejected' | undefined\n\n  const requests = await getLeaveApprovalRequests()\n\n  // Filter by status if provided\n  const filtered = status ? requests.filter((r: any) => r.status === status) : requests\n\n  return NextResponse.json({\n    success: true,\n    data: filtered,\n  })\n}\n\nexport async function POST(request: Request) {\n  const body = await request.json()\n  const { requestId, action } = body // action: 'approve' | 'reject'\n\n  // In real implementation, this would update the database\n  // For now, just return success\n  return NextResponse.json({\n    success: true,\n    message: action === 'approve' ? 'Đơn đã được phê duyệt' : 'Đơn đã bị từ chối',\n    data: { requestId, action, status: action === 'approve' ? 'approved' : 'rejected' },\n  })\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\api\\teacher\\schedule\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\api\\user\\sessions\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":50,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1283,1286],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1283,1286],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":119,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3119,3122],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3119,3122],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * User Sessions API\n * GET /api/user/sessions - Get user's active sessions\n * DELETE /api/user/sessions - Terminate specific session\n */\n\nimport { NextResponse } from 'next/server'\nimport { requireAuth } from '@/lib/auth'\nimport { createClient } from '@/lib/supabase/server'\n\ninterface Session {\n  id: string\n  user_id: string\n  session_token: string\n  is_active: boolean\n  last_active: string\n  created_at: string\n  device_type?: 'web' | 'mobile_ios' | 'mobile_android' | 'desktop'\n  device_id?: string\n  user_agent?: string\n  ip_address?: string\n  terminated_at?: string\n  termination_reason?: 'new_login' | 'timeout' | 'manual' | 'admin'\n}\n\n// GET /api/user/sessions - Get user's active sessions\nexport async function GET() {\n  try {\n    const user = await requireAuth()\n    const supabase = await createClient()\n\n    const { data: sessions, error } = await supabase\n      .from('user_sessions')\n      .select('*')\n      .eq('user_id', user.id)\n      .order('last_active', { ascending: false })\n      .limit(10)\n\n    if (error) {\n      return NextResponse.json({\n        success: false,\n        message: 'Failed to fetch sessions'\n      }, { status: 500 })\n    }\n\n    return NextResponse.json({\n      success: true,\n      data: sessions as Session[]\n    })\n  } catch (error: any) {\n    return NextResponse.json({\n      success: false,\n      message: error.message || 'Authentication required'\n    }, { status: error.status || 401 })\n  }\n}\n\n// DELETE /api/user/sessions - Terminate specific session\nexport async function DELETE(request: Request) {\n  try {\n    const user = await requireAuth()\n    const { searchParams } = new URL(request.url)\n    const sessionId = searchParams.get('id')\n\n    if (!sessionId) {\n      return NextResponse.json({\n        success: false,\n        message: 'Session ID required'\n      }, { status: 400 })\n    }\n\n    const supabase = await createClient()\n\n    // Verify session belongs to user\n    const { data: session } = await supabase\n      .from('user_sessions')\n      .select('*')\n      .eq('id', sessionId)\n      .eq('user_id', user.id)\n      .single()\n\n    if (!session) {\n      return NextResponse.json({\n        success: false,\n        message: 'Session not found'\n      }, { status: 404 })\n    }\n\n    // Terminate session\n    const { error: updateError } = await supabase\n      .from('user_sessions')\n      // @ts-expect-error - user_sessions table exists in DB but not in generated types\n      .update({\n        is_active: false,\n        terminated_at: new Date().toISOString(),\n        termination_reason: 'manual'\n      })\n      .eq('id', sessionId);\n\n    if (updateError) {\n      return NextResponse.json({\n        success: false,\n        message: 'Failed to terminate session'\n      }, { status: 500 })\n    }\n\n    // Broadcast termination\n    await supabase.channel(`user:${user.id}:session`)\n      .send({\n        type: 'broadcast',\n        event: 'session_terminated',\n        payload: { reason: 'manual', timestamp: new Date().toISOString() }\n      })\n\n    return NextResponse.json({\n      success: true,\n      message: 'Session terminated'\n    })\n  } catch (error: any) {\n    return NextResponse.json({\n      success: false,\n      message: error.message || 'Authentication required'\n    }, { status: error.status || 401 })\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\api\\users\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'User' is defined but never used.","line":2,"column":52,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":56},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getCurrentUser' is defined but never used.","line":3,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'checkRateLimit' is defined but never used.","line":3,"column":41,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":55},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'classId' is assigned a value but never used.","line":71,"column":40,"nodeType":null,"messageId":"unusedVar","endLine":71,"endColumn":47}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { getUserById, updateUser, deleteUser, type User } from '@/lib/supabase/queries'\nimport { getCurrentUser, sanitizeInput, checkRateLimit } from '@/lib/security-utils'\n\n// GET /api/users/[id] - Get a specific user\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  // TODO: Add real authentication middleware before production\n  // const { user } = await getCurrentUser(request)\n  // if (!user || user.role !== 'admin') {\n  //   return NextResponse.json(\n  //     { success: false, error: 'Unauthorized' },\n  //     { status: 401 }\n  //   )\n  // }\n\n  try {\n    const { id } = await params\n    const user = await getUserById(id)\n\n    if (!user) {\n      return NextResponse.json(\n        { success: false, error: 'User not found' },\n        { status: 404 }\n      )\n    }\n\n    return NextResponse.json({\n      success: true,\n      data: user\n    })\n  } catch (error) {\n    return NextResponse.json(\n      {\n        success: false,\n        error: error instanceof Error ? error.message : 'Failed to fetch user'\n      },\n      { status: 500 }\n    )\n  }\n}\n\n// PUT /api/users/[id] - Update a user\nexport async function PUT(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  // TODO: Add real authentication middleware before production\n  // const { user } = await getCurrentUser(request)\n  // if (!user || user.role !== 'admin') {\n  //   return NextResponse.json(\n  //     { success: false, error: 'Unauthorized' },\n  //     { status: 401 }\n  //   )\n  // }\n\n  // TODO: Add real rate limiting before production\n  // const rateLimit = await checkRateLimit(request, { windowMs: 60000, maxRequests: 10 })\n  // if (!rateLimit.allowed) {\n  //   return NextResponse.json(\n  //     { error: rateLimit.error },\n  //     { status: 429 }\n  //   )\n  // }\n\n  try {\n    const { id } = await params\n    const body = await request.json()\n    const { name, email, role, status, classId, avatar } = body\n\n    // Verify user exists\n    const existingUser = await getUserById(id)\n    if (!existingUser) {\n      return NextResponse.json(\n        { success: false, error: 'User not found' },\n        { status: 404 }\n      )\n    }\n\n    // Validation for role field\n    if (role && !['admin', 'teacher', 'parent', 'student'].includes(role)) {\n      return NextResponse.json(\n        { success: false, error: 'Invalid role (must be admin, teacher, parent, or student)' },\n        { status: 400 }\n      )\n    }\n\n    // Validation for status field\n    if (status && !['active', 'inactive'].includes(status)) {\n      return NextResponse.json(\n        { success: false, error: 'Invalid status (must be active or inactive)' },\n        { status: 400 }\n      )\n    }\n\n    // Email validation\n    if (email && !/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email)) {\n      return NextResponse.json(\n        { success: false, error: 'Invalid email format' },\n        { status: 400 }\n      )\n    }\n\n    // Update user using Supabase\n    const updatedUser = await updateUser(id, {\n      full_name: name ? sanitizeInput(name.trim()) : undefined,\n      status: status || undefined,\n      avatar_url: avatar || undefined\n    })\n\n    return NextResponse.json({\n      success: true,\n      data: updatedUser,\n      message: 'Cập nhật người dùng thành công'\n    })\n  } catch (error) {\n    return NextResponse.json(\n      {\n        success: false,\n        error: error instanceof Error ? error.message : 'Failed to update user'\n      },\n      { status: 500 }\n    )\n  }\n}\n\n// DELETE /api/users/[id] - Delete a user\nexport async function DELETE(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  // TODO: Add real authentication middleware before production\n  // const { user } = await getCurrentUser(request)\n  // if (!user || user.role !== 'admin') {\n  //   return NextResponse.json(\n  //     { success: false, error: 'Unauthorized' },\n  //     { status: 401 }\n  //   )\n  // }\n\n  try {\n    const { id } = await params\n\n    // Verify user exists\n    const existingUser = await getUserById(id)\n    if (!existingUser) {\n      return NextResponse.json(\n        { success: false, error: 'User not found' },\n        { status: 404 }\n      )\n    }\n\n    // Delete user using Supabase\n    await deleteUser(id)\n\n    return NextResponse.json({\n      success: true,\n      message: 'Xóa người dùng thành công'\n    })\n  } catch (error) {\n    return NextResponse.json(\n      {\n        success: false,\n        error: error instanceof Error ? error.message : 'Failed to delete user'\n      },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\api\\users\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getCurrentUser' is defined but never used.","line":3,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'checkRateLimit' is defined but never used.","line":3,"column":57,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":71},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1184,1187],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1184,1187],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":37,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1264,1267],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1264,1267],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1395,1398],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1395,1398],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\nimport { getUsers, createUser } from '@/lib/supabase/queries'\nimport { getCurrentUser, sanitizeSearch, sanitizeInput, checkRateLimit } from '@/lib/security-utils'\n\nexport async function GET(request: Request) {\n  // TODO: Add real authentication middleware before production\n  // const { user } = await getCurrentUser(request)\n  // if (!user || user.role !== 'admin') {\n  //   return NextResponse.json(\n  //     { success: false, error: 'Unauthorized' },\n  //     { status: 401 }\n  //   )\n  // }\n\n  // TODO: Add real rate limiting before production\n  // const rateLimit = await checkRateLimit(request, { windowMs: 60000, maxRequests: 100 })\n  // if (!rateLimit.allowed) {\n  //   return NextResponse.json(\n  //     { error: rateLimit.error },\n  //     { status: 429 }\n  //   )\n  // }\n\n  try {\n    const { searchParams } = new URL(request.url)\n    const role = searchParams.get('role')\n    const status = searchParams.get('status')\n    const search = searchParams.get('search')\n\n    let users = await getUsers()\n\n    // Client-side filtering since Supabase queries don't support these filters yet\n    if (role) {\n      users = users.filter((u: any) => u.role === role)\n    }\n    if (status) {\n      users = users.filter((u: any) => u.status === status)\n    }\n    if (search) {\n      const sanitized = sanitizeSearch(search)\n      users = users.filter((u: any) =>\n        u.name.toLowerCase().includes(sanitized.toLowerCase()) ||\n        u.email.toLowerCase().includes(sanitized.toLowerCase())\n      )\n    }\n\n    return NextResponse.json({\n      success: true,\n      data: users,\n      total: users.length,\n    })\n  } catch (error) {\n    return NextResponse.json(\n      {\n        success: false,\n        error: error instanceof Error ? error.message : 'Failed to fetch users'\n      },\n      { status: 500 }\n    )\n  }\n}\n\nexport async function POST(request: Request) {\n  // TODO: Add real authentication middleware before production\n  // const { user } = await getCurrentUser(request)\n  // if (!user || user.role !== 'admin') {\n  //   return NextResponse.json(\n  //     { success: false, error: 'Unauthorized' },\n  //     { status: 401 }\n  //   )\n  // }\n\n  // TODO: Add real rate limiting before production\n  // const rateLimit = await checkRateLimit(request, { windowMs: 60000, maxRequests: 10 })\n  // if (!rateLimit.allowed) {\n  //   return NextResponse.json(\n  //     { error: rateLimit.error },\n  //     { status: 429 }\n  //   )\n  // }\n\n  try {\n    const body = await request.json()\n\n    // Sanitize user input\n    const sanitizedName = sanitizeInput(body.name || '')\n    const sanitizedEmail = sanitizeInput(body.email || '')\n\n    if (!sanitizedName || !sanitizedEmail) {\n      return NextResponse.json(\n        { success: false, error: 'Tên và email không được để trống' },\n        { status: 400 }\n      )\n    }\n\n    // Create user using Supabase\n    const newUser = await createUser({\n      id: Date.now().toString(), // In production, this comes from Supabase Auth\n      email: sanitizedEmail,\n      role: body.role || 'student',\n      full_name: sanitizedName,\n      phone: body.phone\n    })\n\n    return NextResponse.json({\n      success: true,\n      data: newUser,\n      message: 'Người dùng đã được tạo thành công',\n    }, { status: 201 })\n  } catch (error) {\n    return NextResponse.json(\n      {\n        success: false,\n        error: error instanceof Error ? error.message : 'Failed to create user'\n      },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\auth\\logout\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\error.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\global-error.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used. Allowed unused args must match /^_/u.","line":6,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":8}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { Button } from '@/components/ui/button'\n\nexport default function GlobalError({\n  error,\n  reset,\n}: {\n  error: Error & { digest?: string }\n  reset: () => void\n}) {\n  return (\n    <html>\n      <body>\n        <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n          <div className=\"max-w-md w-full bg-white shadow-lg rounded-lg p-8\">\n            <div className=\"text-center\">\n              <div className=\"inline-flex items-center justify-center w-16 h-16 rounded-full bg-red-100 mb-4\">\n                <svg\n                  className=\"w-8 h-8 text-red-600\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  viewBox=\"0 0 24 24\"\n                >\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    strokeWidth={2}\n                    d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"\n                  />\n                </svg>\n              </div>\n              <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">\n                Critical error\n              </h2>\n              <p className=\"text-gray-600 mb-6\">\n                A critical error occurred. Please refresh the page.\n              </p>\n              <Button\n                onClick={reset}\n                className=\"w-full bg-blue-600 hover:bg-blue-700 text-white\"\n              >\n                Reload page\n              </Button>\n            </div>\n          </div>\n        </div>\n      </body>\n    </html>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\not-found.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\teacher\\assessments\\AssessmentsClient.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":16},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":30,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1042,1045],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1042,1045],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1149,1152],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1149,1152],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1460,1463],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1460,1463],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1545,1548],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1545,1548],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1629,1632],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1629,1632],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1722,1725],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1722,1725],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":88,"column":83,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":86,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3306,3309],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3306,3309],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useMemo } from 'react'\nimport type { RegularAssessment } from '@/lib/types'\nimport { StudentAssessmentCard } from '@/components/teacher/StudentAssessmentCard'\nimport { Card, CardContent } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Badge } from '@/components/ui/badge'\nimport { CheckCircle2, Clock, AlertCircle, TrendingUp, Search } from 'lucide-react'\nimport { useRouter } from 'next/navigation'\n\ninterface AssessmentsClientProps {\n  initialAssessments: RegularAssessment[]\n}\n\nexport function AssessmentsClient({ initialAssessments }: AssessmentsClientProps) {\n  const router = useRouter()\n  const [filters, setFilters] = useState({\n    classId: '',\n    subject: '',\n    status: 'all' as 'all' | 'evaluated' | 'pending' | 'needs-attention',\n    search: '',\n  })\n\n  const filteredAssessments = useMemo(() => {\n    let filtered = initialAssessments\n\n    if (filters.status !== 'all') {\n      filtered = filtered.filter((a: any) => a.status === filters.status)\n    }\n\n    if (filters.search) {\n      filtered = filtered.filter((a: any) =>\n        a.studentName.toLowerCase().includes(filters.search.toLowerCase()) ||\n        a.className.toLowerCase().includes(filters.search.toLowerCase())\n      )\n    }\n\n    return filtered\n  }, [filters, initialAssessments])\n\n  const summary = useMemo(() => ({\n    evaluated: initialAssessments.filter((a: any) => a.status === 'evaluated').length,\n    pending: initialAssessments.filter((a: any) => a.status === 'pending').length,\n    positive: initialAssessments.filter((a: any) => a.rating && a.rating >= 4).length,\n    needsAttention: initialAssessments.filter((a: any) => a.status === 'needs-attention').length,\n  }), [initialAssessments])\n\n  const handleEvaluate = (studentId: string) => {\n    router.push(`/teacher/assessments/evaluate/${studentId}`)\n  }\n\n  const handleEdit = (studentId: string) => {\n    router.push(`/teacher/assessments/evaluate/${studentId}`)\n  }\n\n  const handleContactParent = (studentId: string) => {\n    router.push(`/teacher/messages?student=${studentId}`)\n  }\n\n  return (\n    <div className=\"space-y-6 p-8\">\n      {/* Page Header */}\n      <div>\n        <h1 className=\"text-2xl font-bold text-gray-900\">Đánh giá thường xuyên</h1>\n        <p className=\"text-gray-500\">Đánh giá và theo dõi tiến độ học sinh</p>\n      </div>\n\n      {/* Filter Bar */}\n      <Card>\n        <CardContent className=\"pt-6\">\n          <div className=\"flex flex-wrap gap-4\">\n            <div className=\"flex-1 min-w-[200px]\">\n              <div className=\"relative\">\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400\" />\n                <Input\n                  placeholder=\"Tìm kiếm học sinh...\"\n                  value={filters.search}\n                  onChange={(e) => setFilters({ ...filters, search: e.target.value })}\n                  className=\"pl-10\"\n                />\n              </div>\n            </div>\n            <select\n              className=\"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-sky-500\"\n              value={filters.status}\n              onChange={(e) => setFilters({ ...filters, status: e.target.value as any })}\n            >\n              <option value=\"all\">Tất cả trạng thái</option>\n              <option value=\"evaluated\">Đã đánh giá</option>\n              <option value=\"pending\">Chưa đánh giá</option>\n              <option value=\"needs-attention\">Cần chú ý</option>\n            </select>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Summary Stats */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <Card className=\"border-l-4 border-l-green-500 bg-gradient-to-r from-green-50 to-white\">\n          <CardContent className=\"pt-6\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 bg-green-100 rounded-lg\">\n                <CheckCircle2 className=\"h-5 w-5 text-green-600\" />\n              </div>\n              <div>\n                <p className=\"text-sm text-gray-600\">Đã đánh giá</p>\n                <p className=\"text-2xl font-bold text-green-600\">{summary.evaluated}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"border-l-4 border-l-amber-500 bg-gradient-to-r from-amber-50 to-white\">\n          <CardContent className=\"pt-6\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 bg-amber-100 rounded-lg\">\n                <Clock className=\"h-5 w-5 text-amber-600\" />\n              </div>\n              <div>\n                <p className=\"text-sm text-gray-600\">Chưa đánh giá</p>\n                <p className=\"text-2xl font-bold text-amber-600\">{summary.pending}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"border-l-4 border-l-sky-500 bg-gradient-to-r from-sky-50 to-white\">\n          <CardContent className=\"pt-6\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 bg-sky-100 rounded-lg\">\n                <TrendingUp className=\"h-5 w-5 text-sky-600\" />\n              </div>\n              <div>\n                <p className=\"text-sm text-gray-600\">Tiến bộ tốt</p>\n                <p className=\"text-2xl font-bold text-sky-600\">{summary.positive}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"border-l-4 border-l-red-500 bg-gradient-to-r from-red-50 to-white\">\n          <CardContent className=\"pt-6\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 bg-red-100 rounded-lg\">\n                <AlertCircle className=\"h-5 w-5 text-red-600\" />\n              </div>\n              <div>\n                <p className=\"text-sm text-gray-600\">Cần chú ý</p>\n                <p className=\"text-2xl font-bold text-red-600\">{summary.needsAttention}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Student Assessment Cards */}\n      <div>\n        <div className=\"flex items-center justify-between mb-4\">\n          <h2 className=\"text-lg font-bold\">Danh sách học sinh</h2>\n          <Badge variant=\"outline\">{filteredAssessments.length} học sinh</Badge>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {filteredAssessments.map((assessment) => (\n            <StudentAssessmentCard\n              key={assessment.studentId}\n              assessment={assessment}\n              onEvaluate={handleEvaluate}\n              onEdit={handleEdit}\n              onContactParent={handleContactParent}\n            />\n          ))}\n        </div>\n\n        {filteredAssessments.length === 0 && (\n          <Card>\n            <CardContent className=\"py-12 text-center\">\n              <p className=\"text-gray-500\">Không tìm thấy kết quả nào</p>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\teacher\\assessments\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[671,674],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[671,674],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { notFound } from 'next/navigation'\nimport { getAssessments } from '@/lib/supabase/queries'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport { ArrowLeft, Edit, Trash2 } from 'lucide-react'\nimport Link from 'next/link'\n\ninterface PageProps {\n  params: Promise<{ id: string }>\n}\n\nexport default async function AssessmentDetailPage({ params }: PageProps) {\n  const { id } = await params\n  // TODO: Get real teacher ID from auth\n  const assessments = await getAssessments('current-teacher-id')\n  const assessment = assessments.find((a: any) => a.id === id)\n\n  if (!assessment) {\n    notFound()\n  }\n\n  return (\n    <div className=\"space-y-6 p-8\">\n      {/* Back Button */}\n      <Link href=\"/teacher/assessments\">\n        <Button variant=\"ghost\">\n          <ArrowLeft className=\"h-4 w-4 mr-2\" />\n          Quay lại\n        </Button>\n      </Link>\n\n      {/* Assessment Header */}\n      <div className=\"flex items-start justify-between\">\n        <div>\n          <div className=\"flex items-center gap-3 mb-2\">\n            <h1 className=\"text-2xl font-bold text-gray-900\">{assessment.name}</h1>\n            <Badge variant={assessment.status === 'published' ? 'success' : 'secondary'}>\n              {assessment.status === 'published' ? 'Đã xuất bản' : assessment.status === 'graded' ? 'Đã chấm' : 'Nháp'}\n            </Badge>\n          </div>\n          <p className=\"text-gray-500\">\n            {assessment.className} • {assessment.subject}\n          </p>\n        </div>\n        <div className=\"flex gap-2\">\n          <Button variant=\"outline\">\n            <Edit className=\"h-4 w-4 mr-2\" />\n            Chỉnh sửa\n          </Button>\n          <Button variant=\"outline\" className=\"text-red-600 hover:text-red-700\">\n            <Trash2 className=\"h-4 w-4 mr-2\" />\n            Xóa\n          </Button>\n        </div>\n      </div>\n\n      {/* Assessment Details */}\n      <div className=\"grid md:grid-cols-3 gap-6\">\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-sm font-medium text-gray-600\">Thông tin</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            <div>\n              <p className=\"text-sm text-gray-500\">Ngày thi</p>\n              <p className=\"font-semibold\">{new Date(assessment.date).toLocaleDateString('vi-VN')}</p>\n            </div>\n            <div>\n              <p className=\"text-sm text-gray-500\">Điểm tối đa</p>\n              <p className=\"font-semibold\">{assessment.maxScore}</p>\n            </div>\n            <div>\n              <p className=\"text-sm text-gray-500\">Loại</p>\n              <p className=\"font-semibold\">\n                {assessment.type === 'quiz' ? '15 phút' : assessment.type === 'midterm' ? 'Giữa kỳ' : assessment.type === 'final' ? 'Cuối kỳ' : 'Miệng'}\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-sm font-medium text-gray-600\">Tiến độ</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            <div>\n              <p className=\"text-sm text-gray-500\">Đã nộp</p>\n              <p className=\"font-semibold\">{assessment.submittedCount}/{assessment.totalCount}</p>\n            </div>\n            <div>\n              <p className=\"text-sm text-gray-500\">Tỷ lệ</p>\n              <p className=\"font-semibold\">\n                {Math.round((assessment.submittedCount / assessment.totalCount) * 100)}%\n              </p>\n            </div>\n            <div>\n              <p className=\"text-sm text-gray-500\">Chưa nộp</p>\n              <p className=\"font-semibold text-amber-600\">{assessment.totalCount - assessment.submittedCount}</p>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-sm font-medium text-gray-600\">Hành động</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-2\">\n            <Button className=\"w-full\">Xem danh sách nộp</Button>\n            <Button variant=\"outline\" className=\"w-full\">Nhập điểm</Button>\n            <Button variant=\"outline\" className=\"w-full\">Xuất báo cáo</Button>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Students List Placeholder */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Danh sách học sinh</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <p className=\"text-gray-500 text-center py-8\">Tính năng đang phát triển...</p>\n        </CardContent>\n      </Card>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\teacher\\assessments\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'RegularAssessment' is defined but never used.","line":2,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { getRegularAssessments } from '@/lib/supabase/queries'\nimport type { RegularAssessment } from '@/lib/types'\nimport { AssessmentsClient } from './AssessmentsClient'\n\nexport default async function AssessmentsPage() {\n  const assessments = await getRegularAssessments()\n  return <AssessmentsClient initialAssessments={assessments} />\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\teacher\\attendance\\[classId]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2542,2545],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2542,2545],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { notFound } from 'next/navigation'\nimport { getClassStudents, getTeacherClasses } from '@/lib/supabase/queries'\nimport { AttendanceForm } from '@/components/teacher/AttendanceForm'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Calendar } from 'lucide-react'\n\ninterface PageProps {\n  params: Promise<{ classId: string }>\n}\n\nexport default async function ClassAttendancePage({ params }: PageProps) {\n  const { classId } = await params\n  const classes = await getTeacherClasses('current-teacher-id')\n  const cls = classes.find(c => c.id === classId)\n  const students = await getClassStudents(classId)\n\n  if (!cls) {\n    notFound()\n  }\n\n  const today = new Date().toLocaleDateString('vi-VN', {\n    weekday: 'long',\n    year: 'numeric',\n    month: 'long',\n    day: 'numeric',\n  })\n\n  return (\n    <div className=\"space-y-6 p-8\">\n      {/* Page Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <div className=\"flex items-center gap-3 mb-2\">\n            <h1 className=\"text-2xl font-bold text-gray-900\">Điểm danh - {cls.name}</h1>\n            {cls.isHomeroom && (\n              <span className=\"px-2 py-1 bg-sky-100 text-sky-700 text-xs font-medium rounded-full\">\n                Lớp chủ nhiệm\n              </span>\n            )}\n          </div>\n          <p className=\"text-gray-500\">Môn: {cls.subject} • Phòng: {cls.room}</p>\n        </div>\n        <div className=\"flex items-center gap-2 text-gray-600\">\n          <Calendar className=\"h-5 w-5\" />\n          <span className=\"text-sm font-medium\">{today}</span>\n        </div>\n      </div>\n\n      {/* Class Info */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Thông tin lớp</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm\">\n            <div>\n              <p className=\"text-gray-500\">Sĩ số</p>\n              <p className=\"font-semibold text-gray-900\">{cls.studentCount} học sinh</p>\n            </div>\n            <div>\n              <p className=\"text-gray-500\">Lịch học</p>\n              <p className=\"font-semibold text-gray-900\">{cls.schedule}</p>\n            </div>\n            <div>\n              <p className=\"text-gray-500\">Phòng học</p>\n              <p className=\"font-semibold text-gray-900\">{cls.room}</p>\n            </div>\n            <div>\n              <p className=\"text-gray-500\">Vắng hôm nay</p>\n              <p className=\"font-semibold text-red-600\">\n                {students.filter((s: any) => s.status !== 'present').length} học sinh\n              </p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Attendance Form */}\n      <AttendanceForm students={students} classId={classId} />\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\teacher\\attendance\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\teacher\\class-management\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'loading' is assigned a value but never used.","line":48,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":48,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState, useEffect } from 'react'\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Badge } from '@/components/ui/badge'\r\nimport { Input } from '@/components/ui/input'\r\nimport {\r\n  Table,\r\n  TableBody,\r\n  TableCell,\r\n  TableHead,\r\n  TableHeader,\r\n  TableRow,\r\n} from '@/components/ui/table'\r\nimport { Users, Mail, Phone, Search, Download } from 'lucide-react'\r\n\r\ninterface ClassInfo {\r\n  id: string\r\n  name: string\r\n  subject: string\r\n  studentCount: number\r\n}\r\n\r\ninterface Student {\r\n  id: string\r\n  name: string\r\n  code: string\r\n  email?: string\r\n  phone?: string\r\n  status: 'active' | 'withdrawn'\r\n}\r\n\r\ninterface ClassData {\r\n  classId: string\r\n  className: string\r\n  subject: string\r\n  grade: string\r\n  room: string\r\n  students: Student[]\r\n}\r\n\r\nexport default function ClassManagementPage() {\r\n  const [selectedClassId, setSelectedClassId] = useState<string | null>(null)\r\n  const [searchQuery, setSearchQuery] = useState('')\r\n  const [classes, setClasses] = useState<ClassInfo[]>([])\r\n  const [classData, setClassData] = useState<ClassData | null>(null)\r\n  const [loading, setLoading] = useState(false)\r\n\r\n  // Fetch classes on mount\r\n  useEffect(() => {\r\n    async function fetchClasses() {\r\n      try {\r\n        const res = await fetch('/api/teacher/classes')\r\n        const json = await res.json()\r\n        setClasses(json.data)\r\n        if (json.data.length > 0 && !selectedClassId) {\r\n          setSelectedClassId(json.data[0].id)\r\n        }\r\n      } catch (error) {\r\n        console.error('Failed to fetch classes:', error)\r\n      }\r\n    }\r\n    fetchClasses()\r\n  }, [selectedClassId])\r\n\r\n  // Fetch class data when selection changes\r\n  useEffect(() => {\r\n    if (!selectedClassId) return\r\n\r\n    async function fetchClassData() {\r\n      setLoading(true)\r\n      try {\r\n        const res = await fetch(`/api/teacher/classes/${selectedClassId}`)\r\n        const json = await res.json()\r\n        setClassData(json.data)\r\n      } catch (error) {\r\n        console.error('Failed to fetch class data:', error)\r\n      } finally {\r\n        setLoading(false)\r\n      }\r\n    }\r\n    fetchClassData()\r\n  }, [selectedClassId])\r\n\r\n  const students = classData?.students || []\r\n  const filteredStudents = students.filter((student) =>\r\n    student.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n    student.code.toLowerCase().includes(searchQuery.toLowerCase())\r\n  )\r\n\r\n  const selectedClass = classes.find((c) => c.id === selectedClassId)\r\n\r\n  return (\r\n    <div className=\"space-y-6 p-8\">\r\n      {/* Header */}\r\n      <div>\r\n        <h1 className=\"text-2xl font-bold text-gray-900\">Quản lý lớp dạy</h1>\r\n        <p className=\"text-gray-500\">Quản lý danh sách học sinh các lớp giảng dạy</p>\r\n      </div>\r\n\r\n      {/* Class Selection */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n        {classes.map((cls) => (\r\n          <Card\r\n            key={cls.id}\r\n            className={`cursor-pointer transition-all hover:shadow-lg ${\r\n              selectedClassId === cls.id\r\n                ? 'ring-2 ring-sky-500 shadow-lg'\r\n                : 'hover:shadow-md'\r\n            }`}\r\n            onClick={() => setSelectedClassId(cls.id)}\r\n          >\r\n            <CardContent className=\"pt-6\">\r\n              <div className=\"text-center\">\r\n                <div className=\"text-2xl font-black text-sky-600 mb-1\">\r\n                  {cls.name}\r\n                </div>\r\n                <div className=\"text-sm text-gray-600 font-medium mb-2\">\r\n                  {cls.subject}\r\n                </div>\r\n                <div className=\"flex items-center justify-center gap-1 text-xs text-gray-500\">\r\n                  <Users className=\"h-3 w-3\" />\r\n                  <span>{cls.studentCount} học sinh</span>\r\n                </div>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        ))}\r\n      </div>\r\n\r\n      {/* Student List */}\r\n      {selectedClass && (\r\n        <Card>\r\n          <CardHeader>\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <CardTitle className=\"text-lg font-bold\">\r\n                  Danh sách học sinh - {selectedClass.name}\r\n                </CardTitle>\r\n                <p className=\"text-sm text-gray-500 mt-1\">\r\n                  Môn: {selectedClass.subject}\r\n                </p>\r\n              </div>\r\n              <Button size=\"sm\" variant=\"outline\">\r\n                <Download className=\"h-4 w-4 mr-2\" />\r\n                Xuất Excel\r\n              </Button>\r\n            </div>\r\n          </CardHeader>\r\n          <CardContent>\r\n            {/* Search */}\r\n            <div className=\"mb-4\">\r\n              <div className=\"relative\">\r\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400\" />\r\n                <Input\r\n                  placeholder=\"Tìm kiếm theo tên hoặc mã học sinh...\"\r\n                  value={searchQuery}\r\n                  onChange={(e) => setSearchQuery(e.target.value)}\r\n                  className=\"pl-10\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Table */}\r\n            <div className=\"rounded-md border\">\r\n              <Table>\r\n                <TableHeader>\r\n                  <TableRow className=\"bg-gray-50\">\r\n                    <TableHead className=\"font-bold\">MSSV</TableHead>\r\n                    <TableHead className=\"font-bold\">Họ và tên</TableHead>\r\n                    <TableHead className=\"font-bold\">Email</TableHead>\r\n                    <TableHead className=\"font-bold\">SĐT</TableHead>\r\n                    <TableHead className=\"font-bold\">Trạng thái</TableHead>\r\n                    <TableHead className=\"font-bold text-right\">Thao tác</TableHead>\r\n                  </TableRow>\r\n                </TableHeader>\r\n                <TableBody>\r\n                  {filteredStudents.length === 0 ? (\r\n                    <TableRow>\r\n                      <TableCell colSpan={6} className=\"text-center py-8 text-gray-500\">\r\n                        Không tìm thấy học sinh nào\r\n                      </TableCell>\r\n                    </TableRow>\r\n                  ) : (\r\n                    filteredStudents.map((student) => (\r\n                      <TableRow key={student.id} className=\"hover:bg-gray-50\">\r\n                        <TableCell className=\"font-medium text-xs\">\r\n                          {student.code}\r\n                        </TableCell>\r\n                        <TableCell className=\"font-bold text-gray-900\">\r\n                          {student.name}\r\n                        </TableCell>\r\n                        <TableCell>\r\n                          {student.email ? (\r\n                            <div className=\"flex items-center gap-1 text-sm text-gray-600\">\r\n                              <Mail className=\"h-3 w-3\" />\r\n                              {student.email}\r\n                            </div>\r\n                          ) : (\r\n                            <span className=\"text-gray-400 text-sm\">-</span>\r\n                          )}\r\n                        </TableCell>\r\n                        <TableCell>\r\n                          {student.phone ? (\r\n                            <div className=\"flex items-center gap-1 text-sm text-gray-600\">\r\n                              <Phone className=\"h-3 w-3\" />\r\n                              {student.phone}\r\n                            </div>\r\n                          ) : (\r\n                            <span className=\"text-gray-400 text-sm\">-</span>\r\n                          )}\r\n                        </TableCell>\r\n                        <TableCell>\r\n                          <Badge\r\n                            variant={student.status === 'active' ? 'default' : 'secondary'}\r\n                            className={\r\n                              student.status === 'active'\r\n                                ? 'bg-green-100 text-green-700 hover:bg-green-200'\r\n                                : 'bg-gray-100 text-gray-600'\r\n                            }\r\n                          >\r\n                            {student.status === 'active' ? 'Đang học' : 'Đã nghỉ'}\r\n                          </Badge>\r\n                        </TableCell>\r\n                        <TableCell className=\"text-right\">\r\n                          <div className=\"flex gap-2 justify-end\">\r\n                            <Button size=\"sm\" variant=\"outline\" className=\"h-8 text-xs\">\r\n                              Chi tiết\r\n                            </Button>\r\n                            <Button size=\"sm\" variant=\"outline\" className=\"h-8 text-xs\">\r\n                              Nhắn tin\r\n                            </Button>\r\n                          </div>\r\n                        </TableCell>\r\n                      </TableRow>\r\n                    ))\r\n                  )}\r\n                </TableBody>\r\n              </Table>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\teacher\\conduct\\ConductClient.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[986,989],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[986,989],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1853,1856],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1853,1856],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":52,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1950,1953],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1950,1953],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":53,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2037,2040],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2037,2040],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":54,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2122,2125],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2122,2125],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2219,2222],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2219,2222],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":59,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2382,2385],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2382,2385],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":60,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2463,2466],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2463,2466],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":61,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2547,2550],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2547,2550],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":62,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2631,2634],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2631,2634],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":68,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2798,2801],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2798,2801],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":242,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":242,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10048,10051],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10048,10051],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":242,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":242,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10060,10063],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10060,10063],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":302,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":302,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12593,12596],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12593,12596],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":14,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useMemo } from 'react'\nimport type { ConductRating } from '@/lib/types'\nimport { DualRatingBadge } from '@/components/teacher/DualRatingBadge'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table'\nimport { Download, Search } from 'lucide-react'\nimport { cn } from '@/lib/utils'\n\ninterface ConductClientProps {\n  initialRatings: ConductRating[]\n}\n\nexport function ConductClient({ initialRatings }: ConductClientProps) {\n  const [filters, setFilters] = useState({\n    semester: '2' as '1' | '2',\n    academicRating: 'all',\n    conductRating: 'all',\n    search: '',\n  })\n  const [currentPage, setCurrentPage] = useState(1)\n  const itemsPerPage = 10\n\n  const filteredRatings = useMemo(() => {\n    return initialRatings.filter((rating: any) => {\n      if (filters.academicRating !== 'all' && rating.academicRating !== filters.academicRating) {\n        return false\n      }\n      if (filters.conductRating !== 'all' && rating.conductRating !== filters.conductRating) {\n        return false\n      }\n      if (filters.search) {\n        const searchLower = filters.search.toLowerCase()\n        return (\n          rating.studentName.toLowerCase().includes(searchLower) ||\n          rating.mssv.toLowerCase().includes(searchLower)\n        )\n      }\n      return true\n    })\n  }, [filters, initialRatings])\n\n  const totalPages = Math.ceil(filteredRatings.length / itemsPerPage)\n  const startIndex = (currentPage - 1) * itemsPerPage\n  const paginatedRatings = filteredRatings.slice(startIndex, startIndex + itemsPerPage)\n\n  const academicSummary = useMemo(() => ({\n    excellentPlus: filteredRatings.filter((r: any) => r.academicRating === 'excellent-plus').length,\n    excellent: filteredRatings.filter((r: any) => r.academicRating === 'excellent').length,\n    good: filteredRatings.filter((r: any) => r.academicRating === 'good').length,\n    average: filteredRatings.filter((r: any) => r.academicRating === 'average').length,\n    needsImprovement: filteredRatings.filter((r: any) => r.academicRating === 'needs-improvement').length,\n  }), [filteredRatings])\n\n  const conductSummary = useMemo(() => ({\n    good: filteredRatings.filter((r: any) => r.conductRating === 'good').length,\n    fair: filteredRatings.filter((r: any) => r.conductRating === 'fair').length,\n    average: filteredRatings.filter((r: any) => r.conductRating === 'average').length,\n    poor: filteredRatings.filter((r: any) => r.conductRating === 'poor').length,\n  }), [filteredRatings])\n\n  const getAvatarInitials = (name: string) => {\n    return name\n      .split(' ')\n      .map((n: any) => n[0])\n      .join('')\n      .slice(-2)\n      .toUpperCase()\n  }\n\n  const getAvatarColor = (index: number) => {\n    const colors = [\n      'bg-sky-100 text-sky-600',\n      'bg-emerald-100 text-emerald-600',\n      'bg-violet-100 text-violet-600',\n      'bg-amber-100 text-amber-600',\n      'bg-rose-100 text-rose-600',\n    ]\n    return colors[index % colors.length]\n  }\n\n  return (\n    <div className=\"space-y-6 p-8\">\n      {/* Page Header */}\n      <div>\n        <h1 className=\"text-2xl font-bold text-gray-900\">Học tập & Hạnh kiểm</h1>\n        <p className=\"text-gray-500\">Xếp loại học tập và hạnh kiểm học sinh</p>\n      </div>\n\n      {/* Filter Bar */}\n      <Card>\n        <CardContent className=\"pt-6\">\n          <div className=\"flex flex-wrap gap-4\">\n            <select\n              className=\"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-sky-500\"\n              value={filters.semester}\n              onChange={(e) => setFilters({ ...filters, semester: e.target.value as '1' | '2' })}\n            >\n              <option value=\"1\">Học kỳ 1</option>\n              <option value=\"2\">Học kỳ 2</option>\n            </select>\n\n            <select\n              className=\"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-sky-500\"\n              value={filters.academicRating}\n              onChange={(e) => setFilters({ ...filters, academicRating: e.target.value })}\n            >\n              <option value=\"all\">Tất cả xếp loại học tập</option>\n              <option value=\"excellent-plus\">Giỏi xuất sắc</option>\n              <option value=\"excellent\">Giỏi</option>\n              <option value=\"good\">Khá</option>\n              <option value=\"average\">Trung bình</option>\n              <option value=\"needs-improvement\">Cần cố gắng</option>\n            </select>\n\n            <select\n              className=\"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-sky-500\"\n              value={filters.conductRating}\n              onChange={(e) => setFilters({ ...filters, conductRating: e.target.value })}\n            >\n              <option value=\"all\">Tất cả xếp loại hạnh kiểm</option>\n              <option value=\"good\">Tốt</option>\n              <option value=\"fair\">Khá</option>\n              <option value=\"average\">Trung bình</option>\n              <option value=\"poor\">Yếu</option>\n            </select>\n\n            <div className=\"flex-1 min-w-[200px]\">\n              <div className=\"relative\">\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400\" />\n                <Input\n                  placeholder=\"Tìm kiếm học sinh...\"\n                  value={filters.search}\n                  onChange={(e) => setFilters({ ...filters, search: e.target.value })}\n                  className=\"pl-10\"\n                />\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Academic Rating Summary */}\n      <div>\n        <h3 className=\"text-lg font-bold mb-4\">Xếp loại học tập</h3>\n        <div className=\"grid grid-cols-1 md:grid-cols-5 gap-4\">\n          <Card className=\"border-l-4 border-green-500\">\n            <CardContent className=\"pt-6\">\n              <div className=\"text-3xl font-bold text-green-600\">{academicSummary.excellentPlus}</div>\n              <div className=\"text-sm text-gray-500\">Giỏi xuất sắc (≥9.0)</div>\n            </CardContent>\n          </Card>\n          <Card className=\"border-l-4 border-blue-500\">\n            <CardContent className=\"pt-6\">\n              <div className=\"text-3xl font-bold text-blue-600\">{academicSummary.excellent}</div>\n              <div className=\"text-sm text-gray-500\">Giỏi (8.0-8.9)</div>\n            </CardContent>\n          </Card>\n          <Card className=\"border-l-4 border-yellow-500\">\n            <CardContent className=\"pt-6\">\n              <div className=\"text-3xl font-bold text-yellow-600\">{academicSummary.good}</div>\n              <div className=\"text-sm text-gray-500\">Khá (6.5-7.9)</div>\n            </CardContent>\n          </Card>\n          <Card className=\"border-l-4 border-orange-500\">\n            <CardContent className=\"pt-6\">\n              <div className=\"text-3xl font-bold text-orange-600\">{academicSummary.average}</div>\n              <div className=\"text-sm text-gray-500\">Trung bình (5.0-6.4)</div>\n            </CardContent>\n          </Card>\n          <Card className=\"border-l-4 border-red-500\">\n            <CardContent className=\"pt-6\">\n              <div className=\"text-3xl font-bold text-red-600\">{academicSummary.needsImprovement}</div>\n              <div className=\"text-sm text-gray-500\">Cần cố gắng (&lt;5.0)</div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n\n      {/* Conduct Rating Summary */}\n      <div>\n        <h3 className=\"text-lg font-bold mb-4\">Xếp loại hạnh kiểm</h3>\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n          <Card className=\"flex items-center gap-4 p-4\">\n            <div className=\"w-4 h-4 rounded-full bg-emerald-500\"></div>\n            <div>\n              <div className=\"text-2xl font-bold\">{conductSummary.good}</div>\n              <div className=\"text-sm text-gray-500\">Tốt</div>\n            </div>\n          </Card>\n          <Card className=\"flex items-center gap-4 p-4\">\n            <div className=\"w-4 h-4 rounded-full bg-blue-500\"></div>\n            <div>\n              <div className=\"text-2xl font-bold\">{conductSummary.fair}</div>\n              <div className=\"text-sm text-gray-500\">Khá</div>\n            </div>\n          </Card>\n          <Card className=\"flex items-center gap-4 p-4\">\n            <div className=\"w-4 h-4 rounded-full bg-yellow-500\"></div>\n            <div>\n              <div className=\"text-2xl font-bold\">{conductSummary.average}</div>\n              <div className=\"text-sm text-gray-500\">Trung bình</div>\n            </div>\n          </Card>\n          <Card className=\"flex items-center gap-4 p-4\">\n            <div className=\"w-4 h-4 rounded-full bg-red-500\"></div>\n            <div>\n              <div className=\"text-2xl font-bold\">{conductSummary.poor}</div>\n              <div className=\"text-sm text-gray-500\">Yếu</div>\n            </div>\n          </Card>\n        </div>\n      </div>\n\n      {/* Student List with Dual Ratings */}\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <CardTitle>Danh sách học sinh</CardTitle>\n            <Button variant=\"outline\" size=\"sm\">\n              <Download className=\"h-4 w-4 mr-2\" />\n              Xuất báo cáo\n            </Button>\n          </div>\n        </CardHeader>\n        <CardContent>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead className=\"w-12\"></TableHead>\n                <TableHead>MSSV</TableHead>\n                <TableHead>Họ và tên</TableHead>\n                <TableHead>Học tập</TableHead>\n                <TableHead>Hạnh kiểm</TableHead>\n                <TableHead>Thao tác</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {paginatedRatings.map((rating: any, index: any) => (\n                <TableRow key={rating.studentId}>\n                  <TableCell>\n                    <div className={cn(\n                      'w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm',\n                      getAvatarColor(index)\n                    )}>\n                      {getAvatarInitials(rating.studentName)}\n                    </div>\n                  </TableCell>\n                  <TableCell className=\"font-bold\">{rating.mssv}</TableCell>\n                  <TableCell className=\"font-bold\">{rating.studentName}</TableCell>\n                  <TableCell>\n                    <div className=\"flex flex-col gap-1\">\n                      <DualRatingBadge\n                        type=\"academic\"\n                        rating={rating.academicRating}\n                        score={rating.academicScore}\n                        size=\"sm\"\n                      />\n                    </div>\n                  </TableCell>\n                  <TableCell>\n                    <div className=\"flex items-center gap-2\">\n                      <div className={cn(\n                        'w-3 h-3 rounded-full',\n                        rating.conductRating === 'good' ? 'bg-emerald-500' :\n                        rating.conductRating === 'fair' ? 'bg-blue-500' :\n                        rating.conductRating === 'average' ? 'bg-yellow-500' :\n                        'bg-red-500'\n                      )}></div>\n                      <DualRatingBadge\n                        type=\"conduct\"\n                        rating={rating.conductRating}\n                        size=\"sm\"\n                      />\n                    </div>\n                  </TableCell>\n                  <TableCell>\n                    <div className=\"flex gap-2\">\n                      <Button size=\"sm\" variant=\"outline\">Chi tiết</Button>\n                      <Button size=\"sm\" variant=\"outline\">Sửa</Button>\n                      <Button size=\"sm\" variant=\"outline\">Liên hệ PH</Button>\n                    </div>\n                  </TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n\n          {/* Pagination */}\n          <div className=\"flex justify-center gap-2 mt-6\">\n            <Button\n              size=\"sm\"\n              variant=\"outline\"\n              onClick={() => setCurrentPage(p => Math.max(1, p - 1))}\n              disabled={currentPage === 1}\n            >\n              Trước\n            </Button>\n            {[...Array(totalPages)].map((_, i: any) => (\n              <Button\n                key={i}\n                size=\"sm\"\n                variant={currentPage === i + 1 ? 'default' : 'outline'}\n                className={currentPage === i + 1 ? 'bg-sky-600' : ''}\n                onClick={() => setCurrentPage(i + 1)}\n              >\n                {i + 1}\n              </Button>\n            ))}\n            <Button\n              size=\"sm\"\n              variant=\"outline\"\n              onClick={() => setCurrentPage(p => Math.min(totalPages, p + 1))}\n              disabled={currentPage === totalPages}\n            >\n              Sau\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\teacher\\conduct\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ConductRating' is defined but never used.","line":3,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { getTeacherClasses } from '@/lib/supabase/queries'\nimport { getConductRatings } from '@/lib/supabase/queries'\nimport type { ConductRating } from '@/lib/types'\nimport { ConductClient } from './ConductClient'\nimport { requireAuth } from '@/lib/auth'\n\nexport default async function ConductPage() {\n  const user = await requireAuth()\n  const classes = await getTeacherClasses(user.id)\n  const homeroomClass = classes.find(c => c.isHomeroom)\n\n  const initialRatings = homeroomClass\n    ? await getConductRatings(homeroomClass.id)\n    : []\n\n  if (initialRatings.length === 0) {\n    return (\n      <div className=\"space-y-6 p-8\">\n        <div>\n          <h1 className=\"text-2xl font-bold text-gray-900\">Học tập & Hạnh kiểm</h1>\n          <p className=\"text-gray-500\">Bạn chưa được phân công lớp chủ nhiệm</p>\n        </div>\n      </div>\n    )\n  }\n\n  return <ConductClient initialRatings={initialRatings} />\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\teacher\\dashboard\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'LeaveRequest' is defined but never used.","line":23,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\r\n  Users,\r\n  Calendar,\r\n  FileText,\r\n  Clock,\r\n  CheckCircle,\r\n  MessageSquare,\r\n  BookOpen,\r\n} from 'lucide-react'\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\r\nimport { Badge } from '@/components/ui/badge'\r\nimport { Button } from '@/components/ui/button'\r\nimport Link from 'next/link'\r\nimport {\r\n  getTeacherStats,\r\n  getLeaveRequests,\r\n  getTeacherSchedule,\r\n  getTeacherClasses,\r\n  getRegularAssessments,\r\n  type TeacherStats,\r\n} from '@/lib/supabase/queries'\r\nimport { requireAuth } from '@/lib/auth'\r\nimport type { LeaveRequest } from '@/lib/types'\r\n\r\ninterface DashboardData {\r\n  stats: TeacherStats & { homeroomClassId?: string }\r\n  gradeReviews: Array<{\r\n    id: string\r\n    studentName?: string\r\n    className?: string\r\n    assessmentType?: string\r\n    currentScore?: number\r\n    reason?: string\r\n    status?: string\r\n  }>\r\n  leaveRequests: Array<{\r\n    id: string\r\n    studentName?: string\r\n    startDate?: string\r\n    endDate?: string\r\n    reason?: string\r\n    status?: string\r\n  }>\r\n  classes: Array<{\r\n    id: string\r\n    name?: string\r\n    subject?: string\r\n    studentCount?: number\r\n    schedule?: string\r\n    isHomeroom?: boolean\r\n  }>\r\n  schedule: Array<{\r\n    period: number\r\n    subject?: string\r\n    className?: string\r\n    time?: string\r\n    room?: string\r\n  }>\r\n  assessments: {\r\n    evaluated: number\r\n    pending: number\r\n    positive: number\r\n    needsAttention: number\r\n  }\r\n}\r\n\r\n// Type for data with status field\r\ntype WithStatus = { status?: string }\r\ntype WithRating = { rating?: number }\r\n\r\n// Safe helper to extract initials from name\r\nfunction getInitials(name?: string): string {\r\n  if (!name) return '??'\r\n  const parts = name.trim().split(' ')\r\n  const lastPart = parts[parts.length - 1] || ''\r\n  return lastPart.substring(0, 2).toUpperCase()\r\n}\r\n\r\nasync function fetchDashboardData(): Promise<DashboardData> {\r\n  // Get authenticated teacher\r\n  const user = await requireAuth()\r\n  const teacherId = user.id\r\n\r\n  // Get classes first to find homeroom class\r\n  const teacherClasses = await getTeacherClasses(teacherId).catch(() => [])\r\n  const homeroomClass = teacherClasses.find((c) => c.isHomeroom)\r\n  const homeroomClassId = homeroomClass?.id || '6A1'\r\n\r\n  const defaultStats: TeacherStats = {\r\n    homeroom: 0,\r\n    teaching: 0,\r\n    students: 0,\r\n    pendingAttendance: 0,\r\n    pendingGrades: 0,\r\n    gradeReviewRequests: 0,\r\n    leaveRequests: 0,\r\n    todaySchedule: [],\r\n  }\r\n\r\n  const [stats, leaveRequests, schedule, classes, regularAssessments] = await Promise.all([\r\n    getTeacherStats(teacherId).catch(() => defaultStats),\r\n    getLeaveRequests(homeroomClassId).catch(() => []),\r\n    getTeacherSchedule(teacherId).catch(() => []),\r\n    Promise.resolve(teacherClasses),\r\n    getRegularAssessments(teacherId).catch(() => []),\r\n  ])\r\n\r\n  // Calculate assessment stats\r\n  const evaluated = regularAssessments.filter((a) => a.status === 'evaluated').length\r\n  const pending = regularAssessments.filter((a) => a.status === 'pending').length\r\n  const positive = regularAssessments.filter((a: WithRating) => a.rating && a.rating >= 4).length\r\n  const needsAttention = regularAssessments.filter((a) => a.status === 'needs-attention').length\r\n\r\n  return {\r\n    stats: {\r\n      ...stats,\r\n      homeroomClassId,\r\n    },\r\n    gradeReviews: [],\r\n    leaveRequests: (leaveRequests || []).filter((r: WithStatus) => r.status === 'pending'),\r\n    schedule: schedule || [],\r\n    classes: classes || [],\r\n    assessments: {\r\n      evaluated,\r\n      pending,\r\n      positive,\r\n      needsAttention,\r\n    },\r\n  }\r\n}\r\n\r\nexport default async function TeacherDashboard() {\r\n  const data = await fetchDashboardData()\r\n  const {\r\n    stats = {\r\n      homeroom: 0,\r\n      teaching: 0,\r\n      students: 0,\r\n      pendingAttendance: 0,\r\n      pendingGrades: 0,\r\n      gradeReviewRequests: 0,\r\n      leaveRequests: 0,\r\n      todaySchedule: [],\r\n    },\r\n    gradeReviews = [],\r\n    leaveRequests = [],\r\n    classes = [],\r\n    schedule = [],\r\n    assessments = { evaluated: 0, pending: 0, positive: 0, needsAttention: 0 }\r\n  } = data || {}\r\n\r\n  return (\r\n    <div className=\"space-y-8 p-8\">\r\n      {/* Page Header */}\r\n      <div>\r\n        <h1 className=\"text-2xl font-extrabold text-gray-900\">Bảng điều khiển Giáo viên</h1>\r\n        <p className=\"text-gray-500\">Học kỳ II • Tuần 24</p>\r\n      </div>\r\n\r\n      {/* Stats Grid */}\r\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6\">\r\n        <Card className=\"border-l-4 border-l-blue-500\">\r\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n            <CardTitle className=\"text-sm font-medium text-gray-600\">Lớp giảng dạy</CardTitle>\r\n            <div className=\"rounded-lg bg-blue-50 p-2\">\r\n              <BookOpen className=\"h-4 w-4 text-blue-600\" />\r\n            </div>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-black text-gray-900\">{stats.teaching}</div>\r\n            <p className=\"text-xs text-gray-500\">Lớp chủ nhiệm: {stats.homeroom}</p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card className=\"border-l-4 border-l-red-500\">\r\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n            <CardTitle className=\"text-sm font-medium text-gray-600\">Phúc khảo mới</CardTitle>\r\n            <div className=\"rounded-lg bg-red-50 p-2\">\r\n              <FileText className=\"h-4 w-4 text-red-600\" />\r\n            </div>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"flex items-center justify-between\">\r\n              <div className=\"text-2xl font-black text-gray-900\">{stats.gradeReviewRequests}</div>\r\n              <Badge variant=\"destructive\" className=\"text-xs\">Mới</Badge>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card className=\"border-l-4 border-l-orange-500\">\r\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n            <CardTitle className=\"text-sm font-medium text-gray-600\">Đơn nghỉ phép</CardTitle>\r\n            <div className=\"rounded-lg bg-orange-50 p-2\">\r\n              <Calendar className=\"h-4 w-4 text-orange-600\" />\r\n            </div>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-black text-gray-900\">{stats.leaveRequests}</div>\r\n            <p className=\"text-xs text-gray-500\">Chờ duyệt</p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card className=\"border-l-4 border-l-green-500\">\r\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n            <CardTitle className=\"text-sm font-medium text-gray-600\">Đã nhập điểm</CardTitle>\r\n            <div className=\"rounded-lg bg-green-50 p-2\">\r\n              <CheckCircle className=\"h-4 w-4 text-green-600\" />\r\n            </div>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-black text-gray-900\">92%</div>\r\n            <p className=\"text-xs text-gray-500\">{stats.pendingGrades} bài còn lại</p>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n        {/* Left Column - Main Content */}\r\n        <div className=\"lg:col-span-2 space-y-8\">\r\n          {/* Grade Review Requests */}\r\n          <Card>\r\n            <CardHeader>\r\n              <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                  <CardTitle className=\"text-lg font-black\">Yêu cầu Phúc khảo (GVBM)</CardTitle>\r\n                  <p className=\"text-xs text-gray-500 font-medium uppercase tracking-widest mt-1\">\r\n                    Các bài thi môn Toán cần chấm lại\r\n                  </p>\r\n                </div>\r\n                <Link href=\"/teacher/assessments\">\r\n                  <Button variant=\"link\" className=\"text-sky-600 text-xs font-black uppercase tracking-widest p-0 h-auto\">\r\n                    Xem tất cả\r\n                  </Button>\r\n                </Link>\r\n              </div>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-3\">\r\n              {gradeReviews.slice(0, 3).map((request) => (\r\n                <div\r\n                  key={request.id}\r\n                  className=\"p-4 bg-gray-50 rounded-2xl flex items-center justify-between hover:bg-gray-100 transition-all border border-transparent hover:border-blue-200\"\r\n                >\r\n                  <div className=\"flex items-center gap-4\">\r\n                    <div className=\"w-12 h-12 bg-white rounded-xl flex items-center justify-center font-bold text-gray-400 border border-gray-200 shadow-sm\">\r\n                      {getInitials(request.studentName)}\r\n                    </div>\r\n                    <div>\r\n                      <p className=\"text-sm font-bold text-gray-900\">\r\n                        {request.studentName || 'N/A'} • {request.className || 'N/A'}\r\n                      </p>\r\n                      <p className=\"text-xs text-gray-500\">\r\n                        {request.assessmentType === 'final' ? 'Thi cuối kỳ' : 'Kiểm tra 15 phút'} • Điểm hiện tại:{' '}\r\n                        <span className=\"font-bold text-red-500\">{request.currentScore ?? 'N/A'}</span>\r\n                      </p>\r\n                      {request.reason && (\r\n                        <p className=\"text-xs text-gray-600 mt-1 italic\">Lý do: {request.reason}</p>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <Button variant=\"outline\" size=\"sm\">\r\n                      Chi tiết\r\n                    </Button>\r\n                    <Button size=\"sm\">Chấm lại</Button>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n              {gradeReviews.length === 0 && (\r\n                <div className=\"text-center text-gray-400 py-8\">Không có yêu cầu phúc khảo nào</div>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* Regular Assessment Section */}\r\n          <Card>\r\n            <CardHeader>\r\n              <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                  <CardTitle className=\"text-lg font-black\">Đánh giá nhận xét</CardTitle>\r\n                  <p className=\"text-xs text-gray-500 font-medium uppercase tracking-widest mt-1\">\r\n                    Đánh giá học sinh theo môn\r\n                  </p>\r\n                </div>\r\n                <Link href=\"/teacher/assessments\">\r\n                  <Button variant=\"link\" className=\"text-sky-600 text-xs font-black uppercase tracking-widest p-0 h-auto\">\r\n                    Xem tất cả\r\n                  </Button>\r\n                </Link>\r\n              </div>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n                <Card className=\"bg-gradient-to-br from-green-50 to-green-100 border-green-200\">\r\n                  <CardContent className=\"pt-6\">\r\n                    <div className=\"text-3xl font-bold text-green-600\">\r\n                      {assessments.evaluated}\r\n                    </div>\r\n                    <div className=\"text-sm text-green-700 font-bold mt-1\">Đã đánh giá</div>\r\n                  </CardContent>\r\n                </Card>\r\n                <Card className=\"bg-gradient-to-br from-amber-50 to-amber-100 border-amber-200\">\r\n                  <CardContent className=\"pt-6\">\r\n                    <div className=\"text-3xl font-bold text-amber-600\">\r\n                      {assessments.pending}\r\n                    </div>\r\n                    <div className=\"text-sm text-amber-700 font-bold mt-1\">Chưa đánh giá</div>\r\n                  </CardContent>\r\n                </Card>\r\n                <Card className=\"bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200\">\r\n                  <CardContent className=\"pt-6\">\r\n                    <div className=\"text-3xl font-bold text-blue-600\">\r\n                      {assessments.positive}\r\n                    </div>\r\n                    <div className=\"text-sm text-blue-700 font-bold mt-1\">Tiếp tục cố gắng</div>\r\n                  </CardContent>\r\n                </Card>\r\n                <Card className=\"bg-gradient-to-br from-red-50 to-red-100 border-red-200\">\r\n                  <CardContent className=\"pt-6\">\r\n                    <div className=\"text-3xl font-bold text-red-600\">\r\n                      {assessments.needsAttention}\r\n                    </div>\r\n                    <div className=\"text-sm text-red-700 font-bold mt-1\">Cần lưu ý</div>\r\n                  </CardContent>\r\n                </Card>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* Leave Requests */}\r\n          <Card>\r\n            <CardHeader>\r\n              <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                  <CardTitle className=\"text-lg font-black\">Đơn nghỉ phép chờ duyệt (GVCN)</CardTitle>\r\n                  <p className=\"text-xs text-gray-500 font-medium uppercase tracking-widest mt-1\">\r\n                    Lớp chủ nhiệm {stats.homeroom}\r\n                  </p>\r\n                </div>\r\n                <Button variant=\"link\" className=\"text-sky-600 text-xs font-black uppercase tracking-widest\">\r\n                  Lịch sử\r\n                </Button>\r\n              </div>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"overflow-x-auto\">\r\n                <table className=\"w-full text-left\">\r\n                  <thead className=\"bg-gray-50\">\r\n                    <tr>\r\n                      <th className=\"px-4 py-3 text-[10px] font-black text-gray-400 uppercase tracking-widest\">\r\n                        Học sinh\r\n                      </th>\r\n                      <th className=\"px-4 py-3 text-[10px] font-black text-gray-400 uppercase tracking-widest\">\r\n                        Ngày nghỉ\r\n                      </th>\r\n                      <th className=\"px-4 py-3 text-[10px] font-black text-gray-400 uppercase tracking-widest\">\r\n                        Lý do\r\n                      </th>\r\n                      <th className=\"px-4 py-3 text-[10px] font-black text-gray-400 uppercase tracking-widest\">\r\n                        Hành động\r\n                      </th>\r\n                    </tr>\r\n                  </thead>\r\n                  <tbody className=\"divide-y divide-gray-100\">\r\n                    {leaveRequests.map((request) => (\r\n                      <tr key={request.id}>\r\n                        <td className=\"px-4 py-4 font-bold text-sm text-gray-700\">{request.studentName || 'N/A'}</td>\r\n                        <td className=\"px-4 py-4 text-xs font-medium text-gray-500\">\r\n                          {request.startDate ? new Date(request.startDate).toLocaleDateString('vi-VN') : 'N/A'} - {request.endDate ? new Date(request.endDate).toLocaleDateString('vi-VN') : 'N/A'}\r\n                        </td>\r\n                        <td className=\"px-4 py-4 text-xs text-gray-400 italic\">{request.reason || 'N/A'}</td>\r\n                        <td className=\"px-4 py-4\">\r\n                          <div className=\"flex gap-2\">\r\n                            <Button variant=\"outline\" size=\"sm\">\r\n                              Chi tiết\r\n                            </Button>\r\n                            <Button variant=\"outline\" size=\"sm\" className=\"text-green-600 hover:text-green-700\">\r\n                              Duyệt\r\n                            </Button>\r\n                            <Button variant=\"outline\" size=\"sm\" className=\"text-red-600 hover:text-red-700\">\r\n                              Từ chối\r\n                            </Button>\r\n                          </div>\r\n                        </td>\r\n                      </tr>\r\n                    ))}\r\n                  </tbody>\r\n                </table>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* My Classes */}\r\n          <Card>\r\n            <CardHeader>\r\n              <div className=\"flex items-center justify-between\">\r\n                <CardTitle className=\"text-lg font-black\">Lớp đang dạy</CardTitle>\r\n                <Link href=\"/teacher/grades\">\r\n                  <Button variant=\"link\" className=\"text-sky-600 text-xs font-black uppercase tracking-widest p-0 h-auto\">\r\n                    Xem tất cả\r\n                  </Button>\r\n                </Link>\r\n              </div>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"grid md:grid-cols-2 gap-4\">\r\n                {classes.slice(0, 4).map((cls) => (\r\n                  <Link key={cls.id} href={`/teacher/grades/${cls.id}`}>\r\n                    <div className=\"p-4 bg-gray-50 rounded-2xl hover:bg-gray-100 transition-all border border-transparent hover:border-blue-200 cursor-pointer\">\r\n                      <div className=\"flex items-start justify-between mb-3\">\r\n                        <div>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <h4 className=\"font-bold text-gray-900\">{cls.name || 'N/A'}</h4>\r\n                            {cls.isHomeroom && (\r\n                              <Badge variant=\"outline\" className=\"text-xs\">\r\n                                CN\r\n                              </Badge>\r\n                            )}\r\n                          </div>\r\n                          <p className=\"text-xs text-gray-500\">{cls.subject || 'N/A'}</p>\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"flex items-center gap-4 text-xs text-gray-600\">\r\n                        <div className=\"flex items-center gap-1\">\r\n                          <Users className=\"h-3 w-3\" />\r\n                          <span>{cls.studentCount ?? 0} HS</span>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-1\">\r\n                          <Clock className=\"h-3 w-3\" />\r\n                          <span>{cls.schedule || 'N/A'}</span>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </Link>\r\n                ))}\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n\r\n        {/* Right Column - Sidebar */}\r\n        <div className=\"space-y-8\">\r\n          {/* Today's Schedule */}\r\n          <Card className=\"bg-gray-900 text-white\">\r\n            <CardHeader>\r\n              <CardTitle className=\"text-lg font-black\">Lịch dạy hôm nay</CardTitle>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-6\">\r\n              {schedule.map((item, index) => (\r\n                <div key={item.period} className=\"relative pl-6 border-l-2 border-blue-500/30\">\r\n                  <div className={`absolute -left-[5px] top-0 w-2 h-2 rounded-full ${index === 0 ? 'bg-blue-500' : 'bg-gray-600'}`} />\r\n                  <p className=\"text-[10px] font-black text-gray-400 uppercase tracking-widest mb-1\">\r\n                    Tiết {item.period}\r\n                  </p>\r\n                  <p className=\"text-sm font-bold\">{item.subject || 'N/A'} • {item.className || 'N/A'}</p>\r\n                  <p className=\"text-xs text-gray-500\">{item.time || 'N/A'} • Phòng {item.room || 'N/A'}</p>\r\n                </div>\r\n              ))}\r\n            </CardContent>\r\n            <div className=\"p-6 pt-0\">\r\n              <Link href=\"/teacher/schedule\">\r\n                <Button variant=\"outline\" className=\"w-full bg-white/10 text-white hover:bg-white/20 border-white/20\">\r\n                  Xem toàn bộ lịch\r\n                </Button>\r\n              </Link>\r\n            </div>\r\n          </Card>\r\n\r\n          {/* Messages Widget */}\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"text-lg font-black\">Tin nhắn mới</CardTitle>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-4\">\r\n              <div className=\"flex gap-3 items-start\">\r\n                <div className=\"w-2 h-2 rounded-full bg-sky-600 mt-1.5 shrink-0\" />\r\n                <div>\r\n                  <p className=\"text-xs font-bold text-gray-700 leading-snug\">\r\n                    Nhà trường: Họp hội đồng sư phạm vào 16:30 chiều nay.\r\n                  </p>\r\n                  <p className=\"text-[10px] text-gray-400 mt-1\">10 phút trước</p>\r\n                </div>\r\n              </div>\r\n              <div className=\"flex gap-3 items-start\">\r\n                <div className=\"w-2 h-2 rounded-full bg-gray-200 mt-1.5 shrink-0\" />\r\n                <div>\r\n                  <p className=\"text-xs font-bold text-gray-700 leading-snug\">\r\n                    Admin: Đã cập nhật mẫu báo cáo học kỳ II mới.\r\n                  </p>\r\n                  <p className=\"text-[10px] text-gray-400 mt-1\">2 giờ trước</p>\r\n                </div>\r\n              </div>\r\n              <Link href=\"/teacher/messages\" className=\"block\">\r\n                <Button variant=\"outline\" className=\"w-full\">Xem tất cả tin nhắn</Button>\r\n              </Link>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* Quick Actions */}\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"text-lg font-black\">Thao tác nhanh</CardTitle>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-3\">\r\n              <Link href=\"/teacher/attendance\" className=\"block\">\r\n                <Button variant=\"outline\" className=\"w-full justify-start\">\r\n                  <Calendar className=\"h-4 w-4 mr-2\" />\r\n                  Điểm danh nhanh\r\n                </Button>\r\n              </Link>\r\n              <Link href=\"/teacher/grades\" className=\"block\">\r\n                <Button variant=\"outline\" className=\"w-full justify-start\">\r\n                  <FileText className=\"h-4 w-4 mr-2\" />\r\n                  Nhập điểm\r\n                </Button>\r\n              </Link>\r\n              <Link href=\"/teacher/messages\" className=\"block\">\r\n                <Button variant=\"outline\" className=\"w-full justify-start\">\r\n                  <MessageSquare className=\"h-4 w-4 mr-2\" />\r\n                  Gửi tin nhắn\r\n                </Button>\r\n              </Link>\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\teacher\\grades\\[classId]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Card' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardContent' is defined but never used.","line":4,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Info' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":14}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { notFound } from 'next/navigation'\nimport { getTeacherClasses, getGradeEntrySheet } from '@/lib/supabase/queries'\nimport { GradeEntryForm } from '@/components/teacher/GradeEntryForm'\nimport { Card, CardContent } from '@/components/ui/card'\nimport { Info } from 'lucide-react'\n\ninterface PageProps {\n  params: Promise<{ classId: string }>\n}\n\nexport default async function ClassGradesPage({ params }: PageProps) {\n  const { classId } = await params\n  const classes = await getTeacherClasses('current-teacher-id')\n  const cls = classes.find(c => c.id === classId)\n  const { students, subject } = await getGradeEntrySheet(classId)\n\n  if (!cls) {\n    notFound()\n  }\n\n  return (\n    <div className=\"space-y-6 p-8\">\n      {/* Page Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <div className=\"flex items-center gap-3 mb-2\">\n            <h1 className=\"text-2xl font-bold text-gray-900\">Nhập điểm - {cls.name}</h1>\n            {cls.isHomeroom && (\n              <span className=\"px-2 py-1 bg-sky-100 text-sky-700 text-xs font-medium rounded-full\">\n                Lớp chủ nhiệm\n              </span>\n            )}\n          </div>\n          <p className=\"text-gray-500\">Môn: {subject} • {cls.studentCount} học sinh</p>\n        </div>\n      </div>\n\n      {/* Grade Info Card - Remove this as it's now handled in the component */}\n\n      {/* Grade Entry Form */}\n      <GradeEntryForm students={students} subject={subject} classId={classId} />\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\teacher\\grades\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\teacher\\homeroom\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\teacher\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\teacher\\leave-approval\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardHeader' is defined but never used.","line":4,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":39},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1888,1891],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1888,1891],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":74,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2442,2445],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2442,2445],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState, useEffect } from 'react'\r\nimport { Card, CardContent, CardHeader } from '@/components/ui/card'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Badge } from '@/components/ui/badge'\r\nimport { Calendar, Clock, CheckCircle, XCircle, User, FileText, Phone } from 'lucide-react'\r\n\r\ninterface LeaveRequestApproval {\r\n  id: string\r\n  studentId: string\r\n  studentName: string\r\n  classId: string\r\n  className: string\r\n  startDate: string\r\n  endDate: string\r\n  reason: string\r\n  status: 'pending' | 'approved' | 'rejected'\r\n  submittedDate: string\r\n  parentContact?: string\r\n}\r\n\r\nexport default function LeaveApprovalPage() {\r\n  const [activeTab, setActiveTab] = useState<'pending' | 'history'>('pending')\r\n  const [requests, setRequests] = useState<LeaveRequestApproval[]>([])\r\n  const [loading, setLoading] = useState(true)\r\n\r\n  // Fetch leave requests on mount and when tab changes\r\n  useEffect(() => {\r\n    async function fetchRequests() {\r\n      setLoading(true)\r\n      try {\r\n        const status = activeTab === 'pending' ? 'pending' : undefined\r\n        const res = await fetch(`/api/teacher/leave-requests?status=${status || ''}`)\r\n        const json = await res.json()\r\n        setRequests(json.data)\r\n      } catch (error) {\r\n        console.error('Failed to fetch leave requests:', error)\r\n        setRequests([])\r\n      } finally {\r\n        setLoading(false)\r\n      }\r\n    }\r\n    fetchRequests()\r\n  }, [activeTab])\r\n\r\n  const handleApprove = async (requestId: string) => {\r\n    try {\r\n      const res = await fetch('/api/teacher/leave-requests', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ requestId, action: 'approve' }),\r\n      })\r\n      const json = await res.json()\r\n      if (json.success) {\r\n        // Remove from list\r\n        setRequests(requests.filter((r: any) => r.id !== requestId))\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to approve request:', error)\r\n    }\r\n  }\r\n\r\n  const handleReject = async (requestId: string) => {\r\n    try {\r\n      const res = await fetch('/api/teacher/leave-requests', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ requestId, action: 'reject' }),\r\n      })\r\n      const json = await res.json()\r\n      if (json.success) {\r\n        // Remove from list\r\n        setRequests(requests.filter((r: any) => r.id !== requestId))\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to reject request:', error)\r\n    }\r\n  }\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"space-y-6 p-8\">\r\n        <div className=\"text-center py-12 text-gray-500\">Đang tải...</div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString('vi-VN', {\r\n      day: '2-digit',\r\n      month: '2-digit',\r\n      year: 'numeric',\r\n    })\r\n  }\r\n\r\n  const renderRequestCard = (request: LeaveRequestApproval) => (\r\n    <Card\r\n      key={request.id}\r\n      className={`transition-all hover:shadow-md ${\r\n        request.status === 'pending'\r\n          ? 'border-amber-200 bg-gradient-to-r from-amber-50 to-orange-50'\r\n          : request.status === 'approved'\r\n          ? 'border-green-200 bg-green-50'\r\n          : 'border-red-200 bg-red-50'\r\n      }`}\r\n    >\r\n      <CardContent className=\"pt-6\">\r\n        <div className=\"flex justify-between items-start gap-4\">\r\n          <div className=\"flex-1 space-y-3\">\r\n            {/* Student Info */}\r\n            <div className=\"flex items-center gap-2\">\r\n              <User className=\"h-4 w-4 text-gray-500\" />\r\n              <div>\r\n                <div className=\"font-bold text-lg text-gray-900\">\r\n                  {request.studentName}\r\n                </div>\r\n                <div className=\"text-sm text-gray-600\">{request.className}</div>\r\n              </div>\r\n              <Badge\r\n                variant=\"outline\"\r\n                className={\r\n                  request.status === 'pending'\r\n                    ? 'bg-amber-100 text-amber-700 border-amber-300'\r\n                    : request.status === 'approved'\r\n                    ? 'bg-green-100 text-green-700 border-green-300'\r\n                    : 'bg-red-100 text-red-700 border-red-300'\r\n                }\r\n              >\r\n                {request.status === 'pending'\r\n                  ? 'Chờ duyệt'\r\n                  : request.status === 'approved'\r\n                  ? 'Đã duyệt'\r\n                  : 'Đã từ chối'}\r\n              </Badge>\r\n            </div>\r\n\r\n            {/* Dates */}\r\n            <div className=\"flex items-center gap-2 text-sm\">\r\n              <Calendar className=\"h-4 w-4 text-gray-500\" />\r\n              <span className=\"font-medium text-gray-700\">Thời gian:</span>\r\n              <span className=\"text-gray-900\">\r\n                {formatDate(request.startDate)} - {formatDate(request.endDate)}\r\n              </span>\r\n            </div>\r\n\r\n            {/* Reason */}\r\n            <div className=\"flex items-start gap-2 text-sm\">\r\n              <FileText className=\"h-4 w-4 text-gray-500 mt-0.5 flex-shrink-0\" />\r\n              <div>\r\n                <span className=\"font-medium text-gray-700\">Lý do:</span>\r\n                <span className=\"text-gray-900 ml-1\">{request.reason}</span>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Parent Contact */}\r\n            {request.parentContact && (\r\n              <div className=\"flex items-center gap-2 text-sm\">\r\n                <Phone className=\"h-4 w-4 text-gray-500\" />\r\n                <span className=\"font-medium text-gray-700\">Liên hệ:</span>\r\n                <span className=\"text-sky-600 font-medium\">{request.parentContact}</span>\r\n              </div>\r\n            )}\r\n\r\n            {/* Submitted Date */}\r\n            <div className=\"flex items-center gap-2 text-xs text-gray-500\">\r\n              <Clock className=\"h-3 w-3\" />\r\n              <span>Nộp đơn ngày {formatDate(request.submittedDate)}</span>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Action Buttons */}\r\n          {request.status === 'pending' && (\r\n            <div className=\"flex flex-col gap-2\">\r\n              <Button\r\n                size=\"sm\"\r\n                variant=\"outline\"\r\n                className=\"border-red-300 text-red-700 hover:bg-red-50\"\r\n                onClick={() => handleReject(request.id)}\r\n              >\r\n                <XCircle className=\"h-4 w-4 mr-1\" />\r\n                Từ chối\r\n              </Button>\r\n              <Button\r\n                size=\"sm\"\r\n                className=\"bg-green-600 hover:bg-green-700\"\r\n                onClick={() => handleApprove(request.id)}\r\n              >\r\n                <CheckCircle className=\"h-4 w-4 mr-1\" />\r\n                Phê duyệt\r\n              </Button>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  )\r\n\r\n  return (\r\n    <div className=\"space-y-6 p-8\">\r\n      {/* Header */}\r\n      <div>\r\n        <h1 className=\"text-2xl font-bold text-gray-900\">Phê duyệt nghỉ phép</h1>\r\n        <p className=\"text-gray-500\">Xét duyệt đơn xin nghỉ của học sinh</p>\r\n      </div>\r\n\r\n      {/* Tabs */}\r\n      <div className=\"flex gap-2\">\r\n        <Button\r\n          variant={activeTab === 'pending' ? 'default' : 'outline'}\r\n          onClick={() => setActiveTab('pending')}\r\n          className={activeTab === 'pending' ? 'bg-sky-600 hover:bg-sky-700' : ''}\r\n        >\r\n          Chờ phê duyệt\r\n          {requests.length > 0 && (\r\n            <Badge\r\n              className=\"ml-2 bg-amber-500 hover:bg-amber-600\"\r\n              variant=\"secondary\"\r\n            >\r\n              {requests.length}\r\n            </Badge>\r\n          )}\r\n        </Button>\r\n        <Button\r\n          variant={activeTab === 'history' ? 'default' : 'outline'}\r\n          onClick={() => setActiveTab('history')}\r\n          className={activeTab === 'history' ? 'bg-sky-600 hover:bg-sky-700' : ''}\r\n        >\r\n          Lịch sử\r\n        </Button>\r\n      </div>\r\n\r\n      {/* Leave Request Cards */}\r\n      <div className=\"space-y-4\">\r\n        {activeTab === 'pending' ? (\r\n          requests.length === 0 ? (\r\n            <Card>\r\n              <CardContent className=\"pt-12 pb-12 text-center\">\r\n                <Calendar className=\"h-12 w-12 text-gray-300 mx-auto mb-3\" />\r\n                <div className=\"text-gray-500 font-medium\">Không có đơn chờ phê duyệt</div>\r\n              </CardContent>\r\n            </Card>\r\n          ) : (\r\n            requests.map(renderRequestCard)\r\n          )\r\n        ) : requests.length === 0 ? (\r\n          <Card>\r\n            <CardContent className=\"pt-12 pb-12 text-center\">\r\n              <FileText className=\"h-12 w-12 text-gray-300 mx-auto mb-3\" />\r\n              <div className=\"text-gray-500 font-medium\">Chưa có lịch sử phê duyệt</div>\r\n            </CardContent>\r\n          </Card>\r\n        ) : (\r\n          requests.map(renderRequestCard)\r\n        )}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\teacher\\loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\teacher\\messages\\MessagesClient.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setConversations' is assigned a value but never used.","line":20,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":41},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":32,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":32,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1191,1231],"text":""},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useCallback } from 'react'\nimport type { Conversation, Message } from '@/lib/types'\nimport { ConversationList } from '@/components/teacher/ConversationList'\nimport { ChatWindow } from '@/components/teacher/ChatWindow'\nimport { ContactInfoPanel } from '@/components/teacher/ContactInfoPanel'\n\ninterface MessagesClientProps {\n  initialConversations: Conversation[]\n  initialSelectedConversationId?: string\n  initialMessages: Message[]\n}\n\nexport function MessagesClient({\n  initialConversations,\n  initialSelectedConversationId,\n  initialMessages\n}: MessagesClientProps) {\n  const [conversations, setConversations] = useState<Conversation[]>(initialConversations)\n  const [selectedConversationId, setSelectedConversationId] = useState<string | undefined>(initialSelectedConversationId)\n  const [messages, setMessages] = useState<Message[]>(initialMessages)\n\n  const handleSelectConversation = useCallback((id: string) => {\n    setSelectedConversationId(id)\n    // TODO: Implement API call to fetch conversation messages\n    // const msgs = await fetchMessages(id)\n    setMessages([])\n  }, [])\n\n  const handleSendMessage = useCallback((content: string) => {\n    console.log('Sending message:', content)\n    // In real implementation, send to API\n  }, [])\n\n  const selectedConversation = conversations.find(c => c.id === selectedConversationId)\n\n  return (\n    <div className=\"flex h-[calc(100vh-64px)]\">\n      {/* Left Column - Chat List (320px) */}\n      <div className=\"w-80 flex-shrink-0 border-r border-gray-200\">\n        <ConversationList\n          conversations={conversations}\n          selectedId={selectedConversationId}\n          onSelectConversation={handleSelectConversation}\n        />\n      </div>\n\n      {/* Center Column - Active Conversation (flex-1) */}\n      <div className=\"flex-1 flex flex-col bg-gray-50\">\n        {selectedConversationId ? (\n          <ChatWindow\n            conversationId={selectedConversationId}\n            messages={messages}\n            onSendMessage={handleSendMessage}\n            conversation={selectedConversation}\n          />\n        ) : (\n          <div className=\"flex items-center justify-center h-full\">\n            <div className=\"text-center text-gray-400\">\n              <p>Chọn một cuộc hội thoại</p>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Right Column - Contact Info (320px, hidden on mobile) */}\n      <div className=\"hidden lg:block w-80 flex-shrink-0 border-l border-gray-200 bg-white\">\n        <ContactInfoPanel conversation={selectedConversation} />\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\teacher\\messages\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Conversation' is defined but never used.","line":2,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Message' is defined but never used.","line":2,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":36}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { getTeacherConversations, getConversationMessages } from '@/lib/supabase/queries'\nimport type { Conversation, Message } from '@/lib/types'\nimport { MessagesClient } from './MessagesClient'\n\nexport default async function MessagesPage() {\n  const conversations = await getTeacherConversations()\n  const selectedConversationId = conversations.length > 0 ? conversations[0].id : undefined\n  const initialMessages = selectedConversationId\n    ? await getConversationMessages(selectedConversationId)\n    : []\n\n  return (\n    <MessagesClient\n      initialConversations={conversations}\n      initialSelectedConversationId={selectedConversationId}\n      initialMessages={initialMessages}\n    />\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\teacher\\regular-assessment\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardHeader' is defined but never used.","line":4,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardTitle' is defined but never used.","line":4,"column":41,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":50},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":39,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1574,1577],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1574,1577],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1817,1820],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1817,1820],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1905,1908],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1905,1908],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1992,1995],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1992,1995],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":48,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2088,2091],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2088,2091],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":59,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":59,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2368,2411],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":64,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":64,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2507,2549],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":69,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":69,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2648,2689],"text":""},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState, useEffect } from 'react'\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\r\nimport { Input } from '@/components/ui/input'\r\nimport { StudentAssessmentCard, RegularAssessment } from '@/components/teacher/StudentAssessmentCard'\r\nimport { CheckCircle, Clock, AlertCircle, TrendingUp, Search } from 'lucide-react'\r\n\r\nexport default function RegularAssessmentPage() {\r\n  const [selectedClass, setSelectedClass] = useState<string>('all')\r\n  const [selectedStatus, setSelectedStatus] = useState<string>('all')\r\n  const [searchQuery, setSearchQuery] = useState('')\r\n  const [assessments, setAssessments] = useState<RegularAssessment[]>([])\r\n  const [loading, setLoading] = useState(true)\r\n\r\n  // Fetch assessments on mount\r\n  useEffect(() => {\r\n    async function fetchAssessments() {\r\n      setLoading(true)\r\n      try {\r\n        const params = new URLSearchParams()\r\n        if (selectedClass !== 'all') params.append('classId', selectedClass)\r\n        if (selectedStatus !== 'all') params.append('status', selectedStatus)\r\n\r\n        const res = await fetch(`/api/teacher/assessments?${params.toString()}`)\r\n        const json = await res.json()\r\n        setAssessments(json.data)\r\n      } catch (error) {\r\n        console.error('Failed to fetch assessments:', error)\r\n        setAssessments([])\r\n      } finally {\r\n        setLoading(false)\r\n      }\r\n    }\r\n    fetchAssessments()\r\n  }, [selectedClass, selectedStatus])\r\n\r\n  // Filter by search query\r\n  const filteredAssessments = assessments.filter((assessment: any) =>\r\n    assessment.studentName.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n    assessment.className.toLowerCase().includes(searchQuery.toLowerCase())\r\n  )\r\n\r\n  // Calculate stats\r\n  const evaluatedCount = assessments.filter((a: any) => a.status === 'evaluated').length\r\n  const pendingCount = assessments.filter((a: any) => a.status === 'pending').length\r\n  const positiveCount = assessments.filter((a: any) => a.rating && a.rating >= 4).length\r\n  const needsAttentionCount = assessments.filter((a: any) => a.status === 'needs-attention').length\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"space-y-6 p-8\">\r\n        <div className=\"text-center py-12 text-gray-500\">Đang tải...</div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  const handleEvaluate = (studentId: string) => {\r\n    console.log('Evaluate student:', studentId)\r\n    // TODO: Open evaluation modal\r\n  }\r\n\r\n  const handleEdit = (studentId: string) => {\r\n    console.log('Edit assessment:', studentId)\r\n    // TODO: Open edit modal\r\n  }\r\n\r\n  const handleContactParent = (studentId: string) => {\r\n    console.log('Contact parent:', studentId)\r\n    // TODO: Open contact modal or redirect to messages\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6 p-8\">\r\n      {/* Header */}\r\n      <div>\r\n        <h1 className=\"text-2xl font-bold text-gray-900\">Đánh giá nhận xét</h1>\r\n        <p className=\"text-gray-500\">Nhận xét học tập của học sinh</p>\r\n      </div>\r\n\r\n      {/* Filter Bar */}\r\n      <Card>\r\n        <CardContent className=\"pt-6\">\r\n          <div className=\"flex gap-4 flex-wrap\">\r\n            <select\r\n              className=\"px-3 py-2 border rounded-lg text-sm bg-white\"\r\n              value={selectedClass}\r\n              onChange={(e) => setSelectedClass(e.target.value)}\r\n            >\r\n              <option value=\"all\">Tất cả các lớp</option>\r\n              <option value=\"6A\">6A</option>\r\n              <option value=\"7A\">7A</option>\r\n              <option value=\"8A\">8A</option>\r\n              <option value=\"9A\">9A</option>\r\n            </select>\r\n            <select\r\n              className=\"px-3 py-2 border rounded-lg text-sm bg-white\"\r\n              value={selectedStatus}\r\n              onChange={(e) => setSelectedStatus(e.target.value)}\r\n            >\r\n              <option value=\"all\">Tất cả trạng thái</option>\r\n              <option value=\"evaluated\">Đã đánh giá</option>\r\n              <option value=\"pending\">Chưa đánh giá</option>\r\n              <option value=\"needs-attention\">Cần lưu ý</option>\r\n            </select>\r\n            <div className=\"relative flex-1 min-w-[200px]\">\r\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400\" />\r\n              <Input\r\n                placeholder=\"Tìm kiếm học sinh...\"\r\n                value={searchQuery}\r\n                onChange={(e) => setSearchQuery(e.target.value)}\r\n                className=\"pl-10\"\r\n              />\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Summary Stats */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n        <Card className=\"border-l-4 border-green-500 bg-gradient-to-r from-green-50 to-white\">\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <div className=\"text-3xl font-black text-green-600\">{evaluatedCount}</div>\r\n                <div className=\"text-sm text-gray-600 font-medium mt-1\">Đã đánh giá</div>\r\n              </div>\r\n              <CheckCircle className=\"h-8 w-8 text-green-500\" />\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n        <Card className=\"border-l-4 border-amber-500 bg-gradient-to-r from-amber-50 to-white\">\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <div className=\"text-3xl font-black text-amber-600\">{pendingCount}</div>\r\n                <div className=\"text-sm text-gray-600 font-medium mt-1\">Chưa đánh giá</div>\r\n              </div>\r\n              <Clock className=\"h-8 w-8 text-amber-500\" />\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n        <Card className=\"border-l-4 border-blue-500 bg-gradient-to-r from-blue-50 to-white\">\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <div className=\"text-3xl font-black text-blue-600\">{positiveCount}</div>\r\n                <div className=\"text-sm text-gray-600 font-medium mt-1\">Tiếp tục cố gắng</div>\r\n              </div>\r\n              <TrendingUp className=\"h-8 w-8 text-blue-500\" />\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n        <Card className=\"border-l-4 border-red-500 bg-gradient-to-r from-red-50 to-white\">\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <div className=\"text-3xl font-black text-red-600\">{needsAttentionCount}</div>\r\n                <div className=\"text-sm text-gray-600 font-medium mt-1\">Cần lưu ý</div>\r\n              </div>\r\n              <AlertCircle className=\"h-8 w-8 text-red-500\" />\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Student Cards */}\r\n      <div className=\"space-y-4\">\r\n        {filteredAssessments.length === 0 ? (\r\n          <Card>\r\n            <CardContent className=\"pt-12 pb-12 text-center\">\r\n              <div className=\"text-gray-400\">Không có học sinh nào phù hợp với bộ lọc</div>\r\n            </CardContent>\r\n          </Card>\r\n        ) : (\r\n          filteredAssessments.map((assessment) => (\r\n            <StudentAssessmentCard\r\n              key={assessment.studentId}\r\n              assessment={assessment}\r\n              onEvaluate={handleEvaluate}\r\n              onEdit={handleEdit}\r\n              onContactParent={handleContactParent}\r\n            />\r\n          ))\r\n        )}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\app\\teacher\\schedule\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\ActivityLogTable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\AttendanceBoxes.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\AttendanceChart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\ClassCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\FeeCollectionChart.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'circumference' is assigned a value but never used.","line":38,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { CheckCircle2, Clock } from 'lucide-react'\nimport type { FeeStats } from '@/lib/types'\nimport { useState, useEffect } from 'react'\n\ninterface FeeCollectionChartProps {\n  initialData: FeeStats\n}\n\nexport function FeeCollectionChart({ initialData }: FeeCollectionChartProps) {\n  const [semester, setSemester] = useState<'1' | '2'>('1')\n  const [data, setData] = useState(initialData)\n\n  useEffect(() => {\n    const mockData: Record<typeof semester, FeeStats> = {\n      '1': {\n        percentage: 84,\n        paidAmount: '2.14 tỷ',\n        remainingAmount: '980 triệu',\n        totalAmount: '3.12 tỷ',\n        paidStudents: 856,\n        totalStudents: 1248,\n      },\n      '2': {\n        percentage: 76,\n        paidAmount: '1.91 tỷ',\n        remainingAmount: '1.21 tỷ',\n        totalAmount: '3.12 tỷ',\n        paidStudents: 765,\n        totalStudents: 1248,\n      },\n    }\n    setData(mockData[semester])\n  }, [semester])\n\n  const circumference = 2 * Math.PI * 15.9155\n  const strokeDasharray = `${data.percentage}, 100`\n\n  return (\n    <Card className=\"rounded-3xl border-slate-100\">\n      <CardHeader className=\"pb-4\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <CardTitle className=\"text-lg font-black text-slate-800 tracking-tight\">\n              Thu Học phí & Khoản thu\n            </CardTitle>\n            <p className=\"text-slate-400 text-[10px] font-bold uppercase tracking-widest mt-1\">\n              Tiến độ hoàn thành kế hoạch thu\n            </p>\n          </div>\n          <div className=\"flex bg-slate-100 p-1 rounded-xl\">\n            <button\n              onClick={() => setSemester('1')}\n              className={`px-4 py-1.5 rounded-lg text-[10px] font-bold transition-all ${\n                semester === '1'\n                  ? 'bg-white shadow-sm text-slate-800'\n                  : 'text-slate-500 hover:text-slate-800'\n              }`}\n            >\n              Kỳ I\n            </button>\n            <button\n              onClick={() => setSemester('2')}\n              className={`px-4 py-1.5 rounded-lg text-[10px] font-bold transition-all ${\n                semester === '2'\n                  ? 'bg-white shadow-sm text-slate-800'\n                  : 'text-slate-500 hover:text-slate-800'\n              }`}\n            >\n              Kỳ II\n            </button>\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent>\n        <div className=\"flex flex-col md:flex-row items-center justify-around gap-8\">\n          {/* Circular Progress */}\n          <div className=\"relative w-44 h-44 flex-shrink-0\">\n            <svg viewBox=\"0 0 36 36\" className=\"w-full h-full transform -rotate-90\">\n              <path\n                d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\"\n                fill=\"none\"\n                stroke=\"#f1f5f9\"\n                strokeWidth=\"3.5\"\n                strokeDasharray=\"100, 100\"\n              />\n              <path\n                d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\"\n                fill=\"none\"\n                stroke=\"#22c55e\"\n                strokeWidth=\"3.5\"\n                strokeDasharray={strokeDasharray}\n                strokeLinecap=\"round\"\n                className=\"transition-all duration-1000 ease-out\"\n              />\n            </svg>\n            <div className=\"absolute inset-0 flex flex-col items-center justify-center\">\n              <span className=\"text-4xl font-black text-slate-800\">{data.percentage}%</span>\n              <span className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest\">\n                Đã thu\n              </span>\n            </div>\n          </div>\n\n          {/* Stats */}\n          <div className=\"flex-1 w-full space-y-4\">\n            <div className=\"bg-slate-50 p-4 rounded-2xl border border-slate-100 flex justify-between items-center\">\n              <div>\n                <p className=\"text-[9px] font-black text-slate-400 uppercase tracking-wider mb-1\">\n                  Thực thu\n                </p>\n                <p className=\"text-lg font-black text-green-600\">{data.paidAmount}</p>\n              </div>\n              <div className=\"w-10 h-10 rounded-full bg-green-100 flex items-center justify-center text-green-600\">\n                <CheckCircle2 className=\"h-5 w-5\" strokeWidth={2.5} />\n              </div>\n            </div>\n            <div className=\"bg-slate-50 p-4 rounded-2xl border border-slate-100 flex justify-between items-center\">\n              <div>\n                <p className=\"text-[9px] font-black text-slate-400 uppercase tracking-wider mb-1\">\n                  Công nợ\n                </p>\n                <p className=\"text-lg font-black text-orange-600\">{data.remainingAmount}</p>\n              </div>\n              <div className=\"w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center text-orange-600\">\n                <Clock className=\"h-5 w-5\" strokeWidth={2.5} />\n              </div>\n            </div>\n            <div className=\"pt-2 px-1\">\n              <div className=\"flex justify-between text-[11px] font-bold text-slate-500 mb-2\">\n                <span>\n                  Chỉ tiêu: {data.totalAmount} ({data.paidStudents}/{data.totalStudents} HS)\n                </span>\n              </div>\n              <div className=\"w-full h-1.5 bg-slate-100 rounded-full overflow-hidden\">\n                <div\n                  className=\"h-full bg-green-500 rounded-full transition-all duration-1000\"\n                  style={{ width: `${data.percentage}%` }}\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\GradeDistribution.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\InvoiceTracker.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\StatsGrid.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\StudentTable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\SupportRequests.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\UserTable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\attendance\\AttendanceManagement.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":93,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2392,2395],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2392,2395],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":94,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2451,2454],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2451,2454],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":103,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2771,2774],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2771,2774],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":147,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":147,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4315,4318],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4315,4318],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect, useMemo, useCallback, useRef } from 'react'\nimport { CheckCircle, XCircle, Clock, Users } from 'lucide-react'\nimport { StatCard, DataTable, StatusBadge, FilterBar } from '@/components/admin/shared'\nimport type { Column } from '@/components/admin/shared'\n\ninterface AttendanceRecord {\n  id: string\n  studentName: string\n  classId: string\n  date: string\n  status: 'present' | 'absent' | 'late' | 'excused'\n  notes?: string\n}\n\ninterface AttendanceStats {\n  total: number\n  present: number\n  absent: number\n  late: number\n  excused: number\n  rate: number\n}\n\ninterface ApiResponse<T> {\n  success: boolean\n  data: T[]\n  stats?: AttendanceStats\n  total?: number\n}\n\nexport function AttendanceManagement() {\n  const [attendance, setAttendance] = useState<AttendanceRecord[]>([])\n  const [stats, setStats] = useState<AttendanceStats>({\n    total: 0,\n    present: 0,\n    absent: 0,\n    late: 0,\n    excused: 0,\n    rate: 0,\n  })\n  const [loading, setLoading] = useState(true)\n  const [filters, setFilters] = useState({\n    search: '',\n    class: '',\n    status: '',\n    dateRange: '',\n  })\n\n  // Use ref to track previous filter values\n  const prevFiltersRef = useRef<string>('')\n\n  // Fetch attendance from API\n  useEffect(() => {\n    const filterString = JSON.stringify(filters)\n\n    // Only fetch if filters actually changed\n    if (filterString === prevFiltersRef.current) {\n      return\n    }\n\n    prevFiltersRef.current = filterString\n\n    const fetchAttendance = async () => {\n      setLoading(true)\n      const params = new URLSearchParams()\n      if (filters.search) params.append('search', filters.search)\n      if (filters.class) params.append('classId', filters.class)\n      if (filters.status) params.append('status', filters.status)\n\n      try {\n        const response = await fetch(`/api/attendance?${params}`)\n        const result: ApiResponse<AttendanceRecord> = await response.json()\n        if (result.success) {\n          setAttendance(result.data)\n          if (result.stats) {\n            setStats(result.stats)\n          }\n        }\n      } catch (error) {\n        console.error('Failed to fetch attendance:', error)\n      } finally {\n        setLoading(false)\n      }\n    }\n\n    fetchAttendance()\n  }, [filters])\n\n  // Get unique classes - memoized\n  const classOptions = useMemo(() => {\n    const classes = new Set(attendance.map((a: any) => a.classId))\n    return Array.from(classes).map((c: any) => ({ value: c, label: `Lớp ${c}` }))\n  }, [attendance])\n\n  // Clear filters - memoized\n  const handleClearFilters = useCallback(() => {\n    setFilters({ search: '', class: '', status: '', dateRange: '' })\n  }, [])\n\n  // Handle filter change - memoized\n  const handleFilterChange = useCallback((key: string, value: any) => {\n    setFilters(prev => ({ ...prev, [key]: value }))\n  }, [])\n\n  // Status configuration - memoized\n  const statusConfig = useMemo(() => ({\n    present: { label: 'Có mặt', color: 'success' as const, icon: CheckCircle },\n    absent: { label: 'Vắng mặt', color: 'error' as const, icon: XCircle },\n    late: { label: 'Đi muộn', color: 'warning' as const, icon: Clock },\n    excused: { label: 'Có phép', color: 'info' as const, icon: Clock },\n  }), [])\n\n  // Status filter options - memoized\n  const statusFilterOptions = useMemo(() => [\n    { value: 'present', label: 'Có mặt' },\n    { value: 'absent', label: 'Vắng mặt' },\n    { value: 'late', label: 'Đi muộn' },\n    { value: 'excused', label: 'Có phép' },\n  ], [])\n\n  // Memoize filters array for FilterBar\n  const filterBarFilters = useMemo(() => [\n    {\n      key: 'class',\n      label: 'Lớp',\n      type: 'select' as const,\n      options: classOptions,\n    },\n    {\n      key: 'status',\n      label: 'Trạng thái',\n      type: 'select' as const,\n      options: statusFilterOptions,\n    },\n  ], [classOptions, statusFilterOptions])\n\n  // Table columns - memoized\n  const columns = useMemo<Column<AttendanceRecord>[]>(() => [\n    {\n      key: 'studentName',\n      label: 'Học sinh',\n      render: (_value, row) => (\n        <div className=\"flex items-center gap-3\">\n          <div className=\"flex h-10 w-10 items-center justify-center rounded-full bg-gradient-to-br from-[#0284C7] to-[#0369a1] text-xs font-bold text-white\">\n            {row.studentName.split(' ').slice(0, 2).map((n: any) => n[0]).join('')}\n          </div>\n          <div>\n            <p className=\"text-sm font-bold text-slate-800\">{row.studentName}</p>\n            <p className=\"text-xs text-slate-400\">Mã HS: {row.id}</p>\n          </div>\n        </div>\n      ),\n    },\n    {\n      key: 'classId',\n      label: 'Lớp',\n      render: (value) => (\n        <span className=\"rounded-lg bg-slate-100 px-3 py-1 text-xs font-semibold text-slate-600\">\n          {value}\n        </span>\n      ),\n    },\n    {\n      key: 'date',\n      label: 'Ngày điểm danh',\n      render: (value) => (\n        <span className=\"text-sm text-slate-600\">{value}</span>\n      ),\n    },\n    {\n      key: 'status',\n      label: 'Trạng thái',\n      render: (value) => {\n        const config = statusConfig[value as keyof typeof statusConfig]\n        return (\n          <StatusBadge\n            status={config.color}\n            label={config.label}\n          />\n        )\n      },\n    },\n    {\n      key: 'notes',\n      label: 'Ghi chú',\n      render: (value) => value ? (\n        <span className=\"text-xs text-slate-500\">{value}</span>\n      ) : (\n        <span className=\"text-xs text-slate-400\">—</span>\n      ),\n    },\n  ], [statusConfig])\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Statistics Cards */}\n      <div className=\"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4\">\n        <StatCard\n          title=\"Tổng học sinh\"\n          value={stats.total}\n          icon={<Users className=\"h-5 w-5\" />}\n          color=\"blue\"\n        />\n        <StatCard\n          title=\"Có mặt\"\n          value={stats.present}\n          trend={stats.rate}\n          icon={<CheckCircle className=\"h-5 w-5\" />}\n          color=\"green\"\n        />\n        <StatCard\n          title=\"Vắng mặt\"\n          value={stats.absent}\n          icon={<XCircle className=\"h-5 w-5\" />}\n          color=\"red\"\n        />\n        <StatCard\n          title=\"Đi muộn\"\n          value={stats.late}\n          icon={<Clock className=\"h-5 w-5\" />}\n          color=\"orange\"\n        />\n      </div>\n\n      {/* Attendance Rate Card */}\n      <div className=\"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm\">\n        <div className=\"mb-4 flex items-center justify-between\">\n          <h3 className=\"text-lg font-bold text-slate-800\">Tỷ lệ chuyên cần</h3>\n          <span className=\"text-3xl font-black text-[#0284C7]\">{stats.rate}%</span>\n        </div>\n        <div className=\"h-3 w-full overflow-hidden rounded-full bg-slate-100\">\n          <div\n            className=\"h-full bg-gradient-to-r from-[#0284C7] to-[#0369a1] transition-all duration-500\"\n            style={{ width: `${stats.rate}%` }}\n          />\n        </div>\n      </div>\n\n      {/* Filters */}\n      <FilterBar\n        searchKey=\"search\"\n        searchPlaceholder=\"Tìm kiếm học sinh...\"\n        filters={filterBarFilters}\n        values={filters}\n        onChange={handleFilterChange}\n        onClear={handleClearFilters}\n      />\n\n      {/* Data Table */}\n      <div className=\"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm\">\n        <DataTable\n          data={attendance}\n          columns={columns}\n          loading={loading}\n          emptyMessage=\"Không tìm thấy bản ghi điểm danh\"\n        />\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\classes\\AcademicStructure.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MoreVertical' is defined but never used.","line":4,"column":43,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":55},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Class' is defined but never used.","line":10,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":20},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":124,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":124,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4163,4206],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":306,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":306,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12426,12429],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12426,12429],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { Calendar, Users, BookOpen, Plus, MoreVertical, Edit, Trash2 } from 'lucide-react'\nimport { StatCard } from '@/components/admin/shared'\nimport { AddYearModal } from './modals/AddYearModal'\nimport { AddClassModal } from './modals/AddClassModal'\nimport { AddSubjectModal } from './modals/AddSubjectModal'\nimport { EditClassModal } from './modals/EditClassModal'\nimport type { Class } from '@/lib/types'\nimport type { MockClass } from '@/lib/mock-data'\n\ninterface ApiResponse<T> {\n  success: boolean\n  data: T[]\n  total?: number\n}\n\ntype TabId = 'years' | 'classes' | 'subjects'\n\ninterface Tab {\n  id: TabId\n  label: string\n  icon: React.ReactNode\n}\n\nconst tabs: Tab[] = [\n  { id: 'years', label: 'Năm học', icon: <Calendar className=\"h-4 w-4\" /> },\n  { id: 'classes', label: 'Khối lớp', icon: <Users className=\"h-4 w-4\" /> },\n  { id: 'subjects', label: 'Môn học', icon: <BookOpen className=\"h-4 w-4\" /> },\n]\n\n// Mock years data\nconst yearsData = [\n  {\n    id: '2025-2026',\n    name: 'Năm học 2025-2026',\n    isCurrent: true,\n    semester1: '01/09/2025 - 15/01/2026',\n    semester2: '16/01/2026 - 31/05/2026',\n    classes: 24,\n    students: 720,\n  },\n  {\n    id: '2024-2025',\n    name: 'Năm học 2024-2025',\n    isCurrent: false,\n    semester1: '01/09/2024 - 15/01/2025',\n    semester2: '16/01/2025 - 31/05/2025',\n    classes: 20,\n    students: 600,\n  },\n]\n\n// Mock subjects data\nconst subjectsData = [\n  { id: '1', name: 'Toán', category: 'Khoa học tự nhiên', coefficient: 3, classes: 24 },\n  { id: '2', name: 'Văn học', category: 'Khoa học xã hội', coefficient: 2, classes: 24 },\n  { id: '3', name: 'Tiếng Anh', category: 'Ngoại ngữ', coefficient: 2, classes: 24 },\n  { id: '4', name: 'Lý', category: 'Khoa học tự nhiên', coefficient: 2, classes: 12 },\n  { id: '5', name: 'Hóa', category: 'Khoa học tự nhiên', coefficient: 2, classes: 12 },\n  { id: '6', name: 'Sinh', category: 'Khoa học tự nhiên', coefficient: 2, classes: 12 },\n  { id: '7', name: 'Sử', category: 'Khoa học xã hội', coefficient: 1, classes: 24 },\n  { id: '8', name: 'Địa', category: 'Khoa học xã hội', coefficient: 1, classes: 24 },\n  { id: '9', name: 'GDCD', category: 'Khoa học xã hội', coefficient: 1, classes: 24 },\n  { id: '10', name: 'Tin học', category: 'Kỹ thuật', coefficient: 1, classes: 24 },\n  { id: '11', name: 'Công nghệ', category: 'Kỹ thuật', coefficient: 1, classes: 24 },\n]\n\nexport function AcademicStructure() {\n  const [activeTab, setActiveTab] = useState<TabId>('years')\n  const [classes, setClasses] = useState<MockClass[]>([])\n  const [selectedClass, setSelectedClass] = useState<MockClass | null>(null)\n\n  // Modal states\n  const [showAddYearModal, setShowAddYearModal] = useState(false)\n  const [showAddClassModal, setShowAddClassModal] = useState(false)\n  const [showAddSubjectModal, setShowAddSubjectModal] = useState(false)\n  const [showEditClassModal, setShowEditClassModal] = useState(false)\n\n  // Refresh data callback\n  const refreshData = async () => {\n    // Re-fetch classes from API\n    try {\n      const response = await fetch('/api/classes')\n      const result: ApiResponse<MockClass> = await response.json()\n      if (result.success) {\n        setClasses(result.data)\n      }\n    } catch (error) {\n      console.error('Failed to refresh classes:', error)\n    }\n  }\n\n  // Fetch classes from API\n  useEffect(() => {\n    const fetchClasses = async () => {\n      try {\n        const response = await fetch('/api/classes')\n        const result: ApiResponse<MockClass> = await response.json()\n        if (result.success) {\n          setClasses(result.data)\n        }\n      } catch (error) {\n        console.error('Failed to fetch classes:', error)\n      }\n    }\n\n    fetchClasses()\n  }, [])\n\n  const handleEditClass = (cls: MockClass) => {\n    setSelectedClass(cls)\n    setShowEditClassModal(true)\n  }\n\n  const handleDeleteSubject = (subjectId: string, subjectName: string) => {\n    const confirmed = window.confirm(\n      `Bạn có chắc muốn xóa môn học \"${subjectName}\"?\\n\\n` +\n      `Hành động này không thể hoàn tác.`\n    )\n    if (confirmed) {\n      // TODO: API - DELETE /api/subjects/:id\n      console.log('Deleting subject:', subjectId)\n    }\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Tab Navigation */}\n      <div className=\"flex gap-2 border-b border-slate-200\">\n        {tabs.map((tab) => (\n          <button\n            key={tab.id}\n            onClick={() => setActiveTab(tab.id)}\n            className={`flex items-center gap-2 rounded-t-lg px-4 py-3 text-sm font-bold transition-all ${\n              activeTab === tab.id\n                ? 'bg-[rgba(2,132,199,0.1)] text-[#0284C7] border-b-2 border-[#0284C7]'\n                : 'text-slate-600 hover:bg-slate-50'\n            }`}\n          >\n            {tab.icon}\n            {tab.label}\n          </button>\n        ))}\n      </div>\n\n      {/* Tab Content */}\n      <div className=\"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm\">\n        {activeTab === 'years' && (\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <h2 className=\"text-lg font-bold text-slate-800\">Năm học & Học kỳ</h2>\n              <button\n                onClick={() => setShowAddYearModal(true)}\n                className=\"flex items-center gap-2 rounded-lg bg-[#0284C7] px-4 py-2 text-sm font-bold text-white transition-all hover:bg-[#0270a8]\"\n              >\n                <Plus className=\"h-4 w-4\" />\n                Thêm Năm Học\n              </button>\n            </div>\n            <div className=\"grid grid-cols-1 gap-4 md:grid-cols-2\">\n              {yearsData.map((year) => (\n                <div\n                  key={year.id}\n                  className={`relative overflow-hidden rounded-2xl border-2 p-6 transition-all hover:shadow-lg ${\n                    year.isCurrent\n                      ? 'border-[#0284C7] bg-gradient-to-br from-blue-50 to-white'\n                      : 'border-slate-200 bg-white'\n                  }`}\n                >\n                  {year.isCurrent && (\n                    <div className=\"absolute right-4 top-4 rounded-full bg-[#0284C7] px-3 py-1 text-[10px] font-bold uppercase tracking-wider text-white\">\n                      Hiện tại\n                    </div>\n                  )}\n                  <h3 className=\"text-xl font-black text-slate-800\">{year.name}</h3>\n                  <div className=\"mt-4 space-y-2\">\n                    <div className=\"flex items-center gap-2 text-sm text-slate-600\">\n                      <Calendar className=\"h-4 w-4\" />\n                      <span>Học kỳ I: {year.semester1}</span>\n                    </div>\n                    <div className=\"flex items-center gap-2 text-sm text-slate-600\">\n                      <Calendar className=\"h-4 w-4\" />\n                      <span>Học kỳ II: {year.semester2}</span>\n                    </div>\n                  </div>\n                  <div className=\"mt-4 flex gap-6 pt-4 border-t border-slate-100\">\n                    <div>\n                      <p className=\"text-xs text-slate-400\">Số lớp</p>\n                      <p className=\"text-lg font-bold text-slate-800\">{year.classes}</p>\n                    </div>\n                    <div>\n                      <p className=\"text-xs text-slate-400\">Học sinh</p>\n                      <p className=\"text-lg font-bold text-slate-800\">{year.students}</p>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {activeTab === 'classes' && (\n          <div className=\"space-y-6\">\n            <div className=\"flex items-center justify-between\">\n              <h2 className=\"text-lg font-bold text-slate-800\">Danh sách Lớp học</h2>\n              <div className=\"flex items-center gap-2\">\n                <button\n                  onClick={() => setShowAddClassModal(true)}\n                  className=\"flex items-center gap-2 rounded-lg bg-[#0284C7] px-4 py-2 text-sm font-bold text-white transition-all hover:bg-[#0270a8]\"\n                >\n                  <Plus className=\"h-4 w-4\" />\n                  Thêm Lớp\n                </button>\n                {['Khối 6', 'Khối 7', 'Khối 8', 'Khối 9'].map((grade) => (\n                  <button\n                    key={grade}\n                    className=\"rounded-lg border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-600 transition-all hover:bg-slate-50 hover:border-[#0284C7]\"\n                  >\n                    {grade}\n                  </button>\n                ))}\n              </div>\n            </div>\n            <div className=\"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3\">\n              {classes.map((cls) => (\n                <div\n                  key={cls.id}\n                  className=\"group rounded-2xl border border-slate-200 bg-white p-6 shadow-sm transition-all hover:shadow-md hover:-translate-y-0.5\"\n                >\n                  <div className=\"mb-4 flex items-start justify-between\">\n                    <div>\n                      <h3 className=\"text-lg font-black text-slate-800\">{cls.name}</h3>\n                      <p className=\"text-xs text-slate-400\">Khối {cls.grade}</p>\n                    </div>\n                    <div className=\"rounded-lg bg-blue-50 px-3 py-1 text-xs font-semibold text-blue-700\">\n                      Phòng {cls.room}\n                    </div>\n                  </div>\n                  <div className=\"space-y-2\">\n                    <div className=\"flex items-center justify-between\">\n                      <span className=\"text-xs text-slate-500\">Giáo viên chủ nhiệm</span>\n                      <span className=\"text-sm font-semibold text-slate-700\">\n                        {cls.teacher || 'Chưa phân công'}\n                      </span>\n                    </div>\n                    <div className=\"flex items-center justify-between\">\n                      <span className=\"text-xs text-slate-500\">Sĩ số</span>\n                      <span className=\"text-sm font-semibold text-slate-700\">{cls.studentCount ?? 0} học sinh</span>\n                    </div>\n                  </div>\n                  <div className=\"mt-4 flex gap-2\">\n                    <button\n                      onClick={() => handleEditClass(cls)}\n                      className=\"flex-1 rounded-lg border border-slate-200 py-2 text-xs font-bold text-slate-600 transition-all hover:bg-slate-50 hover:border-[#0284C7] hover:text-[#0284C7]\"\n                    >\n                      <Edit className=\"inline h-3 w-3 mr-1\" />\n                      Sửa\n                    </button>\n                    <button className=\"flex-1 rounded-lg border border-slate-200 py-2 text-xs font-bold text-slate-600 transition-all hover:bg-slate-50 hover:border-[#0284C7] hover:text-[#0284C7]\">\n                      Xem chi tiết\n                    </button>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {activeTab === 'subjects' && (\n          <div className=\"space-y-6\">\n            <div className=\"flex items-center justify-between\">\n              <h2 className=\"text-lg font-bold text-slate-800\">Danh mục Môn học</h2>\n              <button\n                onClick={() => setShowAddSubjectModal(true)}\n                className=\"flex items-center gap-2 rounded-lg bg-[#0284C7] px-4 py-2 text-sm font-bold text-white transition-all hover:bg-[#0270a8]\"\n              >\n                <Plus className=\"h-4 w-4\" />\n                Thêm Môn Học\n              </button>\n            </div>\n\n            {/* Statistics */}\n            <div className=\"grid grid-cols-1 gap-4 md:grid-cols-3\">\n              <StatCard\n                title=\"Tổng môn học\"\n                value={subjectsData.length}\n                color=\"blue\"\n              />\n              <StatCard\n                title=\"Môn bắt buộc\"\n                value=\"8\"\n                color=\"green\"\n              />\n              <StatCard\n                title=\"Môn tự chọn\"\n                value=\"3\"\n                color=\"orange\"\n              />\n            </div>\n\n            {/* Subjects by Category */}\n            <div className=\"space-y-4\">\n              {['Khoa học tự nhiên', 'Khoa học xã hội', 'Ngoại ngữ', 'Kỹ thuật'].map((category) => {\n                const categorySubjects = subjectsData.filter((s: any) => s.category === category)\n                return (\n                  <div key={category} className=\"rounded-xl border border-slate-200 bg-white p-4\">\n                    <h3 className=\"mb-3 text-sm font-black text-slate-800\">{category}</h3>\n                    <div className=\"grid grid-cols-1 gap-2 md:grid-cols-2 lg:grid-cols-3\">\n                      {categorySubjects.map((subject) => (\n                        <div\n                          key={subject.id}\n                          className=\"flex items-center justify-between rounded-lg border border-slate-100 bg-slate-50 px-4 py-3 transition-all hover:bg-slate-100\"\n                        >\n                          <div className=\"flex-1\">\n                            <p className=\"text-sm font-bold text-slate-800\">{subject.name}</p>\n                            <p className=\"text-xs text-slate-500\">{subject.classes} lớp</p>\n                          </div>\n                          <div className=\"flex items-center gap-2\">\n                            <div className=\"rounded-full bg-[#0284C7] px-3 py-1 text-xs font-bold text-white\">\n                              Hệ số {subject.coefficient}\n                            </div>\n                            <button\n                              onClick={() => handleDeleteSubject(subject.id, subject.name)}\n                              className=\"p-2 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all\"\n                              title=\"Xóa môn học\"\n                            >\n                              <Trash2 className=\"h-4 w-4\" />\n                            </button>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                )\n              })}\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Modals */}\n      <AddYearModal\n        isOpen={showAddYearModal}\n        onClose={() => setShowAddYearModal(false)}\n        onSuccess={refreshData}\n      />\n\n      <AddClassModal\n        isOpen={showAddClassModal}\n        onClose={() => setShowAddClassModal(false)}\n        onSuccess={refreshData}\n      />\n\n      <AddSubjectModal\n        isOpen={showAddSubjectModal}\n        onClose={() => setShowAddSubjectModal(false)}\n        onSuccess={refreshData}\n      />\n\n      <EditClassModal\n        isOpen={showEditClassModal}\n        onClose={() => {\n          setShowEditClassModal(false)\n          setSelectedClass(null)\n        }}\n        classData={selectedClass}\n        onSuccess={refreshData}\n      />\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\classes\\modals\\AddClassModal.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":84,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":84,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2153,2193],"text":""},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { Users, GraduationCap } from 'lucide-react'\nimport { BaseModal, BaseModalProps } from '@/components/admin/shared/modals/BaseModal'\nimport { SUPPORTED_GRADES } from '@/lib/constants'\n\nexport interface AddClassModalProps extends Omit<BaseModalProps, 'title' | 'children'> {\n  onSuccess?: () => void\n}\n\nexport interface ClassFormData {\n  name: string\n  grade: string\n  room: string\n  maxStudents: number\n  homeroomTeacher: string\n}\n\ninterface Teacher {\n  id: string\n  name: string\n  subject?: string\n}\n\nexport function AddClassModal({ isOpen, onClose, onSuccess }: AddClassModalProps) {\n  const [loading, setLoading] = useState(false)\n  const [teachers, setTeachers] = useState<Teacher[]>([])\n  const [formData, setFormData] = useState<ClassFormData>({\n    name: '',\n    grade: '6',\n    room: '',\n    maxStudents: 40,\n    homeroomTeacher: '',\n  })\n\n  // Fetch teachers for dropdown\n  useEffect(() => {\n    const fetchTeachers = async () => {\n      try {\n        // TODO: API - GET /api/teachers?active=true\n        // Mock data for now\n        const mockTeachers: Teacher[] = [\n          { id: '1', name: 'Nguyễn Thanh T.' },\n          { id: '2', name: 'Trần Thị Mai' },\n          { id: '3', name: 'Lê Văn Chính' },\n          { id: '4', name: 'Phạm Thị Dung' },\n          { id: '5', name: 'Hoàng Văn Em' },\n        ]\n        setTeachers(mockTeachers)\n      } catch (error) {\n        console.error('Failed to fetch teachers:', error)\n      }\n    }\n\n    if (isOpen) {\n      fetchTeachers()\n    }\n  }, [isOpen])\n\n  const handleSubmit = async () => {\n    // Validation\n    if (!formData.name || !formData.grade || !formData.room) {\n      alert('Vui lòng điền đầy đủ thông tin bắt buộc')\n      return\n    }\n\n    if (!formData.homeroomTeacher) {\n      alert('Vui lòng chọn giáo viên chủ nhiệm')\n      return\n    }\n\n    if (formData.maxStudents < 10 || formData.maxStudents > 50) {\n      alert('Sĩ số tối đa phải từ 10 đến 50 học sinh')\n      return\n    }\n\n    setLoading(true)\n\n    try {\n      // TODO: API - POST /api/classes\n      await new Promise(resolve => setTimeout(resolve, 1000))\n\n      console.log('Creating class:', formData)\n\n      onSuccess?.()\n      onClose()\n      // Reset form\n      setFormData({\n        name: '',\n        grade: '6',\n        room: '',\n        maxStudents: 40,\n        homeroomTeacher: '',\n      })\n    } catch (error) {\n      console.error('Failed to create class:', error)\n      alert('Không thể tạo lớp học. Vui lòng thử lại.')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const capacityPercentage = (formData.maxStudents / 50) * 100\n  const capacityColor = capacityPercentage > 80 ? 'bg-red-500' :\n                       capacityPercentage > 60 ? 'bg-yellow-500' : 'bg-[#0284C7]'\n\n  return (\n    <BaseModal\n      isOpen={isOpen}\n      onClose={onClose}\n      title=\"Thêm Lớp Học Mới\"\n      size=\"lg\"\n      primaryAction={{\n        label: 'Tạo Lớp',\n        onClick: handleSubmit,\n        loading,\n      }}\n      secondaryAction={{\n        label: 'Hủy',\n        onClick: onClose,\n      }}\n    >\n      <div className=\"space-y-6\">\n        {/* Class Name and Grade */}\n        <div className=\"grid grid-cols-2 gap-4\">\n          <div>\n            <label className=\"block text-sm font-semibold text-slate-700 mb-2\">\n              Tên Lớp <span className=\"text-red-500\">*</span>\n            </label>\n            <input\n              type=\"text\"\n              placeholder=\"Ví dụ: 6A, 7B1\"\n              value={formData.name}\n              onChange={(e) => setFormData({ ...formData, name: e.target.value.toUpperCase() })}\n              className=\"w-full rounded-lg border border-slate-300 px-4 py-2.5 text-sm focus:border-[#0284C7] focus:outline-none focus:ring-2 focus:ring-[#0284C7]/20\"\n            />\n            <p className=\"mt-1 text-xs text-slate-500\">Theo định dạng: Khối + Tên lớp (6A, 7B1...)</p>\n          </div>\n          <div>\n            <label className=\"block text-sm font-semibold text-slate-700 mb-2\">\n              Khối <span className=\"text-red-500\">*</span>\n            </label>\n            <select\n              value={formData.grade}\n              onChange={(e) => setFormData({ ...formData, grade: e.target.value })}\n              className=\"w-full rounded-lg border border-slate-300 px-4 py-2.5 text-sm focus:border-[#0284C7] focus:outline-none focus:ring-2 focus:ring-[#0284C7]/20\"\n            >\n              {SUPPORTED_GRADES.map(grade => (\n                <option key={grade} value={grade}>Khối {grade}</option>\n              ))}\n            </select>\n          </div>\n        </div>\n\n        {/* Room */}\n        <div>\n          <label className=\"block text-sm font-semibold text-slate-700 mb-2\">\n            Phòng Học <span className=\"text-red-500\">*</span>\n          </label>\n          <input\n            type=\"text\"\n            placeholder=\"Ví dụ: A101, P.201\"\n            value={formData.room}\n            onChange={(e) => setFormData({ ...formData, room: e.target.value.toUpperCase() })}\n            className=\"w-full rounded-lg border border-slate-300 px-4 py-2.5 text-sm focus:border-[#0284C7] focus:outline-none focus:ring-2 focus:ring-[#0284C7]/20\"\n          />\n        </div>\n\n        {/* Homeroom Teacher */}\n        <div>\n          <label className=\"block text-sm font-semibold text-slate-700 mb-2\">\n            Giáo Viên Chủ Nhiệm <span className=\"text-red-500\">*</span>\n          </label>\n          <div className=\"relative\">\n            <GraduationCap className=\"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 text-slate-400\" />\n            <select\n              value={formData.homeroomTeacher}\n              onChange={(e) => setFormData({ ...formData, homeroomTeacher: e.target.value })}\n              className=\"w-full rounded-lg border border-slate-300 pl-10 pr-4 py-2.5 text-sm focus:border-[#0284C7] focus:outline-none focus:ring-2 focus:ring-[#0284C7]/20 appearance-none bg-white\"\n            >\n              <option value=\"\">Chọn giáo viên chủ nhiệm</option>\n              {teachers.map(teacher => (\n                <option key={teacher.id} value={teacher.id}>{teacher.name}</option>\n              ))}\n            </select>\n          </div>\n          {teachers.length === 0 && (\n            <p className=\"mt-1 text-xs text-slate-500\">Đang tải danh sách giáo viên...</p>\n          )}\n        </div>\n\n        {/* Max Students with Progress Bar */}\n        <div className=\"rounded-lg border border-slate-200 bg-slate-50 p-4\">\n          <div className=\"flex items-center justify-between mb-3\">\n            <label className=\"flex items-center gap-2 text-sm font-semibold text-slate-700\">\n              <Users className=\"h-4 w-4\" />\n              Sĩ Số Tối Đa\n            </label>\n            <span className=\"text-lg font-bold text-[#0284C7]\">{formData.maxStudents}</span>\n          </div>\n\n          <input\n            type=\"range\"\n            min=\"10\"\n            max=\"50\"\n            value={formData.maxStudents}\n            onChange={(e) => setFormData({ ...formData, maxStudents: parseInt(e.target.value) })}\n            className=\"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-[#0284C7]\"\n          />\n\n          <div className=\"mt-3\">\n            <div className=\"flex items-center justify-between text-xs text-slate-600 mb-1\">\n              <span>Dung lượng lớp</span>\n              <span>{Math.round(capacityPercentage)}%</span>\n            </div>\n            <div className=\"h-2 w-full rounded-full bg-slate-200 overflow-hidden\">\n              <div\n                className={`h-full ${capacityColor} transition-all duration-300`}\n                style={{ width: `${capacityPercentage}%` }}\n              />\n            </div>\n            <p className=\"mt-2 text-xs text-slate-500\">\n              Khuyến nghị: 35-40 học sinh/lớp\n            </p>\n          </div>\n        </div>\n      </div>\n    </BaseModal>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\classes\\modals\\AddSubjectModal.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":61,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":61,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1478,1520],"text":""},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState } from 'react'\nimport { BookOpen } from 'lucide-react'\nimport { BaseModal, BaseModalProps } from '@/components/admin/shared/modals/BaseModal'\n\nexport interface AddSubjectModalProps extends Omit<BaseModalProps, 'title' | 'children'> {\n  onSuccess?: () => void\n}\n\nexport interface SubjectFormData {\n  code: string\n  name: string\n  category: string\n  periodsPerWeek: number\n  coefficient: number\n}\n\nconst SUBJECT_CATEGORIES = [\n  'Khoa học tự nhiên',\n  'Khoa học xã hội',\n  'Ngoại ngữ',\n  'Kỹ thuật',\n  'Năng khiếu',\n]\n\nexport function AddSubjectModal({ isOpen, onClose, onSuccess }: AddSubjectModalProps) {\n  const [loading, setLoading] = useState(false)\n  const [formData, setFormData] = useState<SubjectFormData>({\n    code: '',\n    name: '',\n    category: 'Khoa học tự nhiên',\n    periodsPerWeek: 3,\n    coefficient: 2,\n  })\n\n  const handleSubmit = async () => {\n    // Validation\n    if (!formData.code || !formData.name) {\n      alert('Vui lòng điền đầy đủ thông tin môn học')\n      return\n    }\n\n    if (formData.periodsPerWeek < 1 || formData.periodsPerWeek > 10) {\n      alert('Số tiết/tuần phải từ 1 đến 10')\n      return\n    }\n\n    if (formData.coefficient < 1 || formData.coefficient > 5) {\n      alert('Hệ số phải từ 1 đến 5')\n      return\n    }\n\n    setLoading(true)\n\n    try {\n      // TODO: API - POST /api/subjects\n      // TODO: Validate subject code uniqueness\n      await new Promise(resolve => setTimeout(resolve, 1000))\n\n      console.log('Creating subject:', formData)\n\n      onSuccess?.()\n      onClose()\n      // Reset form\n      setFormData({\n        code: '',\n        name: '',\n        category: 'Khoa học tự nhiên',\n        periodsPerWeek: 3,\n        coefficient: 2,\n      })\n    } catch (error) {\n      console.error('Failed to create subject:', error)\n      alert('Không thể tạo môn học. Vui lòng thử lại.')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <BaseModal\n      isOpen={isOpen}\n      onClose={onClose}\n      title=\"Thêm Môn Học Mới\"\n      size=\"lg\"\n      primaryAction={{\n        label: 'Tạo Môn Học',\n        onClick: handleSubmit,\n        loading,\n      }}\n      secondaryAction={{\n        label: 'Hủy',\n        onClick: onClose,\n      }}\n    >\n      <div className=\"space-y-6\">\n        {/* Subject Code and Name */}\n        <div className=\"grid grid-cols-2 gap-4\">\n          <div>\n            <label className=\"block text-sm font-semibold text-slate-700 mb-2\">\n              Mã Môn <span className=\"text-red-500\">*</span>\n            </label>\n            <input\n              type=\"text\"\n              placeholder=\"Ví dụ: TOAN, VAN, ANH\"\n              value={formData.code}\n              onChange={(e) => setFormData({ ...formData, code: e.target.value.toUpperCase() })}\n              className=\"w-full rounded-lg border border-slate-300 px-4 py-2.5 text-sm focus:border-[#0284C7] focus:outline-none focus:ring-2 focus:ring-[#0284C7]/20 uppercase\"\n            />\n            <p className=\"mt-1 text-xs text-slate-500\">Mã viết tắt, không dấu</p>\n          </div>\n          <div>\n            <label className=\"block text-sm font-semibold text-slate-700 mb-2\">\n              Tên Môn Học <span className=\"text-red-500\">*</span>\n            </label>\n            <input\n              type=\"text\"\n              placeholder=\"Ví dụ: Toán, Văn học, Tiếng Anh\"\n              value={formData.name}\n              onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n              className=\"w-full rounded-lg border border-slate-300 px-4 py-2.5 text-sm focus:border-[#0284C7] focus:outline-none focus:ring-2 focus:ring-[#0284C7]/20\"\n            />\n          </div>\n        </div>\n\n        {/* Category */}\n        <div>\n          <label className=\"block text-sm font-semibold text-slate-700 mb-2\">\n            Danh Mục <span className=\"text-red-500\">*</span>\n          </label>\n          <div className=\"relative\">\n            <BookOpen className=\"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 text-slate-400\" />\n            <select\n              value={formData.category}\n              onChange={(e) => setFormData({ ...formData, category: e.target.value })}\n              className=\"w-full rounded-lg border border-slate-300 pl-10 pr-4 py-2.5 text-sm focus:border-[#0284C7] focus:outline-none focus:ring-2 focus:ring-[#0284C7]/20 appearance-none bg-white\"\n            >\n              {SUBJECT_CATEGORIES.map(category => (\n                <option key={category} value={category}>{category}</option>\n              ))}\n            </select>\n          </div>\n        </div>\n\n        {/* Periods and Coefficient */}\n        <div className=\"grid grid-cols-2 gap-4\">\n          <div>\n            <label className=\"block text-sm font-semibold text-slate-700 mb-2\">\n              Số Tiết/Tuần <span className=\"text-red-500\">*</span>\n            </label>\n            <input\n              type=\"number\"\n              min=\"1\"\n              max=\"10\"\n              value={formData.periodsPerWeek}\n              onChange={(e) => setFormData({ ...formData, periodsPerWeek: parseInt(e.target.value) || 0 })}\n              className=\"w-full rounded-lg border border-slate-300 px-4 py-2.5 text-sm focus:border-[#0284C7] focus:outline-none focus:ring-2 focus:ring-[#0284C7]/20\"\n            />\n            <p className=\"mt-1 text-xs text-slate-500\">Số tiết học mỗi tuần</p>\n          </div>\n          <div>\n            <label className=\"block text-sm font-semibold text-slate-700 mb-2\">\n              Hệ Số <span className=\"text-red-500\">*</span>\n            </label>\n            <input\n              type=\"number\"\n              min=\"1\"\n              max=\"5\"\n              value={formData.coefficient}\n              onChange={(e) => setFormData({ ...formData, coefficient: parseInt(e.target.value) || 0 })}\n              className=\"w-full rounded-lg border border-slate-300 px-4 py-2.5 text-sm focus:border-[#0284C7] focus:outline-none focus:ring-2 focus:ring-[#0284C7]/20\"\n            />\n            <p className=\"mt-1 text-xs text-slate-500\">Hệ số đánh giá (1-5)</p>\n          </div>\n        </div>\n\n        {/* Info Box */}\n        <div className=\"rounded-lg border border-blue-200 bg-blue-50 p-4\">\n          <h4 className=\"text-sm font-bold text-blue-900 mb-2 flex items-center gap-2\">\n            <BookOpen className=\"h-4 w-4\" />\n            Thông Tin\n          </h4>\n          <ul className=\"space-y-1 text-xs text-blue-800\">\n            <li>• Mã môn phải duy nhất, không trùng với môn học khác</li>\n            <li>• Hệ số ảnh hưởng đến điểm tổng kết</li>\n            <li>• Số tiết/tuần dùng để phân công giáo viên</li>\n          </ul>\n        </div>\n\n        {/* Subject Examples */}\n        <div className=\"rounded-lg border border-slate-200 bg-slate-50 p-4\">\n          <h4 className=\"text-sm font-bold text-slate-800 mb-3\">Ví Dụ Môn Học Phổ Biến</h4>\n          <div className=\"grid grid-cols-2 gap-2\">\n            {[\n              { code: 'TOAN', name: 'Toán', cat: 'Khoa học tự nhiên', coef: 3 },\n              { code: 'VAN', name: 'Văn học', cat: 'Khoa học xã hội', coef: 2 },\n              { code: 'ANH', name: 'Tiếng Anh', cat: 'Ngoại ngữ', coef: 2 },\n              { code: 'LY', name: 'Vật lý', cat: 'Khoa học tự nhiên', coef: 2 },\n              { code: 'HOA', name: 'Hóa học', cat: 'Khoa học tự nhiên', coef: 2 },\n              { code: 'SINH', name: 'Sinh học', cat: 'Khoa học tự nhiên', coef: 2 },\n              { code: 'SU', name: 'Lịch sử', cat: 'Khoa học xã hội', coef: 1 },\n              { code: 'DIA', name: 'Địa lý', cat: 'Khoa học xã hội', coef: 1 },\n            ].map(example => (\n              <button\n                key={example.code}\n                type=\"button\"\n                onClick={() => setFormData({\n                  code: example.code,\n                  name: example.name,\n                  category: example.cat,\n                  periodsPerWeek: 3,\n                  coefficient: example.coef,\n                })}\n                className=\"text-left rounded-lg border border-slate-200 bg-white px-3 py-2 text-xs hover:border-[#0284C7] hover:bg-blue-50 transition-all\"\n              >\n                <div className=\"font-semibold text-slate-800\">{example.code} - {example.name}</div>\n                <div className=\"text-slate-500\">HS: {example.coef}</div>\n              </button>\n            ))}\n          </div>\n        </div>\n      </div>\n    </BaseModal>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\classes\\modals\\AddYearModal.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":70,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":70,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1871,1910],"text":""},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState } from 'react'\nimport { Calendar } from 'lucide-react'\nimport { BaseModal, BaseModalProps } from '@/components/admin/shared/modals/BaseModal'\nimport { validateDateRange } from '@/lib/security-utils'\n\nexport interface AddYearModalProps extends Omit<BaseModalProps, 'title' | 'children'> {\n  onSuccess?: () => void\n}\n\nexport interface YearFormData {\n  name: string\n  startDate: string\n  endDate: string\n  semester1Start: string\n  semester1End: string\n  semester2Start: string\n  semester2End: string\n  isCurrent: boolean\n}\n\nexport function AddYearModal({ isOpen, onClose, onSuccess }: AddYearModalProps) {\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState<string>('')\n  const [formData, setFormData] = useState<YearFormData>({\n    name: '',\n    startDate: '',\n    endDate: '',\n    semester1Start: '',\n    semester1End: '',\n    semester2Start: '',\n    semester2End: '',\n    isCurrent: false,\n  })\n\n  const handleSubmit = async () => {\n    setError('')\n\n    // Validation\n    if (!formData.name || !formData.startDate || !formData.endDate) {\n      setError('Vui lòng điền đầy đủ thông tin năm học')\n      return\n    }\n\n    if (!formData.semester1Start || !formData.semester1End ||\n        !formData.semester2Start || !formData.semester2End) {\n      setError('Vui lòng điền đầy đủ thông tin học kỳ')\n      return\n    }\n\n    if (new Date(formData.endDate) <= new Date(formData.startDate)) {\n      setError('Ngày kết thúc phải sau ngày bắt đầu')\n      return\n    }\n\n    // Comprehensive date validation\n    const dateValidation = validateDateRange(formData)\n    if (!dateValidation.isValid) {\n      setError(dateValidation.errors[0]) // Show first error\n      return\n    }\n\n    setLoading(true)\n\n    try {\n      // TODO: API - POST /api/years\n      await new Promise(resolve => setTimeout(resolve, 1000))\n\n      console.log('Creating year:', formData)\n\n      onSuccess?.()\n      onClose()\n      // Reset form\n      setFormData({\n        name: '',\n        startDate: '',\n        endDate: '',\n        semester1Start: '',\n        semester1End: '',\n        semester2Start: '',\n        semester2End: '',\n        isCurrent: false,\n      })\n      setError('')\n    } catch (error) {\n      console.error('Failed to create year:', error)\n      setError('Không thể tạo năm học. Vui lòng thử lại.')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <BaseModal\n      isOpen={isOpen}\n      onClose={onClose}\n      title=\"Thêm Năm Học Mới\"\n      size=\"lg\"\n      primaryAction={{\n        label: 'Tạo Năm Học',\n        onClick: handleSubmit,\n        loading,\n      }}\n      secondaryAction={{\n        label: 'Hủy',\n        onClick: onClose,\n      }}\n    >\n      <div className=\"space-y-6\">\n        {/* Error Display */}\n        {error && (\n          <div className=\"p-3 bg-red-50 border border-red-200 rounded-lg\">\n            <p className=\"text-sm text-red-700\">{error}</p>\n          </div>\n        )}\n\n        {/* Year Name */}\n        <div>\n          <label className=\"block text-sm font-semibold text-slate-700 mb-2\">\n            Tên Năm Học <span className=\"text-red-500\">*</span>\n          </label>\n          <input\n            type=\"text\"\n            placeholder=\"Ví dụ: 2025-2026\"\n            value={formData.name}\n            onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n            className=\"w-full rounded-lg border border-slate-300 px-4 py-2.5 text-sm focus:border-[#0284C7] focus:outline-none focus:ring-2 focus:ring-[#0284C7]/20\"\n          />\n        </div>\n\n        {/* Year Date Range */}\n        <div className=\"grid grid-cols-2 gap-4\">\n          <div>\n            <label className=\"block text-sm font-semibold text-slate-700 mb-2\">\n              Ngày Bắt Đầu <span className=\"text-red-500\">*</span>\n            </label>\n            <input\n              type=\"date\"\n              value={formData.startDate}\n              onChange={(e) => setFormData({ ...formData, startDate: e.target.value })}\n              className=\"w-full rounded-lg border border-slate-300 px-4 py-2.5 text-sm focus:border-[#0284C7] focus:outline-none focus:ring-2 focus:ring-[#0284C7]/20\"\n            />\n          </div>\n          <div>\n            <label className=\"block text-sm font-semibold text-slate-700 mb-2\">\n              Ngày Kết Thúc <span className=\"text-red-500\">*</span>\n            </label>\n            <input\n              type=\"date\"\n              value={formData.endDate}\n              onChange={(e) => setFormData({ ...formData, endDate: e.target.value })}\n              className=\"w-full rounded-lg border border-slate-300 px-4 py-2.5 text-sm focus:border-[#0284C7] focus:outline-none focus:ring-2 focus:ring-[#0284C7]/20\"\n            />\n          </div>\n        </div>\n\n        {/* Current Year Toggle */}\n        <div className=\"flex items-center gap-3\">\n          <input\n            type=\"checkbox\"\n            id=\"isCurrent\"\n            checked={formData.isCurrent}\n            onChange={(e) => setFormData({ ...formData, isCurrent: e.target.checked })}\n            className=\"h-4 w-4 rounded border-slate-300 text-[#0284C7] focus:ring-[#0284C7]\"\n          />\n          <label htmlFor=\"isCurrent\" className=\"text-sm font-semibold text-slate-700\">\n            Đặt làm năm học hiện tại\n          </label>\n        </div>\n\n        {/* Divider */}\n        <div className=\"border-t border-slate-200 pt-4\">\n          <h3 className=\"text-sm font-bold text-slate-800 mb-4 flex items-center gap-2\">\n            <Calendar className=\"h-4 w-4\" />\n            Cấu Hình Học Kỳ\n          </h3>\n        </div>\n\n        {/* Semester 1 */}\n        <div className=\"rounded-lg border border-slate-200 bg-slate-50 p-4\">\n          <h4 className=\"text-sm font-bold text-slate-800 mb-3\">Học Kỳ I</h4>\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <label className=\"block text-xs font-semibold text-slate-600 mb-2\">\n                Ngày Bắt Đầu\n              </label>\n              <input\n                type=\"date\"\n                value={formData.semester1Start}\n                onChange={(e) => setFormData({ ...formData, semester1Start: e.target.value })}\n                className=\"w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:border-[#0284C7] focus:outline-none\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-xs font-semibold text-slate-600 mb-2\">\n                Ngày Kết Thúc\n              </label>\n              <input\n                type=\"date\"\n                value={formData.semester1End}\n                onChange={(e) => setFormData({ ...formData, semester1End: e.target.value })}\n                className=\"w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:border-[#0284C7] focus:outline-none\"\n              />\n            </div>\n          </div>\n        </div>\n\n        {/* Semester 2 */}\n        <div className=\"rounded-lg border border-slate-200 bg-slate-50 p-4\">\n          <h4 className=\"text-sm font-bold text-slate-800 mb-3\">Học Kỳ II</h4>\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <label className=\"block text-xs font-semibold text-slate-600 mb-2\">\n                Ngày Bắt Đầu\n              </label>\n              <input\n                type=\"date\"\n                value={formData.semester2Start}\n                onChange={(e) => setFormData({ ...formData, semester2Start: e.target.value })}\n                className=\"w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:border-[#0284C7] focus:outline-none\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-xs font-semibold text-slate-600 mb-2\">\n                Ngày Kết Thúc\n              </label>\n              <input\n                type=\"date\"\n                value={formData.semester2End}\n                onChange={(e) => setFormData({ ...formData, semester2End: e.target.value })}\n                className=\"w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:border-[#0284C7] focus:outline-none\"\n              />\n            </div>\n          </div>\n        </div>\n      </div>\n    </BaseModal>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\classes\\modals\\EditClassModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Class' is defined but never used.","line":7,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":20},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":110,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":110,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2963,3017],"text":""},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { Users, GraduationCap, AlertTriangle } from 'lucide-react'\nimport { BaseModal, BaseModalProps } from '@/components/admin/shared/modals/BaseModal'\nimport { SUPPORTED_GRADES } from '@/lib/constants'\nimport type { Class } from '@/lib/types'\nimport type { MockClass } from '@/lib/mock-data'\n\nexport interface EditClassModalProps extends Omit<BaseModalProps, 'title' | 'children'> {\n  classData: MockClass | null\n  onSuccess?: () => void\n}\n\nexport interface ClassFormData {\n  name: string\n  grade: string\n  room: string\n  maxStudents: number\n  homeroomTeacher: string\n}\n\ninterface Teacher {\n  id: string\n  name: string\n  subject?: string\n}\n\nexport function EditClassModal({ isOpen, onClose, classData, onSuccess }: EditClassModalProps) {\n  const [loading, setLoading] = useState(false)\n  const [teachers, setTeachers] = useState<Teacher[]>([])\n  const [formData, setFormData] = useState<ClassFormData>({\n    name: '',\n    grade: '6',\n    room: '',\n    maxStudents: 40,\n    homeroomTeacher: '',\n  })\n\n  // Populate form when classData changes\n  useEffect(() => {\n    if (classData) {\n      setFormData({\n        name: classData.name,\n        grade: classData.grade,\n        room: classData.room,\n        maxStudents: 40, // Default, would come from API\n        homeroomTeacher: classData.teacher,\n      })\n    }\n  }, [classData, isOpen])\n\n  // Fetch teachers for dropdown\n  useEffect(() => {\n    const fetchTeachers = async () => {\n      try {\n        // TODO: API - GET /api/teachers?active=true\n        const mockTeachers: Teacher[] = [\n          { id: '1', name: 'Nguyễn Thanh T.' },\n          { id: '2', name: 'Trần Thị Mai' },\n          { id: '3', name: 'Lê Văn Chính' },\n          { id: '4', name: 'Phạm Thị Dung' },\n          { id: '5', name: 'Hoàng Văn Em' },\n        ]\n        setTeachers(mockTeachers)\n      } catch (error) {\n        console.error('Failed to fetch teachers:', error)\n      }\n    }\n\n    if (isOpen) {\n      fetchTeachers()\n    }\n  }, [isOpen])\n\n  const handleSubmit = async () => {\n    if (!classData) return\n\n    // Validation\n    if (!formData.name || !formData.grade || !formData.room) {\n      alert('Vui lòng điền đầy đủ thông tin bắt buộc')\n      return\n    }\n\n    if (!formData.homeroomTeacher) {\n      alert('Vui lòng chọn giáo viên chủ nhiệm')\n      return\n    }\n\n    if (formData.maxStudents < 10 || formData.maxStudents > 50) {\n      alert('Sĩ số tối đa phải từ 10 đến 50 học sinh')\n      return\n    }\n\n    // Capacity warning\n    if (formData.maxStudents < classData.studentCount) {\n      const confirm = window.confirm(\n        `Cảnh báo: Sĩ số tối đa (${formData.maxStudents}) nhỏ hơn số học sinh hiện tại (${classData.studentCount}).\\n\\n` +\n        `Bạn có chắc muốn tiếp tục?`\n      )\n      if (!confirm) return\n    }\n\n    setLoading(true)\n\n    try {\n      // TODO: API - PUT /api/classes/:id\n      await new Promise(resolve => setTimeout(resolve, 1000))\n\n      console.log('Updating class:', classData.id, formData)\n\n      onSuccess?.()\n      onClose()\n    } catch (error) {\n      console.error('Failed to update class:', error)\n      alert('Không thể cập nhật lớp học. Vui lòng thử lại.')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const capacityPercentage = (formData.maxStudents / 50) * 100\n  const currentStudentCount = classData?.studentCount || 0\n  const currentUsage = (currentStudentCount / formData.maxStudents) * 100\n  const isOverCapacity = currentStudentCount > formData.maxStudents\n\n  const capacityColor = isOverCapacity ? 'bg-red-500' :\n                       currentUsage > 80 ? 'bg-yellow-500' : 'bg-[#0284C7]'\n\n  return (\n    <BaseModal\n      isOpen={isOpen}\n      onClose={onClose}\n      title={`Cập Nhật Lớp ${classData?.name || ''}`}\n      size=\"lg\"\n      primaryAction={{\n        label: 'Lưu Thay Đổi',\n        onClick: handleSubmit,\n        loading,\n      }}\n      secondaryAction={{\n        label: 'Hủy',\n        onClick: onClose,\n      }}\n    >\n      <div className=\"space-y-6\">\n        {/* Current Students Display */}\n        {classData && (\n          <div className=\"rounded-lg border border-blue-200 bg-blue-50 p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h4 className=\"text-sm font-bold text-blue-900\">Sĩ Số Hiện Tại</h4>\n                <p className=\"text-2xl font-black text-[#0284C7]\">{classData.studentCount}</p>\n              </div>\n              <Users className=\"h-8 w-8 text-[#0284C7]\" />\n            </div>\n          </div>\n        )}\n\n        {/* Capacity Warning */}\n        {isOverCapacity && (\n          <div className=\"flex items-start gap-3 rounded-lg border border-red-200 bg-red-50 p-4\">\n            <AlertTriangle className=\"h-5 w-5 text-red-600 flex-shrink-0 mt-0.5\" />\n            <div>\n              <h4 className=\"text-sm font-bold text-red-900\">Cảnh Báo Vượt Sĩ Số</h4>\n              <p className=\"text-xs text-red-800 mt-1\">\n                Lớp hiện có {currentStudentCount} học sinh, nhưng sĩ số tối đa chỉ còn {formData.maxStudents}.\n              </p>\n            </div>\n          </div>\n        )}\n\n        {/* Class Name and Grade */}\n        <div className=\"grid grid-cols-2 gap-4\">\n          <div>\n            <label className=\"block text-sm font-semibold text-slate-700 mb-2\">\n              Tên Lớp <span className=\"text-red-500\">*</span>\n            </label>\n            <input\n              type=\"text\"\n              placeholder=\"Ví dụ: 6A, 7B1\"\n              value={formData.name}\n              onChange={(e) => setFormData({ ...formData, name: e.target.value.toUpperCase() })}\n              className=\"w-full rounded-lg border border-slate-300 px-4 py-2.5 text-sm focus:border-[#0284C7] focus:outline-none focus:ring-2 focus:ring-[#0284C7]/20\"\n            />\n          </div>\n          <div>\n            <label className=\"block text-sm font-semibold text-slate-700 mb-2\">\n              Khối <span className=\"text-red-500\">*</span>\n            </label>\n            <select\n              value={formData.grade}\n              onChange={(e) => setFormData({ ...formData, grade: e.target.value })}\n              className=\"w-full rounded-lg border border-slate-300 px-4 py-2.5 text-sm focus:border-[#0284C7] focus:outline-none focus:ring-2 focus:ring-[#0284C7]/20\"\n            >\n              {SUPPORTED_GRADES.map(grade => (\n                <option key={grade} value={grade}>Khối {grade}</option>\n              ))}\n            </select>\n          </div>\n        </div>\n\n        {/* Room */}\n        <div>\n          <label className=\"block text-sm font-semibold text-slate-700 mb-2\">\n            Phòng Học <span className=\"text-red-500\">*</span>\n          </label>\n          <input\n            type=\"text\"\n            placeholder=\"Ví dụ: A101, P.201\"\n            value={formData.room}\n            onChange={(e) => setFormData({ ...formData, room: e.target.value.toUpperCase() })}\n            className=\"w-full rounded-lg border border-slate-300 px-4 py-2.5 text-sm focus:border-[#0284C7] focus:outline-none focus:ring-2 focus:ring-[#0284C7]/20\"\n          />\n        </div>\n\n        {/* Homeroom Teacher */}\n        <div>\n          <label className=\"block text-sm font-semibold text-slate-700 mb-2\">\n            Giáo Viên Chủ Nhiệm <span className=\"text-red-500\">*</span>\n          </label>\n          <div className=\"relative\">\n            <GraduationCap className=\"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 text-slate-400\" />\n            <select\n              value={formData.homeroomTeacher}\n              onChange={(e) => setFormData({ ...formData, homeroomTeacher: e.target.value })}\n              className=\"w-full rounded-lg border border-slate-300 pl-10 pr-4 py-2.5 text-sm focus:border-[#0284C7] focus:outline-none focus:ring-2 focus:ring-[#0284C7]/20 appearance-none bg-white\"\n            >\n              <option value=\"\">Chọn giáo viên chủ nhiệm</option>\n              {teachers.map(teacher => (\n                <option key={teacher.id} value={teacher.id}>{teacher.name}</option>\n              ))}\n            </select>\n          </div>\n        </div>\n\n        {/* Max Students with Progress Bar */}\n        <div className=\"rounded-lg border border-slate-200 bg-slate-50 p-4\">\n          <div className=\"flex items-center justify-between mb-3\">\n            <label className=\"flex items-center gap-2 text-sm font-semibold text-slate-700\">\n              <Users className=\"h-4 w-4\" />\n              Sĩ Số Tối Đa\n            </label>\n            <span className=\"text-lg font-bold text-[#0284C7]\">{formData.maxStudents}</span>\n          </div>\n\n          <input\n            type=\"range\"\n            min=\"10\"\n            max=\"50\"\n            value={formData.maxStudents}\n            onChange={(e) => setFormData({ ...formData, maxStudents: parseInt(e.target.value) })}\n            className=\"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-[#0284C7]\"\n          />\n\n          <div className=\"mt-3 space-y-2\">\n            {/* Max Capacity Bar */}\n            <div>\n              <div className=\"flex items-center justify-between text-xs text-slate-600 mb-1\">\n                <span>Dung lượng tối đa</span>\n                <span>{Math.round(capacityPercentage)}%</span>\n              </div>\n              <div className=\"h-2 w-full rounded-full bg-slate-200 overflow-hidden\">\n                <div\n                  className=\"h-full bg-slate-400 transition-all duration-300\"\n                  style={{ width: `${capacityPercentage}%` }}\n                />\n              </div>\n            </div>\n\n            {/* Current Usage Bar */}\n            <div>\n              <div className=\"flex items-center justify-between text-xs text-slate-600 mb-1\">\n                <span>Đang sử dụng ({currentStudentCount}/{formData.maxStudents})</span>\n                <span className={isOverCapacity ? 'text-red-600 font-bold' : ''}>\n                  {Math.round(currentUsage)}%\n                </span>\n              </div>\n              <div className=\"h-2 w-full rounded-full bg-slate-200 overflow-hidden\">\n                <div\n                  className={`h-full ${capacityColor} transition-all duration-300`}\n                  style={{ width: `${Math.min(currentUsage, 100)}%` }}\n                />\n              </div>\n            </div>\n\n            {isOverCapacity && (\n              <p className=\"text-xs text-red-600 font-semibold\">\n                ⚠️ Vượt quá sĩ số cho phép\n              </p>\n            )}\n          </div>\n        </div>\n      </div>\n    </BaseModal>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\grades\\GradesManagement.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":98,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2482,2485],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2482,2485],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":99,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2541,2544],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2541,2544],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":103,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2685,2688],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2685,2688],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":104,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2745,2748],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2745,2748],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":113,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3055,3058],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3055,3058],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect, useMemo, useCallback, useRef } from 'react'\nimport { TrendingUp, Award, BarChart3 } from 'lucide-react'\nimport { StatCard, DataTable, FilterBar } from '@/components/admin/shared'\nimport type { Column } from '@/components/admin/shared'\n\ninterface GradeRecord {\n  id: string\n  studentName: string\n  classId: string\n  subject: string\n  midterm: number\n  final: number\n  average: number\n  letterGrade: 'A' | 'B' | 'C' | 'D' | 'F'\n}\n\ninterface GradeStats {\n  totalStudents: number\n  averageScore: number\n  gradeA: number\n  gradeB: number\n  gradeC: number\n  gradeD: number\n  gradeF: number\n}\n\ninterface ApiResponse<T> {\n  success: boolean\n  data: T[]\n  stats?: GradeStats\n  total?: number\n}\n\nexport function GradesManagement() {\n  const [grades, setGrades] = useState<GradeRecord[]>([])\n  const [stats, setStats] = useState<GradeStats>({\n    totalStudents: 0,\n    averageScore: 0,\n    gradeA: 0,\n    gradeB: 0,\n    gradeC: 0,\n    gradeD: 0,\n    gradeF: 0,\n  })\n  const [loading, setLoading] = useState(true)\n  const [filters, setFilters] = useState({\n    search: '',\n    class: '',\n    subject: '',\n    letterGrade: '',\n  })\n\n  // Use ref to track previous filter values\n  const prevFiltersRef = useRef<string>('')\n\n  // Fetch grades from API\n  useEffect(() => {\n    const filterString = JSON.stringify(filters)\n\n    // Only fetch if filters actually changed\n    if (filterString === prevFiltersRef.current) {\n      return\n    }\n\n    prevFiltersRef.current = filterString\n\n    const fetchGrades = async () => {\n      setLoading(true)\n      const params = new URLSearchParams()\n      if (filters.search) params.append('search', filters.search)\n      if (filters.class) params.append('classId', filters.class)\n      if (filters.subject) params.append('subject', filters.subject)\n      if (filters.letterGrade) params.append('letterGrade', filters.letterGrade)\n\n      try {\n        const response = await fetch(`/api/grades?${params}`)\n        const result: ApiResponse<GradeRecord> = await response.json()\n        if (result.success) {\n          setGrades(result.data)\n          if (result.stats) {\n            setStats(result.stats)\n          }\n        }\n      } catch (error) {\n        console.error('Failed to fetch grades:', error)\n      } finally {\n        setLoading(false)\n      }\n    }\n\n    fetchGrades()\n  }, [filters])\n\n  // Get unique values - memoized\n  const classOptions = useMemo(() => {\n    const classes = new Set(grades.map((g: any) => g.classId))\n    return Array.from(classes).map((c: any) => ({ value: c, label: `Lớp ${c}` }))\n  }, [grades])\n\n  const subjectOptions = useMemo(() => {\n    const subjects = new Set(grades.map((g: any) => g.subject))\n    return Array.from(subjects).map((s: any) => ({ value: s, label: s }))\n  }, [grades])\n\n  // Clear filters - memoized\n  const handleClearFilters = useCallback(() => {\n    setFilters({ search: '', class: '', subject: '', letterGrade: '' })\n  }, [])\n\n  // Handle filter change - memoized\n  const handleFilterChange = useCallback((key: string, value: any) => {\n    setFilters(prev => ({ ...prev, [key]: value }))\n  }, [])\n\n  // Grade letter badge function - memoized\n  const getGradeBadge = useCallback((letterGrade: string) => {\n    const config = {\n      A: 'bg-green-100 text-green-700 border-green-200',\n      B: 'bg-blue-100 text-blue-700 border-blue-200',\n      C: 'bg-yellow-100 text-yellow-700 border-yellow-200',\n      D: 'bg-orange-100 text-orange-700 border-orange-200',\n      F: 'bg-red-100 text-red-700 border-red-200',\n    }\n    return (\n      <span className={`inline-flex items-center justify-center rounded-lg border px-3 py-1 text-xs font-black ${config[letterGrade as keyof typeof config]}`}>\n        {letterGrade}\n      </span>\n    )\n  }, [])\n\n  // Table columns - memoized\n  const columns = useMemo<Column<GradeRecord>[]>(() => [\n    {\n      key: 'studentName',\n      label: 'Học sinh',\n      render: (_value, row) => (\n        <div className=\"flex items-center gap-3\">\n          <div className=\"flex h-10 w-10 items-center justify-center rounded-full bg-gradient-to-br from-[#0284C7] to-[#0369a1] text-xs font-bold text-white\">\n            {row.studentName.split(' ').slice(0, 2).map((n: string) => n[0]).join('')}\n          </div>\n          <div>\n            <p className=\"text-sm font-bold text-slate-800\">{row.studentName}</p>\n            <p className=\"text-xs text-slate-400\">Mã HS: {row.id}</p>\n          </div>\n        </div>\n      ),\n    },\n    {\n      key: 'classId',\n      label: 'Lớp',\n      render: (value) => (\n        <span className=\"rounded-lg bg-slate-100 px-3 py-1 text-xs font-semibold text-slate-600\">\n          {value}\n        </span>\n      ),\n    },\n    {\n      key: 'subject',\n      label: 'Môn học',\n      render: (value) => (\n        <span className=\"text-sm font-medium text-slate-700\">{value}</span>\n      ),\n    },\n    {\n      key: 'midterm',\n      label: 'Giữa kỳ',\n      render: (value) => (\n        <span className=\"rounded-lg bg-slate-50 px-3 py-1 text-sm font-semibold text-slate-700\">\n          {value.toFixed(1)}\n        </span>\n      ),\n    },\n    {\n      key: 'final',\n      label: 'Cuối kỳ',\n      render: (value) => (\n        <span className=\"rounded-lg bg-slate-50 px-3 py-1 text-sm font-semibold text-slate-700\">\n          {value.toFixed(1)}\n        </span>\n      ),\n    },\n    {\n      key: 'average',\n      label: 'Trung bình',\n      render: (value) => (\n        <span className=\"rounded-lg bg-blue-50 px-3 py-1 text-sm font-black text-blue-700\">\n          {value.toFixed(1)}\n        </span>\n      ),\n    },\n    {\n      key: 'letterGrade',\n      label: 'Điểm chữ',\n      render: (value) => getGradeBadge(value),\n    },\n  ], [getGradeBadge])\n\n  // Grade distribution data - memoized\n  const gradeDistribution = useMemo(() => [\n    { label: 'A', count: stats.gradeA, percentage: stats.totalStudents > 0 ? (stats.gradeA / stats.totalStudents) * 100 : 0 },\n    { label: 'B', count: stats.gradeB, percentage: stats.totalStudents > 0 ? (stats.gradeB / stats.totalStudents) * 100 : 0 },\n    { label: 'C', count: stats.gradeC, percentage: stats.totalStudents > 0 ? (stats.gradeC / stats.totalStudents) * 100 : 0 },\n    { label: 'D', count: stats.gradeD, percentage: stats.totalStudents > 0 ? (stats.gradeD / stats.totalStudents) * 100 : 0 },\n    { label: 'F', count: stats.gradeF, percentage: stats.totalStudents > 0 ? (stats.gradeF / stats.totalStudents) * 100 : 0 },\n  ], [stats])\n\n  // Letter grade filter options - memoized\n  const letterGradeOptions = useMemo(() => [\n    { value: 'A', label: 'A (Xuất sắc)' },\n    { value: 'B', label: 'B (Giỏi)' },\n    { value: 'C', label: 'C (Khá)' },\n    { value: 'D', label: 'D (Trung bình)' },\n    { value: 'F', label: 'F (Kém)' },\n  ], [])\n\n  // Memoize filters array for FilterBar\n  const filterBarFilters = useMemo(() => [\n    {\n      key: 'class',\n      label: 'Lớp',\n      type: 'select' as const,\n      options: classOptions,\n    },\n    {\n      key: 'subject',\n      label: 'Môn học',\n      type: 'select' as const,\n      options: subjectOptions,\n    },\n    {\n      key: 'letterGrade',\n      label: 'Điểm chữ',\n      type: 'select' as const,\n      options: letterGradeOptions,\n    },\n  ], [classOptions, letterGradeOptions, subjectOptions])\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Statistics Cards */}\n      <div className=\"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3\">\n        <StatCard\n          title=\"Tổng học sinh\"\n          value={stats.totalStudents}\n          icon={<Award className=\"h-5 w-5\" />}\n          color=\"blue\"\n        />\n        <StatCard\n          title=\"Điểm trung bình\"\n          value={stats.averageScore.toFixed(1)}\n          trend={2.5}\n          icon={<TrendingUp className=\"h-5 w-5\" />}\n          color=\"green\"\n        />\n        <StatCard\n          title=\"Điểm A\"\n          value={`${stats.gradeA} (${Math.round(stats.totalStudents > 0 ? (stats.gradeA / stats.totalStudents) * 100 : 0)}%)`}\n          icon={<BarChart3 className=\"h-5 w-5\" />}\n          color=\"purple\"\n        />\n      </div>\n\n      {/* Grade Distribution */}\n      <div className=\"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm\">\n        <h3 className=\"mb-4 text-lg font-bold text-slate-800\">Phân bố điểm số</h3>\n        <div className=\"space-y-3\">\n          {gradeDistribution.map((grade) => (\n            <div key={grade.label} className=\"flex items-center gap-4\">\n              <span className=\"w-8 text-center text-xs font-black text-slate-600\">{grade.label}</span>\n              <div className=\"flex-1 overflow-hidden rounded-full bg-slate-100\">\n                <div\n                  className={`h-2 rounded-full transition-all ${\n                    grade.label === 'A' ? 'bg-green-500' :\n                    grade.label === 'B' ? 'bg-blue-500' :\n                    grade.label === 'C' ? 'bg-yellow-500' :\n                    grade.label === 'D' ? 'bg-orange-500' :\n                    'bg-red-500'\n                  }`}\n                  style={{ width: `${grade.percentage}%` }}\n                />\n              </div>\n              <span className=\"w-20 text-right text-xs font-semibold text-slate-600\">\n                {grade.count} HS ({grade.percentage.toFixed(0)}%)\n              </span>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Filters */}\n      <FilterBar\n        searchKey=\"search\"\n        searchPlaceholder=\"Tìm kiếm học sinh...\"\n        filters={filterBarFilters}\n        values={filters}\n        onChange={handleFilterChange}\n        onClear={handleClearFilters}\n      />\n\n      {/* Data Table */}\n      <div className=\"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm\">\n        <DataTable\n          data={grades}\n          columns={columns}\n          loading={loading}\n          emptyMessage=\"Không tìm thấy bản ghi điểm số\"\n        />\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\notifications\\NotificationManagement.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DeliveryStatus' is defined but never used.","line":13,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":17},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The ref value 'deliveryChannelsRef.current' will likely have changed by the time this effect cleanup function runs. If this ref points to a node rendered by React, copy 'deliveryChannelsRef.current' to a variable inside the effect, and use that variable in the cleanup function.","line":150,"column":27,"nodeType":"Identifier","endLine":150,"endColumn":34}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect, useCallback, useMemo, useRef } from 'react'\nimport { useForm, FormProvider } from 'react-hook-form'\nimport { Bell, Send, Trash2, Megaphone, CheckCircle, XCircle, Clock } from 'lucide-react'\nimport { StatusBadge, PrimaryButton, FormField, FormSelect } from '@/components/admin/shared'\nimport { subscribeToAllNotifications, subscribeToDeliveryStatus, unsubscribeChannel } from '@/lib/supabase/realtime'\nimport type {\n  NotificationCreateInput,\n  NotificationListItem,\n  NotificationCategory,\n  NotificationPriority,\n  DeliveryStatus,\n  RealtimeChannel,\n} from '@school-management/shared-types'\n\ninterface DeliveryStatusData {\n  notificationId: string\n  total: number\n  delivered: number\n  failed: number\n  pending: number\n}\n\ninterface NotificationFormData {\n  title: string\n  content: string\n  category: NotificationCategory\n  priority: NotificationPriority\n  targetRole: 'admin' | 'teacher' | 'parent' | 'student' | 'all'\n}\n\ninterface ApiResponse<T> {\n  success: boolean\n  data?: T\n  message?: string\n}\n\nconst categoryOptions = [\n  { value: 'announcement', label: 'Thông báo' },\n  { value: 'emergency', label: 'Khẩn cấp' },\n  { value: 'reminder', label: 'Nhắc nhở' },\n  { value: 'system', label: 'Hệ thống' },\n]\n\nconst priorityOptions = [\n  { value: 'low', label: 'Thấp' },\n  { value: 'normal', label: 'Bình thường' },\n  { value: 'high', label: 'Cao' },\n  { value: 'emergency', label: 'Khẩn cấp' },\n]\n\nconst roleOptions = [\n  { value: 'all', label: 'Tất cả' },\n  { value: 'teacher', label: 'Giáo viên' },\n  { value: 'parent', label: 'Phụ huynh' },\n  { value: 'student', label: 'Học sinh' },\n]\n\nexport function NotificationManagement() {\n  const [notifications, setNotifications] = useState<NotificationListItem[]>([])\n  const [isSending, setIsSending] = useState(false)\n  const [deliveryStatuses, setDeliveryStatuses] = useState<Record<string, DeliveryStatusData>>({})\n\n  // Track active delivery status channels to prevent memory leaks\n  const deliveryChannelsRef = useRef<Map<string, RealtimeChannel>>(new Map())\n\n  const form = useForm<NotificationFormData>({\n    defaultValues: {\n      title: '',\n      content: '',\n      category: 'announcement',\n      priority: 'normal',\n      targetRole: 'all',\n    },\n  })\n\n  // Fetch notifications on mount\n  useEffect(() => {\n    fetchNotifications()\n  }, [])\n\n  // Subscribe to all notification changes (admin view)\n  useEffect(() => {\n    const channel = subscribeToAllNotifications(({ event, notification }) => {\n      if (event === 'INSERT' && notification) {\n        // Add new notification to list\n        setNotifications((prev) => {\n          const newItem: NotificationListItem = {\n            id: notification.id,\n            title: notification.title,\n            content: notification.content,\n            category: (notification.category || 'announcement') as NotificationCategory,\n            priority: (notification.priority || 'normal') as NotificationPriority,\n            isRead: notification.is_read ?? false,\n            createdAt: notification.created_at ?? new Date().toISOString(),\n          }\n          return [newItem, ...prev]\n        })\n\n        // Subscribe to delivery status for new notification\n        subscribeToNotificationDelivery(notification.id)\n      } else if (event === 'DELETE') {\n        // Remove deleted notification\n        setNotifications((prev) => prev.filter((n) => n.id !== notification?.id))\n        // Clean up delivery status\n        setDeliveryStatuses((prev) => {\n          const updated = { ...prev }\n          delete updated[notification?.id || '']\n          return updated\n        })\n        // Clean up delivery channel\n        const deliveryChannel = deliveryChannelsRef.current.get(notification?.id || '')\n        if (deliveryChannel) {\n          unsubscribeChannel(deliveryChannel)\n          deliveryChannelsRef.current.delete(notification?.id || '')\n        }\n      }\n    })\n\n    return () => {\n      channel.unsubscribe()\n    }\n  }, [])\n\n  // Subscribe to delivery status updates for existing notifications\n  // Fixed: Properly cleanup previous subscriptions before creating new ones\n  useEffect(() => {\n    // Cleanup all existing delivery channels\n    deliveryChannelsRef.current.forEach((channel) => {\n      unsubscribeChannel(channel)\n    })\n    deliveryChannelsRef.current.clear()\n\n    // Subscribe to notifications with limit to prevent memory issues\n    const notificationsToTrack = notifications.slice(0, 20) // Max 20 concurrent subscriptions\n\n    notificationsToTrack.forEach((notification) => {\n      // Skip if already subscribed (defensive check)\n      if (deliveryChannelsRef.current.has(notification.id)) return\n\n      subscribeToNotificationDelivery(notification.id)\n    })\n\n    // Cleanup on unmount\n    return () => {\n      deliveryChannelsRef.current.forEach((channel) => {\n        unsubscribeChannel(channel)\n      })\n      deliveryChannelsRef.current.clear()\n    }\n  }, [notifications])\n\n  const subscribeToNotificationDelivery = (notificationId: string) => {\n    // Skip if already subscribed\n    if (deliveryChannelsRef.current.has(notificationId)) {\n      return\n    }\n\n    const channel = subscribeToDeliveryStatus(notificationId, (status) => {\n      setDeliveryStatuses((prev) => {\n        const current = prev[notificationId] || {\n          notificationId,\n          total: 0,\n          delivered: 0,\n          failed: 0,\n          pending: 0,\n        }\n\n        // Update based on status\n        let updated: DeliveryStatusData\n        if (status.status === 'sent' || status.status === 'delivered') {\n          updated = {\n            ...current,\n            total: current.total + 1,\n            delivered: current.delivered + 1,\n          }\n        } else if (status.status === 'failed') {\n          updated = {\n            ...current,\n            total: current.total + 1,\n            failed: current.failed + 1,\n          }\n        } else if (status.status === 'pending') {\n          updated = {\n            ...current,\n            total: current.total + 1,\n            pending: current.pending + 1,\n          }\n        } else {\n          updated = current\n        }\n\n        return {\n          ...prev,\n          [notificationId]: updated,\n        }\n      })\n    })\n\n    // Store channel reference for cleanup\n    deliveryChannelsRef.current.set(notificationId, channel)\n  }\n\n  const fetchNotifications = async () => {\n    try {\n      // Add pagination limit to prevent unbounded state growth\n      const response = await fetch('/api/notifications?page=1&limit=50')\n      const result: ApiResponse<{ data: NotificationListItem[]; total: number }> =\n        await response.json()\n      if (result.success && result.data) {\n        setNotifications(result.data.data || [])\n      }\n    } catch (error) {\n      console.error('[NotificationManagement] Failed to fetch:', error)\n    }\n  }\n\n  const handleSubmit = useCallback(\n    async (data: NotificationFormData) => {\n      setIsSending(true)\n      try {\n        const payload: NotificationCreateInput = {\n          title: data.title,\n          content: data.content,\n          category: data.category,\n          priority: data.priority,\n          targetRole: data.targetRole,\n        }\n\n        const response = await fetch('/api/notifications', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(payload),\n        })\n\n        const result: ApiResponse<NotificationListItem> = await response.json()\n        if (result.success && result.data) {\n          setNotifications((prev) => [result.data!, ...prev])\n          form.reset()\n        }\n      } catch (error) {\n        console.error('[NotificationManagement] Failed to create:', error)\n      } finally {\n        setIsSending(false)\n      }\n    },\n    [form]\n  )\n\n  const handleDelete = useCallback(\n    async (id: string) => {\n      try {\n        const response = await fetch(`/api/notifications/${id}`, {\n          method: 'DELETE',\n        })\n        if (response.ok) {\n          setNotifications((prev) => prev.filter((n) => n.id !== id))\n        }\n      } catch (error) {\n        console.error('[NotificationManagement] Failed to delete:', error)\n      }\n    },\n    []\n  )\n\n  const getCategoryLabel = useCallback((category: NotificationCategory) => {\n    const labels: Record<NotificationCategory, string> = {\n      announcement: 'Thông báo',\n      emergency: 'Khẩn cấp',\n      reminder: 'Nhắc nhở',\n      system: 'Hệ thống',\n    }\n    return labels[category] || category\n  }, [])\n\n  const getStatusForCategory = useCallback((category: NotificationCategory) => {\n    const statusMap: Record<NotificationCategory, 'info' | 'warning' | 'success' | 'error'> = {\n      announcement: 'info',\n      emergency: 'error',\n      reminder: 'warning',\n      system: 'success',\n    }\n    return statusMap[category] || 'info'\n  }, [])\n\n  return (\n    <div className=\"grid grid-cols-1 gap-6 lg:grid-cols-2\">\n      {/* Create Notification Form */}\n      <NotificationComposer\n        form={form}\n        onSubmit={handleSubmit}\n        isSending={isSending}\n      />\n\n      {/* Notifications List */}\n      <NotificationList\n        notifications={notifications}\n        onDelete={handleDelete}\n        getCategoryLabel={getCategoryLabel}\n        getStatusForCategory={getStatusForCategory}\n        deliveryStatuses={deliveryStatuses}\n      />\n    </div>\n  )\n}\n\n// Notification Composer Component\nfunction NotificationComposer({\n  form,\n  onSubmit,\n  isSending,\n}: {\n  form: ReturnType<typeof useForm<NotificationFormData>>\n  onSubmit: (data: NotificationFormData) => void\n  isSending: boolean\n}) {\n  const category = form.watch('category')\n  const priority = form.watch('priority')\n\n  // Calculate expected channels\n  const expectedChannels = useMemo(() => {\n    if (priority === 'emergency' || category === 'emergency') {\n      return ['WebSocket', 'Email', 'In-App']\n    }\n    if (category === 'announcement') {\n      return ['WebSocket', 'Email']\n    }\n    return ['In-App']\n  }, [category, priority])\n\n  return (\n    <div className=\"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm\">\n      <div className=\"mb-6 flex items-center gap-3\">\n        <div className=\"rounded-xl bg-blue-50 p-2\">\n          <Megaphone className=\"h-5 w-5 text-[#0284C7]\" />\n        </div>\n        <h2 className=\"text-lg font-bold text-slate-800\">Tạo thông báo mới</h2>\n      </div>\n\n      <FormProvider {...form}>\n        <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n          <FormField\n            name=\"title\"\n            label=\"Tiêu đề\"\n            placeholder=\"Nhập tiêu đề thông báo\"\n            required\n          />\n\n          <div>\n            <label className=\"mb-1 block text-xs font-medium text-slate-700\">\n              Nội dung <span className=\"ml-1 text-red-500\">*</span>\n            </label>\n            <textarea\n              {...form.register('content', { required: true })}\n              className=\"h-32 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm transition-colors focus:border-[#0284C7] focus:outline-none focus:ring-1 focus:ring-[#0284C7]\"\n              placeholder=\"Nhập nội dung thông báo\"\n            />\n            {form.formState.errors.content && (\n              <p className=\"mt-1 text-xs text-red-500\">\n                {form.formState.errors.content.message}\n              </p>\n            )}\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-4\">\n            <FormSelect\n              name=\"category\"\n              label=\"Loại thông báo\"\n              options={categoryOptions}\n              required\n            />\n            <FormSelect\n              name=\"priority\"\n              label=\"Mức độ ưu tiên\"\n              options={priorityOptions}\n              required\n            />\n          </div>\n\n          <FormSelect\n            name=\"targetRole\"\n            label=\"Đối tượng\"\n            options={roleOptions}\n            required\n          />\n\n          {/* Delivery Preview */}\n          <div className=\"rounded-lg bg-slate-50 p-4\">\n            <p className=\"mb-2 text-xs font-medium text-slate-700\">Kênh gửi dự kiến:</p>\n            <div className=\"flex flex-wrap gap-2\">\n              {expectedChannels.map((channel) => (\n                <span\n                  key={channel}\n                  className=\"rounded-full bg-blue-100 px-3 py-1 text-xs font-medium text-blue-700\"\n                >\n                  {channel}\n                </span>\n              ))}\n            </div>\n          </div>\n\n          <PrimaryButton type=\"submit\" fullWidth disabled={isSending}>\n            <Send className=\"mr-2 h-4 w-4\" />\n            {isSending ? 'Đang gửi...' : 'Gửi thông báo'}\n          </PrimaryButton>\n        </form>\n      </FormProvider>\n    </div>\n  )\n}\n\n// Notification List Component\nfunction NotificationList({\n  notifications,\n  onDelete,\n  getCategoryLabel,\n  getStatusForCategory,\n  deliveryStatuses,\n}: {\n  notifications: NotificationListItem[]\n  onDelete: (id: string) => void\n  getCategoryLabel: (category: NotificationCategory) => string\n  getStatusForCategory: (category: NotificationCategory) => 'info' | 'warning' | 'success' | 'error'\n  deliveryStatuses: Record<string, DeliveryStatusData>\n}) {\n  return (\n    <div className=\"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm\">\n      <div className=\"mb-6 flex items-center justify-between\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"rounded-xl bg-blue-50 p-2\">\n            <Bell className=\"h-5 w-5 text-[#0284C7]\" />\n          </div>\n          <h2 className=\"text-lg font-bold text-slate-800\">Danh sách thông báo</h2>\n        </div>\n        <span className=\"text-sm text-slate-500\">{notifications.length} thông báo</span>\n      </div>\n\n      <div className=\"space-y-3\">\n        {notifications.length === 0 ? (\n          <div className=\"flex flex-col items-center justify-center py-12\">\n            <Bell className=\"mb-4 h-12 w-12 text-slate-300\" />\n            <p className=\"text-sm font-medium text-slate-500\">Chưa có thông báo nào</p>\n          </div>\n        ) : (\n          notifications.map((notification) => (\n            <NotificationCard\n              key={notification.id}\n              notification={notification}\n              getCategoryLabel={getCategoryLabel}\n              getStatusForCategory={getStatusForCategory}\n              deliveryStatus={deliveryStatuses[notification.id]}\n              onDelete={() => onDelete(notification.id)}\n            />\n          ))\n        )}\n      </div>\n    </div>\n  )\n}\n\n// Individual Notification Card\nfunction NotificationCard({\n  notification,\n  getCategoryLabel,\n  getStatusForCategory,\n  deliveryStatus,\n  onDelete,\n}: {\n  notification: NotificationListItem\n  getCategoryLabel: (category: NotificationCategory) => string\n  getStatusForCategory: (category: NotificationCategory) => 'info' | 'warning' | 'success' | 'error'\n  deliveryStatus?: DeliveryStatusData\n  onDelete: () => void\n}) {\n  return (\n    <div className=\"group rounded-xl border border-slate-200 bg-slate-50 p-4 transition-all hover:border-[#0284C7] hover:shadow-sm\">\n      <div className=\"flex items-start justify-between gap-3\">\n        <div className=\"flex-1\">\n          <div className=\"mb-2 flex flex-wrap items-center gap-2\">\n            <StatusBadge\n              status={getStatusForCategory(notification.category)}\n              label={getCategoryLabel(notification.category)}\n            />\n            <span\n              className={`rounded-full px-2 py-0.5 text-[10px] font-semibold ${\n                notification.priority === 'emergency'\n                  ? 'bg-red-100 text-red-700'\n                  : notification.priority === 'high'\n                    ? 'bg-orange-100 text-orange-700'\n                    : 'bg-slate-200 text-slate-600'\n              }`}\n            >\n              {notification.priority === 'emergency'\n                ? 'Khẩn cấp'\n                : notification.priority === 'high'\n                  ? 'Cao'\n                  : notification.priority === 'low'\n                    ? 'Thấp'\n                    : 'Bình thường'}\n            </span>\n          </div>\n          <h3 className=\"mb-1 text-sm font-bold text-slate-800\">{notification.title}</h3>\n          <p className=\"text-xs text-slate-500 line-clamp-2\">{notification.content}</p>\n\n          {/* Delivery Status Indicator */}\n          {deliveryStatus && deliveryStatus.total > 0 && (\n            <DeliveryStatusIndicator status={deliveryStatus} />\n          )}\n        </div>\n        <button\n          onClick={onDelete}\n          className=\"flex-shrink-0 rounded-lg p-2 text-slate-400 transition-colors hover:bg-red-50 hover:text-red-500\"\n        >\n          <Trash2 className=\"h-4 w-4\" />\n        </button>\n      </div>\n      <p className=\"mt-3 text-[10px] text-slate-400\">\n        {new Date(notification.createdAt).toLocaleString('vi-VN')}\n      </p>\n    </div>\n  )\n}\n\n// Delivery Status Indicator Component\nfunction DeliveryStatusIndicator({ status }: { status: DeliveryStatusData }) {\n  const { total, delivered, failed, pending } = status\n  const progress = total > 0 ? (delivered / total) * 100 : 0\n\n  return (\n    <div className=\"mt-3 space-y-2\">\n      {/* Progress bar */}\n      <div className=\"flex items-center gap-2\">\n        <div className=\"flex-1 h-1.5 bg-slate-200 rounded-full overflow-hidden\">\n          <div\n            className=\"h-full bg-green-500 rounded-full transition-all duration-300\"\n            style={{ width: `${progress}%` }}\n          />\n        </div>\n        <span className=\"text-[10px] text-slate-600 font-medium\">\n          {delivered}/{total}\n        </span>\n      </div>\n\n      {/* Status breakdown */}\n      <div className=\"flex items-center gap-3 text-[10px]\">\n        {delivered > 0 && (\n          <span className=\"flex items-center gap-1 text-green-600\">\n            <CheckCircle className=\"h-3 w-3\" />\n            {delivered} đã gửi\n          </span>\n        )}\n        {pending > 0 && (\n          <span className=\"flex items-center gap-1 text-orange-600\">\n            <Clock className=\"h-3 w-3\" />\n            {pending} đang chờ\n          </span>\n        )}\n        {failed > 0 && (\n          <span className=\"flex items-center gap-1 text-red-600\">\n            <XCircle className=\"h-3 w-3\" />\n            {failed} thất bại\n          </span>\n        )}\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\payments\\FeeAssignmentWizard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Users' is defined but never used.","line":4,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":42},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":176,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":176,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5780,5783],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5780,5783],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'formatCurrency' is assigned a value but never used.","line":182,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":182,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":187,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":187,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6030,6033],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6030,6033],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":188,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":188,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6085,6088],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6085,6088],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":188,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":188,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6093,6096],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6093,6096],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":318,"column":93,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":318,"endColumn":96,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11154,11157],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11154,11157],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":361,"column":109,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":361,"endColumn":112,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12946,12949],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12946,12949],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'feeItems' is defined but never used. Allowed unused args must match /^_/u.","line":419,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":419,"endColumn":11},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":429,"column":4,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":429,"endColumn":7,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15775,15778],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15775,15778],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":549,"column":4,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":549,"endColumn":7,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21442,21445],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21442,21445],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'index' is defined but never used. Allowed unused args must match /^_/u.","line":623,"column":51,"nodeType":null,"messageId":"unusedVar","endLine":623,"endColumn":56}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { ChevronRight, ChevronLeft, Users } from 'lucide-react'\n\ntype Step = 1 | 2 | 3 | 4\n\ninterface GradeData {\n  grade: string\n  classes: string[]\n  students: number\n}\n\ninterface FeeItem {\n  id: string\n  name: string\n  code: string\n  type: 'mandatory' | 'voluntary'\n  amount: number\n  semester: '1' | '2' | 'all'\n  status: 'active' | 'inactive'\n}\n\ninterface FeeAssignmentWizardProps {\n  onComplete?: () => void\n}\n\nexport function FeeAssignmentWizard({ onComplete }: FeeAssignmentWizardProps) {\n  const [currentStep, setCurrentStep] = useState<Step>(1)\n  const [selectedGrades, setSelectedGrades] = useState<string[]>([])\n  const [selectedClasses, setSelectedClasses] = useState<string[]>([])\n  const [selectedFees, setSelectedFees] = useState<string[]>([])\n  const [invoiceName, setInvoiceName] = useState('')\n  const [gradeData, setGradeData] = useState<Record<string, GradeData>>({})\n  const [feeItems, setFeeItems] = useState<FeeItem[]>([])\n\n  // Step 3: Timeline configuration state\n  const [startDate, setStartDate] = useState('2025-09-01')\n  const [dueDate, setDueDate] = useState('2025-10-15')\n  const [reminderDays, setReminderDays] = useState(7)\n  const [reminderFrequency, setReminderFrequency] = useState<'once' | 'daily' | 'weekly'>('weekly')\n\n  // Step 4: Terms confirmation\n  const [termsAccepted, setTermsAccepted] = useState(false)\n\n  useEffect(() => {\n    // Fetch grade data\n    fetch('/api/grades/data')\n      .then(res => res.json())\n      .then(result => {\n        if (result.success) {\n          setGradeData(result.data)\n        } else {\n          // Fallback data\n          setGradeData({\n            '6': { grade: '6', classes: ['6A', '6B', '6C', '6D', '6E', '6F'], students: 180 },\n            '7': { grade: '7', classes: ['7A', '7B', '7C', '7D', '7E', '7F'], students: 195 },\n            '8': { grade: '8', classes: ['8A', '8B', '8C', '8D', '8E', '8F'], students: 188 },\n            '9': { grade: '9', classes: ['9A', '9B', '9C', '9D', '9E', '9F'], students: 175 }\n          })\n        }\n      })\n      .catch(() => {\n        // Fallback data on error\n        setGradeData({\n          '6': { grade: '6', classes: ['6A', '6B', '6C', '6D', '6E', '6F'], students: 180 },\n          '7': { grade: '7', classes: ['7A', '7B', '7C', '7D', '7E', '7F'], students: 195 },\n          '8': { grade: '8', classes: ['8A', '8B', '8C', '8D', '8E', '8F'], students: 188 },\n          '9': { grade: '9', classes: ['9A', '9B', '9C', '9D', '9E', '9F'], students: 175 }\n        })\n      })\n\n    // Fetch fee items\n    fetch('/api/fee-items')\n      .then(res => res.json())\n      .then(result => {\n        if (result.success) {\n          setFeeItems(result.data || [])\n        }\n      })\n      .catch(() => {\n        // Fallback data\n        setFeeItems([\n          { id: 'tuition-hk1', name: 'Học phí', code: 'HP-HK1', type: 'mandatory', amount: 2500000, semester: '1', status: 'active' },\n          { id: 'insurance', name: 'Bảo hiểm y tế', code: 'BHYT-25', type: 'mandatory', amount: 854000, semester: 'all', status: 'active' },\n          { id: 'uniform-hk1', name: 'Tiền đồng phục', code: 'DP-HK1', type: 'voluntary', amount: 850000, semester: '1', status: 'active' },\n          { id: 'boarding-hk1', name: 'Tiền ăn bán trú', code: 'BT-HK1', type: 'voluntary', amount: 1200000, semester: '1', status: 'active' }\n        ])\n      })\n  }, [])\n\n  const handleNextStep = () => {\n    // Validation\n    if (currentStep === 1 && selectedClasses.length === 0) {\n      alert('Vui lòng chọn ít nhất một lớp!')\n      return\n    }\n    if (currentStep === 2) {\n      if (!invoiceName.trim()) {\n        alert('Vui lòng nhập tên phiếu thu!')\n        return\n      }\n      if (selectedFees.length === 0) {\n        alert('Vui lòng chọn ít nhất một khoản thu!')\n        return\n      }\n    }\n\n    if (currentStep < 4) {\n      setCurrentStep((currentStep + 1) as Step)\n    }\n  }\n\n  const handlePrevStep = () => {\n    if (currentStep > 1) {\n      setCurrentStep((currentStep - 1) as Step)\n    }\n  }\n\n  const handleGenerateInvoices = async () => {\n    if (!termsAccepted) {\n      alert('Vui lòng xác nhận điều khoản trước khi xuất phiếu thu!')\n      return\n    }\n\n    try {\n      const response = await fetch('/api/fee-assignments', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          name: invoiceName,\n          targetGrades: selectedGrades,\n          targetClasses: selectedClasses,\n          feeItems: selectedFees,\n          startDate,\n          dueDate,\n          reminderDays,\n          reminderFrequency\n        })\n      })\n\n      if (response.ok) {\n        // Reset and show success\n        setCurrentStep(1)\n        setSelectedClasses([])\n        setSelectedGrades([])\n        setSelectedFees([])\n        setInvoiceName('')\n        setStartDate('2025-09-01')\n        setDueDate('2025-10-15')\n        setReminderDays(7)\n        setReminderFrequency('weekly')\n        setTermsAccepted(false)\n        onComplete?.()\n        alert('Đã tạo phiếu thu thành công!')\n      }\n    } catch (error) {\n      console.error('Failed to create fee assignment:', error)\n      alert('Có lỗi xảy ra khi tạo phiếu thu!')\n    }\n  }\n\n  const toggleGrade = (grade: string) => {\n    const data = gradeData[grade]\n    if (selectedGrades.includes(grade)) {\n      setSelectedGrades(selectedGrades.filter(g => g !== grade))\n      setSelectedClasses(selectedClasses.filter(c => !data?.classes.includes(c)))\n    } else if (data) {\n      setSelectedGrades([...selectedGrades, grade])\n      setSelectedClasses([...selectedClasses, ...data.classes])\n    }\n  }\n\n  const toggleFee = (feeId: string) => {\n    if (selectedFees.includes(feeId)) {\n      setSelectedFees(selectedFees.filter((f: any) => f !== feeId))\n    } else {\n      setSelectedFees([...selectedFees, feeId])\n    }\n  }\n\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat('vi-VN').format(amount)\n  }\n\n  const totalAmount = feeItems\n    .filter((f: any) => selectedFees.includes(f.id))\n    .reduce((sum: any, f: any) => sum + f.amount, 0)\n\n  return (\n    <div className=\"bg-white rounded-[32px] shadow-sm border border-slate-100 overflow-hidden\">\n      {/* Step Wizard Header */}\n      <div className=\"p-8 border-b border-slate-100\">\n        <div className=\"flex items-center justify-between\">\n          {[1, 2, 3, 4].map((step) => (\n            <div key={step} className={`flex-1 ${step < 4 ? 'relative' : ''}`}>\n              <div className={`flex flex-col items-center ${currentStep === step ? 'active' : ''} ${currentStep > step ? 'completed' : ''}`}>\n                <div className={`w-12 h-12 rounded-2xl flex items-center justify-center font-black text-lg transition-all ${\n                  currentStep === step\n                    ? 'bg-gradient-to-br from-[#0284C7] to-[#0369a1] text-white shadow-lg'\n                    : currentStep > step\n                    ? 'bg-green-500 text-white'\n                    : 'bg-white border-2 border-slate-200 text-slate-400'\n                }`}>\n                  {currentStep > step ? '✓' : step}\n                </div>\n                <span className=\"text-[10px] font-black uppercase tracking-widest mt-2\">\n                  {step === 1 && 'Chọn đối tượng'}\n                  {step === 2 && 'Chọn khoản thu'}\n                  {step === 3 && 'Cấu hình thời gian'}\n                  {step === 4 && 'Xác nhận'}\n                </span>\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Step Content */}\n      <div className=\"p-8\">\n        {currentStep === 1 && (\n          <Step1GradeSelection\n            selectedGrades={selectedGrades}\n            selectedClasses={selectedClasses}\n            gradeData={gradeData}\n            onToggleGrade={toggleGrade}\n          />\n        )}\n        {currentStep === 2 && (\n          <Step2FeeSelection\n            selectedFees={selectedFees}\n            invoiceName={invoiceName}\n            feeItems={feeItems}\n            onFeesChange={setSelectedFees}\n            onNameChange={setInvoiceName}\n            onToggleFee={toggleFee}\n            totalAmount={totalAmount}\n          />\n        )}\n        {currentStep === 3 && (\n          <Step3TimelineConfiguration\n            invoiceName={invoiceName}\n            selectedClasses={selectedClasses}\n            selectedFees={selectedFees}\n            feeItems={feeItems}\n            totalAmount={totalAmount}\n            startDate={startDate}\n            dueDate={dueDate}\n            reminderDays={reminderDays}\n            reminderFrequency={reminderFrequency}\n            onStartDateChange={setStartDate}\n            onDueDateChange={setDueDate}\n            onReminderDaysChange={setReminderDays}\n            onReminderFrequencyChange={setReminderFrequency}\n          />\n        )}\n        {currentStep === 4 && (\n          <Step4Review\n            invoiceName={invoiceName}\n            selectedClasses={selectedClasses}\n            selectedFees={selectedFees}\n            feeItems={feeItems}\n            totalAmount={totalAmount}\n            startDate={startDate}\n            dueDate={dueDate}\n            reminderDays={reminderDays}\n            reminderFrequency={reminderFrequency}\n            termsAccepted={termsAccepted}\n            onTermsChange={setTermsAccepted}\n          />\n        )}\n      </div>\n\n      {/* Navigation */}\n      {currentStep < 4 && (\n        <div className=\"px-8 pb-8 flex items-center justify-between\">\n          <button\n            onClick={handlePrevStep}\n            disabled={currentStep === 1}\n            className=\"px-6 py-3 border border-slate-200 rounded-xl font-bold text-sm text-slate-700 hover:bg-slate-50 disabled:opacity-50 flex items-center gap-2\"\n          >\n            <ChevronLeft className=\"w-4 h-4\" />\n            Quay lại\n          </button>\n          <button\n            onClick={handleNextStep}\n            className=\"px-6 py-3 bg-[#0284C7] text-white rounded-xl font-bold text-sm hover:bg-[#0369a1] flex items-center gap-2\"\n          >\n            {currentStep === 3 ? 'Xem trước' : 'Tiếp theo'}\n            <ChevronRight className=\"w-4 h-4\" />\n          </button>\n        </div>\n      )}\n\n      {currentStep === 4 && (\n        <div className=\"px-8 pb-8 flex items-center justify-end gap-3\">\n          <button\n            onClick={handlePrevStep}\n            className=\"px-6 py-3 border border-slate-200 rounded-xl font-bold text-sm text-slate-700 hover:bg-slate-50 flex items-center gap-2\"\n          >\n            <ChevronLeft className=\"w-4 h-4\" />\n            Quay lại\n          </button>\n          <button\n            onClick={handleGenerateInvoices}\n            disabled={!termsAccepted}\n            className=\"px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-xl font-bold text-sm hover:from-green-600 hover:to-emerald-600 disabled:opacity-50 disabled:cursor-not-allowed\"\n          >\n            Phê duyệt & Xuất phiếu\n          </button>\n        </div>\n      )}\n    </div>\n  )\n}\n\n// Step 1: Grade Selection\nfunction Step1GradeSelection({ selectedGrades, selectedClasses, gradeData, onToggleGrade }: any) {\n  return (\n    <div className=\"grid grid-cols-2 gap-8\">\n      <div>\n        <h3 className=\"text-sm font-bold text-slate-700 mb-4\">Chọn theo Khối</h3>\n        <div className=\"space-y-2\">\n          {Object.keys(gradeData).map(grade => (\n            <label key={grade} className=\"flex items-center gap-3 p-3 bg-slate-50 rounded-xl cursor-pointer hover:bg-slate-100\">\n              <input\n                type=\"checkbox\"\n                checked={selectedGrades.includes(grade)}\n                onChange={() => onToggleGrade(grade)}\n                className=\"w-5 h-5 rounded border-slate-300\"\n              />\n              <span className=\"text-sm font-bold text-slate-700\">Khối {grade}</span>\n              <span className=\"text-xs text-slate-400 ml-auto\">\n                {gradeData[grade]?.classes.length || 0} lớp • {gradeData[grade]?.students || 0} học sinh\n              </span>\n            </label>\n          ))}\n        </div>\n      </div>\n      <div>\n        <h3 className=\"text-sm font-bold text-slate-700 mb-4\">Lớp đã chọn</h3>\n        <div className=\"min-h-[200px] p-4 bg-slate-50 rounded-xl border-2 border-dashed border-slate-200\">\n          {selectedClasses.length === 0 ? (\n            <p className=\"text-sm text-slate-400 text-center py-8\">Chưa chọn lớp nào</p>\n          ) : (\n            <div className=\"flex flex-wrap gap-2\">\n              {selectedClasses.map((cls: string) => (\n                <span key={cls} className=\"px-3 py-1 bg-blue-100 text-blue-700 text-xs font-black rounded-lg\">\n                  {cls}\n                </span>\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  )\n}\n\n// Step 2: Fee Selection\nfunction Step2FeeSelection({ selectedFees, invoiceName, feeItems, onNameChange, onToggleFee, totalAmount }: any) {\n  return (\n    <div>\n      <div className=\"mb-6\">\n        <label className=\"text-sm font-bold text-slate-700 mb-2 block\">Tên phiếu thu</label>\n        <input\n          type=\"text\"\n          value={invoiceName}\n          onChange={(e) => onNameChange(e.target.value)}\n          placeholder=\"Ví dụ: Học phí HK1 - 2025\"\n          className=\"w-full px-4 py-3 bg-white border border-slate-200 rounded-xl text-sm font-bold focus:ring-2 focus:ring-blue-100 outline-none\"\n        />\n      </div>\n\n      <div className=\"grid grid-cols-2 gap-4 mb-6\">\n        {feeItems.map((fee: FeeItem) => (\n          <label key={fee.id} className=\"flex items-start gap-4 p-5 bg-slate-50 rounded-2xl cursor-pointer hover:bg-blue-50 transition-all border-2 border-transparent hover:border-blue-200\">\n            <input\n              type=\"checkbox\"\n              checked={selectedFees.includes(fee.id)}\n              onChange={() => onToggleFee(fee.id)}\n              className=\"w-5 h-5 mt-1 rounded border-slate-300\"\n            />\n            <div className=\"flex-1\">\n              <div className=\"flex items-center gap-2 mb-1\">\n                <span className=\"text-xs font-bold text-slate-500 bg-slate-200 px-2 py-0.5 rounded font-mono\">{fee.code}</span>\n                <span className={`px-2 py-0.5 text-[9px] font-black uppercase rounded ${fee.type === 'mandatory' ? 'bg-red-100 text-red-600' : 'bg-blue-100 text-blue-600'}`}>\n                  {fee.type === 'mandatory' ? 'Bắt buộc' : 'Tự nguyện'}\n                </span>\n              </div>\n              <h4 className=\"text-sm font-bold text-slate-800 mb-1\">{fee.name}</h4>\n              <p className=\"text-xs text-slate-500\">{new Intl.NumberFormat('vi-VN').format(fee.amount)} ₫</p>\n            </div>\n          </label>\n        ))}\n      </div>\n\n      <div className=\"p-5 bg-gradient-to-r from-blue-50 to-cyan-50 rounded-2xl border border-blue-100\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <p className=\"text-xs font-bold text-slate-500 uppercase tracking-widest mb-1\">Tổng tiền thu dự kiến</p>\n            <p className=\"text-2xl font-black text-[#0284C7]\">{new Intl.NumberFormat('vi-VN').format(totalAmount)} ₫</p>\n          </div>\n          <div className=\"text-right\">\n            <p className=\"text-xs font-bold text-slate-500 uppercase tracking-widest mb-1\">Số khoản thu</p>\n            <p className=\"text-2xl font-black text-slate-800\">{selectedFees.length}</p>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n\n// Step 3: Timeline Configuration\nfunction Step3TimelineConfiguration({\n  invoiceName,\n  selectedClasses,\n  selectedFees,\n  feeItems,\n  totalAmount,\n  startDate,\n  dueDate,\n  reminderDays,\n  reminderFrequency,\n  onStartDateChange,\n  onDueDateChange,\n  onReminderDaysChange,\n  onReminderFrequencyChange,\n}: any) {\n  const formatCurrency = (amount: number) => new Intl.NumberFormat('vi-VN').format(amount)\n\n  // Calculate total students (assuming 40 students per class)\n  const totalStudents = selectedClasses.length * 40\n  const grandTotal = totalAmount * totalStudents\n\n  return (\n    <div className=\"grid grid-cols-2 gap-8\">\n      <div className=\"space-y-6\">\n        <div className=\"p-6 bg-slate-50 rounded-2xl\">\n          <h3 className=\"text-sm font-bold text-slate-700 mb-4\">Thời gian áp dụng</h3>\n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Ngày bắt đầu</label>\n              <input\n                type=\"date\"\n                value={startDate}\n                onChange={(e) => onStartDateChange(e.target.value)}\n                className=\"w-full px-4 py-3 bg-white border border-slate-200 rounded-xl text-sm font-bold outline-none focus:border-[#0284C7]\"\n              />\n            </div>\n            <div>\n              <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Ngày hết hạn</label>\n              <input\n                type=\"date\"\n                value={dueDate}\n                onChange={(e) => onDueDateChange(e.target.value)}\n                min={startDate}\n                className=\"w-full px-4 py-3 bg-white border border-slate-200 rounded-xl text-sm font-bold outline-none focus:border-[#0284C7]\"\n              />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"p-6 bg-slate-50 rounded-2xl\">\n          <h3 className=\"text-sm font-bold text-slate-700 mb-4\">Cài đặt nhắc nhở</h3>\n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Nhắc trước hạn (ngày)</label>\n              <select\n                value={reminderDays}\n                onChange={(e) => onReminderDaysChange(Number(e.target.value))}\n                className=\"w-full px-4 py-3 bg-white border border-slate-200 rounded-xl text-sm font-bold outline-none focus:border-[#0284C7]\"\n              >\n                <option value=\"3\">3 ngày trước</option>\n                <option value=\"5\">5 ngày trước</option>\n                <option value=\"7\">7 ngày trước</option>\n                <option value=\"10\">10 ngày trước</option>\n                <option value=\"14\">14 ngày trước</option>\n              </select>\n            </div>\n            <div>\n              <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Tần suất nhắc</label>\n              <select\n                value={reminderFrequency}\n                onChange={(e) => onReminderFrequencyChange(e.target.value)}\n                className=\"w-full px-4 py-3 bg-white border border-slate-200 rounded-xl text-sm font-bold outline-none focus:border-[#0284C7]\"\n              >\n                <option value=\"once\">Nhắc 1 lần</option>\n                <option value=\"daily\">Hàng ngày</option>\n                <option value=\"weekly\">Hàng tuần</option>\n              </select>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"p-6 bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl text-white\">\n        <h3 className=\"text-sm font-bold mb-6\">Thông tin đợt thu</h3>\n        <div className=\"space-y-4\">\n          <div className=\"flex justify-between items-center pb-3 border-b border-white/10\">\n            <span className=\"text-xs text-slate-400 uppercase tracking-wider\">Tên phiếu thu</span>\n            <span className=\"text-lg font-black text-blue-300\">{invoiceName || 'Chưa đặt tên'}</span>\n          </div>\n          <div className=\"flex justify-between items-center pb-3 border-b border-white/10\">\n            <span className=\"text-xs text-slate-400 uppercase tracking-wider\">Số lớp</span>\n            <span className=\"text-lg font-black\">{selectedClasses.length}</span>\n          </div>\n          <div className=\"flex justify-between items-center pb-3 border-b border-white/10\">\n            <span className=\"text-xs text-slate-400 uppercase tracking-wider\">Số học sinh</span>\n            <span className=\"text-lg font-black\">{totalStudents}</span>\n          </div>\n          <div className=\"flex justify-between items-center pb-3 border-b border-white/10\">\n            <span className=\"text-xs text-slate-400 uppercase tracking-wider\">Số khoản thu</span>\n            <span className=\"text-lg font-black\">{selectedFees.length}</span>\n          </div>\n          <div className=\"flex justify-between items-center\">\n            <span className=\"text-xs text-slate-400 uppercase tracking-wider\">Tổng tiền</span>\n            <span className=\"text-xl font-black text-green-400\">{formatCurrency(grandTotal)} ₫</span>\n          </div>\n        </div>\n\n        {/* Date Range Summary */}\n        <div className=\"mt-6 pt-6 border-t border-white/10\">\n          <p className=\"text-[10px] text-slate-400 uppercase tracking-wider mb-2\">Thời gian thu</p>\n          <div className=\"flex items-center gap-2 text-sm\">\n            <span className=\"px-2 py-1 bg-white/10 rounded-lg\">{new Date(startDate).toLocaleDateString('vi-VN')}</span>\n            <span className=\"text-slate-400\">→</span>\n            <span className=\"px-2 py-1 bg-white/10 rounded-lg\">{new Date(dueDate).toLocaleDateString('vi-VN')}</span>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n\n// Step 4: Review\nfunction Step4Review({\n  invoiceName,\n  selectedClasses,\n  selectedFees,\n  feeItems,\n  totalAmount,\n  startDate,\n  dueDate,\n  reminderDays,\n  reminderFrequency,\n  termsAccepted,\n  onTermsChange,\n}: any) {\n  const formatCurrency = (amount: number) => new Intl.NumberFormat('vi-VN').format(amount)\n\n  // Calculate total students (assuming 40 students per class)\n  const totalStudents = selectedClasses.length * 40\n  const grandTotal = totalAmount * totalStudents\n\n  // Get selected fee items details\n  const selectedFeeItems = feeItems.filter((f: FeeItem) => selectedFees.includes(f.id))\n\n  return (\n    <div>\n      <div className=\"flex items-center justify-between mb-5\">\n        <div>\n          <h3 className=\"text-base font-black text-slate-800\">Xác nhận & Phê duyệt</h3>\n          <p className=\"text-xs text-slate-500 mt-0.5\">Kiểm tra lại thông tin trước khi xuất phiếu thu</p>\n        </div>\n        <div className=\"px-4 py-2 bg-gradient-to-r from-blue-50 to-cyan-50 rounded-xl border border-blue-200\">\n          <p className=\"text-[9px] font-bold text-slate-500 uppercase tracking-wider\">Tên phiếu thu</p>\n          <p className=\"text-sm font-black text-[#0284C7]\">{invoiceName || 'Chưa đặt tên'}</p>\n        </div>\n      </div>\n\n      {/* Summary Cards */}\n      <div className=\"grid grid-cols-4 gap-3 mb-5\">\n        <div className=\"bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-4 text-white text-center\">\n          <p className=\"text-[10px] font-bold text-blue-100 uppercase tracking-wider\">Số lớp</p>\n          <p className=\"text-xl font-black\">{selectedClasses.length}</p>\n        </div>\n        <div className=\"bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-4 text-white text-center\">\n          <p className=\"text-[10px] font-bold text-purple-100 uppercase tracking-wider\">Học sinh</p>\n          <p className=\"text-xl font-black\">{totalStudents}</p>\n        </div>\n        <div className=\"bg-gradient-to-br from-amber-500 to-orange-500 rounded-xl p-4 text-white text-center\">\n          <p className=\"text-[10px] font-bold text-amber-100 uppercase tracking-wider\">Khoản thu</p>\n          <p className=\"text-xl font-black\">{selectedFees.length}</p>\n        </div>\n        <div className=\"bg-gradient-to-br from-emerald-500 to-green-500 rounded-xl p-4 text-white text-center\">\n          <p className=\"text-[10px] font-bold text-emerald-100 uppercase tracking-wider\">Tổng tiền</p>\n          <p className=\"text-sm font-black\">{formatCurrency(grandTotal)} ₫</p>\n        </div>\n      </div>\n\n      {/* Detailed Information */}\n      <div className=\"grid grid-cols-2 gap-4 mb-5\">\n        {/* Timeline */}\n        <div className=\"p-4 bg-slate-50 rounded-xl border border-slate-200\">\n          <p className=\"text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-3\">Thời gian thu</p>\n          <div className=\"space-y-2\">\n            <div className=\"flex justify-between\">\n              <span className=\"text-xs text-slate-500\">Ngày bắt đầu</span>\n              <span className=\"text-xs font-bold text-slate-800\">{new Date(startDate).toLocaleDateString('vi-VN')}</span>\n            </div>\n            <div className=\"flex justify-between\">\n              <span className=\"text-xs text-slate-500\">Ngày hết hạn</span>\n              <span className=\"text-xs font-bold text-slate-800\">{new Date(dueDate).toLocaleDateString('vi-VN')}</span>\n            </div>\n            <div className=\"flex justify-between\">\n              <span className=\"text-xs text-slate-500\">Nhắc trước hạn</span>\n              <span className=\"text-xs font-bold text-slate-800\">{reminderDays} ngày</span>\n            </div>\n            <div className=\"flex justify-between\">\n              <span className=\"text-xs text-slate-500\">Tần suất nhắc</span>\n              <span className=\"text-xs font-bold text-slate-800\">\n                {reminderFrequency === 'once' ? '1 lần' : reminderFrequency === 'daily' ? 'Hàng ngày' : 'Hàng tuần'}\n              </span>\n            </div>\n          </div>\n        </div>\n\n        {/* Fee Items List */}\n        <div className=\"p-4 bg-slate-50 rounded-xl border border-slate-200\">\n          <p className=\"text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-3\">Danh sách khoản thu</p>\n          <div className=\"space-y-2 max-h-32 overflow-y-auto\">\n            {selectedFeeItems.map((item: FeeItem, index: number) => (\n              <div key={item.id} className=\"flex justify-between items-center text-xs\">\n                <div>\n                  <p className=\"font-bold text-slate-800\">{item.name}</p>\n                  <p className=\"text-[10px] text-slate-400 font-mono\">{item.code}</p>\n                </div>\n                <span className=\"font-bold text-slate-800\">{formatCurrency(item.amount)} ₫</span>\n              </div>\n            ))}\n          </div>\n        </div>\n      </div>\n\n      {/* Classes Preview */}\n      <div className=\"mb-5 p-4 bg-slate-50 rounded-xl border border-slate-200\">\n        <p className=\"text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-2\">Lớp được chọn ({selectedClasses.length})</p>\n        <div className=\"flex flex-wrap gap-2\">\n          {selectedClasses.map((cls: string) => (\n            <span key={cls} className=\"px-3 py-1 bg-blue-100 text-blue-700 text-xs font-black rounded-lg\">\n              {cls}\n            </span>\n          ))}\n        </div>\n      </div>\n\n      {/* Terms Confirmation */}\n      <div className=\"p-4 bg-amber-50 rounded-xl border border-amber-200\">\n        <label className=\"flex items-start gap-3 cursor-pointer\">\n          <input\n            type=\"checkbox\"\n            checked={termsAccepted}\n            onChange={(e) => onTermsChange(e.target.checked)}\n            className=\"w-5 h-5 mt-0.5 rounded border-amber-300 text-amber-500 focus:ring-amber-500\"\n          />\n          <div className=\"flex-1\">\n            <p className=\"text-sm font-bold text-amber-900\">Xác nhận điều khoản xuất phiếu thu</p>\n            <p className=\"text-xs text-amber-700 mt-1\">\n              Tôi xác nhận rằng thông tin trên là chính xác và đồng ý xuất phiếu thu cho {totalStudents} học sinh với tổng số tiền {formatCurrency(grandTotal)} ₫.\n              Hệ thống sẽ tự động tạo hóa đơn cho từng học sinh và gửi nhắc nhở theo lịch đã cấu hình.\n            </p>\n          </div>\n        </label>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\payments\\FeeItemsTable.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchItems'. Either include it or remove the dependency array.","line":28,"column":6,"nodeType":"ArrayExpression","endLine":28,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [fetchItems, semester, year]","fix":{"range":[641,657],"text":"[fetchItems, semester, year]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { FileText, Trash2, Edit } from 'lucide-react'\n\ninterface FeeItem {\n  id: string\n  name: string\n  code: string\n  type: 'mandatory' | 'voluntary'\n  amount: number\n  semester: '1' | '2' | 'all'\n  status: 'active' | 'inactive'\n}\n\ninterface FeeItemsTableProps {\n  semester?: string\n  year?: string\n  onEdit?: (item: FeeItem) => void\n}\n\nexport function FeeItemsTable({ semester = 'all', year = '2025-2026', onEdit }: FeeItemsTableProps) {\n  const [items, setItems] = useState<FeeItem[]>([])\n  const [loading, setLoading] = useState(true)\n\n  useEffect(() => {\n    fetchItems()\n  }, [semester, year])\n\n  const fetchItems = async () => {\n    setLoading(true)\n    const params = new URLSearchParams()\n    if (semester !== 'all') params.append('semester', semester)\n\n    try {\n      const res = await fetch(`/api/fee-items?${params}`)\n      const result = await res.json()\n      setItems(result.data || [])\n    } catch (error) {\n      console.error('Failed to fetch fee items:', error)\n      // Fallback to mock data if API fails\n      setItems([\n        { id: 'tuition-hk1', name: 'Học phí', code: 'HP-HK1', type: 'mandatory', amount: 2500000, semester: '1', status: 'active' },\n        { id: 'insurance', name: 'Bảo hiểm y tế', code: 'BHYT-25', type: 'mandatory', amount: 854000, semester: 'all', status: 'active' },\n        { id: 'uniform-hk1', name: 'Tiền đồng phục', code: 'DP-HK1', type: 'voluntary', amount: 850000, semester: '1', status: 'active' },\n        { id: 'boarding-hk1', name: 'Tiền ăn bán trú', code: 'BT-HK1', type: 'voluntary', amount: 1200000, semester: '1', status: 'active' }\n      ])\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleDelete = async (id: string) => {\n    if (!confirm('Bạn có chắc muốn xóa khoản thu này?')) return\n\n    try {\n      await fetch(`/api/fee-items/${id}`, { method: 'DELETE' })\n      fetchItems()\n    } catch (error) {\n      console.error('Failed to delete fee item:', error)\n    }\n  }\n\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat('vi-VN').format(amount)\n  }\n\n  if (loading) {\n    return <div className=\"p-8 text-center text-slate-400\">Đang tải...</div>\n  }\n\n  return (\n    <div className=\"bg-white rounded-[32px] shadow-sm border border-slate-100 overflow-hidden\">\n      {/* Table */}\n      <div className=\"overflow-x-auto\">\n        <table className=\"w-full text-left\">\n          <thead>\n            <tr className=\"bg-slate-50\">\n              <th className=\"px-8 py-4 text-[10px] font-black text-slate-400 uppercase tracking-widest\">\n                Tên khoản thu\n              </th>\n              <th className=\"px-8 py-4 text-[10px] font-black text-slate-400 uppercase tracking-widest w-32\">\n                Mã khoản thu\n              </th>\n              <th className=\"px-8 py-4 text-[10px] font-black text-slate-400 uppercase tracking-widest w-28\">\n                Loại\n              </th>\n              <th className=\"px-8 py-4 text-[10px] font-black text-slate-400 uppercase tracking-widest\">\n                Số tiền (VNĐ)\n              </th>\n              <th className=\"px-8 py-4 text-[10px] font-black text-slate-400 uppercase tracking-widest\">\n                Học kỳ\n              </th>\n              <th className=\"px-8 py-4 text-[10px] font-black text-slate-400 uppercase tracking-widest\">\n                Trạng thái\n              </th>\n              <th className=\"px-8 py-4 text-[10px] font-black text-slate-400 uppercase tracking-widest\">\n                Thao tác\n              </th>\n            </tr>\n          </thead>\n          <tbody className=\"divide-y divide-slate-100\">\n            {items.map((item) => (\n              <tr key={item.id} className=\"hover:bg-slate-50/50 transition-all\">\n                <td className=\"px-8 py-4\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center\">\n                      <FileText className=\"w-5 h-5 text-[#0284C7]\" />\n                    </div>\n                    <span className=\"text-sm font-bold text-slate-800\">{item.name}</span>\n                  </div>\n                </td>\n                <td className=\"px-8 py-4\">\n                  <span className=\"text-xs font-bold text-slate-500 bg-slate-100 px-2 py-1 rounded-lg font-mono\">\n                    {item.code}\n                  </span>\n                </td>\n                <td className=\"px-8 py-4\">\n                  <span className={`px-3 py-1 text-[10px] font-black uppercase rounded-lg ${\n                    item.type === 'mandatory'\n                      ? 'bg-red-100 text-red-600'\n                      : 'bg-blue-100 text-blue-600'\n                  }`}>\n                    {item.type === 'mandatory' ? 'Bắt buộc' : 'Tự nguyện'}\n                  </span>\n                </td>\n                <td className=\"px-8 py-4 text-sm font-bold text-slate-700\">\n                  {formatCurrency(item.amount)} ₫\n                </td>\n                <td className=\"px-8 py-4 text-sm font-medium text-slate-500\">\n                  {item.semester === 'all' ? 'Cả năm' : `Học kỳ ${item.semester}`}\n                </td>\n                <td className=\"px-8 py-4\">\n                  <span className=\"flex items-center gap-2 text-sm font-medium text-green-600\">\n                    <span className=\"w-2 h-2 bg-green-500 rounded-full\"></span>\n                    Hoạt động\n                  </span>\n                </td>\n                <td className=\"px-8 py-4\">\n                  <div className=\"flex items-center gap-2\">\n                    <button\n                      onClick={() => onEdit?.(item)}\n                      className=\"p-2 text-slate-400 hover:text-blue-500 hover:bg-blue-50 rounded-lg transition-all\"\n                    >\n                      <Edit className=\"w-4 h-4\" />\n                    </button>\n                    <button\n                      onClick={() => handleDelete(item.id)}\n                      className=\"p-2 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-all\"\n                    >\n                      <Trash2 className=\"w-4 h-4\" />\n                    </button>\n                  </div>\n                </td>\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\payments\\PaymentsManagement.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":75,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2391,2394],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2391,2394],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":136,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4385,4388],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4385,4388],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect, useMemo, useCallback, useRef } from 'react'\nimport { DollarSign, TrendingUp, AlertCircle, FileText, Plus, Download } from 'lucide-react'\nimport { StatCard, DataTable, StatusBadge, FilterBar } from '@/components/admin/shared'\nimport type { Column } from '@/components/admin/shared'\nimport { FeeItemsTable } from './FeeItemsTable'\nimport { FeeAssignmentWizard } from './FeeAssignmentWizard'\nimport { QuickAccessCard } from './QuickAccessCard'\nimport { AddFeeItemModal } from './modals/AddFeeItemModal'\nimport { EditFeeItemModal } from './modals/EditFeeItemModal'\nimport { PaymentConfirmModal } from './modals/PaymentConfirmModal'\nimport { InvoiceDetailModal } from './modals/InvoiceDetailModal'\nimport { SendReminderModal } from './modals/SendReminderModal'\nimport { ExportReportModal } from './modals/ExportReportModal'\n\ninterface Invoice {\n  id: string\n  studentId: string\n  studentName: string\n  amount: number\n  status: 'paid' | 'pending' | 'overdue'\n  dueDate: string\n  paidDate?: string\n}\n\ninterface PaymentStats {\n  totalAmount: number\n  collectedAmount: number\n  pendingCount: number\n  overdueCount: number\n  collectionRate: number\n}\n\ninterface ApiResponse<T> {\n  success: boolean\n  data: T[]\n  stats?: PaymentStats\n  total?: number\n}\n\ninterface FeeItem {\n  id: string\n  name: string\n  code: string\n  type: 'mandatory' | 'voluntary'\n  amount: number\n  semester: '1' | '2' | 'all'\n  status: 'active' | 'inactive'\n}\n\nexport function PaymentsManagement() {\n  const [invoices, setInvoices] = useState<Invoice[]>([])\n  const [stats, setStats] = useState<PaymentStats>({\n    totalAmount: 0,\n    collectedAmount: 0,\n    pendingCount: 0,\n    overdueCount: 0,\n    collectionRate: 0,\n  })\n  const [loading, setLoading] = useState(true)\n  const [filters, setFilters] = useState({\n    search: '',\n    status: '',\n    class: '',\n  })\n  const [activeTab, setActiveTab] = useState<'fees' | 'assignment' | 'invoices'>('fees')\n  const [refreshKey, setRefreshKey] = useState(0)\n\n  // Modal states\n  const [addFeeItemModalOpen, setAddFeeItemModalOpen] = useState(false)\n  const [editFeeItemModalOpen, setEditFeeItemModalOpen] = useState(false)\n  const [selectedFeeItem, setSelectedFeeItem] = useState<FeeItem | null>(null)\n  const [paymentConfirmModalOpen, setPaymentConfirmModalOpen] = useState(false)\n  const [selectedInvoice, setSelectedInvoice] = useState<any>(null)\n  const [invoiceDetailModalOpen, setInvoiceDetailModalOpen] = useState(false)\n  const [selectedInvoiceId, setSelectedInvoiceId] = useState('')\n  const [sendReminderModalOpen, setSendReminderModalOpen] = useState(false)\n  const [exportReportModalOpen, setExportReportModalOpen] = useState(false)\n\n  // Current user (mock - should come from auth context)\n  const currentUser = { role: 'admin', id: 'admin@school.edu', name: 'Admin User' }\n\n  // Use ref to track previous filter values\n  const prevFiltersRef = useRef<string>('')\n\n  // Fetch invoices from API\n  useEffect(() => {\n    const filterString = JSON.stringify(filters)\n\n    // Only fetch if filters actually changed\n    if (filterString === prevFiltersRef.current) {\n      return\n    }\n\n    prevFiltersRef.current = filterString\n\n    const fetchInvoices = async () => {\n      setLoading(true)\n      const params = new URLSearchParams()\n      if (filters.search) params.append('search', filters.search)\n      if (filters.status) params.append('status', filters.status)\n\n      try {\n        const response = await fetch(`/api/payments?${params}`)\n        const result: ApiResponse<Invoice> = await response.json()\n        if (result.success) {\n          setInvoices(result.data)\n          if (result.stats) {\n            setStats(result.stats)\n          }\n        }\n      } catch (error) {\n        console.error('Failed to fetch invoices:', error)\n      } finally {\n        setLoading(false)\n      }\n    }\n\n    fetchInvoices()\n  }, [filters])\n\n  // Get unique classes from student names (simplified) - memoized\n  const classOptions = useMemo(() => [\n    { value: '10A1', label: 'Lớp 10A1' },\n    { value: '10A2', label: 'Lớp 10A2' },\n    { value: '10A3', label: 'Lớp 10A3' },\n  ], [])\n\n  // Clear filters - memoized\n  const handleClearFilters = useCallback(() => {\n    setFilters({ search: '', status: '', class: '' })\n  }, [])\n\n  // Handle filter change - memoized\n  const handleFilterChange = useCallback((key: string, value: any) => {\n    setFilters(prev => ({ ...prev, [key]: value }))\n  }, [])\n\n  // Format currency function - memoized\n  const formatCurrency = useCallback((amount: number) => {\n    return new Intl.NumberFormat('vi-VN').format(amount)\n  }, [])\n\n  // Table columns - memoized\n  const columns = useMemo<Column<Invoice>[]>(() => [\n    {\n      key: 'studentName',\n      label: 'Học sinh',\n      render: (_value, row) => (\n        <div className=\"flex items-center gap-3\">\n          <div className=\"flex h-10 w-10 items-center justify-center rounded-full bg-gradient-to-br from-[#0284C7] to-[#0369a1] text-xs font-bold text-white\">\n            {row.studentName.split(' ').slice(0, 2).map((n: string) => n[0]).join('')}\n          </div>\n          <div>\n            <p className=\"text-sm font-bold text-slate-800\">{row.studentName}</p>\n            <p className=\"text-xs text-slate-400\">Mã HS: {row.studentId}</p>\n          </div>\n        </div>\n      ),\n    },\n    {\n      key: 'amount',\n      label: 'Số tiền',\n      render: (value) => (\n        <span className=\"text-sm font-bold text-slate-800\">\n          {formatCurrency(value)} đ\n        </span>\n      ),\n    },\n    {\n      key: 'dueDate',\n      label: 'Hạn thanh toán',\n      render: (value) => (\n        <span className=\"text-sm text-slate-600\">{value}</span>\n      ),\n    },\n    {\n      key: 'paidDate',\n      label: 'Ngày thanh toán',\n      render: (value) => value ? (\n        <span className=\"text-sm text-slate-600\">{value}</span>\n      ) : (\n        <span className=\"text-xs text-slate-400\">—</span>\n      ),\n    },\n    {\n      key: 'status',\n      label: 'Trạng thái',\n      render: (value) => {\n        const statusConfig = {\n          paid: { label: 'Đã thanh toán', status: 'success' as const },\n          pending: { label: 'Chờ thanh toán', status: 'warning' as const },\n          overdue: { label: 'Quá hạn', status: 'error' as const },\n        }\n        const config = statusConfig[value as keyof typeof statusConfig]\n        return <StatusBadge status={config.status} label={config.label} />\n      },\n    },\n    {\n      key: 'actions',\n      label: 'Thao tác',\n      render: (_value, row) => (\n        <div className=\"flex items-center gap-1\">\n          <button\n            onClick={() => {\n              setSelectedInvoiceId(row.id)\n              setInvoiceDetailModalOpen(true)\n            }}\n            className=\"rounded-lg p-2 text-slate-400 transition-colors hover:bg-blue-50 hover:text-blue-600\"\n            title=\"Xem chi tiết\"\n          >\n            <FileText className=\"h-4 w-4\" />\n          </button>\n          {row.status !== 'paid' && (\n            <button\n              onClick={() => {\n                setSelectedInvoice(row)\n                setPaymentConfirmModalOpen(true)\n              }}\n              className=\"rounded-lg p-2 text-green-500 transition-colors hover:bg-green-50 hover:text-green-600\"\n              title=\"Xác nhận thanh toán\"\n            >\n              <DollarSign className=\"h-4 w-4\" />\n            </button>\n          )}\n        </div>\n      ),\n    },\n  ], [formatCurrency])\n\n  // Status filter options - memoized\n  const statusFilterOptions = useMemo(() => [\n    { value: 'paid', label: 'Đã thanh toán' },\n    { value: 'pending', label: 'Chờ thanh toán' },\n    { value: 'overdue', label: 'Quá hạn' },\n  ], [])\n\n  // Memoize filters array for FilterBar\n  const filterBarFilters = useMemo(() => [\n    {\n      key: 'status',\n      label: 'Trạng thái',\n      type: 'select' as const,\n      options: statusFilterOptions,\n    },\n    {\n      key: 'class',\n      label: 'Lớp',\n      type: 'select' as const,\n      options: classOptions,\n    },\n  ], [classOptions, statusFilterOptions])\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Quick Access to Invoice Tracker */}\n      <QuickAccessCard />\n\n      {/* Tab Navigation */}\n      <div className=\"flex gap-2 bg-slate-100 p-1 rounded-xl\">\n        <button\n          onClick={() => setActiveTab('fees')}\n          className={`flex-1 px-4 py-2 rounded-lg font-bold text-sm transition-all ${\n            activeTab === 'fees'\n              ? 'bg-white text-[#0284C7] shadow-sm'\n              : 'text-slate-500 hover:text-slate-700'\n          }`}\n        >\n          Danh mục Khoản thu\n        </button>\n        <button\n          onClick={() => setActiveTab('assignment')}\n          className={`flex-1 px-4 py-2 rounded-lg font-bold text-sm transition-all ${\n            activeTab === 'assignment'\n              ? 'bg-white text-[#0284C7] shadow-sm'\n              : 'text-slate-500 hover:text-slate-700'\n          }`}\n        >\n          Thiết lập Đợt thu\n        </button>\n        <button\n          onClick={() => setActiveTab('invoices')}\n          className={`flex-1 px-4 py-2 rounded-lg font-bold text-sm transition-all ${\n            activeTab === 'invoices'\n              ? 'bg-white text-[#0284C7] shadow-sm'\n              : 'text-slate-500 hover:text-slate-700'\n          }`}\n        >\n          Theo dõi Hóa đơn\n        </button>\n      </div>\n\n      {/* Content based on active tab */}\n      {activeTab === 'fees' && (\n        <div>\n          {/* Section Header */}\n          <div className=\"mb-4 p-6 bg-white rounded-2xl border border-slate-100 shadow-sm\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-4\">\n                <div className=\"p-3 bg-gradient-to-br from-blue-50 to-cyan-50 rounded-2xl\">\n                  <FileText className=\"w-6 h-6 text-[#0284C7]\" />\n                </div>\n                <div>\n                  <h3 className=\"text-xl font-black text-slate-800 tracking-tight\">Quản lý Danh mục Khoản thu</h3>\n                  <p className=\"text-slate-400 text-[10px] font-bold uppercase tracking-widest mt-1\">Fee Item Library</p>\n                </div>\n              </div>\n              <button\n                onClick={() => setAddFeeItemModalOpen(true)}\n                className=\"px-5 py-2.5 bg-[#0284C7] text-white rounded-xl font-bold text-sm hover:bg-[#0369a1] flex items-center gap-2 shadow-lg shadow-blue-100 transition-all\"\n              >\n                <Plus className=\"w-4 h-4\" />\n                Thêm khoản thu mới\n              </button>\n            </div>\n          </div>\n\n          {/* Filters */}\n          <div className=\"flex items-center gap-4 mb-4\">\n            <select className=\"bg-slate-50 border border-slate-200 text-xs font-bold rounded-xl px-4 py-2 outline-none\">\n              <option>2025-2026</option>\n              <option>2024-2025</option>\n            </select>\n            <select className=\"bg-slate-50 border border-slate-200 text-xs font-bold rounded-xl px-4 py-2 outline-none\">\n              <option value=\"all\">Tất cả học kỳ</option>\n              <option value=\"1\">Học kỳ 1</option>\n              <option value=\"2\">Học kỳ 2</option>\n            </select>\n          </div>\n          <FeeItemsTable key={refreshKey} />\n        </div>\n      )}\n\n      {activeTab === 'assignment' && (\n        <div>\n          {/* Section Header */}\n          <div className=\"mb-4 p-6 bg-white rounded-2xl border border-slate-100 shadow-sm\">\n            <div className=\"flex items-center gap-4\">\n              <div className=\"p-3 bg-gradient-to-br from-green-50 to-emerald-50 rounded-2xl\">\n                <TrendingUp className=\"w-6 h-6 text-green-600\" />\n              </div>\n              <div>\n                <h3 className=\"text-xl font-black text-slate-800 tracking-tight\">Thiết lập Đợt thu và Áp dụng</h3>\n                <p className=\"text-slate-400 text-[10px] font-bold uppercase tracking-widest mt-1\">Fee Assignment - Tạo phiếu thu hàng loạt</p>\n              </div>\n            </div>\n          </div>\n          <FeeAssignmentWizard onComplete={() => setRefreshKey(k => k + 1)} />\n        </div>\n      )}\n\n      {activeTab === 'invoices' && (\n        <div>\n          {/* Statistics Cards */}\n          <div className=\"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4 mb-6\">\n            <StatCard\n              title=\"Tổng học phí\"\n              value={`${formatCurrency(stats.totalAmount)} đ`}\n              icon={<DollarSign className=\"h-5 w-5\" />}\n              color=\"blue\"\n            />\n            <StatCard\n              title=\"Đã thu\"\n              value={`${formatCurrency(stats.collectedAmount)} đ`}\n              trend={stats.collectionRate}\n              icon={<TrendingUp className=\"h-5 w-5\" />}\n              color=\"green\"\n            />\n            <StatCard\n              title=\"Chờ thu\"\n              value={stats.pendingCount}\n              icon={<AlertCircle className=\"h-5 w-5\" />}\n              color=\"orange\"\n            />\n            <StatCard\n              title=\"Quá hạn\"\n              value={stats.overdueCount}\n              icon={<AlertCircle className=\"h-5 w-5\" />}\n              color=\"red\"\n            />\n          </div>\n\n          {/* Collection Rate */}\n          <div className=\"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm mb-6\">\n            <div className=\"mb-4 flex items-center justify-between\">\n              <h3 className=\"text-lg font-bold text-slate-800\">Tỷ lệ thu học phí</h3>\n              <span className=\"text-3xl font-black text-[#0284C7]\">{stats.collectionRate}%</span>\n            </div>\n            <div className=\"h-3 w-full overflow-hidden rounded-full bg-slate-100\">\n              <div\n                className=\"h-full bg-gradient-to-r from-[#0284C7] to-[#0369a1] transition-all duration-500\"\n                style={{ width: `${stats.collectionRate}%` }}\n              />\n            </div>\n            <div className=\"mt-2 text-xs text-slate-500\">\n              {formatCurrency(stats.collectedAmount)} đ / {formatCurrency(stats.totalAmount)} đ\n            </div>\n          </div>\n\n          {/* Filters */}\n          <FilterBar\n            searchKey=\"search\"\n            searchPlaceholder=\"Tìm kiếm học sinh hoặc mã hóa đơn...\"\n            filters={filterBarFilters}\n            values={filters}\n            onChange={handleFilterChange}\n            onClear={handleClearFilters}\n          />\n\n          {/* Invoice Table */}\n          <div className=\"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm\">\n            <div className=\"mb-4 flex items-center justify-between\">\n              <h3 className=\"text-lg font-bold text-slate-800\">Theo dõi Học phí</h3>\n              <div className=\"flex items-center gap-2\">\n                <span className=\"text-sm text-slate-500\">\n                  {invoices.length} hóa đơn\n                </span>\n                <button\n                  onClick={() => setExportReportModalOpen(true)}\n                  className=\"px-4 py-2 bg-[#0284C7] text-white rounded-lg font-bold text-sm hover:bg-[#0369a1] flex items-center gap-2 transition-all\"\n                  title=\"Xuất báo cáo\"\n                >\n                  <Download className=\"w-4 h-4\" />\n                  Xuất báo cáo\n                </button>\n              </div>\n            </div>\n            <DataTable\n              data={invoices}\n              columns={columns}\n              loading={loading}\n              emptyMessage=\"Không tìm thấy hóa đơn\"\n            />\n          </div>\n        </div>\n      )}\n\n      {/* Modals */}\n      <AddFeeItemModal\n        isOpen={addFeeItemModalOpen}\n        onClose={() => setAddFeeItemModalOpen(false)}\n        onSuccess={() => {\n          setAddFeeItemModalOpen(false)\n          setRefreshKey(k => k + 1)\n        }}\n      />\n\n      {selectedFeeItem && (\n        <EditFeeItemModal\n          isOpen={editFeeItemModalOpen}\n          onClose={() => {\n            setEditFeeItemModalOpen(false)\n            setSelectedFeeItem(null)\n          }}\n          onSuccess={() => {\n            setEditFeeItemModalOpen(false)\n            setSelectedFeeItem(null)\n            setRefreshKey(k => k + 1)\n          }}\n          feeItem={selectedFeeItem}\n        />\n      )}\n\n      {selectedInvoice && (\n        <PaymentConfirmModal\n          isOpen={paymentConfirmModalOpen}\n          onClose={() => {\n            setPaymentConfirmModalOpen(false)\n            setSelectedInvoice(null)\n          }}\n          onSuccess={() => {\n            setPaymentConfirmModalOpen(false)\n            setSelectedInvoice(null)\n            setRefreshKey(k => k + 1)\n          }}\n          invoice={selectedInvoice}\n          currentUser={currentUser}\n        />\n      )}\n\n      <InvoiceDetailModal\n        isOpen={invoiceDetailModalOpen}\n        onClose={() => {\n          setInvoiceDetailModalOpen(false)\n          setSelectedInvoiceId('')\n        }}\n        invoiceId={selectedInvoiceId}\n      />\n\n      <SendReminderModal\n        isOpen={sendReminderModalOpen}\n        onClose={() => setSendReminderModalOpen(false)}\n        onSuccess={() => {\n          setSendReminderModalOpen(false)\n          setRefreshKey(k => k + 1)\n        }}\n        recipients={invoices\n          .filter(inv => inv.status === 'pending' || inv.status === 'overdue')\n          .map(inv => ({\n            studentName: inv.studentName,\n            parentEmail: `parent_${inv.studentId}@example.com`,\n            parentPhone: '09xxxxxxxx',\n            amount: inv.amount,\n            dueDate: inv.dueDate,\n          }))}\n        currentUser={currentUser}\n      />\n\n      <ExportReportModal\n        isOpen={exportReportModalOpen}\n        onClose={() => setExportReportModalOpen(false)}\n        onSuccess={() => {\n          setExportReportModalOpen(false)\n        }}\n      />\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\payments\\QuickAccessCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\payments\\modals\\AddFeeItemModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PrimaryButton' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SecondaryButton' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1235,1238],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1235,1238],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1358,1361],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1358,1361],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'formData.code'. Either include it or remove the dependency array.","line":57,"column":6,"nodeType":"ArrayExpression","endLine":57,"endColumn":40,"suggestions":[{"desc":"Update the dependencies array to be: [formData.code, formData.name, formData.semester]","fix":{"range":[1595,1629],"text":"[formData.code, formData.name, formData.semester]"}}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { BaseModal } from '@/components/admin/shared/modals/BaseModal'\nimport { PrimaryButton } from '@/components/admin/shared/buttons/primary-button'\nimport { SecondaryButton } from '@/components/admin/shared/buttons/secondary-button'\n\nexport interface FeeItemFormData {\n  name: string\n  code: string\n  type: 'mandatory' | 'voluntary'\n  amount: string\n  semester: '1' | '2' | 'all'\n}\n\ninterface AddFeeItemModalProps {\n  isOpen: boolean\n  onClose: () => void\n  onSuccess?: () => void\n  existingCodes?: string[]\n}\n\nexport function AddFeeItemModal({\n  isOpen,\n  onClose,\n  onSuccess,\n  existingCodes = [],\n}: AddFeeItemModalProps) {\n  const [formData, setFormData] = useState<FeeItemFormData>({\n    name: '',\n    code: '',\n    type: 'mandatory',\n    amount: '',\n    semester: '1',\n  })\n  const [errors, setErrors] = useState<Partial<Record<keyof FeeItemFormData, string>>>({})\n  const [isSubmitting, setIsSubmitting] = useState(false)\n\n  // Auto-generate code based on name\n  useEffect(() => {\n    if (formData.name && !formData.code) {\n      const words = formData.name\n        .normalize('NFD')\n        .replace(/[\\u0300-\\u036f]/g, '')\n        .split(' ')\n        .filter((w: any) => w.length > 0)\n\n      if (words.length >= 2) {\n        const code = words\n          .slice(0, 2)\n          .map((w: any) => w.substring(0, 2).toUpperCase())\n          .join('')\n        const semester = formData.semester === 'all' ? '' : `-HK${formData.semester}`\n        setFormData(prev => ({ ...prev, code: `${code}${semester}` }))\n      }\n    }\n  }, [formData.name, formData.semester])\n\n  const validateForm = (): boolean => {\n    const newErrors: Partial<Record<keyof FeeItemFormData, string>> = {}\n\n    if (!formData.name.trim()) {\n      newErrors.name = 'Vui lòng nhập tên khoản thu'\n    }\n\n    if (!formData.code.trim()) {\n      newErrors.code = 'Mã khoản thu không được để trống'\n    } else if (existingCodes.includes(formData.code)) {\n      newErrors.code = 'Mã khoản thu đã tồn tại'\n    }\n\n    if (!formData.amount) {\n      newErrors.amount = 'Vui lòng nhập số tiền'\n    } else if (isNaN(Number(formData.amount)) || Number(formData.amount) <= 0) {\n      newErrors.amount = 'Số tiền phải lớn hơn 0'\n    }\n\n    setErrors(newErrors)\n    return Object.keys(newErrors).length === 0\n  }\n\n  const handleSubmit = async () => {\n    if (!validateForm()) return\n\n    setIsSubmitting(true)\n    try {\n      // TODO: API call to POST /api/fee-items\n      const response = await fetch('/api/fee-items', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          name: formData.name,\n          code: formData.code,\n          type: formData.type,\n          amount: Number(formData.amount),\n          semester: formData.semester,\n          status: 'active',\n        }),\n      })\n\n      if (response.ok) {\n        onSuccess?.()\n        handleClose()\n      } else {\n        const error = await response.json()\n        alert(error.message || 'Có lỗi xảy ra khi tạo khoản thu')\n      }\n    } catch (error) {\n      console.error('Failed to create fee item:', error)\n      // Mock success for demo\n      onSuccess?.()\n      handleClose()\n    } finally {\n      setIsSubmitting(false)\n    }\n  }\n\n  const handleClose = () => {\n    setFormData({\n      name: '',\n      code: '',\n      type: 'mandatory',\n      amount: '',\n      semester: '1',\n    })\n    setErrors({})\n    onClose()\n  }\n\n  return (\n    <BaseModal\n      isOpen={isOpen}\n      onClose={handleClose}\n      title=\"Thêm Khoản Thu Mới\"\n      size=\"lg\"\n      primaryAction={{\n        label: 'Tạo Khoản Thu',\n        onClick: handleSubmit,\n        disabled: isSubmitting,\n        loading: isSubmitting,\n      }}\n      secondaryAction={{\n        label: 'Hủy',\n        onClick: handleClose,\n      }}\n    >\n      <div className=\"space-y-4\">\n        {/* Name */}\n        <div>\n          <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">\n            Tên Khoản Thu <span className=\"text-red-500\">*</span>\n          </label>\n          <input\n            type=\"text\"\n            value={formData.name}\n            onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n            placeholder=\"Ví dụ: Học phí, Tiền ăn bán trú\"\n            className={`w-full px-4 py-3 bg-slate-50 border rounded-xl text-sm font-bold outline-none transition-colors ${\n              errors.name\n                ? 'border-red-300 focus:border-red-500'\n                : 'border-slate-200 focus:border-[#0284C7]'\n            }`}\n          />\n          {errors.name && <p className=\"text-xs text-red-500 mt-1\">{errors.name}</p>}\n        </div>\n\n        {/* Code */}\n        <div>\n          <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">\n            Mã Khoản Thu <span className=\"text-red-500\">*</span>\n          </label>\n          <input\n            type=\"text\"\n            value={formData.code}\n            onChange={(e) => setFormData({ ...formData, code: e.target.value.toUpperCase() })}\n            placeholder=\"Ví dụ: HP-HK1\"\n            className={`w-full px-4 py-3 bg-slate-50 border rounded-xl text-sm font-mono font-bold outline-none transition-colors ${\n              errors.code\n                ? 'border-red-300 focus:border-red-500'\n                : 'border-slate-200 focus:border-[#0284C7]'\n            }`}\n          />\n          {errors.code && <p className=\"text-xs text-red-500 mt-1\">{errors.code}</p>}\n          {!errors.code && (\n            <p className=\"text-xs text-slate-400 mt-1\">Mã sẽ tự động tạo từ tên khoản thu</p>\n          )}\n        </div>\n\n        {/* Type */}\n        <div>\n          <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">\n            Loại Khoản Thu <span className=\"text-red-500\">*</span>\n          </label>\n          <div className=\"grid grid-cols-2 gap-3\">\n            <label\n              className={`flex items-center gap-3 p-4 border-2 rounded-xl cursor-pointer transition-all ${\n                formData.type === 'mandatory'\n                  ? 'border-red-300 bg-red-50'\n                  : 'border-slate-200 bg-slate-50 hover:border-red-200'\n              }`}\n            >\n              <input\n                type=\"radio\"\n                name=\"type\"\n                value=\"mandatory\"\n                checked={formData.type === 'mandatory'}\n                onChange={(e) => setFormData({ ...formData, type: e.target.value as 'mandatory' | 'voluntary' })}\n                className=\"w-4 h-4 text-red-500\"\n              />\n              <div>\n                <p className=\"text-sm font-bold text-slate-800\">Bắt Buộc</p>\n                <p className=\"text-xs text-slate-500\">Học phí, bảo hiểm...</p>\n              </div>\n            </label>\n            <label\n              className={`flex items-center gap-3 p-4 border-2 rounded-xl cursor-pointer transition-all ${\n                formData.type === 'voluntary'\n                  ? 'border-blue-300 bg-blue-50'\n                  : 'border-slate-200 bg-slate-50 hover:border-blue-200'\n              }`}\n            >\n              <input\n                type=\"radio\"\n                name=\"type\"\n                value=\"voluntary\"\n                checked={formData.type === 'voluntary'}\n                onChange={(e) => setFormData({ ...formData, type: e.target.value as 'mandatory' | 'voluntary' })}\n                className=\"w-4 h-4 text-blue-500\"\n              />\n              <div>\n                <p className=\"text-sm font-bold text-slate-800\">Tự Nguyện</p>\n                <p className=\"text-xs text-slate-500\">Đồng phục, ăn bán trú...</p>\n              </div>\n            </label>\n          </div>\n        </div>\n\n        {/* Amount */}\n        <div>\n          <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">\n            Số Tiền (VNĐ) <span className=\"text-red-500\">*</span>\n          </label>\n          <div className=\"relative\">\n            <input\n              type=\"number\"\n              value={formData.amount}\n              onChange={(e) => setFormData({ ...formData, amount: e.target.value })}\n              placeholder=\"2500000\"\n              className={`w-full px-4 py-3 bg-slate-50 border rounded-xl text-sm font-bold outline-none transition-colors pr-16 ${\n                errors.amount\n                  ? 'border-red-300 focus:border-red-500'\n                  : 'border-slate-200 focus:border-[#0284C7]'\n              }`}\n            />\n            <span className=\"absolute right-4 top-1/2 -translate-y-1/2 text-sm font-bold text-slate-400\">\n              đ\n            </span>\n          </div>\n          {errors.amount && <p className=\"text-xs text-red-500 mt-1\">{errors.amount}</p>}\n        </div>\n\n        {/* Semester */}\n        <div>\n          <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">\n            Học Kỳ <span className=\"text-red-500\">*</span>\n          </label>\n          <select\n            value={formData.semester}\n            onChange={(e) => setFormData({ ...formData, semester: e.target.value as '1' | '2' | 'all' })}\n            className=\"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm font-bold outline-none focus:border-[#0284C7]\"\n          >\n            <option value=\"1\">Học Kỳ 1</option>\n            <option value=\"2\">Học Kỳ 2</option>\n            <option value=\"all\">Cả Năm</option>\n          </select>\n        </div>\n      </div>\n    </BaseModal>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\payments\\modals\\EditFeeItemModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PrimaryButton' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SecondaryButton' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { BaseModal } from '@/components/admin/shared/modals/BaseModal'\nimport { PrimaryButton } from '@/components/admin/shared/buttons/primary-button'\nimport { SecondaryButton } from '@/components/admin/shared/buttons/secondary-button'\nimport type { FeeItemFormData } from './AddFeeItemModal'\n\ninterface FeeItem {\n  id: string\n  name: string\n  code: string\n  type: 'mandatory' | 'voluntary'\n  amount: number\n  semester: '1' | '2' | 'all'\n  status: 'active' | 'inactive'\n}\n\ninterface EditFeeItemModalProps {\n  isOpen: boolean\n  onClose: () => void\n  onSuccess?: () => void\n  feeItem: FeeItem\n  existingCodes?: string[]\n}\n\nexport function EditFeeItemModal({\n  isOpen,\n  onClose,\n  onSuccess,\n  feeItem,\n  existingCodes = [],\n}: EditFeeItemModalProps) {\n  const [formData, setFormData] = useState<FeeItemFormData>({\n    name: feeItem.name,\n    code: feeItem.code,\n    type: feeItem.type,\n    amount: feeItem.amount.toString(),\n    semester: feeItem.semester,\n  })\n  const [errors, setErrors] = useState<Partial<Record<keyof FeeItemFormData, string>>>({})\n  const [isSubmitting, setIsSubmitting] = useState(false)\n\n  // Update form data when feeItem changes\n  useEffect(() => {\n    setFormData({\n      name: feeItem.name,\n      code: feeItem.code,\n      type: feeItem.type,\n      amount: feeItem.amount.toString(),\n      semester: feeItem.semester,\n    })\n  }, [feeItem])\n\n  const validateForm = (): boolean => {\n    const newErrors: Partial<Record<keyof FeeItemFormData, string>> = {}\n\n    if (!formData.name.trim()) {\n      newErrors.name = 'Vui lòng nhập tên khoản thu'\n    }\n\n    if (!formData.code.trim()) {\n      newErrors.code = 'Mã khoản thu không được để trống'\n    } else if (formData.code !== feeItem.code && existingCodes.includes(formData.code)) {\n      newErrors.code = 'Mã khoản thu đã tồn tại'\n    }\n\n    if (!formData.amount) {\n      newErrors.amount = 'Vui lòng nhập số tiền'\n    } else if (isNaN(Number(formData.amount)) || Number(formData.amount) <= 0) {\n      newErrors.amount = 'Số tiền phải lớn hơn 0'\n    }\n\n    setErrors(newErrors)\n    return Object.keys(newErrors).length === 0\n  }\n\n  const handleSubmit = async () => {\n    if (!validateForm()) return\n\n    setIsSubmitting(true)\n    try {\n      // TODO: API call to PUT /api/fee-items/:id\n      const response = await fetch(`/api/fee-items/${feeItem.id}`, {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          name: formData.name,\n          code: formData.code,\n          type: formData.type,\n          amount: Number(formData.amount),\n          semester: formData.semester,\n          status: feeItem.status,\n        }),\n      })\n\n      if (response.ok) {\n        onSuccess?.()\n        handleClose()\n      } else {\n        const error = await response.json()\n        alert(error.message || 'Có lỗi xảy ra khi cập nhật khoản thu')\n      }\n    } catch (error) {\n      console.error('Failed to update fee item:', error)\n      // Mock success for demo\n      onSuccess?.()\n      handleClose()\n    } finally {\n      setIsSubmitting(false)\n    }\n  }\n\n  const handleClose = () => {\n    setErrors({})\n    onClose()\n  }\n\n  return (\n    <BaseModal\n      isOpen={isOpen}\n      onClose={handleClose}\n      title=\"Cập Nhật Khoản Thu\"\n      size=\"lg\"\n      primaryAction={{\n        label: 'Lưu Thay Đổi',\n        onClick: handleSubmit,\n        disabled: isSubmitting,\n        loading: isSubmitting,\n      }}\n      secondaryAction={{\n        label: 'Hủy',\n        onClick: handleClose,\n      }}\n    >\n      <div className=\"space-y-4\">\n        {/* Fee Item ID Display */}\n        <div className=\"p-3 bg-slate-50 rounded-xl border border-slate-200\">\n          <p className=\"text-xs font-bold text-slate-500 uppercase tracking-wider\">Mã Khoản Thu (Hệ Thống)</p>\n          <p className=\"text-sm font-mono font-bold text-slate-800\">{feeItem.id}</p>\n        </div>\n\n        {/* Name */}\n        <div>\n          <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">\n            Tên Khoản Thu <span className=\"text-red-500\">*</span>\n          </label>\n          <input\n            type=\"text\"\n            value={formData.name}\n            onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n            placeholder=\"Ví dụ: Học phí, Tiền ăn bán trú\"\n            className={`w-full px-4 py-3 bg-slate-50 border rounded-xl text-sm font-bold outline-none transition-colors ${\n              errors.name\n                ? 'border-red-300 focus:border-red-500'\n                : 'border-slate-200 focus:border-[#0284C7]'\n            }`}\n          />\n          {errors.name && <p className=\"text-xs text-red-500 mt-1\">{errors.name}</p>}\n        </div>\n\n        {/* Code */}\n        <div>\n          <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">\n            Mã Khoản Thu <span className=\"text-red-500\">*</span>\n          </label>\n          <input\n            type=\"text\"\n            value={formData.code}\n            onChange={(e) => setFormData({ ...formData, code: e.target.value.toUpperCase() })}\n            placeholder=\"Ví dụ: HP-HK1\"\n            className={`w-full px-4 py-3 bg-slate-50 border rounded-xl text-sm font-mono font-bold outline-none transition-colors ${\n              errors.code\n                ? 'border-red-300 focus:border-red-500'\n                : 'border-slate-200 focus:border-[#0284C7]'\n            }`}\n          />\n          {errors.code && <p className=\"text-xs text-red-500 mt-1\">{errors.code}</p>}\n        </div>\n\n        {/* Type */}\n        <div>\n          <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">\n            Loại Khoản Thu <span className=\"text-red-500\">*</span>\n          </label>\n          <div className=\"grid grid-cols-2 gap-3\">\n            <label\n              className={`flex items-center gap-3 p-4 border-2 rounded-xl cursor-pointer transition-all ${\n                formData.type === 'mandatory'\n                  ? 'border-red-300 bg-red-50'\n                  : 'border-slate-200 bg-slate-50 hover:border-red-200'\n              }`}\n            >\n              <input\n                type=\"radio\"\n                name=\"type\"\n                value=\"mandatory\"\n                checked={formData.type === 'mandatory'}\n                onChange={(e) => setFormData({ ...formData, type: e.target.value as 'mandatory' | 'voluntary' })}\n                className=\"w-4 h-4 text-red-500\"\n              />\n              <div>\n                <p className=\"text-sm font-bold text-slate-800\">Bắt Buộc</p>\n                <p className=\"text-xs text-slate-500\">Học phí, bảo hiểm...</p>\n              </div>\n            </label>\n            <label\n              className={`flex items-center gap-3 p-4 border-2 rounded-xl cursor-pointer transition-all ${\n                formData.type === 'voluntary'\n                  ? 'border-blue-300 bg-blue-50'\n                  : 'border-slate-200 bg-slate-50 hover:border-blue-200'\n              }`}\n            >\n              <input\n                type=\"radio\"\n                name=\"type\"\n                value=\"voluntary\"\n                checked={formData.type === 'voluntary'}\n                onChange={(e) => setFormData({ ...formData, type: e.target.value as 'mandatory' | 'voluntary' })}\n                className=\"w-4 h-4 text-blue-500\"\n              />\n              <div>\n                <p className=\"text-sm font-bold text-slate-800\">Tự Nguyện</p>\n                <p className=\"text-xs text-slate-500\">Đồng phục, ăn bán trú...</p>\n              </div>\n            </label>\n          </div>\n        </div>\n\n        {/* Amount */}\n        <div>\n          <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">\n            Số Tiền (VNĐ) <span className=\"text-red-500\">*</span>\n          </label>\n          <div className=\"relative\">\n            <input\n              type=\"number\"\n              value={formData.amount}\n              onChange={(e) => setFormData({ ...formData, amount: e.target.value })}\n              placeholder=\"2500000\"\n              className={`w-full px-4 py-3 bg-slate-50 border rounded-xl text-sm font-bold outline-none transition-colors pr-16 ${\n                errors.amount\n                  ? 'border-red-300 focus:border-red-500'\n                  : 'border-slate-200 focus:border-[#0284C7]'\n              }`}\n            />\n            <span className=\"absolute right-4 top-1/2 -translate-y-1/2 text-sm font-bold text-slate-400\">\n              đ\n            </span>\n          </div>\n          {errors.amount && <p className=\"text-xs text-red-500 mt-1\">{errors.amount}</p>}\n        </div>\n\n        {/* Semester */}\n        <div>\n          <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">\n            Học Kỳ <span className=\"text-red-500\">*</span>\n          </label>\n          <select\n            value={formData.semester}\n            onChange={(e) => setFormData({ ...formData, semester: e.target.value as '1' | '2' | 'all' })}\n            className=\"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm font-bold outline-none focus:border-[#0284C7]\"\n          >\n            <option value=\"1\">Học Kỳ 1</option>\n            <option value=\"2\">Học Kỳ 2</option>\n            <option value=\"all\">Cả Năm</option>\n          </select>\n        </div>\n      </div>\n    </BaseModal>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\payments\\modals\\ExportReportModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PrimaryButton' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SecondaryButton' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState } from 'react'\nimport { Download, FileText, Table, FileSpreadsheet, Calendar } from 'lucide-react'\nimport { BaseModal } from '@/components/admin/shared/modals/BaseModal'\nimport { PrimaryButton } from '@/components/admin/shared/buttons/primary-button'\nimport { SecondaryButton } from '@/components/admin/shared/buttons/secondary-button'\n\ntype ExportFormat = 'pdf' | 'excel' | 'csv'\n\ninterface ExportReportModalProps {\n  isOpen: boolean\n  onClose: () => void\n  onSuccess?: () => void\n}\n\nexport function ExportReportModal({ isOpen, onClose, onSuccess }: ExportReportModalProps) {\n  const [format, setFormat] = useState<ExportFormat>('pdf')\n  const [startDate, setStartDate] = useState('')\n  const [endDate, setEndDate] = useState('')\n  const [includePaid, setIncludePaid] = useState(true)\n  const [includePending, setIncludePending] = useState(true)\n  const [includeOverdue, setIncludeOverdue] = useState(true)\n  const [isExporting, setIsExporting] = useState(false)\n  const [error, setError] = useState('')\n\n  // Set default date range (current month)\n  useState(() => {\n    const now = new Date()\n    const firstDay = new Date(now.getFullYear(), now.getMonth(), 1)\n    const lastDay = new Date(now.getFullYear(), now.getMonth() + 1, 0)\n    setStartDate(firstDay.toISOString().split('T')[0])\n    setEndDate(lastDay.toISOString().split('T')[0])\n  })\n\n  const formatOptions = [\n    {\n      id: 'pdf' as ExportFormat,\n      name: 'PDF',\n      description: 'Tài liệu in ấn chất lượng cao',\n      icon: FileText,\n      color: 'text-red-500',\n      bgColor: 'bg-red-50',\n      borderColor: 'border-red-200',\n    },\n    {\n      id: 'excel' as ExportFormat,\n      name: 'Excel',\n      description: 'Bảng tính có thể chỉnh sửa',\n      icon: FileSpreadsheet,\n      color: 'text-green-500',\n      bgColor: 'bg-green-50',\n      borderColor: 'border-green-200',\n    },\n    {\n      id: 'csv' as ExportFormat,\n      name: 'CSV',\n      description: 'Dữ liệu thô dạng văn bản',\n      icon: Table,\n      color: 'text-blue-500',\n      bgColor: 'bg-blue-50',\n      borderColor: 'border-blue-200',\n    },\n  ]\n\n  const validateForm = (): boolean => {\n    if (!startDate || !endDate) {\n      setError('Vui lòng chọn khoảng thời gian')\n      return false\n    }\n\n    const start = new Date(startDate)\n    const end = new Date(endDate)\n\n    if (start > end) {\n      setError('Ngày bắt đầu không được sau ngày kết thúc')\n      return false\n    }\n\n    // Check date range is not more than 1 year\n    const maxDate = new Date(start)\n    maxDate.setFullYear(maxDate.getFullYear() + 1)\n    if (end > maxDate) {\n      setError('Khoảng thời gian không được quá 1 năm')\n      return false\n    }\n\n    if (!includePaid && !includePending && !includeOverdue) {\n      setError('Vui lòng chọn ít nhất một trạng thái hóa đơn')\n      return false\n    }\n\n    setError('')\n    return true\n  }\n\n  const handleExport = async () => {\n    if (!validateForm()) return\n\n    setIsExporting(true)\n    setError('')\n\n    try {\n      // TODO: API call to POST /api/invoices/export\n      const response = await fetch('/api/invoices/export', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          format,\n          startDate,\n          endDate,\n          includePaid,\n          includePending,\n          includeOverdue,\n        }),\n      })\n\n      if (response.ok) {\n        // Download file\n        const blob = await response.blob()\n        const url = window.URL.createObjectURL(blob)\n        const a = document.createElement('a')\n        a.href = url\n        a.download = `bao-cao-hoa-don_${startDate}_${endDate}.${format === 'csv' ? 'csv' : format === 'excel' ? 'xlsx' : 'pdf'}`\n        document.body.appendChild(a)\n        a.click()\n        window.URL.revokeObjectURL(url)\n        document.body.removeChild(a)\n\n        onSuccess?.()\n        handleClose()\n      } else {\n        const errorData = await response.json()\n        setError(errorData.message || 'Có lỗi xảy ra khi xuất báo cáo')\n      }\n    } catch (error) {\n      console.error('Failed to export report:', error)\n      // Mock success for demo\n      alert(`Đã xuất báo cáo thành công (định dạng: ${format.toUpperCase()})`)\n      onSuccess?.()\n      handleClose()\n    } finally {\n      setIsExporting(false)\n    }\n  }\n\n  const handleClose = () => {\n    setFormat('pdf')\n    setError('')\n    onClose()\n  }\n\n  const formatDate = (dateString: string) => {\n    if (!dateString) return ''\n    return new Date(dateString).toLocaleDateString('vi-VN')\n  }\n\n  return (\n    <BaseModal\n      isOpen={isOpen}\n      onClose={handleClose}\n      title=\"Xuất Báo Cáo Hóa Đơn\"\n      size=\"lg\"\n      primaryAction={{\n        label: 'Xuất Báo Cáo',\n        onClick: handleExport,\n        disabled: isExporting,\n        loading: isExporting,\n      }}\n      secondaryAction={{\n        label: 'Hủy',\n        onClick: handleClose,\n      }}\n    >\n      <div className=\"space-y-4\">\n        {/* Format Selection */}\n        <div>\n          <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">\n            Định Dạng Tập Tin <span className=\"text-red-500\">*</span>\n          </label>\n          <div className=\"grid grid-cols-3 gap-3\">\n            {formatOptions.map((option) => {\n              const Icon = option.icon\n              return (\n                <label\n                  key={option.id}\n                  className={`flex flex-col items-center gap-2 p-4 border-2 rounded-xl cursor-pointer transition-all ${\n                    format === option.id\n                      ? `${option.borderColor} ${option.bgColor}`\n                      : 'border-slate-200 bg-slate-50 hover:border-slate-300'\n                  }`}\n                >\n                  <input\n                    type=\"radio\"\n                    name=\"format\"\n                    value={option.id}\n                    checked={format === option.id}\n                    onChange={(e) => setFormat(e.target.value as ExportFormat)}\n                    className=\"sr-only\"\n                  />\n                  <Icon className={`w-6 h-6 ${option.color}`} />\n                  <div className=\"text-center\">\n                    <p className=\"text-sm font-bold text-slate-800\">{option.name}</p>\n                    <p className=\"text-[10px] text-slate-500\">{option.description}</p>\n                  </div>\n                </label>\n              )\n            })}\n          </div>\n        </div>\n\n        {/* Date Range */}\n        <div>\n          <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">\n            Khoảng Thời Gian <span className=\"text-red-500\">*</span>\n          </label>\n          <div className=\"grid grid-cols-2 gap-3\">\n            <div className=\"relative\">\n              <label className=\"text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-1 block\">\n                Từ ngày\n              </label>\n              <input\n                type=\"date\"\n                value={startDate}\n                onChange={(e) => setStartDate(e.target.value)}\n                max={endDate || undefined}\n                className=\"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm font-bold outline-none focus:border-[#0284C7]\"\n              />\n              <Calendar className=\"absolute right-4 top-8 w-4 h-4 text-slate-400 pointer-events-none\" />\n            </div>\n            <div className=\"relative\">\n              <label className=\"text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-1 block\">\n                Đến ngày\n              </label>\n              <input\n                type=\"date\"\n                value={endDate}\n                onChange={(e) => setEndDate(e.target.value)}\n                min={startDate || undefined}\n                className=\"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm font-bold outline-none focus:border-[#0284C7]\"\n              />\n              <Calendar className=\"absolute right-4 top-8 w-4 h-4 text-slate-400 pointer-events-none\" />\n            </div>\n          </div>\n          {startDate && endDate && (\n            <p className=\"text-xs text-slate-500 mt-2\">\n              Khoảng thời gian: {formatDate(startDate)} - {formatDate(endDate)}\n            </p>\n          )}\n        </div>\n\n        {/* Invoice Status Filter */}\n        <div>\n          <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">\n            Trạng Thái Hóa Đơn <span className=\"text-red-500\">*</span>\n          </label>\n          <div className=\"space-y-2\">\n            <label className=\"flex items-center gap-3 p-3 bg-slate-50 rounded-xl cursor-pointer hover:bg-green-50 transition-colors\">\n              <input\n                type=\"checkbox\"\n                checked={includePaid}\n                onChange={(e) => setIncludePaid(e.target.checked)}\n                className=\"w-4 h-4 text-green-500 rounded\"\n              />\n              <div className=\"flex-1\">\n                <p className=\"text-sm font-bold text-slate-800\">Đã thanh toán</p>\n                <p className=\"text-xs text-slate-500\">Bao gồm các hóa đơn đã hoàn tất thanh toán</p>\n              </div>\n              <span className=\"px-2 py-1 bg-green-100 text-green-700 text-xs font-bold rounded-lg\">PAID</span>\n            </label>\n\n            <label className=\"flex items-center gap-3 p-3 bg-slate-50 rounded-xl cursor-pointer hover:bg-amber-50 transition-colors\">\n              <input\n                type=\"checkbox\"\n                checked={includePending}\n                onChange={(e) => setIncludePending(e.target.checked)}\n                className=\"w-4 h-4 text-amber-500 rounded\"\n              />\n              <div className=\"flex-1\">\n                <p className=\"text-sm font-bold text-slate-800\">Chờ thanh toán</p>\n                <p className=\"text-xs text-slate-500\">Bao gồm các hóa đơn chưa thanh toán</p>\n              </div>\n              <span className=\"px-2 py-1 bg-amber-100 text-amber-700 text-xs font-bold rounded-lg\">PENDING</span>\n            </label>\n\n            <label className=\"flex items-center gap-3 p-3 bg-slate-50 rounded-xl cursor-pointer hover:bg-red-50 transition-colors\">\n              <input\n                type=\"checkbox\"\n                checked={includeOverdue}\n                onChange={(e) => setIncludeOverdue(e.target.checked)}\n                className=\"w-4 h-4 text-red-500 rounded\"\n              />\n              <div className=\"flex-1\">\n                <p className=\"text-sm font-bold text-slate-800\">Quá hạn</p>\n                <p className=\"text-xs text-slate-500\">Bao gồm các hóa đơn quá hạn thanh toán</p>\n              </div>\n              <span className=\"px-2 py-1 bg-red-100 text-red-700 text-xs font-bold rounded-lg\">OVERDUE</span>\n            </label>\n          </div>\n        </div>\n\n        {/* Summary */}\n        <div className=\"p-4 bg-gradient-to-br from-slate-50 to-slate-100 rounded-xl border border-slate-200\">\n          <div className=\"flex items-center gap-2 mb-3\">\n            <Download className=\"w-4 h-4 text-[#0284C7]\" />\n            <p className=\"text-sm font-bold text-slate-700\">Tóm Tắt Xuất Dữ Liệu</p>\n          </div>\n          <div className=\"space-y-2 text-xs\">\n            <div className=\"flex justify-between\">\n              <span className=\"text-slate-500\">Định dạng:</span>\n              <span className=\"font-bold text-slate-800 uppercase\">{format}</span>\n            </div>\n            <div className=\"flex justify-between\">\n              <span className=\"text-slate-500\">Khoảng thời gian:</span>\n              <span className=\"font-bold text-slate-800\">{formatDate(startDate)} - {formatDate(endDate)}</span>\n            </div>\n            <div className=\"flex justify-between\">\n              <span className=\"text-slate-500\">Trạng thái:</span>\n              <span className=\"font-bold text-slate-800\">\n                {[\n                  includePaid && 'Đã thanh toán',\n                  includePending && 'Chờ thanh toán',\n                  includeOverdue && 'Quá hạn',\n                ].filter(Boolean).join(', ') || 'Không có'}\n              </span>\n            </div>\n          </div>\n        </div>\n\n        {/* Error Message */}\n        {error && (\n          <div className=\"p-3 bg-red-50 border border-red-200 rounded-lg flex items-start gap-2\">\n            <Download className=\"w-4 h-4 text-red-500 flex-shrink-0 mt-0.5\" />\n            <p className=\"text-xs text-red-700\">{error}</p>\n          </div>\n        )}\n      </div>\n    </BaseModal>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\payments\\modals\\InvoiceDetailModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SecondaryButton' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'InvoiceSummary' is defined but never used.","line":7,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":29},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchInvoiceDetails'. Either include it or remove the dependency array.","line":57,"column":6,"nodeType":"ArrayExpression","endLine":57,"endColumn":25,"suggestions":[{"desc":"Update the dependencies array to be: [isOpen, invoiceId, fetchInvoiceDetails]","fix":{"range":[1416,1435],"text":"[isOpen, invoiceId, fetchInvoiceDetails]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { User, Calendar, DollarSign, Clock, FileText, CheckCircle2 } from 'lucide-react'\nimport { BaseModal } from '@/components/admin/shared/modals/BaseModal'\nimport { SecondaryButton } from '@/components/admin/shared/buttons/secondary-button'\nimport type { InvoiceSummary } from './PaymentConfirmModal'\n\ninterface PaymentRecord {\n  id: string\n  date: string\n  amount: number\n  method: 'cash' | 'bank_transfer' | 'card'\n  status: 'completed' | 'pending' | 'failed'\n  confirmedBy: string\n  notes?: string\n}\n\ninterface InvoiceDetail {\n  id: string\n  student: {\n    id: string\n    name: string\n    class: string\n    parentPhone: string\n  }\n  totalAmount: number\n  paidAmount: number\n  remainingAmount: number\n  status: 'paid' | 'pending' | 'overdue'\n  issueDate: string\n  dueDate: string\n  paidDate?: string\n  feeItems: Array<{\n    name: string\n    code: string\n    type: 'mandatory' | 'voluntary'\n    amount: number\n  }>\n  paymentHistory: PaymentRecord[]\n}\n\ninterface InvoiceDetailModalProps {\n  isOpen: boolean\n  onClose: () => void\n  invoiceId: string\n}\n\nexport function InvoiceDetailModal({ isOpen, onClose, invoiceId }: InvoiceDetailModalProps) {\n  const [invoice, setInvoice] = useState<InvoiceDetail | null>(null)\n  const [loading, setLoading] = useState(false)\n\n  useEffect(() => {\n    if (isOpen && invoiceId) {\n      fetchInvoiceDetails()\n    }\n  }, [isOpen, invoiceId])\n\n  const fetchInvoiceDetails = async () => {\n    setLoading(true)\n    try {\n      // TODO: API call to GET /api/invoices/:id\n      const response = await fetch(`/api/invoices/${invoiceId}`)\n      if (response.ok) {\n        const data = await response.json()\n        setInvoice(data.data)\n      } else {\n        // Mock data for demo\n        setInvoice(getMockInvoiceDetail())\n      }\n    } catch (error) {\n      console.error('Failed to fetch invoice details:', error)\n      // Mock data for demo\n      setInvoice(getMockInvoiceDetail())\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat('vi-VN').format(amount)\n  }\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('vi-VN')\n  }\n\n  const getStatusBadge = (status: string) => {\n    const config = {\n      paid: { label: 'Đã thanh toán', color: 'bg-green-100 text-green-700', icon: CheckCircle2 },\n      pending: { label: 'Chờ thanh toán', color: 'bg-amber-100 text-amber-700', icon: Clock },\n      overdue: { label: 'Quá hạn', color: 'bg-red-100 text-red-700', icon: Clock },\n    }\n    const { label, color, icon: Icon } = config[status as keyof typeof config] || config.pending\n    return (\n      <span className={`inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-black uppercase rounded-lg ${color}`}>\n        <Icon className=\"w-3.5 h-3.5\" />\n        {label}\n      </span>\n    )\n  }\n\n  return (\n    <BaseModal\n      isOpen={isOpen}\n      onClose={onClose}\n      title=\"Chi Tiết Hóa Đơn\"\n      size=\"xl\"\n      secondaryAction={{\n        label: 'Đóng',\n        onClick: onClose,\n      }}\n    >\n      {loading ? (\n        <div className=\"flex items-center justify-center py-12\">\n          <div className=\"text-center\">\n            <div className=\"w-12 h-12 border-4 border-[#0284C7] border-t-transparent rounded-full animate-spin mx-auto mb-4\"></div>\n            <p className=\"text-sm font-bold text-slate-500\">Đang tải thông tin...</p>\n          </div>\n        </div>\n      ) : invoice ? (\n        <div className=\"space-y-6\">\n          {/* Invoice Header */}\n          <div className=\"p-5 bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl text-white\">\n            <div className=\"flex items-start justify-between mb-4\">\n              <div>\n                <p className=\"text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1\">Mã Hóa Đơn</p>\n                <p className=\"text-xl font-black font-mono tracking-tight\">{invoice.id}</p>\n              </div>\n              {getStatusBadge(invoice.status)}\n            </div>\n\n            <div className=\"grid grid-cols-3 gap-4\">\n              <div>\n                <p className=\"text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1\">Tổng tiền</p>\n                <p className=\"text-lg font-black\">{formatCurrency(invoice.totalAmount)} ₫</p>\n              </div>\n              <div>\n                <p className=\"text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1\">Đã thanh toán</p>\n                <p className=\"text-lg font-black text-green-400\">{formatCurrency(invoice.paidAmount)} ₫</p>\n              </div>\n              <div>\n                <p className=\"text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1\">Còn lại</p>\n                <p className=\"text-lg font-black text-red-400\">{formatCurrency(invoice.remainingAmount)} ₫</p>\n              </div>\n            </div>\n          </div>\n\n          {/* Student Information */}\n          <div className=\"p-5 bg-slate-50 rounded-2xl border border-slate-200\">\n            <div className=\"flex items-center gap-2 mb-4\">\n              <User className=\"w-4 h-4 text-[#0284C7]\" />\n              <p className=\"text-sm font-bold text-slate-700\">Thông Tin Học Sinh</p>\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <p className=\"text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-1\">Họ và tên</p>\n                <p className=\"text-sm font-bold text-slate-800\">{invoice.student.name}</p>\n              </div>\n              <div>\n                <p className=\"text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-1\">Lớp</p>\n                <p className=\"text-sm font-bold text-slate-800\">{invoice.student.class}</p>\n              </div>\n              <div>\n                <p className=\"text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-1\">Mã học sinh</p>\n                <p className=\"text-sm font-mono text-slate-600\">{invoice.student.id}</p>\n              </div>\n              <div>\n                <p className=\"text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-1\">SĐT Phụ huynh</p>\n                <p className=\"text-sm font-mono text-slate-600\">{invoice.student.parentPhone}</p>\n              </div>\n            </div>\n          </div>\n\n          {/* Fee Items */}\n          <div>\n            <div className=\"flex items-center gap-2 mb-3\">\n              <FileText className=\"w-4 h-4 text-[#0284C7]\" />\n              <p className=\"text-sm font-bold text-slate-700\">Chi Tiết Khoản Thu</p>\n            </div>\n            <div className=\"bg-white border border-slate-200 rounded-xl overflow-hidden\">\n              <div className=\"grid grid-cols-4 gap-2 px-4 py-2 bg-slate-50 border-b border-slate-200\">\n                <p className=\"text-[10px] font-bold text-slate-500 uppercase tracking-wider col-span-2\">Khoản thu</p>\n                <p className=\"text-[10px] font-bold text-slate-500 uppercase tracking-wider\">Loại</p>\n                <p className=\"text-[10px] font-bold text-slate-500 uppercase tracking-wider text-right\">Số tiền</p>\n              </div>\n              {invoice.feeItems.map((item, index) => (\n                <div key={index} className=\"grid grid-cols-4 gap-2 px-4 py-3 border-b border-slate-100 last:border-b-0\">\n                  <div className=\"col-span-2\">\n                    <p className=\"text-sm font-bold text-slate-800\">{item.name}</p>\n                    <p className=\"text-[10px] text-slate-400 font-mono\">{item.code}</p>\n                  </div>\n                  <span className={`inline-flex self-center px-2 py-0.5 text-[9px] font-black uppercase rounded ${\n                    item.type === 'mandatory' ? 'bg-red-100 text-red-600' : 'bg-blue-100 text-blue-600'\n                  }`}>\n                    {item.type === 'mandatory' ? 'Bắt buộc' : 'Tự nguyện'}\n                  </span>\n                  <p className=\"text-sm font-bold text-slate-800 text-right\">{formatCurrency(item.amount)} ₫</p>\n                </div>\n              ))}\n            </div>\n          </div>\n\n          {/* Date Information */}\n          <div className=\"grid grid-cols-3 gap-4\">\n            <div className=\"p-4 bg-blue-50 rounded-xl border border-blue-100\">\n              <div className=\"flex items-center gap-2 mb-2\">\n                <Calendar className=\"w-4 h-4 text-blue-600\" />\n                <p className=\"text-[10px] font-bold text-blue-700 uppercase tracking-wider\">Ngày phát hành</p>\n              </div>\n              <p className=\"text-base font-black text-blue-800\">{formatDate(invoice.issueDate)}</p>\n            </div>\n            <div className=\"p-4 bg-amber-50 rounded-xl border border-amber-100\">\n              <div className=\"flex items-center gap-2 mb-2\">\n                <Clock className=\"w-4 h-4 text-amber-600\" />\n                <p className=\"text-[10px] font-bold text-amber-700 uppercase tracking-wider\">Hạn thanh toán</p>\n              </div>\n              <p className=\"text-base font-black text-amber-800\">{formatDate(invoice.dueDate)}</p>\n            </div>\n            {invoice.paidDate && (\n              <div className=\"p-4 bg-green-50 rounded-xl border border-green-100\">\n                <div className=\"flex items-center gap-2 mb-2\">\n                  <CheckCircle2 className=\"w-4 h-4 text-green-600\" />\n                  <p className=\"text-[10px] font-bold text-green-700 uppercase tracking-wider\">Ngày thanh toán</p>\n                </div>\n                <p className=\"text-base font-black text-green-800\">{formatDate(invoice.paidDate)}</p>\n              </div>\n            )}\n          </div>\n\n          {/* Payment History Timeline */}\n          <div>\n            <div className=\"flex items-center gap-2 mb-3\">\n              <DollarSign className=\"w-4 h-4 text-[#0284C7]\" />\n              <p className=\"text-sm font-bold text-slate-700\">Lịch Sử Thanh Toán</p>\n            </div>\n            <div className=\"space-y-3\">\n              {invoice.paymentHistory.length === 0 ? (\n                <div className=\"p-6 bg-slate-50 rounded-xl border-2 border-dashed border-slate-200 text-center\">\n                  <p className=\"text-sm font-bold text-slate-400\">Chưa có giao dịch thanh toán nào</p>\n                </div>\n              ) : (\n                invoice.paymentHistory.map((payment, index) => (\n                  <div key={payment.id} className=\"relative pl-8\">\n                    {/* Timeline Line */}\n                    {index < invoice.paymentHistory.length - 1 && (\n                      <div className=\"absolute left-[13px] top-8 bottom-[-12px] w-0.5 bg-slate-200\" />\n                    )}\n\n                    {/* Timeline Dot */}\n                    <div className={`absolute left-0 top-1.5 w-7 h-7 rounded-full border-2 ${\n                      payment.status === 'completed'\n                        ? 'bg-green-100 border-green-500'\n                        : payment.status === 'pending'\n                        ? 'bg-amber-100 border-amber-500'\n                        : 'bg-red-100 border-red-500'\n                    } flex items-center justify-center`}>\n                      {payment.status === 'completed' && <CheckCircle2 className=\"w-3.5 h-3.5 text-green-600\" />}\n                      {payment.status === 'pending' && <Clock className=\"w-3.5 h-3.5 text-amber-600\" />}\n                    </div>\n\n                    {/* Payment Card */}\n                    <div className=\"p-4 bg-white border border-slate-200 rounded-xl\">\n                      <div className=\"flex items-start justify-between mb-2\">\n                        <div>\n                          <p className=\"text-sm font-bold text-slate-800\">\n                            {formatCurrency(payment.amount)} ₫\n                          </p>\n                          <p className=\"text-xs text-slate-500\">{formatDate(payment.date)}</p>\n                        </div>\n                        <span className={`px-2 py-0.5 text-[9px] font-black uppercase rounded ${\n                          payment.status === 'completed'\n                            ? 'bg-green-100 text-green-600'\n                            : payment.status === 'pending'\n                            ? 'bg-amber-100 text-amber-600'\n                            : 'bg-red-100 text-red-600'\n                        }`}>\n                          {payment.status === 'completed' ? 'Hoàn thành' : payment.status === 'pending' ? 'Đang xử lý' : 'Thất bại'}\n                        </span>\n                      </div>\n                      <div className=\"flex items-center gap-4 text-xs text-slate-500\">\n                        <span>Phương thức: <span className=\"font-bold text-slate-700\">{\n                          payment.method === 'cash' ? 'Tiền mặt' :\n                          payment.method === 'bank_transfer' ? 'Chuyển khoản' : 'Thẻ'\n                        }</span></span>\n                        <span>Xác nhận bởi: <span className=\"font-bold text-slate-700\">{payment.confirmedBy}</span></span>\n                      </div>\n                      {payment.notes && (\n                        <p className=\"text-xs text-slate-600 mt-2 italic\">&ldquo;{payment.notes}&rdquo;</p>\n                      )}\n                    </div>\n                  </div>\n                ))\n              )}\n            </div>\n          </div>\n        </div>\n      ) : (\n        <div className=\"text-center py-12\">\n          <p className=\"text-sm font-bold text-slate-400\">Không tìm thấy thông tin hóa đơn</p>\n        </div>\n      )}\n    </BaseModal>\n  )\n}\n\n// Mock data helper\nfunction getMockInvoiceDetail(): InvoiceDetail {\n  return {\n    id: 'INV-2025-001234',\n    student: {\n      id: 'HS2025001',\n      name: 'Nguyễn Văn An',\n      class: '6A',\n      parentPhone: '0912345678',\n    },\n    totalAmount: 5404000,\n    paidAmount: 2500000,\n    remainingAmount: 2904000,\n    status: 'pending',\n    issueDate: '2025-09-01',\n    dueDate: '2025-10-15',\n    feeItems: [\n      { name: 'Học phí', code: 'HP-HK1', type: 'mandatory', amount: 2500000 },\n      { name: 'Bảo hiểm y tế', code: 'BHYT-25', type: 'mandatory', amount: 854000 },\n      { name: 'Tiền đồng phục', code: 'DP-HK1', type: 'voluntary', amount: 850000 },\n      { name: 'Tiền ăn bán trú', code: 'BT-HK1', type: 'voluntary', amount: 1200000 },\n    ],\n    paymentHistory: [\n      {\n        id: 'PAY-001',\n        date: '2025-09-10',\n        amount: 2500000,\n        method: 'cash',\n        status: 'completed',\n        confirmedBy: 'admin@school.edu',\n        notes: 'Thanh toán học phí HK1',\n      },\n    ],\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\payments\\modals\\PaymentConfirmModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PrimaryButton' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SecondaryButton' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState } from 'react'\nimport { CheckCircle, AlertCircle } from 'lucide-react'\nimport { BaseModal } from '@/components/admin/shared/modals/BaseModal'\nimport { PrimaryButton } from '@/components/admin/shared/buttons/primary-button'\nimport { SecondaryButton } from '@/components/admin/shared/buttons/secondary-button'\n\nexport interface InvoiceSummary {\n  id: string\n  studentName: string\n  studentId: string\n  totalAmount: number\n  paidAmount: number\n  remainingAmount: number\n  status: 'paid' | 'pending' | 'overdue'\n  dueDate: string\n  feeItems: Array<{\n    name: string\n    code: string\n    amount: number\n  }>\n}\n\ninterface PaymentConfirmModalProps {\n  isOpen: boolean\n  onClose: () => void\n  onSuccess?: () => void\n  invoice: InvoiceSummary\n  currentUser?: { role: string; id?: string }\n}\n\nexport function PaymentConfirmModal({\n  isOpen,\n  onClose,\n  onSuccess,\n  invoice,\n  currentUser,\n}: PaymentConfirmModalProps) {\n  const [paymentAmount, setPaymentAmount] = useState(invoice.remainingAmount.toString())\n  const [notes, setNotes] = useState('')\n  const [isSubmitting, setIsSubmitting] = useState(false)\n  const [error, setError] = useState('')\n\n  // Permission check\n  const canConfirmPayment = currentUser?.role === 'admin'\n\n  const remainingBalance = invoice.remainingAmount - Number(paymentAmount || 0)\n  const isPartialPayment = Number(paymentAmount) < invoice.remainingAmount\n  const isOverPayment = Number(paymentAmount || 0) > invoice.remainingAmount\n\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat('vi-VN').format(amount)\n  }\n\n  const handleConfirm = async () => {\n    // Permission check\n    if (!canConfirmPayment) {\n      setError('Bạn không có quyền xác nhận thanh toán')\n      return\n    }\n\n    if (!paymentAmount || Number(paymentAmount) <= 0) {\n      setError('Vui lòng nhập số tiền thanh toán')\n      return\n    }\n\n    if (isOverPayment) {\n      setError('Số tiền thanh toán không được lớn hơn số tiền còn lại')\n      return\n    }\n\n    setIsSubmitting(true)\n    setError('')\n\n    try {\n      // TODO: API call to POST /api/payments/:id/confirm\n      const response = await fetch(`/api/payments/${invoice.id}/confirm`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          amount: Number(paymentAmount),\n          notes: notes.trim(),\n          confirmedBy: currentUser?.id || 'admin-id',\n          confirmedAt: new Date().toISOString(),\n        }),\n      })\n\n      if (response.ok) {\n        onSuccess?.()\n        handleClose()\n      } else {\n        const errorData = await response.json()\n        setError(errorData.message || 'Có lỗi xảy ra khi xác nhận thanh toán')\n      }\n    } catch (error) {\n      console.error('Failed to confirm payment:', error)\n      // Mock success for demo\n      onSuccess?.()\n      handleClose()\n    } finally {\n      setIsSubmitting(false)\n    }\n  }\n\n  const handleClose = () => {\n    setPaymentAmount(invoice.remainingAmount.toString())\n    setNotes('')\n    setError('')\n    onClose()\n  }\n\n  const getStatusBadge = (status: string) => {\n    const config = {\n      paid: { label: 'Đã thanh toán', color: 'bg-green-100 text-green-700' },\n      pending: { label: 'Chờ thanh toán', color: 'bg-amber-100 text-amber-700' },\n      overdue: { label: 'Quá hạn', color: 'bg-red-100 text-red-700' },\n    }\n    const { label, color } = config[status as keyof typeof config] || config.pending\n    return (\n      <span className={`px-3 py-1 text-xs font-black uppercase rounded-lg ${color}`}>\n        {label}\n      </span>\n    )\n  }\n\n  return (\n    <BaseModal\n      isOpen={isOpen}\n      onClose={handleClose}\n      title=\"Xác Nhận Thanh Toán\"\n      size=\"lg\"\n      primaryAction={{\n        label: 'Xác Nhận Thanh Toán',\n        onClick: handleConfirm,\n        disabled: !canConfirmPayment || isSubmitting,\n        loading: isSubmitting,\n      }}\n      secondaryAction={{\n        label: 'Hủy',\n        onClick: handleClose,\n      }}\n    >\n      <div className=\"space-y-4\">\n        {/* Permission Warning */}\n        {!canConfirmPayment && (\n          <div className=\"p-4 bg-amber-50 border border-amber-200 rounded-xl flex items-start gap-3\">\n            <AlertCircle className=\"w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5\" />\n            <div>\n              <p className=\"text-sm font-bold text-amber-800\">Không Có Quyền Truy Cập</p>\n              <p className=\"text-xs text-amber-700 mt-1\">Chỉ quản trị viên mới có quyền xác nhận thanh toán</p>\n            </div>\n          </div>\n        )}\n\n        {/* Invoice Summary */}\n        <div className=\"p-4 bg-gradient-to-br from-slate-50 to-slate-100 rounded-xl border border-slate-200\">\n          <div className=\"flex items-start justify-between mb-3\">\n            <div>\n              <p className=\"text-xs font-bold text-slate-500 uppercase tracking-wider\">Hóa Đơn</p>\n              <p className=\"text-lg font-black text-slate-800 font-mono\">{invoice.id}</p>\n            </div>\n            {getStatusBadge(invoice.status)}\n          </div>\n\n          <div className=\"space-y-2\">\n            <div className=\"flex justify-between items-center\">\n              <span className=\"text-xs text-slate-500\">Học sinh</span>\n              <span className=\"text-sm font-bold text-slate-800\">{invoice.studentName}</span>\n            </div>\n            <div className=\"flex justify-between items-center\">\n              <span className=\"text-xs text-slate-500\">Mã HS</span>\n              <span className=\"text-sm font-mono text-slate-600\">{invoice.studentId}</span>\n            </div>\n            <div className=\"flex justify-between items-center pt-2 border-t border-slate-200\">\n              <span className=\"text-xs font-bold text-slate-500 uppercase tracking-wider\">Tổng tiền</span>\n              <span className=\"text-base font-black text-slate-800\">{formatCurrency(invoice.totalAmount)} ₫</span>\n            </div>\n            <div className=\"flex justify-between items-center\">\n              <span className=\"text-xs text-slate-500\">Đã thanh toán</span>\n              <span className=\"text-sm font-bold text-green-600\">{formatCurrency(invoice.paidAmount)} ₫</span>\n            </div>\n            <div className=\"flex justify-between items-center\">\n              <span className=\"text-xs font-bold text-slate-500 uppercase tracking-wider\">Còn lại</span>\n              <span className=\"text-base font-black text-red-600\">{formatCurrency(invoice.remainingAmount)} ₫</span>\n            </div>\n          </div>\n        </div>\n\n        {/* Fee Items Preview */}\n        <div>\n          <p className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2\">Chi Tiết Khoản Thu</p>\n          <div className=\"space-y-2 max-h-32 overflow-y-auto\">\n            {invoice.feeItems.map((item, index) => (\n              <div key={index} className=\"flex justify-between items-center p-2 bg-slate-50 rounded-lg\">\n                <div>\n                  <p className=\"text-xs font-bold text-slate-700\">{item.name}</p>\n                  <p className=\"text-[10px] text-slate-400 font-mono\">{item.code}</p>\n                </div>\n                <span className=\"text-xs font-bold text-slate-800\">{formatCurrency(item.amount)} ₫</span>\n              </div>\n            ))}\n          </div>\n        </div>\n\n        {/* Payment Amount Input */}\n        <div>\n          <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">\n            Số Tiền Thanh Toán <span className=\"text-red-500\">*</span>\n          </label>\n          <div className=\"relative\">\n            <input\n              type=\"number\"\n              value={paymentAmount}\n              onChange={(e) => setPaymentAmount(e.target.value)}\n              placeholder={invoice.remainingAmount.toString()}\n              disabled={!canConfirmPayment}\n              className={`w-full px-4 py-3 bg-slate-50 border rounded-xl text-lg font-black outline-none transition-colors pr-20 ${\n                isOverPayment\n                  ? 'border-red-300 focus:border-red-500 text-red-600'\n                  : 'border-slate-200 focus:border-[#0284C7]'\n              } ${!canConfirmPayment ? 'opacity-50 cursor-not-allowed' : ''}`}\n            />\n            <span className=\"absolute right-4 top-1/2 -translate-y-1/2 text-base font-bold text-slate-400\">\n              ₫\n            </span>\n          </div>\n\n          {/* Quick Amount Buttons */}\n          {canConfirmPayment && (\n            <div className=\"flex gap-2 mt-2\">\n              <button\n                onClick={() => setPaymentAmount(invoice.remainingAmount.toString())}\n                className=\"px-3 py-1.5 bg-blue-100 hover:bg-blue-200 text-blue-700 text-xs font-bold rounded-lg transition-colors\"\n              >\n                Thanh toán hết ({formatCurrency(invoice.remainingAmount)} ₫)\n              </button>\n              <button\n                onClick={() => setPaymentAmount(Math.floor(invoice.remainingAmount / 2).toString())}\n                className=\"px-3 py-1.5 bg-slate-100 hover:bg-slate-200 text-slate-700 text-xs font-bold rounded-lg transition-colors\"\n              >\n                50% ({formatCurrency(Math.floor(invoice.remainingAmount / 2))} ₫)\n              </button>\n            </div>\n          )}\n        </div>\n\n        {/* Balance Preview */}\n        {paymentAmount && (\n          <div className={`p-4 rounded-xl border-2 ${\n            isPartialPayment\n              ? 'bg-amber-50 border-amber-200'\n              : isOverPayment\n              ? 'bg-red-50 border-red-200'\n              : 'bg-green-50 border-green-200'\n          }`}>\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-2\">\n                {isPartialPayment ? (\n                  <AlertCircle className=\"w-5 h-5 text-amber-500\" />\n                ) : isOverPayment ? (\n                  <AlertCircle className=\"w-5 h-5 text-red-500\" />\n                ) : (\n                  <CheckCircle className=\"w-5 h-5 text-green-500\" />\n                )}\n                <span className=\"text-sm font-bold text-slate-700\">\n                  {isOverPayment ? 'Thanh toán quá mức' : isPartialPayment ? 'Thanh toán một phần' : 'Thanh toán đủ'}\n                </span>\n              </div>\n              <div className=\"text-right\">\n                <p className=\"text-xs text-slate-500\">Còn lại sau khi thanh toán</p>\n                <p className={`text-lg font-black ${\n                  remainingBalance > 0 ? 'text-amber-600' : 'text-green-600'\n                }`}>\n                  {formatCurrency(Math.max(0, remainingBalance))} ₫\n                </p>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Notes */}\n        <div>\n          <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">\n            Ghi Chú\n          </label>\n          <textarea\n            value={notes}\n            onChange={(e) => setNotes(e.target.value)}\n            placeholder=\"Nhập ghi chú cho thanh toán này (không bắt buộc)\"\n            rows={3}\n            disabled={!canConfirmPayment}\n            className={`w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm font-bold outline-none focus:border-[#0284C7] resize-none ${\n              !canConfirmPayment ? 'opacity-50 cursor-not-allowed' : ''\n            }`}\n          />\n        </div>\n\n        {/* Error Message */}\n        {error && (\n          <div className=\"p-3 bg-red-50 border border-red-200 rounded-lg flex items-start gap-2\">\n            <AlertCircle className=\"w-4 h-4 text-red-500 flex-shrink-0 mt-0.5\" />\n            <p className=\"text-xs text-red-700\">{error}</p>\n          </div>\n        )}\n      </div>\n    </BaseModal>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\payments\\modals\\SendReminderModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PrimaryButton' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SecondaryButton' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":180,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":180,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5427,5430],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5427,5430],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState } from 'react'\nimport { Mail, Calendar, User, Send } from 'lucide-react'\nimport { BaseModal } from '@/components/admin/shared/modals/BaseModal'\nimport { PrimaryButton } from '@/components/admin/shared/buttons/primary-button'\nimport { SecondaryButton } from '@/components/admin/shared/buttons/secondary-button'\n\ninterface ReminderRecipient {\n  studentName: string\n  parentEmail: string\n  parentPhone: string\n  amount: number\n  dueDate: string\n}\n\ninterface ReminderTemplate {\n  id: string\n  name: string\n  subject: string\n  message: string\n}\n\ninterface SendReminderModalProps {\n  isOpen: boolean\n  onClose: () => void\n  onSuccess?: () => void\n  recipients: ReminderRecipient[]\n  currentUser?: { role: string; name: string; id?: string }\n}\n\nconst REMINDER_TEMPLATES: ReminderTemplate[] = [\n  {\n    id: 'overdue',\n    name: 'Nhắc nhở quá hạn',\n    subject: 'THÔNG BÁO: Học phí chưa thanh toán đã quá hạn',\n    message: `Kính gửi Phụ huynh của em {studentName},\n\nHệ thống ghi nhận khoản học phí {amount} đ của em có hạn thanh toán vào ngày {dueDate} hiện đã QUÁ HẠN.\n\nĐể tránh ảnh hưởng đến việc học tập của em, vui lòng hoàn tất thanh toán sớm nhất có thể.\n\nThông tin thanh toán:\n- Số tiền: {amount} đ\n- Hạn thanh toán: {dueDate}\n\nTrân trọng,\nBan hành chính Trường THCS ABC`,\n  },\n  {\n    id: 'due_soon',\n    name: 'Sắp đến hạn',\n    subject: 'NHẮC NHỞ: Hạn thanh toán học phí sắp tới',\n    message: `Kính gửi Phụ huynh của em {studentName},\n\nĐây là email nhắc nhở về khoản học phí {amount} đ với hạn thanh toán vào ngày {dueDate}.\n\nVui lòng hoàn tất thanh toán trước hạn để đảm bảo quy định nhà trường.\n\nThông tin thanh toán:\n- Số tiền: {amount} đ\n- Hạn thanh toán: {dueDate}\n\nTrân trọng,\nBan hành chính Trường THCS ABC`,\n  },\n  {\n    id: 'partial_payment',\n    name: 'Thanh toán một phần',\n    subject: 'XÁC NHẬN: Đã nhận thanh toán một phần học phí',\n    message: `Kính gửi Phụ huynh của em {studentName},\n\nChúng tôi đã nhận được thanh toán một phần khoản học phí. Tuy nhiên, vẫn còn số tiền chưa thanh toán như sau:\n\n- Tổng tiền: {totalAmount} đ\n- Đã thanh toán: {paidAmount} đ\n- Còn lại: {remainingAmount} đ\n- Hạn thanh toán: {dueDate}\n\nVui lòng hoàn tất thanh toán số tiền còn lại trước hạn.\n\nTrân trọng,\nBan hành chính Trường THCS ABC`,\n  },\n  {\n    id: 'custom',\n    name: 'Tùy chỉnh',\n    subject: 'THÔNG BÁO HỌC PHÍ',\n    message: `Kính gửi Phụ huynh,\n\nVui lòng thanh toán khoản học phí của em {studentName}.\n\nSố tiền: {amount} đ\nHạn thanh toán: {dueDate}\n\nTrân trọng.`,\n  },\n]\n\nexport function SendReminderModal({\n  isOpen,\n  onClose,\n  onSuccess,\n  recipients,\n  currentUser,\n}: SendReminderModalProps) {\n  const [selectedTemplate, setSelectedTemplate] = useState(REMINDER_TEMPLATES[0].id)\n  const [customSubject, setCustomSubject] = useState('')\n  const [customMessage, setCustomMessage] = useState('')\n  const [sendDate, setSendDate] = useState(new Date().toISOString().split('T')[0])\n  const [isSending, setIsSending] = useState(false)\n  const [error, setError] = useState('')\n\n  // Permission check\n  const canSendReminder = currentUser?.role === 'admin'\n\n  const currentTemplate = REMINDER_TEMPLATES.find(t => t.id === selectedTemplate) || REMINDER_TEMPLATES[0]\n  const isCustomTemplate = selectedTemplate === 'custom'\n\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat('vi-VN').format(amount)\n  }\n\n  const previewMessage = (recipient: ReminderRecipient) => {\n    let message = isCustomTemplate ? customMessage : currentTemplate.message\n    let subject = isCustomTemplate ? customSubject : currentTemplate.subject\n\n    // Replace placeholders\n    message = message\n      .replace(/{studentName}/g, recipient.studentName)\n      .replace(/{amount}/g, formatCurrency(recipient.amount))\n      .replace(/{dueDate}/g, new Date(recipient.dueDate).toLocaleDateString('vi-VN'))\n      .replace(/{totalAmount}/g, formatCurrency(recipient.amount))\n      .replace(/{paidAmount}/g, formatCurrency(Math.floor(recipient.amount * 0.5)))\n      .replace(/{remainingAmount}/g, formatCurrency(Math.ceil(recipient.amount * 0.5)))\n\n    subject = subject\n      .replace(/{studentName}/g, recipient.studentName)\n      .replace(/{amount}/g, formatCurrency(recipient.amount))\n      .replace(/{dueDate}/g, new Date(recipient.dueDate).toLocaleDateString('vi-VN'))\n\n    return { subject, message }\n  }\n\n  const handleSend = async () => {\n    // Permission check\n    if (!canSendReminder) {\n      setError('Bạn không có quyền gửi nhắc nhở thanh toán')\n      return\n    }\n\n    if (recipients.length === 0) {\n      setError('Không có người nhận để gửi nhắc nhở')\n      return\n    }\n\n    setIsSending(true)\n    setError('')\n\n    try {\n      // TODO: API call to POST /api/payments/:id/reminder\n      const promises = recipients.map((recipient) => {\n        const { subject, message } = previewMessage(recipient)\n        return fetch('/api/payments/reminder', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            recipientEmail: recipient.parentEmail,\n            recipientPhone: recipient.parentPhone,\n            subject,\n            message,\n            sendDate,\n            sentBy: currentUser?.id || 'admin-id',\n            sentByName: currentUser?.name || 'Admin',\n          }),\n        })\n      })\n\n      const results = await Promise.allSettled(promises)\n      const successful = results.filter((r: any) => r.status === 'fulfilled').length\n\n      if (successful === recipients.length) {\n        onSuccess?.()\n        handleClose()\n        alert(`Đã gửi nhắc nhở thành công đến ${successful} phụ huynh`)\n      } else {\n        setError(`Đã gửi thành công ${successful}/${recipients.length} nhắc nhở`)\n      }\n    } catch (error) {\n      console.error('Failed to send reminder:', error)\n      // Mock success for demo\n      onSuccess?.()\n      handleClose()\n      alert(`Đã gửi nhắc nhở thành công đến ${recipients.length} phụ huynh`)\n    } finally {\n      setIsSending(false)\n    }\n  }\n\n  const handleClose = () => {\n    setSelectedTemplate(REMINDER_TEMPLATES[0].id)\n    setCustomSubject('')\n    setCustomMessage('')\n    setSendDate(new Date().toISOString().split('T')[0])\n    setError('')\n    onClose()\n  }\n\n  return (\n    <BaseModal\n      isOpen={isOpen}\n      onClose={handleClose}\n      title=\"Gửi Nhắc Nhở Thanh Toán\"\n      size=\"xl\"\n      primaryAction={{\n        label: `Gửi ${recipients.length} Nhắc Nhở`,\n        onClick: handleSend,\n        disabled: !canSendReminder || isSending,\n        loading: isSending,\n      }}\n      secondaryAction={{\n        label: 'Hủy',\n        onClick: handleClose,\n      }}\n    >\n      <div className=\"space-y-4\">\n        {/* Permission Warning */}\n        {!canSendReminder && (\n          <div className=\"p-4 bg-amber-50 border border-amber-200 rounded-xl flex items-start gap-3\">\n            <Mail className=\"w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5\" />\n            <div>\n              <p className=\"text-sm font-bold text-amber-800\">Không Có Quyền Truy Cập</p>\n              <p className=\"text-xs text-amber-700 mt-1\">Chỉ quản trị viên mới có quyền gửi nhắc nhở thanh toán</p>\n            </div>\n          </div>\n        )}\n\n        {/* Recipients Summary */}\n        <div className=\"p-4 bg-slate-50 rounded-xl border border-slate-200\">\n          <div className=\"flex items-center gap-2 mb-2\">\n            <User className=\"w-4 h-4 text-[#0284C7]\" />\n            <p className=\"text-xs font-bold text-slate-500 uppercase tracking-wider\">Người Nhận</p>\n          </div>\n          <p className=\"text-sm font-bold text-slate-800\">\n            {recipients.length} phụ huynh sẽ nhận nhắc nhở\n          </p>\n          {recipients.length <= 5 && (\n            <div className=\"mt-2 space-y-1\">\n              {recipients.map((recipient, index) => (\n                <p key={index} className=\"text-xs text-slate-600\">\n                  • {recipient.studentName} - {recipient.parentEmail}\n                </p>\n              ))}\n            </div>\n          )}\n        </div>\n\n        {/* Template Selection */}\n        <div>\n          <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">\n            Mẫu Thông Báo <span className=\"text-red-500\">*</span>\n          </label>\n          <div className=\"grid grid-cols-2 gap-3\">\n            {REMINDER_TEMPLATES.map((template) => (\n              <label\n                key={template.id}\n                className={`flex items-center gap-3 p-4 border-2 rounded-xl cursor-pointer transition-all ${\n                  selectedTemplate === template.id\n                    ? 'border-[#0284C7] bg-blue-50'\n                    : 'border-slate-200 bg-slate-50 hover:border-slate-300'\n                }`}\n              >\n                <input\n                  type=\"radio\"\n                  name=\"template\"\n                  value={template.id}\n                  checked={selectedTemplate === template.id}\n                  onChange={(e) => setSelectedTemplate(e.target.value)}\n                  disabled={!canSendReminder}\n                  className=\"w-4 h-4\"\n                />\n                <div className=\"flex-1\">\n                  <p className=\"text-sm font-bold text-slate-800\">{template.name}</p>\n                  <p className=\"text-xs text-slate-500 truncate\">{template.subject}</p>\n                </div>\n              </label>\n            ))}\n          </div>\n        </div>\n\n        {/* Custom Subject (when custom template selected) */}\n        {isCustomTemplate && (\n          <div>\n            <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">\n              Tiêu Đề Email <span className=\"text-red-500\">*</span>\n            </label>\n            <input\n              type=\"text\"\n              value={customSubject}\n              onChange={(e) => setCustomSubject(e.target.value)}\n              placeholder=\"Nhập tiêu đề email\"\n              disabled={!canSendReminder}\n              className={`w-full px-4 py-3 bg-slate-50 border rounded-xl text-sm font-bold outline-none focus:border-[#0284C7] ${\n                !canSendReminder ? 'opacity-50 cursor-not-allowed' : ''\n              }`}\n            />\n          </div>\n        )}\n\n        {/* Custom Message (when custom template selected) */}\n        {isCustomTemplate && (\n          <div>\n            <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">\n              Nội Dung <span className=\"text-red-500\">*</span>\n            </label>\n            <textarea\n              value={customMessage}\n              onChange={(e) => setCustomMessage(e.target.value)}\n              placeholder=\"Nhập nội dung nhắc nhở. Sử dụng {studentName}, {amount}, {dueDate} để tự động điền thông tin.\"\n              rows={6}\n              disabled={!canSendReminder}\n              className={`w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm font-bold outline-none focus:border-[#0284C7] resize-none ${\n                !canSendReminder ? 'opacity-50 cursor-not-allowed' : ''\n              }`}\n            />\n          </div>\n        )}\n\n        {/* Send Date */}\n        <div>\n          <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">\n            Ngày Gửi\n          </label>\n          <div className=\"relative\">\n            <input\n              type=\"date\"\n              value={sendDate}\n              onChange={(e) => setSendDate(e.target.value)}\n              min={new Date().toISOString().split('T')[0]}\n              disabled={!canSendReminder}\n              className={`w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm font-bold outline-none focus:border-[#0284C7] ${\n                !canSendReminder ? 'opacity-50 cursor-not-allowed' : ''\n              }`}\n            />\n            <Calendar className=\"absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 pointer-events-none\" />\n          </div>\n        </div>\n\n        {/* Preview */}\n        {!isCustomTemplate && recipients.length > 0 && (\n          <div>\n            <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">\n              Xem Trước\n            </label>\n            <div className=\"p-4 bg-white border border-slate-200 rounded-xl\">\n              <p className=\"text-xs font-bold text-slate-500 mb-2\">Tiêu đề:</p>\n              <p className=\"text-sm font-bold text-slate-800 mb-3\">\n                {previewMessage(recipients[0]).subject}\n              </p>\n              <p className=\"text-xs font-bold text-slate-500 mb-2\">Nội dung:</p>\n              <div className=\"bg-slate-50 rounded-lg p-3 max-h-48 overflow-y-auto\">\n                <pre className=\"text-xs text-slate-700 whitespace-pre-wrap font-sans\">\n                  {previewMessage(recipients[0]).message}\n                </pre>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Error Message */}\n        {error && (\n          <div className=\"p-3 bg-red-50 border border-red-200 rounded-lg flex items-start gap-2\">\n            <Send className=\"w-4 h-4 text-red-500 flex-shrink-0 mt-0.5\" />\n            <p className=\"text-xs text-red-700\">{error}</p>\n          </div>\n        )}\n      </div>\n    </BaseModal>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\payments\\modals\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\shared\\buttons\\primary-button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\shared\\buttons\\secondary-button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\shared\\cards\\stat-card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\shared\\filters\\filter-bar.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":18,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[359,362],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[359,362],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[445,448],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[445,448],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":24,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[483,486],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[483,486],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { memo } from 'react'\nimport { X } from 'lucide-react'\nimport { cn } from '@/lib/utils'\nimport { SearchInput } from './search-input'\n\nexport interface FilterOption {\n  value: string\n  label: string\n}\n\nexport interface Filter {\n  key: string\n  label: string\n  type: 'select' | 'multiselect' | 'search'\n  options?: FilterOption[]\n  value?: any\n}\n\nexport interface FilterBarProps {\n  filters: Filter[]\n  values: Record<string, any>\n  onChange: (key: string, value: any) => void\n  onClear: () => void\n  searchKey?: string\n  searchPlaceholder?: string\n  className?: string\n}\n\nexport const FilterBar = memo(function FilterBar({\n  filters,\n  values,\n  onChange,\n  onClear,\n  searchKey,\n  searchPlaceholder,\n  className,\n}: FilterBarProps) {\n  const hasActiveFilters =\n    Object.values(values).some((v) =>\n      Array.isArray(v) ? v.length > 0 : v !== undefined && v !== ''\n    ) || false\n\n  return (\n    <div className={cn('space-y-4', className)}>\n      {/* Search Row */}\n      {searchKey && (\n        <div className=\"flex items-center gap-4\">\n          <div className=\"flex-1\">\n            <SearchInput\n              value={values[searchKey] || ''}\n              onChange={(val) => onChange(searchKey, val)}\n              placeholder={searchPlaceholder}\n            />\n          </div>\n          {hasActiveFilters && (\n            <button\n              onClick={onClear}\n              className=\"flex items-center gap-2 rounded-lg border border-slate-300 px-4 py-2 text-sm font-medium text-slate-600 transition-colors hover:bg-slate-50\"\n            >\n              <X className=\"h-4 w-4\" />\n              Xóa bộ lọc\n            </button>\n          )}\n        </div>\n      )}\n\n      {/* Filter Row */}\n      <div className=\"flex flex-wrap gap-3\">\n        {filters.map((filter) => (\n          <div key={filter.key} className=\"flex-1 min-w-[200px]\">\n            <label className=\"mb-1 block text-xs font-medium text-slate-700\">\n              {filter.label}\n            </label>\n            {filter.type === 'select' && (\n              <select\n                value={values[filter.key] || ''}\n                onChange={(e) => onChange(filter.key, e.target.value)}\n                className={cn(\n                  'h-10 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm',\n                  'focus:border-[#0284C7] focus:outline-none focus:ring-1 focus:ring-[#0284C7]',\n                  'transition-colors'\n                )}\n              >\n                <option value=\"\">Tất cả</option>\n                {filter.options?.map((option) => (\n                  <option key={option.value} value={option.value}>\n                    {option.label}\n                  </option>\n                ))}\n              </select>\n            )}\n          </div>\n        ))}\n      </div>\n    </div>\n  )\n})\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\shared\\filters\\search-input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\shared\\forms\\form-field.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\shared\\forms\\form-select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\shared\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\shared\\modals\\BaseModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\shared\\modals\\ModalContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\shared\\modals\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\shared\\tables\\data-table.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[157,160],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[157,160],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":24,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[497,500],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[497,500],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { cn } from '@/lib/utils'\n\nexport interface Column<T> {\n  key: keyof T | string\n  label: string\n  sortable?: boolean\n  render?: (value: any, row: T) => React.ReactNode\n}\n\nexport interface DataTableProps<T> {\n  data: T[]\n  columns: Column<T>[]\n  onRowClick?: (row: T) => void\n  selectable?: boolean\n  selectedIds?: string[]\n  onSelect?: (id: string) => void\n  loading?: boolean\n  emptyMessage?: string\n  className?: string\n}\n\nexport function DataTable<T extends Record<string, any>>({\n  data,\n  columns,\n  onRowClick,\n  selectable = false,\n  selectedIds = [],\n  onSelect,\n  loading = false,\n  emptyMessage = 'Không có dữ liệu',\n  className,\n}: DataTableProps<T>) {\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center p-12\">\n        <div className=\"h-8 w-8 animate-spin rounded-full border-4 border-slate-200 border-t-[#0284C7]\" />\n      </div>\n    )\n  }\n\n  if (data.length === 0) {\n    return (\n      <div className=\"flex flex-col items-center justify-center p-12\">\n        <svg\n          className=\"mb-4 h-12 w-12 text-slate-300\"\n          fill=\"none\"\n          stroke=\"currentColor\"\n          viewBox=\"0 0 24 24\"\n        >\n          <path\n            strokeLinecap=\"round\"\n            strokeLinejoin=\"round\"\n            strokeWidth={1.5}\n            d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"\n          />\n        </svg>\n        <p className=\"text-sm font-medium text-slate-500\">{emptyMessage}</p>\n      </div>\n    )\n  }\n\n  return (\n    <div className={cn('overflow-x-auto', className)}>\n      <table className=\"min-w-full divide-y divide-slate-200\">\n        <thead className=\"bg-slate-50\">\n          <tr>\n            {selectable && (\n              <th className=\"px-4 py-3 text-left\">\n                <input\n                  type=\"checkbox\"\n                  className=\"h-4 w-4 rounded border-slate-300 text-[#0284C7] focus:ring-[#0284C7]\"\n                  checked={selectedIds.length === data.length}\n                  onChange={(e) => {\n                    if (e.target.checked) {\n                      data.forEach((row) => onSelect?.(row.id))\n                    } else {\n                      selectedIds.forEach((id) => onSelect?.(id))\n                    }\n                  }}\n                />\n              </th>\n            )}\n            {columns.map((column) => (\n              <th\n                key={String(column.key)}\n                className=\"px-4 py-3 text-left text-xs font-black uppercase tracking-wider text-slate-500\"\n              >\n                {column.label}\n              </th>\n            ))}\n          </tr>\n        </thead>\n        <tbody className=\"divide-y divide-slate-200 bg-white\">\n          {data.map((row, idx) => (\n            <tr\n              key={row.id || idx}\n              className={cn(\n                'transition-colors',\n                onRowClick && 'cursor-pointer hover:bg-slate-50',\n                idx % 2 === 0 && 'bg-slate-50/30'\n              )}\n              onClick={() => onRowClick?.(row)}\n            >\n              {selectable && (\n                <td className=\"whitespace-nowrap px-4 py-3\">\n                  <input\n                    type=\"checkbox\"\n                    className=\"h-4 w-4 rounded border-slate-300 text-[#0284C7] focus:ring-[#0284C7]\"\n                    checked={selectedIds.includes(row.id)}\n                    onChange={() => onSelect?.(row.id)}\n                    onClick={(e) => e.stopPropagation()}\n                  />\n                </td>\n              )}\n              {columns.map((column) => (\n                <td\n                  key={String(column.key)}\n                  className=\"whitespace-nowrap px-4 py-3 text-sm text-slate-700\"\n                >\n                  {column.render\n                    ? column.render(row[column.key as keyof T], row)\n                    : String(row[column.key as keyof T] ?? '')}\n                </td>\n              ))}\n            </tr>\n          ))}\n        </tbody>\n      </table>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\shared\\tables\\status-badge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\users\\UsersManagement.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[649,652],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[649,652],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setClassOptions' is assigned a value but never used.","line":44,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":44,"endColumn":39},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":62,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2044,2047],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2044,2047],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":63,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2127,2130],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2127,2130],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2211,2214],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2211,2214],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":65,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2295,2298],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2295,2298],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":138,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4662,4665],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4662,4665],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":139,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4743,4746],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4743,4746],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":140,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":140,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4825,4828],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4825,4828],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":141,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":141,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4907,4910],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4907,4910],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":161,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":161,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5444,5447],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5444,5447],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleLinkParent' is assigned a value but never used.","line":172,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":172,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleLinkStudent' is assigned a value but never used.","line":178,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":178,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleAddUserClick' is assigned a value but never used.","line":184,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":184,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleImportExcelClick' is assigned a value but never used.","line":193,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":193,"endColumn":31},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":210,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":210,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6874,6877],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6874,6877],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":345,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":345,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11358,11361],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11358,11361],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":357,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":357,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11898,11901],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11898,11901],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":369,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":369,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12428,12431],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12428,12431],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":14,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect, useMemo, useCallback, useRef } from 'react'\nimport { Users, Shield, UserCheck, Users2, MoreVertical } from 'lucide-react'\nimport { StatCard, DataTable, StatusBadge } from '@/components/admin/shared'\nimport type { Column } from '@/components/admin/shared'\nimport type { User } from '@/lib/types'\nimport { AddUserModal, UserActionsModal, LinkParentModal, LinkStudentModal, ImportExcelModal } from './modals'\n\ninterface UserStats {\n  total: number\n  admin: number\n  teachers: number\n  parents: number\n  students: number\n}\n\ninterface ApiResponse<T> {\n  success: boolean\n  data: T[]\n  total?: number\n  stats?: any\n}\n\ninterface UsersManagementProps {\n  initialUsers: User[]\n  initialStats: UserStats\n  initialClassOptions: Array<{ value: string; label: string }>\n  refreshTrigger?: number\n  onAddUser?: () => void\n  onImportExcel?: () => void\n}\n\nexport function UsersManagement({\n  initialUsers,\n  initialStats,\n  initialClassOptions,\n  refreshTrigger: externalRefreshTrigger = 0,\n  onAddUser,\n  onImportExcel\n}: UsersManagementProps) {\n  const [users, setUsers] = useState<User[]>(initialUsers)\n  const [stats, setStats] = useState<UserStats>(initialStats)\n  const [classOptions, setClassOptions] = useState(initialClassOptions)\n  const [loading, setLoading] = useState(false)\n  const [internalRefreshTrigger, setInternalRefreshTrigger] = useState(0)\n\n  // Combine external and internal refresh triggers\n  useEffect(() => {\n    if (externalRefreshTrigger > 0 && externalRefreshTrigger !== internalRefreshTrigger) {\n      setInternalRefreshTrigger(externalRefreshTrigger)\n      // Refetch data when external trigger changes\n      const refetchUsers = async () => {\n        setLoading(true)\n        try {\n          const response = await fetch('/api/users?')\n          const result: ApiResponse<User> = await response.json()\n          if (result.success) {\n            setUsers(result.data)\n            const newStats = {\n              total: result.data.length,\n              admin: result.data.filter((u: any) => u.role === 'admin').length,\n              teachers: result.data.filter((u: any) => u.role === 'teacher').length,\n              parents: result.data.filter((u: any) => u.role === 'parent').length,\n              students: result.data.filter((u: any) => u.role === 'student').length,\n            }\n            setStats(newStats)\n          }\n        } catch (error) {\n          console.error('Failed to refresh users:', error)\n        } finally {\n          setLoading(false)\n        }\n      }\n      refetchUsers()\n    }\n  }, [externalRefreshTrigger, internalRefreshTrigger])\n\n  // Modal states\n  const [showAddModal, setShowAddModal] = useState(false)\n  const [showActionsModal, setShowActionsModal] = useState(false)\n  const [showLinkParentModal, setShowLinkParentModal] = useState(false)\n  const [showLinkStudentModal, setShowLinkStudentModal] = useState(false)\n  const [showImportModal, setShowImportModal] = useState(false)\n  const [selectedUser, setSelectedUser] = useState<User | null>(null)\n\n  // Mock current user (would come from auth context)\n  const currentUser = { role: 'admin' as const }\n\n  const [filters, setFilters] = useState({\n    search: '',\n    role: '',\n    status: '',\n    class: '',\n  })\n\n  // Refresh callback pattern\n  const handleRefresh = useCallback(() => {\n    setInternalRefreshTrigger(prev => prev + 1)\n  }, [])\n\n  // Use ref to track previous filter values\n  const prevFiltersRef = useRef<string>('')\n\n  // Fetch users from API - only when filters change, skip initial render\n  useEffect(() => {\n    const filterString = JSON.stringify(filters)\n\n    // Skip initial fetch - we already have server data\n    if (prevFiltersRef.current === '') {\n      prevFiltersRef.current = filterString\n      return\n    }\n\n    // Only fetch if filters actually changed\n    if (filterString === prevFiltersRef.current) {\n      return\n    }\n\n    prevFiltersRef.current = filterString\n\n    const fetchUsers = async () => {\n      setLoading(true)\n      const params = new URLSearchParams()\n      if (filters.search) params.append('search', filters.search)\n      if (filters.role) params.append('role', filters.role)\n      if (filters.status) params.append('status', filters.status)\n      if (filters.class) params.append('classId', filters.class)\n\n      try {\n        const response = await fetch(`/api/users?${params}`)\n        const result: ApiResponse<User> = await response.json()\n        if (result.success) {\n          setUsers(result.data)\n          // Update stats when data changes\n          const newStats = {\n            total: result.data.length,\n            admin: result.data.filter((u: any) => u.role === 'admin').length,\n            teachers: result.data.filter((u: any) => u.role === 'teacher').length,\n            parents: result.data.filter((u: any) => u.role === 'parent').length,\n            students: result.data.filter((u: any) => u.role === 'student').length,\n          }\n          setStats(newStats)\n        }\n      } catch (error) {\n        console.error('Failed to fetch users:', error)\n      } finally {\n        setLoading(false)\n      }\n    }\n\n    fetchUsers()\n  }, [filters, internalRefreshTrigger])\n\n  // Clear filters - memoized\n  const handleClearFilters = useCallback(() => {\n    setFilters({ search: '', role: '', status: '', class: '' })\n  }, [])\n\n  // Handle filter change - memoized\n  const handleFilterChange = useCallback((key: string, value: any) => {\n    setFilters(prev => ({ ...prev, [key]: value }))\n  }, [])\n\n  // Open user actions modal\n  const handleUserActions = useCallback((user: User) => {\n    setSelectedUser(user)\n    setShowActionsModal(true)\n  }, [])\n\n  // Open link parent modal\n  const handleLinkParent = useCallback((user: User) => {\n    setSelectedUser(user)\n    setShowLinkParentModal(true)\n  }, [])\n\n  // Open link student modal\n  const handleLinkStudent = useCallback((user: User) => {\n    setSelectedUser(user)\n    setShowLinkStudentModal(true)\n  }, [])\n\n  // Handle add user\n  const handleAddUserClick = useCallback(() => {\n    if (onAddUser) {\n      onAddUser()\n    } else {\n      setShowAddModal(true)\n    }\n  }, [onAddUser])\n\n  // Handle import excel\n  const handleImportExcelClick = useCallback(() => {\n    if (onImportExcel) {\n      onImportExcel()\n    } else {\n      setShowImportModal(true)\n    }\n  }, [onImportExcel])\n\n  // Table columns - memoized\n  const columns = useMemo<Column<User>[]>(() => [\n    {\n      key: 'name',\n      label: 'Người dùng',\n      render: (_value, row) => (\n        <div className=\"flex items-center gap-3\">\n          <div className=\"h-10 w-10 overflow-hidden rounded-full bg-gradient-to-br from-[#0284C7] to-[#0369a1] p-0.5\">\n            <div className=\"flex h-full w-full items-center justify-center rounded-full bg-white text-xs font-bold text-[#0284C7]\">\n              {row.name.split(' ').slice(0, 2).map((n: any) => n[0]).join('')}\n            </div>\n          </div>\n          <div>\n            <p className=\"text-sm font-bold text-slate-800\">{row.name}</p>\n            <p className=\"text-xs text-slate-400\">{row.email}</p>\n          </div>\n        </div>\n      ),\n    },\n    {\n      key: 'role',\n      label: 'Vai trò',\n      render: (value) => {\n        const roleConfig: Record<string, { label: string; color: string }> = {\n          admin: { label: 'Admin', color: 'bg-purple-100 text-purple-700' },\n          teacher: { label: 'Giáo viên', color: 'bg-blue-100 text-blue-700' },\n          parent: { label: 'Phụ huynh', color: 'bg-green-100 text-green-700' },\n          student: { label: 'Học sinh', color: 'bg-orange-100 text-orange-700' },\n        }\n        // Safe type assertion with fallback\n        const config = roleConfig[value ?? ''] ?? { label: value ?? 'Unknown', color: 'bg-gray-100 text-gray-700' }\n        return (\n          <span className={`inline-flex items-center gap-1 rounded-full px-3 py-1 text-[10px] font-bold uppercase ${config.color}`}>\n            <Shield className=\"h-3 w-3\" />\n            {config.label}\n          </span>\n        )\n      },\n    },\n    {\n      key: 'classId',\n      label: 'Lớp / Đơn vị',\n      render: (value) => value ? (\n        <span className=\"rounded-lg bg-slate-100 px-3 py-1 text-xs font-semibold text-slate-600\">\n          Lớp {value}\n        </span>\n      ) : (\n        <span className=\"text-xs text-slate-400\">—</span>\n      ),\n    },\n    {\n      key: 'status',\n      label: 'Trạng thái',\n      render: (value) => (\n        <StatusBadge\n          status={value === 'active' ? 'success' : 'warning'}\n          label={value === 'active' ? 'Hoạt động' : 'Không hoạt động'}\n        />\n      ),\n    },\n    {\n      key: 'lastLogin',\n      label: 'Đăng nhập cuối',\n      render: () => <span className=\"text-xs text-slate-500\">2 giờ trước</span>,\n    },\n    {\n      key: 'actions',\n      label: '',\n      render: (_value, row) => (\n        <button\n          onClick={() => handleUserActions(row)}\n          className=\"rounded-lg p-2 text-slate-400 hover:bg-slate-100 hover:text-slate-600 transition-colors\"\n          aria-label=\"Thao tác\"\n        >\n          <MoreVertical className=\"h-4 w-4\" />\n        </button>\n      ),\n    },\n  ], [handleUserActions])\n\n  // Static filter options - memoized\n  const roleFilterOptions = useMemo(() => [\n    { value: 'admin', label: 'Admin' },\n    { value: 'teacher', label: 'Giáo viên' },\n    { value: 'parent', label: 'Phụ huynh' },\n    { value: 'student', label: 'Học sinh' },\n  ], [])\n\n  const statusFilterOptions = useMemo(() => [\n    { value: 'active', label: 'Hoạt động' },\n    { value: 'inactive', label: 'Không hoạt động' },\n  ], [])\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Statistics Cards */}\n      <div className=\"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-5\">\n        <StatCard\n          title=\"Tổng người dùng\"\n          value={stats.total}\n          trend={3.2}\n          icon={<Users className=\"h-5 w-5\" />}\n          color=\"blue\"\n        />\n        <StatCard\n          title=\"Admin\"\n          value={stats.admin}\n          icon={<Shield className=\"h-5 w-5\" />}\n          color=\"purple\"\n        />\n        <StatCard\n          title=\"Giáo viên\"\n          value={stats.teachers}\n          icon={<UserCheck className=\"h-5 w-5\" />}\n          color=\"blue\"\n        />\n        <StatCard\n          title=\"Phụ huynh\"\n          value={stats.parents}\n          trend={1.8}\n          icon={<Users2 className=\"h-5 w-5\" />}\n          color=\"green\"\n        />\n        <StatCard\n          title=\"Học sinh\"\n          value={stats.students}\n          trend={2.5}\n          icon={<Users className=\"h-5 w-5\" />}\n          color=\"orange\"\n        />\n      </div>\n\n      {/* Filters - Buttons removed from here, now in page header */}\n      <div className=\"rounded-[24px] border border-slate-200 bg-white p-6 shadow-sm\">\n        <div className=\"flex flex-wrap items-center gap-3\">\n          <span className=\"text-xs font-black text-slate-400 uppercase tracking-widest\">Bộ lọc:</span>\n\n          {/* Role Filter */}\n          <select\n            value={filters.role}\n            onChange={(e) => handleFilterChange('role', e.target.value)}\n            className=\"px-4 py-2 bg-slate-50 border border-slate-200 rounded-xl text-sm font-bold focus:ring-2 focus:ring-blue-100 outline-none\"\n          >\n            <option value=\"\">Tất cả vai trò</option>\n            {roleFilterOptions.map((opt: any) => (\n              <option key={opt.value} value={opt.value}>{opt.label}</option>\n            ))}\n          </select>\n\n          {/* Status Filter */}\n          <select\n            value={filters.status}\n            onChange={(e) => handleFilterChange('status', e.target.value)}\n            className=\"px-4 py-2 bg-slate-50 border border-slate-200 rounded-xl text-sm font-bold focus:ring-2 focus:ring-blue-100 outline-none\"\n          >\n            <option value=\"\">Tất cả trạng thái</option>\n            {statusFilterOptions.map((opt: any) => (\n              <option key={opt.value} value={opt.value}>{opt.label}</option>\n            ))}\n          </select>\n\n          {/* Grade/Class Filter */}\n          <select\n            value={filters.class}\n            onChange={(e) => handleFilterChange('class', e.target.value)}\n            className=\"px-4 py-2 bg-slate-50 border border-slate-200 rounded-xl text-sm font-bold focus:ring-2 focus:ring-blue-100 outline-none\"\n          >\n            <option value=\"\">Tất cả khối</option>\n            {classOptions.map((opt: any) => (\n              <option key={opt.value} value={opt.value}>{opt.label}</option>\n            ))}\n          </select>\n\n          <button\n            onClick={handleClearFilters}\n            className=\"px-4 py-2 text-slate-500 hover:text-slate-700 text-sm font-bold hover:bg-slate-50 rounded-xl transition-all\"\n          >\n            Xóa bộ lọc\n          </button>\n        </div>\n\n        {/* Active Filters Display */}\n        {(filters.role || filters.status || filters.class) && (\n          <div className=\"flex flex-wrap gap-2 mt-4\">\n            {filters.role && (\n              <span className=\"px-3 py-1 bg-blue-100 text-blue-600 rounded-lg text-xs font-bold flex items-center gap-2\">\n                {roleFilterOptions.find(o => o.value === filters.role)?.label}\n                <button onClick={() => handleFilterChange('role', '')} className=\"hover:text-blue-800\">×</button>\n              </span>\n            )}\n            {filters.status && (\n              <span className=\"px-3 py-1 bg-blue-100 text-blue-600 rounded-lg text-xs font-bold flex items-center gap-2\">\n                {statusFilterOptions.find(o => o.value === filters.status)?.label}\n                <button onClick={() => handleFilterChange('status', '')} className=\"hover:text-blue-800\">×</button>\n              </span>\n            )}\n            {filters.class && (\n              <span className=\"px-3 py-1 bg-blue-100 text-blue-600 rounded-lg text-xs font-bold flex items-center gap-2\">\n                {classOptions.find(o => o.value === filters.class)?.label}\n                <button onClick={() => handleFilterChange('class', '')} className=\"hover:text-blue-800\">×</button>\n              </span>\n            )}\n          </div>\n        )}\n      </div>\n\n      {/* Data Table */}\n      <div className=\"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm\">\n        <DataTable\n          data={users}\n          columns={columns}\n          loading={loading}\n          emptyMessage=\"Không tìm thấy người dùng\"\n        />\n      </div>\n\n      {/* Modals */}\n      <AddUserModal\n        isOpen={showAddModal}\n        onClose={() => setShowAddModal(false)}\n        onSuccess={handleRefresh}\n      />\n\n      {selectedUser && (\n        <>\n          <UserActionsModal\n            isOpen={showActionsModal}\n            onClose={() => {\n              setShowActionsModal(false)\n              setSelectedUser(null)\n            }}\n            onSuccess={handleRefresh}\n            onLinkParent={() => {\n              setShowActionsModal(false)\n              setShowLinkParentModal(true)\n            }}\n            onLinkStudent={() => {\n              setShowActionsModal(false)\n              setShowLinkStudentModal(true)\n            }}\n            user={{\n              id: selectedUser.id,\n              name: selectedUser.name,\n              role: selectedUser.role,\n              status: selectedUser.status,\n              email: selectedUser.email,\n            }}\n            currentUser={currentUser}\n          />\n\n          <LinkParentModal\n            isOpen={showLinkParentModal}\n            onClose={() => {\n              setShowLinkParentModal(false)\n              setSelectedUser(null)\n            }}\n            onSuccess={handleRefresh}\n            student={{\n              id: selectedUser.id,\n              name: selectedUser.name,\n              code: selectedUser.id, // Using ID as code for now\n            }}\n          />\n\n          <LinkStudentModal\n            isOpen={showLinkStudentModal}\n            onClose={() => {\n              setShowLinkStudentModal(false)\n              setSelectedUser(null)\n            }}\n            onSuccess={handleRefresh}\n            parent={{\n              id: selectedUser.id,\n              name: selectedUser.name,\n              code: selectedUser.id, // Using ID as code for now\n            }}\n          />\n        </>\n      )}\n\n      <ImportExcelModal\n        isOpen={showImportModal}\n        onClose={() => setShowImportModal(false)}\n        onSuccess={handleRefresh}\n        importType=\"students\"\n      />\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\users\\UsersManagementServer.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":33,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[794,797],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[794,797],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[868,871],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[868,871],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[943,946],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[943,946],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1018,1021],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1018,1021],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1146,1149],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1146,1149],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1206,1209],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1206,1209],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1218,1221],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1218,1221],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1229,1232],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1229,1232],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1281,1284],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1281,1284],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * UsersManagementServer - Server Component for SSR\n * Renders initial data server-side, passes to client component for interactivity\n */\n\nimport { UsersManagement } from './UsersManagement'\nimport type { User } from '@/lib/types'\n\ninterface UserStats {\n  total: number\n  admin: number\n  teachers: number\n  parents: number\n  students: number\n}\n\ninterface UsersManagementServerProps {\n  initialUsers: User[]\n  refreshTrigger?: number\n  onAddUser?: () => void\n  onImportExcel?: () => void\n}\n\nexport function UsersManagementServer({\n  initialUsers,\n  refreshTrigger,\n  onAddUser,\n  onImportExcel\n}: UsersManagementServerProps) {\n  // Calculate statistics server-side (faster, no client-side work)\n  const stats: UserStats = {\n    total: initialUsers.length,\n    admin: initialUsers.filter((u: any) => u.role === 'admin').length,\n    teachers: initialUsers.filter((u: any) => u.role === 'teacher').length,\n    parents: initialUsers.filter((u: any) => u.role === 'parent').length,\n    students: initialUsers.filter((u: any) => u.role === 'student').length,\n  }\n\n  // Get unique classes server-side\n  const classOptions = initialUsers\n    .map((u: any) => u.classId)\n    .filter(Boolean)\n    .filter((value: any, index: any, self: any) => self.indexOf(value) === index)\n    .map((c: any) => ({ value: c as string, label: `Lớp ${c}` }))\n\n  return (\n    <UsersManagement\n      initialUsers={initialUsers}\n      initialStats={stats}\n      initialClassOptions={classOptions}\n      refreshTrigger={refreshTrigger}\n      onAddUser={onAddUser}\n      onImportExcel={onImportExcel}\n    />\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\users\\modals\\AddUserModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":161,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":161,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4463,4466],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4463,4466],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":216,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":216,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5965,6018],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":231,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":231,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6440,6443],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6440,6443],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":232,"column":81,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":232,"endColumn":84,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6564,6567],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6564,6567],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":233,"column":178,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":233,"endColumn":181,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6784,6787],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6784,6787],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":432,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":432,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15492,15495],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15492,15495],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":447,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":447,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16256,16259],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16256,16259],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":519,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":519,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19760,19763],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19760,19763],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState } from 'react'\nimport { useForm } from 'react-hook-form'\nimport { X, Edit3 } from 'lucide-react'\nimport { cn } from '@/lib/utils'\nimport { validatePassword } from '@/lib/security-utils'\n\ntype UserRole = 'student' | 'teacher' | 'parent'\n\ninterface AddUserModalProps {\n  isOpen: boolean\n  onClose: () => void\n  onSuccess?: () => void\n  initialRole?: UserRole\n}\n\ninterface StudentFormData {\n  name: string\n  dob: string\n  gender: 'male' | 'female' | 'other'\n  grade: string\n  classId: string\n  enrollmentDate: string\n  sendPassword: boolean\n  forcePasswordChange: boolean\n}\n\ninterface TeacherFormData {\n  name: string\n  phone: string\n  email: string\n  subject: string\n  sendPassword: boolean\n  forcePasswordChange: boolean\n}\n\ninterface ParentFormData {\n  name: string\n  phone: string\n  email: string\n  sendPassword: boolean\n  forcePasswordChange: boolean\n}\n\n// Role configuration matching wireframe\nconst roleConfig = {\n  student: { prefix: 'HS', name: 'Học sinh', counter: 1248, color: 'blue', icon: 'student' },\n  teacher: { prefix: 'GV', name: 'Giáo viên', counter: 85, color: 'purple', icon: 'teacher' },\n  parent: { prefix: 'PH', name: 'Phụ huynh', counter: 2186, color: 'teal', icon: 'parent' },\n} as const\n\n// Generate user code based on role\nconst generateUserCode = (role: UserRole): string => {\n  const year = new Date().getFullYear()\n  const config = roleConfig[role]\n  const seq = String(config.counter + 1).padStart(4, '0')\n  return `${config.prefix}${year}${seq}`\n}\n\n// Icons as SVG components matching wireframe\nconst StudentIcon = () => (\n  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n    <path d=\"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2\" />\n    <circle cx=\"9\" cy=\"7\" r=\"4\" />\n  </svg>\n)\n\nconst TeacherIcon = () => (\n  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n    <path d=\"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2\" />\n    <circle cx=\"12\" cy=\"7\" r=\"4\" />\n  </svg>\n)\n\nconst ParentIcon = () => (\n  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n    <path d=\"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2\" />\n    <circle cx=\"9\" cy=\"7\" r=\"4\" />\n    <path d=\"M22 21v-2a4 4 0 0 0-3-3.87\" />\n    <path d=\"M16 3.13a4 4 0 0 1 0 7.75\" />\n  </svg>\n)\n\nexport function AddUserModal({ isOpen, onClose, onSuccess, initialRole = 'student' }: AddUserModalProps) {\n  const [activeRole, setActiveRole] = useState<UserRole>(initialRole)\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState<string>('')\n\n  const generatedCode = generateUserCode(activeRole)\n\n  // Student form\n  const studentForm = useForm<StudentFormData>({\n    defaultValues: {\n      name: '',\n      dob: '',\n      gender: 'male',\n      grade: '6',\n      classId: '',\n      enrollmentDate: new Date().toISOString().split('T')[0],\n      sendPassword: true,\n      forcePasswordChange: true,\n    },\n  })\n\n  // Teacher form\n  const teacherForm = useForm<TeacherFormData>({\n    defaultValues: {\n      name: '',\n      phone: '',\n      email: '',\n      subject: '',\n      sendPassword: true,\n      forcePasswordChange: true,\n    },\n  })\n\n  // Parent form\n  const parentForm = useForm<ParentFormData>({\n    defaultValues: {\n      name: '',\n      phone: '',\n      email: '',\n      sendPassword: true,\n      forcePasswordChange: true,\n    },\n  })\n\n  const handleClose = () => {\n    studentForm.reset()\n    teacherForm.reset()\n    parentForm.reset()\n    setError('')\n    onClose()\n  }\n\n  const generateStrongPassword = (): string => {\n    const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'\n    const lowercase = 'abcdefghijklmnopqrstuvwxyz'\n    const numbers = '0123456789'\n    const all = uppercase + lowercase + numbers\n\n    let password = ''\n    password += uppercase[Math.floor(Math.random() * uppercase.length)]\n    password += lowercase[Math.floor(Math.random() * lowercase.length)]\n    password += numbers[Math.floor(Math.random() * numbers.length)]\n\n    for (let i = password.length; i < 10; i++) {\n      password += all[Math.floor(Math.random() * all.length)]\n    }\n\n    return password.split('').sort(() => Math.random() - 0.5).join('')\n  }\n\n  const handleSubmit = async () => {\n    setLoading(true)\n    setError('')\n\n    try {\n      let formValid = false\n      let formData: any = {}\n\n      if (activeRole === 'student') {\n        const result = studentForm.trigger()\n        if (!await result) {\n          setError('Vui lòng điền đầy đủ thông tin bắt buộc')\n          setLoading(false)\n          return\n        }\n        formData = studentForm.getValues()\n        formValid = true\n      } else if (activeRole === 'teacher') {\n        const result = teacherForm.trigger()\n        if (!await result) {\n          setError('Vui lòng điền đầy đủ thông tin bắt buộc')\n          setLoading(false)\n          return\n        }\n        formData = teacherForm.getValues()\n        formValid = true\n      } else {\n        const result = parentForm.trigger()\n        if (!await result) {\n          setError('Vui lòng điền đầy đủ thông tin bắt buộc')\n          setLoading(false)\n          return\n        }\n        formData = parentForm.getValues()\n        formValid = true\n      }\n\n      if (!formValid) {\n        setError('Dữ liệu không hợp lệ')\n        setLoading(false)\n        return\n      }\n\n      const generatedPassword = generateStrongPassword()\n      const passwordValidation = validatePassword(generatedPassword)\n\n      if (!passwordValidation.isValid) {\n        setError(`Lỗi mật khẩu: ${passwordValidation.error}`)\n        setLoading(false)\n        return\n      }\n\n      const payload = {\n        role: activeRole,\n        code: generatedCode,\n        password: generatedPassword,\n        sendPassword: true,\n        forcePasswordChange: true,\n        ...formData,\n      }\n\n      console.log('[AddUserModal] Creating user:', payload)\n\n      await new Promise(resolve => setTimeout(resolve, 1000))\n\n      onSuccess?.()\n      handleClose()\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : 'Không thể tạo người dùng'\n      setError(errorMessage)\n      console.error('[AddUserModal] Failed to create user:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const gradeOptions = ['6', '7', '8', '9'].map((g: any) => ({ value: g, label: `Khối ${g}` }))\n  const classOptions = ['6A', '6B', '7A', '7B', '8A', '8B', '9A', '9B'].map((c: any) => ({ value: c, label: `Lớp ${c}` }))\n  const subjectOptions = ['Toán', 'Ngữ văn', 'Tiếng Anh', 'Vật lý', 'Hóa học', 'Sinh học', 'Lịch sử', 'Địa lý', 'GDCD', 'Tin học', 'Thể dục', 'Nghệ thuật', 'Công nghệ'].map((s: any) => ({ value: s, label: s }))\n\n  // Role radio cards config with shadow colors\n  const roleCards: { key: UserRole; label: string; icon: React.ReactNode; shadowClass: string; bgClass: string; borderClass: string }[] = [\n    {\n      key: 'student',\n      label: 'Học sinh',\n      icon: <StudentIcon />,\n      shadowClass: 'shadow-blue-200',\n      bgClass: 'bg-blue-100 text-blue-600',\n      borderClass: 'peer-checked:border-blue-500 peer-checked:shadow-lg peer-checked:shadow-blue-200 peer-checked:bg-blue-50',\n    },\n    {\n      key: 'teacher',\n      label: 'Giáo viên',\n      icon: <TeacherIcon />,\n      shadowClass: 'shadow-purple-200',\n      bgClass: 'bg-purple-100 text-purple-600',\n      borderClass: 'peer-checked:border-purple-500 peer-checked:shadow-lg peer-checked:shadow-purple-200 peer-checked:bg-purple-50',\n    },\n    {\n      key: 'parent',\n      label: 'Phụ huynh',\n      icon: <ParentIcon />,\n      shadowClass: 'shadow-teal-200',\n      bgClass: 'bg-teal-100 text-teal-600',\n      borderClass: 'peer-checked:border-teal-500 peer-checked:shadow-lg peer-checked:shadow-teal-200 peer-checked:bg-teal-50',\n    },\n  ]\n\n  if (!isOpen) return null\n\n  return (\n    <>\n      {/* Modal Overlay */}\n      <div\n        className=\"fixed inset-0 z-50 bg-slate-900/60 backdrop-blur-sm\"\n        onClick={handleClose}\n      />\n\n      {/* Slide-in Modal */}\n      <div className=\"fixed right-0 top-0 z-50 h-full w-full max-w-2xl bg-white shadow-2xl overflow-y-auto animate-slide-in\">\n        {/* Modal Header */}\n        <div className=\"sticky top-0 bg-white border-b border-slate-200 px-8 py-6 flex items-center justify-between z-10\">\n          <div>\n            <h3 className=\"text-xl font-black text-slate-800\">Thêm người dùng mới</h3>\n            <p className=\"text-slate-400 text-xs font-medium uppercase tracking-widest mt-1\">\n              Nhập thông tin tài khoản\n            </p>\n          </div>\n          <button\n            onClick={handleClose}\n            className=\"p-2 hover:bg-slate-100 rounded-xl transition-all\"\n          >\n            <X className=\"h-6 w-6 text-slate-400\" />\n          </button>\n        </div>\n\n        {/* Modal Body */}\n        <form onSubmit={(e) => { e.preventDefault(); handleSubmit(); }} className=\"p-8 space-y-6\">\n          {/* Error Display */}\n          {error && (\n            <div className=\"p-3 bg-red-50 border border-red-200 rounded-lg\">\n              <p className=\"text-sm text-red-700\">{error}</p>\n            </div>\n          )}\n\n          {/* Step Indicator */}\n          <div className=\"flex items-center gap-3 mb-6\">\n            <div className=\"flex-1 h-1 bg-blue-500 rounded-full\"></div>\n            <div className=\"flex-1 h-1 bg-slate-200 rounded-full\" id=\"stepIndicator2\"></div>\n            <div className=\"flex-1 h-1 bg-slate-200 rounded-full\" id=\"stepIndicator3\"></div>\n          </div>\n\n          {/* Role Selection (Step 1) */}\n          <div>\n            <label className=\"block text-sm font-black text-slate-700 mb-3 uppercase tracking-wider\">\n              Bước 1: Chọn vai trò\n            </label>\n            <div className=\"grid grid-cols-3 gap-3\">\n              {roleCards.map((card) => (\n                <label key={card.key} className=\"cursor-pointer\">\n                  <input\n                    type=\"radio\"\n                    name=\"role\"\n                    value={card.key}\n                    checked={activeRole === card.key}\n                    onChange={(e) => setActiveRole(e.target.value as UserRole)}\n                    className=\"sr-only peer\"\n                  />\n                  <div className={cn(\n                    'p-4 border-2 border-slate-200 rounded-xl text-center transition-all hover:border-slate-300',\n                    card.borderClass\n                  )}>\n                    <div className={cn(\n                      'w-10 h-10 rounded-full flex items-center justify-center mx-auto mb-2',\n                      card.bgClass\n                    )}>\n                      {card.icon}\n                    </div>\n                    <p className=\"text-xs font-bold text-slate-700\">{card.label}</p>\n                  </div>\n                </label>\n              ))}\n            </div>\n          </div>\n\n          {/* Auto-generated Code Display */}\n          <div className=\"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-xl p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-xs font-black text-blue-600 uppercase tracking-wider mb-1\">\n                  Mã định danh (Tự sinh)\n                </p>\n                <p className=\"text-sm font-bold text-slate-700\">{generatedCode}</p>\n              </div>\n              <div className=\"w-10 h-10 bg-blue-100 text-blue-600 rounded-lg flex items-center justify-center\">\n                <Edit3 className=\"h-5 w-5\" />\n              </div>\n            </div>\n            <p className=\"text-[10px] text-slate-500 mt-2\">\n              Quy tắc: [Tiền tố vai trò] + [Năm hiện tại] + [Số thứ tự tự tăng]\n            </p>\n          </div>\n\n          {/* Student Form */}\n          {activeRole === 'student' && (\n            <div className=\"space-y-6 border-t border-slate-200 pt-6\">\n              <h4 className=\"text-sm font-black text-slate-700 uppercase tracking-wider\">\n                Thông tin học sinh\n              </h4>\n\n              <div className=\"grid grid-cols-2 gap-6\">\n                <div>\n                  <label className=\"block text-sm font-black text-slate-700 mb-2\">\n                    Họ và tên <span className=\"text-red-500\">*</span>\n                  </label>\n                  <input\n                    {...studentForm.register('name', { required: 'Vui lòng nhập họ tên' })}\n                    placeholder=\"Nguyễn Văn A\"\n                    className=\"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm font-medium focus:ring-2 focus:ring-blue-100 outline-none\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-black text-slate-700 mb-2\">\n                    Ngày sinh <span className=\"text-red-500\">*</span>\n                  </label>\n                  <input\n                    type=\"date\"\n                    {...studentForm.register('dob', { required: 'Vui lòng nhập ngày sinh' })}\n                    className=\"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm font-medium focus:ring-2 focus:ring-blue-100 outline-none\"\n                  />\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-black text-slate-700 mb-2\">Giới tính</label>\n                <div className=\"flex gap-3\">\n                  <label className=\"flex items-center gap-2 cursor-pointer\">\n                    <input\n                      type=\"radio\"\n                      {...studentForm.register('gender')}\n                      value=\"male\"\n                      className=\"w-4 h-4 text-blue-600\"\n                    />\n                    <span className=\"text-sm font-medium text-slate-700\">Nam</span>\n                  </label>\n                  <label className=\"flex items-center gap-2 cursor-pointer\">\n                    <input\n                      type=\"radio\"\n                      {...studentForm.register('gender')}\n                      value=\"female\"\n                      className=\"w-4 h-4 text-blue-600\"\n                    />\n                    <span className=\"text-sm font-medium text-slate-700\">Nữ</span>\n                  </label>\n                  <label className=\"flex items-center gap-2 cursor-pointer\">\n                    <input\n                      type=\"radio\"\n                      {...studentForm.register('gender')}\n                      value=\"other\"\n                      className=\"w-4 h-4 text-blue-600\"\n                    />\n                    <span className=\"text-sm font-medium text-slate-700\">Khác</span>\n                  </label>\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-6\">\n                <div>\n                  <label className=\"block text-sm font-black text-slate-700 mb-2\">\n                    Khối <span className=\"text-red-500\">*</span>\n                  </label>\n                  <select\n                    {...studentForm.register('grade', { required: 'Vui lòng chọn khối' })}\n                    className=\"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm font-bold focus:ring-2 focus:ring-blue-100 outline-none\"\n                  >\n                    <option value=\"\">Chọn khối</option>\n                    {gradeOptions.map((opt: any) => (\n                      <option key={opt.value} value={opt.value}>{opt.label}</option>\n                    ))}\n                  </select>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-black text-slate-700 mb-2\">\n                    Lớp <span className=\"text-red-500\">*</span>\n                  </label>\n                  <select\n                    {...studentForm.register('classId', { required: 'Vui lòng chọn lớp' })}\n                    className=\"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm font-bold focus:ring-2 focus:ring-blue-100 outline-none\"\n                  >\n                    <option value=\"\">Chọn lớp</option>\n                    {classOptions.map((opt: any) => (\n                      <option key={opt.value} value={opt.value}>{opt.label}</option>\n                    ))}\n                  </select>\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-black text-slate-700 mb-2\">Ngày nhập học</label>\n                <input\n                  type=\"date\"\n                  {...studentForm.register('enrollmentDate')}\n                  className=\"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm font-medium focus:ring-2 focus:ring-blue-100 outline-none\"\n                />\n              </div>\n            </div>\n          )}\n\n          {/* Teacher Form */}\n          {activeRole === 'teacher' && (\n            <div className=\"space-y-6 border-t border-slate-200 pt-6\">\n              <h4 className=\"text-sm font-black text-slate-700 uppercase tracking-wider\">\n                Thông tin giáo viên\n              </h4>\n\n              <div className=\"grid grid-cols-2 gap-6\">\n                <div>\n                  <label className=\"block text-sm font-black text-slate-700 mb-2\">\n                    Họ và tên <span className=\"text-red-500\">*</span>\n                  </label>\n                  <input\n                    {...teacherForm.register('name', { required: 'Vui lòng nhập họ tên' })}\n                    placeholder=\"Nguyễn Thị B\"\n                    className=\"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm font-medium focus:ring-2 focus:ring-blue-100 outline-none\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-black text-slate-700 mb-2\">\n                    Số điện thoại <span className=\"text-red-500\">*</span>\n                  </label>\n                  <input\n                    type=\"tel\"\n                    {...teacherForm.register('phone', { required: 'Vui lòng nhập SĐT' })}\n                    placeholder=\"09xxxxxxxxx\"\n                    className=\"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm font-medium focus:ring-2 focus:ring-blue-100 outline-none\"\n                  />\n                  <p className=\"text-[10px] text-slate-400 mt-1\">Dùng để nhận OTP và liên lạc</p>\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-black text-slate-700 mb-2\">\n                  Email công vụ <span className=\"text-red-500\">*</span>\n                </label>\n                <input\n                  type=\"email\"\n                  {...teacherForm.register('email', { required: 'Vui lòng nhập email' })}\n                  placeholder=\"nguyenthib@school.edu.vn\"\n                  className=\"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm font-medium focus:ring-2 focus:ring-blue-100 outline-none\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-black text-slate-700 mb-2\">\n                  Bộ môn giảng dạy chính <span className=\"text-red-500\">*</span>\n                </label>\n                <select\n                  {...teacherForm.register('subject', { required: 'Vui lòng chọn bộ môn' })}\n                  className=\"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm font-bold focus:ring-2 focus:ring-blue-100 outline-none\"\n                >\n                  <option value=\"\">Chọn bộ môn</option>\n                  {subjectOptions.map((opt: any) => (\n                    <option key={opt.value} value={opt.value}>{opt.label}</option>\n                  ))}\n                </select>\n              </div>\n            </div>\n          )}\n\n          {/* Parent Form */}\n          {activeRole === 'parent' && (\n            <div className=\"space-y-6 border-t border-slate-200 pt-6\">\n              <h4 className=\"text-sm font-black text-slate-700 uppercase tracking-wider\">\n                Thông tin phụ huynh\n              </h4>\n\n              <div className=\"grid grid-cols-2 gap-6\">\n                <div>\n                  <label className=\"block text-sm font-black text-slate-700 mb-2\">\n                    Họ và tên <span className=\"text-red-500\">*</span>\n                  </label>\n                  <input\n                    {...parentForm.register('name', { required: 'Vui lòng nhập họ tên' })}\n                    placeholder=\"Nguyễn Văn C\"\n                    className=\"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm font-medium focus:ring-2 focus:ring-blue-100 outline-none\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-black text-slate-700 mb-2\">\n                    Số điện thoại <span className=\"text-red-500\">*</span>\n                  </label>\n                  <input\n                    type=\"tel\"\n                    {...parentForm.register('phone', { required: 'Vui lòng nhập SĐT' })}\n                    placeholder=\"09xxxxxxxxx\"\n                    className=\"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm font-medium focus:ring-2 focus:ring-blue-100 outline-none\"\n                  />\n                  <p className=\"text-[10px] text-slate-400 mt-1\">⚠️ SĐT là tên đăng nhập chính</p>\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-black text-slate-700 mb-2\">Email</label>\n                <input\n                  type=\"email\"\n                  {...parentForm.register('email')}\n                  placeholder=\"email@example.com\"\n                  className=\"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm font-medium focus:ring-2 focus:ring-blue-100 outline-none\"\n                />\n                <p className=\"text-[10px] text-slate-400 mt-1\">Nhận biên lai học phí điện tử</p>\n              </div>\n            </div>\n          )}\n\n          {/* Account Settings */}\n          <div className=\"border-t border-slate-200 pt-6\">\n            <h4 className=\"text-sm font-black text-slate-700 mb-4 uppercase tracking-wider\">\n              Cài đặt tài khoản\n            </h4>\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center justify-between p-4 bg-slate-50 rounded-xl\">\n                <div>\n                  <p className=\"text-sm font-bold text-slate-800\">Gửi mật khẩu qua SMS/Email</p>\n                  <p className=\"text-xs text-slate-400\">Tự động gửi thông tin đăng nhập</p>\n                </div>\n                <label className=\"relative inline-flex items-center cursor-pointer\">\n                  <input\n                    type=\"checkbox\"\n                    {...(activeRole === 'student' ? studentForm.register('sendPassword') : activeRole === 'teacher' ? teacherForm.register('sendPassword') : parentForm.register('sendPassword'))}\n                    className=\"sr-only peer\"\n                    defaultChecked\n                  />\n                  <div className=\"w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-100 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#0284C7]\"></div>\n                </label>\n              </div>\n              <div className=\"flex items-center justify-between p-4 bg-slate-50 rounded-xl\">\n                <div>\n                  <p className=\"text-sm font-bold text-slate-800\">Yêu cầu đổi mật khẩu lần đầu</p>\n                  <p className=\"text-xs text-slate-400\">Bắt buộc đổi mật khẩu khi đăng nhập</p>\n                </div>\n                <label className=\"relative inline-flex items-center cursor-pointer\">\n                  <input\n                    type=\"checkbox\"\n                    {...(activeRole === 'student' ? studentForm.register('forcePasswordChange') : activeRole === 'teacher' ? teacherForm.register('forcePasswordChange') : parentForm.register('forcePasswordChange'))}\n                    className=\"sr-only peer\"\n                    defaultChecked\n                  />\n                  <div className=\"w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-100 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#0284C7]\"></div>\n                </label>\n              </div>\n            </div>\n          </div>\n\n          {/* Actions */}\n          <div className=\"flex gap-3 pt-4 border-t border-slate-200\">\n            <button\n              type=\"button\"\n              onClick={handleClose}\n              className=\"flex-1 px-6 py-3 bg-white border border-slate-200 rounded-xl font-bold text-sm text-slate-700 hover:bg-slate-50 transition-all\"\n            >\n              Hủy bỏ\n            </button>\n            <button\n              type=\"submit\"\n              disabled={loading}\n              className=\"flex-1 px-6 py-3 bg-[#0284C7] text-white rounded-xl font-bold text-sm hover:bg-[#0369a1] disabled:bg-slate-300 disabled:cursor-not-allowed transition-all\"\n            >\n              {loading ? 'Đang lưu...' : 'Lưu người dùng'}\n            </button>\n          </div>\n        </form>\n      </div>\n\n      {/* Add slide-in animation to global styles */}\n      <style jsx global>{`\n        @keyframes slideIn {\n          from {\n            transform: translateX(100%);\n          }\n          to {\n            transform: translateX(0);\n          }\n        }\n        .animate-slide-in {\n          animation: slideIn 0.3s ease-out;\n        }\n      `}</style>\n    </>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\users\\modals\\ImportExcelModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Download' is defined but never used.","line":4,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ValidationResult' is defined but never used.","line":14,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":27},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":89,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":89,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2416,2487],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":121,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":121,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3395,3476],"text":""},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useRef, useCallback } from 'react'\nimport { Upload, Download, FileSpreadsheet, X, CheckCircle2 } from 'lucide-react'\nimport { cn } from '@/lib/utils'\n\ninterface ImportExcelModalProps {\n  isOpen: boolean\n  onClose: () => void\n  onSuccess?: () => void\n  importType?: 'students' | 'teachers' | 'parents'\n}\n\ninterface ValidationResult {\n  row: number\n  errors: string[]\n}\n\nexport function ImportExcelModal({ isOpen, onClose, onSuccess, importType = 'students' }: ImportExcelModalProps) {\n  const [file, setFile] = useState<File | null>(null)\n  const [dragActive, setDragActive] = useState(false)\n  const [uploading, setUploading] = useState(false)\n  const [progress, setProgress] = useState(0)\n  const [importSuccess, setImportSuccess] = useState(false)\n  const fileInputRef = useRef<HTMLInputElement>(null)\n\n  const typeLabels = {\n    students: 'học sinh',\n    teachers: 'giáo viên',\n    parents: 'phụ huynh',\n  }\n\n  const handleDrag = useCallback((e: React.DragEvent) => {\n    e.preventDefault()\n    e.stopPropagation()\n    if (e.type === 'dragenter' || e.type === 'dragover') {\n      setDragActive(true)\n    } else if (e.type === 'dragleave') {\n      setDragActive(false)\n    }\n  }, [])\n\n  const handleDrop = useCallback((e: React.DragEvent) => {\n    e.preventDefault()\n    e.stopPropagation()\n    setDragActive(false)\n\n    const files = e.dataTransfer.files\n    if (files && files[0]) {\n      handleFile(files[0])\n    }\n  }, [])\n\n  const handleFileInput = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = e.target.files\n    if (files && files[0]) {\n      handleFile(files[0])\n    }\n  }\n\n  const handleFile = (selectedFile: File) => {\n    const validTypes = [\n      'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n      'application/vnd.ms-excel',\n    ]\n    const validExtensions = ['.xlsx', '.xls']\n\n    const fileExtension = '.' + selectedFile.name.split('.').pop()?.toLowerCase()\n\n    if (!validTypes.includes(selectedFile.type) && !validExtensions.includes(fileExtension)) {\n      alert('Vui lòng chọn file Excel (.xlsx hoặc .xls)')\n      return\n    }\n\n    setFile(selectedFile)\n    setImportSuccess(false)\n  }\n\n  const handleRemoveFile = () => {\n    setFile(null)\n    setImportSuccess(false)\n    setProgress(0)\n    if (fileInputRef.current) {\n      fileInputRef.current.value = ''\n    }\n  }\n\n  const handleDownloadTemplate = async () => {\n    console.log('[ImportExcelModal] Downloading template for:', importType)\n\n    const headers = importType === 'students'\n      ? 'Họ và tên,Ngày sinh,Giới tính,Khối,Lớp,Ngày nhập học\\n'\n      : importType === 'teachers'\n      ? 'Họ và tên,Số điện thoại,Email,Chuyên môn\\n'\n      : 'Họ và tên,Số điện thoại,Email\\n'\n\n    const blob = new Blob([headers], { type: 'text/csv;charset=utf-8;' })\n    const url = URL.createObjectURL(blob)\n    const link = document.createElement('a')\n    link.href = url\n    link.download = `template_${importType}_${new Date().getTime()}.csv`\n    document.body.appendChild(link)\n    link.click()\n    document.body.removeChild(link)\n    URL.revokeObjectURL(url)\n  }\n\n  const handleImport = async () => {\n    if (!file) return\n\n    setUploading(true)\n    setProgress(0)\n\n    try {\n      const totalSteps = 100\n      for (let i = 0; i <= totalSteps; i++) {\n        await new Promise(resolve => setTimeout(resolve, 30))\n        setProgress(i)\n      }\n\n      console.log('[ImportExcelModal] Importing file:', file.name, 'Type:', importType)\n\n      setImportSuccess(true)\n      setTimeout(() => {\n        onSuccess?.()\n        handleClose()\n      }, 2000)\n    } catch (error) {\n      console.error('[ImportExcelModal] Import failed:', error)\n      alert('Nhập dữ liệu thất bại. Vui lòng thử lại.')\n    } finally {\n      setUploading(false)\n    }\n  }\n\n  const handleClose = () => {\n    handleRemoveFile()\n    onClose()\n  }\n\n  if (!isOpen) return null\n\n  return (\n    <>\n      {/* Modal Overlay */}\n      <div\n        className=\"fixed inset-0 z-50 bg-slate-900/60 backdrop-blur-sm\"\n        onClick={handleClose}\n      />\n\n      {/* Modal */}\n      <div className=\"fixed inset-0 z-50 flex items-center justify-center p-8\">\n        <div className=\"bg-white rounded-3xl shadow-2xl max-w-lg w-full p-8\">\n          <div className=\"flex items-center justify-between mb-6\">\n            <h3 className=\"text-xl font-black text-slate-800\">Nhập danh sách từ Excel</h3>\n            <button\n              onClick={handleClose}\n              className=\"p-2 hover:bg-slate-100 rounded-xl\"\n            >\n              <X className=\"h-5 w-5 text-slate-400\" />\n            </button>\n          </div>\n\n          <div className=\"space-y-6\">\n            {/* File Upload Area */}\n            {!file && !importSuccess && (\n              <div\n                onDragEnter={handleDrag}\n                onDragLeave={handleDrag}\n                onDragOver={handleDrag}\n                onDrop={handleDrop}\n                onClick={() => fileInputRef.current?.click()}\n                className={cn(\n                  'border-2 border-dashed rounded-2xl p-8 text-center transition-all cursor-pointer',\n                  dragActive\n                    ? 'border-blue-400 bg-blue-50'\n                    : 'border-slate-200 hover:border-blue-400'\n                )}\n              >\n                <div className=\"w-16 h-16 bg-blue-50 text-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-4\">\n                  <Upload className=\"h-8 w-8\" />\n                </div>\n                <p className=\"text-sm font-bold text-slate-700 mb-2\">\n                  Kéo thả file Excel vào đây\n                </p>\n                <p className=\"text-xs text-slate-400 mb-4\">hoặc nhấn để chọn file</p>\n                <input\n                  ref={fileInputRef}\n                  type=\"file\"\n                  accept=\".xlsx,.xls\"\n                  onChange={handleFileInput}\n                  className=\"hidden\"\n                />\n                <button\n                  type=\"button\"\n                  onClick={(e) => {\n                    e.stopPropagation()\n                    fileInputRef.current?.click()\n                  }}\n                  className=\"px-6 py-2 bg-[#0284C7] text-white rounded-xl font-bold text-sm hover:bg-[#0369a1]\"\n                >\n                  Chọn file\n                </button>\n              </div>\n            )}\n\n            {/* Selected File */}\n            {file && !importSuccess && (\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center gap-3 p-4 bg-slate-50 rounded-xl\">\n                  <FileSpreadsheet className=\"h-10 w-10 text-green-600\" />\n                  <div className=\"flex-1 min-w-0\">\n                    <p className=\"text-sm font-bold text-slate-900 truncate\">{file.name}</p>\n                    <p className=\"text-xs text-slate-500\">{(file.size / 1024).toFixed(2)} KB</p>\n                  </div>\n                  <button\n                    onClick={handleRemoveFile}\n                    className=\"rounded-lg p-2 text-slate-400 hover:bg-red-50 hover:text-red-600 transition-colors\"\n                  >\n                    <X className=\"h-5 w-5\" />\n                  </button>\n                </div>\n\n                {/* Progress Bar */}\n                {uploading && (\n                  <div className=\"space-y-2\">\n                    <div className=\"flex items-center justify-between text-xs text-slate-600\">\n                      <span>Đang xử lý file...</span>\n                      <span className=\"font-bold\">{progress}%</span>\n                    </div>\n                    <div className=\"h-2 overflow-hidden rounded-full bg-slate-200\">\n                      <div\n                        className=\"h-full bg-[#0284C7] transition-all duration-300\"\n                        style={{ width: `${progress}%` }}\n                      />\n                    </div>\n                  </div>\n                )}\n              </div>\n            )}\n\n            {/* Template Download */}\n            {!file && !importSuccess && (\n              <div className=\"flex items-center justify-between p-4 bg-slate-50 rounded-xl\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"w-10 h-10 bg-green-100 text-green-600 rounded-lg flex items-center justify-center\">\n                    <FileSpreadsheet className=\"h-5 w-5\" />\n                  </div>\n                  <div>\n                    <p className=\"text-sm font-bold text-slate-800\">Tải mẫu file Excel</p>\n                    <p className=\"text-xs text-slate-400\">Template với định dạng chuẩn</p>\n                  </div>\n                </div>\n                <button\n                  onClick={handleDownloadTemplate}\n                  className=\"px-4 py-2 text-[#0284C7] font-bold text-sm hover:bg-blue-50 rounded-xl\"\n                >\n                  Tải xuống\n                </button>\n              </div>\n            )}\n\n            {/* Success State */}\n            {importSuccess && (\n              <div className=\"rounded-2xl bg-green-50 border border-green-200 p-6 text-center\">\n                <CheckCircle2 className=\"mx-auto h-16 w-16 text-green-600 mb-4\" />\n                <p className=\"text-lg font-bold text-green-900\">Nhập dữ liệu thành công!</p>\n                <p className=\"text-sm text-green-700 mt-2\">\n                  Danh sách {typeLabels[importType]} đã được cập nhật.\n                </p>\n              </div>\n            )}\n          </div>\n\n          {/* Actions */}\n          <div className=\"flex gap-3 pt-6 mt-6 border-t border-slate-200\">\n            <button\n              onClick={handleClose}\n              className=\"flex-1 px-6 py-3 bg-white border border-slate-200 rounded-xl font-bold text-sm text-slate-700 hover:bg-slate-50\"\n            >\n              {importSuccess ? 'Đóng' : 'Hủy bỏ'}\n            </button>\n            {!importSuccess && (\n              <button\n                onClick={handleImport}\n                disabled={!file || uploading}\n                className=\"flex-1 px-6 py-3 bg-[#0284C7] text-white rounded-xl font-bold text-sm hover:bg-[#0369a1] disabled:bg-slate-300 disabled:cursor-not-allowed\"\n              >\n                {uploading ? `Đang nhập ${progress}%` : 'Nhập dữ liệu'}\n              </button>\n            )}\n          </div>\n        </div>\n      </div>\n    </>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\users\\modals\\LinkParentModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PrimaryButton' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SecondaryButton' is defined but never used.","line":5,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":40}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { BaseModal } from '@/components/admin/shared/modals/BaseModal'\nimport { PrimaryButton, SecondaryButton } from '@/components/admin/shared'\nimport { Search, UserPlus, Link2, Phone, Mail } from 'lucide-react'\nimport { cn } from '@/lib/utils'\n\ninterface Parent {\n  id: string\n  code: string\n  name: string\n  phone: string\n  email?: string\n}\n\ninterface LinkParentModalProps {\n  isOpen: boolean\n  onClose: () => void\n  onSuccess?: () => void\n  student: {\n    id: string\n    name: string\n    code: string\n  }\n}\n\ntype Relationship = 'father' | 'mother' | 'guardian'\n\nconst relationshipLabels: Record<Relationship, string> = {\n  father: 'Bố',\n  mother: 'Mẹ',\n  guardian: 'Người giám hộ',\n}\n\nexport function LinkParentModal({ isOpen, onClose, onSuccess, student }: LinkParentModalProps) {\n  const [searchQuery, setSearchQuery] = useState('')\n  const [searchResults, setSearchResults] = useState<Parent[]>([])\n  const [selectedParent, setSelectedParent] = useState<Parent | null>(null)\n  const [relationship, setRelationship] = useState<Relationship>('father')\n  const [isPrimary, setIsPrimary] = useState(false)\n  const [loading, setLoading] = useState(false)\n  const [searching, setSearching] = useState(false)\n\n  // Debounced search for parents\n  useEffect(() => {\n    if (!searchQuery || searchQuery.length < 2) {\n      setSearchResults([])\n      return\n    }\n\n    const timer = setTimeout(async () => {\n      setSearching(true)\n      try {\n        const response = await fetch(`/api/student-guardians?search=${encodeURIComponent(searchQuery)}&type=parents`)\n        const result = await response.json()\n\n        if (result.success) {\n          setSearchResults(result.data)\n        } else {\n          console.error('[LinkParentModal] Search failed:', result.error)\n          setSearchResults([])\n        }\n      } catch (error) {\n        console.error('[LinkParentModal] Search failed:', error)\n        setSearchResults([])\n      } finally {\n        setSearching(false)\n      }\n    }, 300)\n\n    return () => clearTimeout(timer)\n  }, [searchQuery])\n\n  const handleLink = async () => {\n    if (!selectedParent) {\n      alert('Vui lòng chọn phụ huynh để liên kết')\n      return\n    }\n\n    setLoading(true)\n\n    try {\n      const response = await fetch('/api/student-guardians', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          studentId: student.id,\n          parentId: selectedParent.id,\n          relationship,\n          isPrimary,\n        }),\n      })\n\n      const result = await response.json()\n\n      if (result.success) {\n        alert(`Đã liên kết ${selectedParent.name} với ${student.name}`)\n        onSuccess?.()\n        handleClose()\n      } else {\n        alert(result.error || 'Liên kết thất bại. Vui lòng thử lại.')\n      }\n    } catch (error) {\n      console.error('[LinkParentModal] Link failed:', error)\n      alert('Liên kết thất bại. Vui lòng thử lại.')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleClose = () => {\n    setSearchQuery('')\n    setSearchResults([])\n    setSelectedParent(null)\n    setRelationship('father')\n    setIsPrimary(false)\n    onClose()\n  }\n\n  return (\n    <BaseModal\n      isOpen={isOpen}\n      onClose={handleClose}\n      title=\"Liên kết phụ huynh\"\n      size=\"lg\"\n      primaryAction={{\n        label: 'Liên kết',\n        onClick: handleLink,\n        disabled: !selectedParent || loading,\n        loading,\n      }}\n      secondaryAction={{\n        label: 'Hủy',\n        onClick: handleClose,\n      }}\n    >\n      <div className=\"space-y-6\">\n        {/* Student Info */}\n        <div className=\"rounded-lg bg-blue-50 border border-blue-200 p-4\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"h-10 w-10 overflow-hidden rounded-full bg-gradient-to-br from-[#0284C7] to-[#0369a1] p-0.5\">\n              <div className=\"flex h-full w-full items-center justify-center rounded-full bg-white text-xs font-bold text-[#0284C7]\">\n                {student.name.split(' ').slice(0, 2).map((n: string) => n[0]).join('')}\n              </div>\n            </div>\n            <div>\n              <p className=\"text-xs font-bold text-blue-800 uppercase tracking-wider\">Học sinh</p>\n              <p className=\"text-sm font-bold text-slate-900\">{student.name}</p>\n              <p className=\"text-xs text-slate-500\">Mã: {student.code}</p>\n            </div>\n          </div>\n        </div>\n\n        {/* Parent Search */}\n        <div className=\"space-y-3\">\n          <label className=\"text-xs font-bold text-slate-700 uppercase tracking-wider\">\n            Tìm kiếm phụ huynh <span className=\"text-red-500\">*</span>\n          </label>\n          <div className=\"relative\">\n            <Search className=\"absolute left-4 top-1/2 h-4 w-4 -translate-y-1/2 text-slate-400\" />\n            <input\n              type=\"text\"\n              value={searchQuery}\n              onChange={e => setSearchQuery(e.target.value)}\n              placeholder=\"Tìm theo tên, số điện thoại, mã phụ huynh...\"\n              className={cn(\n                'w-full rounded-lg border border-slate-300 py-3 pl-12 pr-4 text-sm',\n                'focus:outline-none focus:ring-2 focus:ring-[#0284C7]',\n                searching && 'animate-pulse'\n              )}\n            />\n          </div>\n\n          {/* Search Results */}\n          {searchResults.length > 0 && (\n            <div className=\"rounded-lg border border-slate-200 overflow-hidden max-h-48 overflow-y-auto\">\n              {searchResults.map(parent => (\n                <button\n                  key={parent.id}\n                  onClick={() => setSelectedParent(parent)}\n                  className={cn(\n                    'w-full flex items-center gap-3 p-3 text-left transition-colors border-b border-slate-100 last:border-b-0',\n                    selectedParent?.id === parent.id\n                      ? 'bg-blue-50 border-l-4 border-l-[#0284C7]'\n                      : 'bg-white hover:bg-slate-50'\n                  )}\n                >\n                  <div className=\"h-8 w-8 overflow-hidden rounded-full bg-gradient-to-br from-green-500 to-green-600 p-0.5\">\n                    <div className=\"flex h-full w-full items-center justify-center rounded-full bg-white text-xs font-bold text-green-600\">\n                      {parent.name.split(' ').slice(0, 2).map((n: string) => n[0]).join('')}\n                    </div>\n                  </div>\n                  <div className=\"flex-1 min-w-0\">\n                    <p className=\"text-sm font-bold text-slate-900 truncate\">{parent.name}</p>\n                    <div className=\"flex items-center gap-2 text-xs text-slate-500\">\n                      <span className=\"font-mono\">{parent.code}</span>\n                      <span>•</span>\n                      <span className=\"flex items-center gap-1\">\n                        <Phone className=\"h-3 w-3\" />\n                        {parent.phone}\n                      </span>\n                    </div>\n                  </div>\n                  {selectedParent?.id === parent.id && (\n                    <UserPlus className=\"h-5 w-5 text-[#0284C7]\" />\n                  )}\n                </button>\n              ))}\n            </div>\n          )}\n\n          {searchQuery && searchResults.length === 0 && !searching && (\n            <div className=\"rounded-lg bg-slate-50 border border-slate-200 p-4 text-center\">\n              <p className=\"text-sm text-slate-500\">Không tìm thấy phụ huynh nào</p>\n              <p className=\"text-xs text-slate-400 mt-1\">Thử tìm kiếm với từ khóa khác</p>\n            </div>\n          )}\n        </div>\n\n        {/* Relationship Selection */}\n        {selectedParent && (\n          <div className=\"space-y-4 pt-4 border-t border-slate-200\">\n            <div className=\"rounded-lg bg-green-50 border border-green-200 p-4\">\n              <div className=\"flex items-center gap-3 mb-3\">\n                <Link2 className=\"h-5 w-5 text-green-600\" />\n                <p className=\"text-sm font-bold text-green-800\">Phụ huynh đã chọn</p>\n              </div>\n              <div className=\"flex items-center gap-4\">\n                <div className=\"h-12 w-12 overflow-hidden rounded-full bg-gradient-to-br from-green-500 to-green-600 p-0.5\">\n                  <div className=\"flex h-full w-full items-center justify-center rounded-full bg-white text-sm font-bold text-green-600\">\n                    {selectedParent.name.split(' ').slice(0, 2).map((n: string) => n[0]).join('')}\n                  </div>\n                </div>\n                <div>\n                  <p className=\"text-base font-bold text-slate-900\">{selectedParent.name}</p>\n                  <div className=\"flex items-center gap-3 text-xs text-slate-500\">\n                    <span className=\"font-mono\">{selectedParent.code}</span>\n                    <span className=\"flex items-center gap-1\">\n                      <Phone className=\"h-3 w-3\" />\n                      {selectedParent.phone}\n                    </span>\n                    {selectedParent.email && (\n                      <span className=\"flex items-center gap-1\">\n                        <Mail className=\"h-3 w-3\" />\n                        {selectedParent.email}\n                      </span>\n                    )}\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-1 gap-4 sm:grid-cols-2\">\n              <div className=\"space-y-2\">\n                <label className=\"text-xs font-bold text-slate-700 uppercase tracking-wider\">\n                  Mối quan hệ <span className=\"text-red-500\">*</span>\n                </label>\n                <div className=\"flex flex-wrap gap-2\">\n                  {(Object.keys(relationshipLabels) as Relationship[]).map(rel => (\n                    <button\n                      key={rel}\n                      onClick={() => setRelationship(rel)}\n                      className={cn(\n                        'px-4 py-2 rounded-lg text-sm font-bold transition-all',\n                        relationship === rel\n                          ? 'bg-[#0284C7] text-white shadow-md'\n                          : 'bg-slate-100 text-slate-700 hover:bg-slate-200'\n                      )}\n                    >\n                      {relationshipLabels[rel]}\n                    </button>\n                  ))}\n                </div>\n              </div>\n\n              <div className=\"space-y-2\">\n                <label className=\"flex items-center gap-2 cursor-pointer\">\n                  <input\n                    type=\"checkbox\"\n                    checked={isPrimary}\n                    onChange={e => setIsPrimary(e.target.checked)}\n                    className=\"h-4 w-4 rounded border-slate-300 text-[#0284C7] focus:ring-[#0284C7]\"\n                  />\n                  <span className=\"text-sm text-slate-700\">Đặt làm liên hệ chính</span>\n                </label>\n                <p className=\"text-xs text-slate-500\">\n                  Thông báo sẽ được gửi优先 đến liên hệ chính\n                </p>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n    </BaseModal>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\users\\modals\\LinkStudentModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Phone' is defined but never used.","line":5,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":40},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Mail' is defined but never used.","line":5,"column":42,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":46}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { BaseModal } from '@/components/admin/shared/modals/BaseModal'\nimport { Search, UserPlus, Link2, Phone, Mail, GraduationCap } from 'lucide-react'\nimport { cn } from '@/lib/utils'\n\ninterface Student {\n  id: string\n  code: string\n  name: string\n  classId?: string\n  grade?: string\n}\n\ninterface LinkStudentModalProps {\n  isOpen: boolean\n  onClose: () => void\n  onSuccess?: () => void\n  parent: {\n    id: string\n    name: string\n    code: string\n  }\n}\n\ntype Relationship = 'father' | 'mother' | 'guardian'\n\nconst relationshipLabels: Record<Relationship, string> = {\n  father: 'Bố',\n  mother: 'Mẹ',\n  guardian: 'Người giám hộ',\n}\n\nexport function LinkStudentModal({ isOpen, onClose, onSuccess, parent }: LinkStudentModalProps) {\n  const [searchQuery, setSearchQuery] = useState('')\n  const [searchResults, setSearchResults] = useState<Student[]>([])\n  const [selectedStudent, setSelectedStudent] = useState<Student | null>(null)\n  const [relationship, setRelationship] = useState<Relationship>('father')\n  const [isPrimary, setIsPrimary] = useState(false)\n  const [loading, setLoading] = useState(false)\n  const [searching, setSearching] = useState(false)\n\n  // Debounced search for students\n  useEffect(() => {\n    if (!searchQuery || searchQuery.length < 2) {\n      setSearchResults([])\n      return\n    }\n\n    const timer = setTimeout(async () => {\n      setSearching(true)\n      try {\n        const response = await fetch(`/api/student-guardians?search=${encodeURIComponent(searchQuery)}&type=students`)\n        const result = await response.json()\n\n        if (result.success) {\n          setSearchResults(result.data)\n        } else {\n          console.error('[LinkStudentModal] Search failed:', result.error)\n          setSearchResults([])\n        }\n      } catch (error) {\n        console.error('[LinkStudentModal] Search failed:', error)\n        setSearchResults([])\n      } finally {\n        setSearching(false)\n      }\n    }, 300)\n\n    return () => clearTimeout(timer)\n  }, [searchQuery])\n\n  const handleLink = async () => {\n    if (!selectedStudent) {\n      alert('Vui lòng chọn học sinh để liên kết')\n      return\n    }\n\n    setLoading(true)\n\n    try {\n      const response = await fetch('/api/student-guardians', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          studentId: selectedStudent.id,\n          parentId: parent.id,\n          relationship,\n          isPrimary,\n        }),\n      })\n\n      const result = await response.json()\n\n      if (result.success) {\n        alert(`Đã liên kết ${parent.name} với ${selectedStudent.name}`)\n        onSuccess?.()\n        handleClose()\n      } else {\n        alert(result.error || 'Liên kết thất bại. Vui lòng thử lại.')\n      }\n    } catch (error) {\n      console.error('[LinkStudentModal] Link failed:', error)\n      alert('Liên kết thất bại. Vui lòng thử lại.')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleClose = () => {\n    setSearchQuery('')\n    setSearchResults([])\n    setSelectedStudent(null)\n    setRelationship('father')\n    setIsPrimary(false)\n    onClose()\n  }\n\n  return (\n    <BaseModal\n      isOpen={isOpen}\n      onClose={handleClose}\n      title=\"Liên kết học sinh\"\n      size=\"lg\"\n      primaryAction={{\n        label: 'Liên kết',\n        onClick: handleLink,\n        disabled: !selectedStudent || loading,\n        loading,\n      }}\n      secondaryAction={{\n        label: 'Hủy',\n        onClick: handleClose,\n      }}\n    >\n      <div className=\"space-y-6\">\n        {/* Parent Info */}\n        <div className=\"rounded-lg bg-teal-50 border border-teal-200 p-4\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"h-10 w-10 overflow-hidden rounded-full bg-gradient-to-br from-teal-500 to-teal-600 p-0.5\">\n              <div className=\"flex h-full w-full items-center justify-center rounded-full bg-white text-xs font-bold text-teal-600\">\n                {parent.name.split(' ').slice(0, 2).map((n: string) => n[0]).join('')}\n              </div>\n            </div>\n            <div>\n              <p className=\"text-xs font-bold text-teal-800 uppercase tracking-wider\">Phụ huynh</p>\n              <p className=\"text-sm font-bold text-slate-900\">{parent.name}</p>\n              <p className=\"text-xs text-slate-500\">Mã: {parent.code}</p>\n            </div>\n          </div>\n        </div>\n\n        {/* Student Search */}\n        <div className=\"space-y-3\">\n          <label className=\"text-xs font-bold text-slate-700 uppercase tracking-wider\">\n            Tìm kiếm học sinh <span className=\"text-red-500\">*</span>\n          </label>\n          <div className=\"relative\">\n            <Search className=\"absolute left-4 top-1/2 h-4 w-4 -translate-y-1/2 text-slate-400\" />\n            <input\n              type=\"text\"\n              value={searchQuery}\n              onChange={e => setSearchQuery(e.target.value)}\n              placeholder=\"Tìm theo tên, mã học sinh, lớp...\"\n              className={cn(\n                'w-full rounded-lg border border-slate-300 py-3 pl-12 pr-4 text-sm',\n                'focus:outline-none focus:ring-2 focus:ring-[#0284C7]',\n                searching && 'animate-pulse'\n              )}\n            />\n          </div>\n\n          {/* Search Results */}\n          {searchResults.length > 0 && (\n            <div className=\"rounded-lg border border-slate-200 overflow-hidden max-h-48 overflow-y-auto\">\n              {searchResults.map(student => (\n                <button\n                  key={student.id}\n                  onClick={() => setSelectedStudent(student)}\n                  className={cn(\n                    'w-full flex items-center gap-3 p-3 text-left transition-colors border-b border-slate-100 last:border-b-0',\n                    selectedStudent?.id === student.id\n                      ? 'bg-blue-50 border-l-4 border-l-[#0284C7]'\n                      : 'bg-white hover:bg-slate-50'\n                  )}\n                >\n                  <div className=\"h-8 w-8 overflow-hidden rounded-full bg-gradient-to-br from-orange-500 to-orange-600 p-0.5\">\n                    <div className=\"flex h-full w-full items-center justify-center rounded-full bg-white text-xs font-bold text-orange-600\">\n                      {student.name.split(' ').slice(0, 2).map((n: string) => n[0]).join('')}\n                    </div>\n                  </div>\n                  <div className=\"flex-1 min-w-0\">\n                    <p className=\"text-sm font-bold text-slate-900 truncate\">{student.name}</p>\n                    <div className=\"flex items-center gap-2 text-xs text-slate-500\">\n                      <span className=\"font-mono\">{student.code}</span>\n                      {student.classId && (\n                        <>\n                          <span>•</span>\n                          <span className=\"flex items-center gap-1\">\n                            <GraduationCap className=\"h-3 w-3\" />\n                            Lớp {student.classId}\n                          </span>\n                        </>\n                      )}\n                    </div>\n                  </div>\n                  {selectedStudent?.id === student.id && (\n                    <UserPlus className=\"h-5 w-5 text-[#0284C7]\" />\n                  )}\n                </button>\n              ))}\n            </div>\n          )}\n\n          {searchQuery && searchResults.length === 0 && !searching && (\n            <div className=\"rounded-lg bg-slate-50 border border-slate-200 p-4 text-center\">\n              <p className=\"text-sm text-slate-500\">Không tìm thấy học sinh nào</p>\n              <p className=\"text-xs text-slate-400 mt-1\">Thử tìm kiếm với từ khóa khác</p>\n            </div>\n          )}\n        </div>\n\n        {/* Relationship Selection */}\n        {selectedStudent && (\n          <div className=\"space-y-4 pt-4 border-t border-slate-200\">\n            <div className=\"rounded-lg bg-orange-50 border border-orange-200 p-4\">\n              <div className=\"flex items-center gap-3 mb-3\">\n                <Link2 className=\"h-5 w-5 text-orange-600\" />\n                <p className=\"text-sm font-bold text-orange-800\">Học sinh đã chọn</p>\n              </div>\n              <div className=\"flex items-center gap-4\">\n                <div className=\"h-12 w-12 overflow-hidden rounded-full bg-gradient-to-br from-orange-500 to-orange-600 p-0.5\">\n                  <div className=\"flex h-full w-full items-center justify-center rounded-full bg-white text-sm font-bold text-orange-600\">\n                    {selectedStudent.name.split(' ').slice(0, 2).map((n: string) => n[0]).join('')}\n                  </div>\n                </div>\n                <div>\n                  <p className=\"text-base font-bold text-slate-900\">{selectedStudent.name}</p>\n                  <div className=\"flex items-center gap-3 text-xs text-slate-500\">\n                    <span className=\"font-mono\">{selectedStudent.code}</span>\n                    {selectedStudent.classId && (\n                      <span className=\"flex items-center gap-1\">\n                        <GraduationCap className=\"h-3 w-3\" />\n                        Lớp {selectedStudent.classId}\n                      </span>\n                    )}\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-1 gap-4 sm:grid-cols-2\">\n              <div className=\"space-y-2\">\n                <label className=\"text-xs font-bold text-slate-700 uppercase tracking-wider\">\n                  Mối quan hệ <span className=\"text-red-500\">*</span>\n                </label>\n                <div className=\"flex flex-wrap gap-2\">\n                  {(Object.keys(relationshipLabels) as Relationship[]).map(rel => (\n                    <button\n                      key={rel}\n                      onClick={() => setRelationship(rel)}\n                      className={cn(\n                        'px-4 py-2 rounded-lg text-sm font-bold transition-all',\n                        relationship === rel\n                          ? 'bg-[#0284C7] text-white shadow-md'\n                          : 'bg-slate-100 text-slate-700 hover:bg-slate-200'\n                      )}\n                    >\n                      {relationshipLabels[rel]}\n                    </button>\n                  ))}\n                </div>\n              </div>\n\n              <div className=\"space-y-2\">\n                <label className=\"flex items-center gap-2 cursor-pointer\">\n                  <input\n                    type=\"checkbox\"\n                    checked={isPrimary}\n                    onChange={e => setIsPrimary(e.target.checked)}\n                    className=\"h-4 w-4 rounded border-slate-300 text-[#0284C7] focus:ring-[#0284C7]\"\n                  />\n                  <span className=\"text-sm text-slate-700\">Đặt làm liên hệ chính</span>\n                </label>\n                <p className=\"text-xs text-slate-500\">\n                  Thông báo sẽ được gửi ưu tiên đến liên hệ chính\n                </p>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n    </BaseModal>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\users\\modals\\UserActionsModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":33,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[873,876],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[873,876],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":64,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":64,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1676,1743],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":86,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":86,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2361,2434],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":131,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":131,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3582,3637],"text":""},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState } from 'react'\nimport { X, Lock, RotateCcw, Edit, Smartphone, Trash2 } from 'lucide-react'\nimport { cn } from '@/lib/utils'\n\ninterface UserActionsModalProps {\n  isOpen: boolean\n  onClose: () => void\n  onSuccess?: () => void\n  onLinkParent?: () => void\n  onLinkStudent?: () => void\n  user: {\n    id: string\n    name: string\n    role: string\n    status: string\n    email?: string\n    phone?: string\n  }\n  currentUser?: {\n    role: string\n  }\n}\n\nexport function UserActionsModal({ isOpen, onClose, onSuccess, onLinkParent, onLinkStudent, user, currentUser }: UserActionsModalProps) {\n  const [loading, setLoading] = useState(false)\n\n  // Permission check: only admins can access sensitive actions\n  const canPerformAction = currentUser?.role === 'admin'\n\n  const getInitials = (name: string) => {\n    return name.split(' ').slice(0, 2).map((n: any) => n[0]).join('').toUpperCase()\n  }\n\n  const getRoleBadgeClass = (role: string) => {\n    const classes: Record<string, string> = {\n      admin: 'bg-red-100 text-red-600',\n      teacher: 'bg-purple-100 text-purple-600',\n      parent: 'bg-teal-100 text-teal-600',\n      student: 'bg-blue-100 text-blue-600',\n    }\n    return classes[role] || 'bg-slate-100 text-slate-600'\n  }\n\n  const getRoleLabel = (role: string) => {\n    const labels: Record<string, string> = {\n      admin: 'Admin',\n      teacher: 'Giáo viên',\n      parent: 'Phụ huynh',\n      student: 'Học sinh',\n    }\n    return labels[role] || role\n  }\n\n  const handleResetPassword = async () => {\n    if (!canPerformAction) {\n      alert('Bạn không có quyền thực hiện hành động này')\n      return\n    }\n\n    setLoading(true)\n    try {\n      console.log('[UserActionsModal] Reset password for user:', user.id)\n      await new Promise(resolve => setTimeout(resolve, 1000))\n      alert(`Đã gửi mật khẩu mới cho ${user.name} qua SMS/Email`)\n      onSuccess?.()\n      onClose()\n    } catch (error) {\n      console.error('[UserActionsModal] Reset password failed:', error)\n      alert('Thao tác thất bại. Vui lòng thử lại.')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleToggleLock = async () => {\n    if (!canPerformAction) {\n      alert('Bạn không có quyền thực hiện hành động này')\n      return\n    }\n\n    setLoading(true)\n    try {\n      const newStatus = user.status === 'active' ? 'locked' : 'active'\n      console.log('[UserActionsModal] Toggle user status:', user.id, newStatus)\n      await new Promise(resolve => setTimeout(resolve, 1000))\n      alert(`${user.name} đã được ${newStatus === 'active' ? 'mở khóa' : 'khóa'}`)\n      onSuccess?.()\n      onClose()\n    } catch (error) {\n      console.error('[UserActionsModal] Toggle lock failed:', error)\n      alert('Thao tác thất bại. Vui lòng thử lại.')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleManageDevices = () => {\n    alert('Tính năng quản lý thiết bị đang phát triển')\n  }\n\n  const handleEdit = () => {\n    alert('Tính năng sửa người dùng sẽ có ở modal riêng')\n  }\n\n  const handleLinkParent = () => {\n    // Close this modal and let parent open LinkParentModal\n    onClose()\n    if (onLinkParent) onLinkParent()\n  }\n\n  const handleLinkStudent = () => {\n    // Close this modal and let parent open LinkStudentModal\n    onClose()\n    if (onLinkStudent) onLinkStudent()\n  }\n\n  const handleDelete = async () => {\n    if (!canPerformAction) {\n      alert('Bạn không có quyền thực hiện hành động này')\n      return\n    }\n\n    if (!confirm(`Bạn có chắc chắn muốn xóa người dùng ${user.name}?`)) {\n      return\n    }\n\n    setLoading(true)\n    try {\n      console.log('[UserActionsModal] Delete user:', user.id)\n      await new Promise(resolve => setTimeout(resolve, 1000))\n      alert(`Đã xóa người dùng ${user.name}`)\n      onSuccess?.()\n      onClose()\n    } catch (error) {\n      console.error('[UserActionsModal] Delete failed:', error)\n      alert('Thao tác thất bại. Vui lòng thử lại.')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  if (!isOpen) return null\n\n  return (\n    <>\n      {/* Modal Overlay */}\n      <div\n        className=\"fixed inset-0 z-50 bg-slate-900/60 backdrop-blur-sm\"\n        onClick={onClose}\n      />\n\n      {/* Slide-in Modal */}\n      <div className=\"fixed right-0 top-0 z-50 h-full w-full max-w-md bg-white shadow-2xl overflow-y-auto animate-slide-in\">\n        {/* Modal Header */}\n        <div className=\"sticky top-0 bg-white border-b border-slate-200 px-8 py-6 flex items-center justify-between z-10\">\n          <div>\n            <h3 className=\"text-xl font-black text-slate-800\">Thao tác tài khoản</h3>\n            <p className=\"text-slate-400 text-xs font-medium uppercase tracking-widest mt-1\">\n              Quản lý bảo mật & truy cập\n            </p>\n          </div>\n          <button\n            onClick={onClose}\n            className=\"p-2 hover:bg-slate-100 rounded-xl transition-all\"\n          >\n            <X className=\"h-6 w-6 text-slate-400\" />\n          </button>\n        </div>\n\n        {/* Modal Body */}\n        <div className=\"p-8 space-y-6\">\n          {/* User Info */}\n          <div className=\"flex items-center gap-4 p-4 bg-slate-50 rounded-2xl\">\n            <div className={cn(\n              'w-16 h-16 rounded-full flex items-center justify-center text-xl font-black',\n              getRoleBadgeClass(user.role)\n            )}>\n              {getInitials(user.name)}\n            </div>\n            <div>\n              <h4 className=\"text-lg font-black text-slate-800\">{user.name}</h4>\n              <p className=\"text-sm font-medium text-slate-500\">{user.id}</p>\n              <span className={cn(\n                'inline-block mt-1 px-3 py-1 text-xs font-bold rounded-lg',\n                getRoleBadgeClass(user.role)\n              )}>\n                {getRoleLabel(user.role)}\n              </span>\n            </div>\n          </div>\n\n          {/* Action Buttons */}\n          <div className=\"space-y-3\">\n            {/* Reset Password */}\n            <button\n              onClick={handleResetPassword}\n              disabled={loading}\n              className=\"w-full p-4 border border-slate-200 rounded-xl flex items-center gap-4 hover:bg-slate-50 transition-all disabled:opacity-50\"\n            >\n              <div className=\"w-10 h-10 bg-orange-100 text-orange-600 rounded-lg flex items-center justify-center\">\n                <RotateCcw className=\"h-5 w-5\" />\n              </div>\n              <div className=\"text-left\">\n                <p className=\"text-sm font-black text-slate-800\">Reset mật khẩu</p>\n                <p className=\"text-xs text-slate-400\">Gửi mật khẩu mới qua SMS/Email</p>\n              </div>\n            </button>\n\n            {/* Lock/Unlock Account */}\n            <button\n              onClick={handleToggleLock}\n              disabled={loading}\n              className=\"w-full p-4 border border-slate-200 rounded-xl flex items-center gap-4 hover:bg-slate-50 transition-all disabled:opacity-50\"\n            >\n              <div className=\"w-10 h-10 bg-red-100 text-red-600 rounded-lg flex items-center justify-center\">\n                <Lock className=\"h-5 w-5\" />\n              </div>\n              <div className=\"text-left\">\n                <p className=\"text-sm font-black text-slate-800\">\n                  {user.status === 'active' ? 'Khóa tài khoản' : 'Mở khóa tài khoản'}\n                </p>\n                <p className=\"text-xs text-slate-400\">\n                  {user.status === 'active' ? 'Tạm dừng quyền truy cập' : 'Khôi phục quyền truy cập'}\n                </p>\n              </div>\n            </button>\n\n            {/* Manage Devices */}\n            <button\n              onClick={handleManageDevices}\n              className=\"w-full p-4 border border-slate-200 rounded-xl flex items-center gap-4 hover:bg-slate-50 transition-all\"\n            >\n              <div className=\"w-10 h-10 bg-purple-100 text-purple-600 rounded-lg flex items-center justify-center\">\n                <Smartphone className=\"h-5 w-5\" />\n              </div>\n              <div className=\"text-left\">\n                <p className=\"text-sm font-black text-slate-800\">Thiết bị tin cậy</p>\n                <p className=\"text-xs text-slate-400\">Quản lý danh sách thiết bị</p>\n              </div>\n            </button>\n\n            {/* Edit User */}\n            <button\n              onClick={handleEdit}\n              className=\"w-full p-4 border border-slate-200 rounded-xl flex items-center gap-4 hover:bg-slate-50 transition-all\"\n            >\n              <div className=\"w-10 h-10 bg-blue-100 text-blue-600 rounded-lg flex items-center justify-center\">\n                <Edit className=\"h-5 w-5\" />\n              </div>\n              <div className=\"text-left\">\n                <p className=\"text-sm font-black text-slate-800\">Chỉnh sửa thông tin</p>\n                <p className=\"text-xs text-slate-400\">Cập nhật thông tin cá nhân</p>\n              </div>\n            </button>\n\n            {/* Link Parent - only show for students */}\n            {user.role === 'student' && (\n              <button\n                onClick={handleLinkParent}\n                className=\"w-full p-4 border border-slate-200 rounded-xl flex items-center gap-4 hover:bg-slate-50 transition-all\"\n              >\n                <div className=\"w-10 h-10 bg-teal-100 text-teal-600 rounded-lg flex items-center justify-center\">\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                    <path d=\"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2\" />\n                    <circle cx=\"9\" cy=\"7\" r=\"4\" />\n                    <path d=\"M22 21v-2a4 4 0 0 0-3-3.87\" />\n                  </svg>\n                </div>\n                <div className=\"text-left\">\n                  <p className=\"text-sm font-black text-slate-800\">Liên kết Phụ huynh</p>\n                  <p className=\"text-xs text-slate-400\">Gán phụ huynh cho học sinh</p>\n                </div>\n              </button>\n            )}\n\n            {/* Link Student - only show for parents */}\n            {user.role === 'parent' && (\n              <button\n                onClick={handleLinkStudent}\n                className=\"w-full p-4 border border-slate-200 rounded-xl flex items-center gap-4 hover:bg-slate-50 transition-all\"\n              >\n                <div className=\"w-10 h-10 bg-orange-100 text-orange-600 rounded-lg flex items-center justify-center\">\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                    <path d=\"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2\" />\n                    <circle cx=\"9\" cy=\"7\" r=\"4\" />\n                    <path d=\"M22 21v-2a4 4 0 0 0-3-3.87\" />\n                  </svg>\n                </div>\n                <div className=\"text-left\">\n                  <p className=\"text-sm font-black text-slate-800\">Liên kết Học sinh</p>\n                  <p className=\"text-xs text-slate-400\">Gán học sinh cho phụ huynh</p>\n                </div>\n              </button>\n            )}\n          </div>\n\n          {/* Delete Action */}\n          <div className=\"pt-6 border-t border-slate-200\">\n            <button\n              onClick={handleDelete}\n              disabled={loading}\n              className=\"w-full p-4 bg-red-50 text-red-600 rounded-xl flex items-center gap-4 hover:bg-red-100 transition-all disabled:opacity-50\"\n            >\n              <div className=\"w-10 h-10 bg-red-600 text-white rounded-lg flex items-center justify-center\">\n                <Trash2 className=\"h-5 w-5\" />\n              </div>\n              <div className=\"text-left\">\n                <p className=\"text-sm font-black text-red-600\">Xóa người dùng</p>\n                <p className=\"text-xs text-red-400\">Hành động này không thể hoàn tác</p>\n              </div>\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* Add slide-in animation to global styles */}\n      <style jsx global>{`\n        @keyframes slideIn {\n          from {\n            transform: translateX(100%);\n          }\n          to {\n            transform: translateX(0);\n          }\n        }\n        .animate-slide-in {\n          animation: slideIn 0.3s ease-out;\n        }\n      `}</style>\n    </>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\admin\\users\\modals\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\auth-branding-panel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\auth-error-message.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\layout\\Header.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used.","line":5,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'subtitle' is defined but never used. Allowed unused args must match /^_/u.","line":25,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":41},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used.","line":26,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'sliderScroll' is assigned a value but never used.","line":28,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setSliderScroll' is assigned a value but never used.","line":28,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleLogout' is assigned a value but never used.","line":30,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { Bell, Search, Settings } from 'lucide-react'\nimport { cn } from '@/lib/utils'\nimport { useState, useEffect } from 'react'\nimport type { User as UserType } from '@school-management/shared-types'\n\ninterface HeaderProps {\n  title?: string\n  subtitle?: string\n  user?: UserType | null\n  showYearSlider?: boolean\n}\n\nconst years = [\n  '2025-2026',\n  '2024-2025',\n  '2023-2024',\n  '2022-2023',\n  '2021-2022',\n  '2020-2021',\n  '2019-2020',\n]\n\nexport function Header({ title, subtitle, user: initialUser, showYearSlider = false }: HeaderProps) {\n  const [user] = useState(initialUser)\n  const [selectedYear, setSelectedYear] = useState('2025-2026')\n  const [sliderScroll, setSliderScroll] = useState(0)\n\n  const handleLogout = () => {\n    const form = document.createElement('form')\n    form.method = 'POST'\n    form.action = '/auth/logout'\n    document.body.appendChild(form)\n    form.submit()\n  }\n\n  const slideYear = (direction: number) => {\n    const slider = document.getElementById('yearSlider')\n    if (slider) {\n      const scrollAmount = 150\n      if (direction === 1) {\n        slider.scrollBy({ left: scrollAmount, behavior: 'smooth' })\n      } else {\n        slider.scrollBy({ left: -scrollAmount, behavior: 'smooth' })\n      }\n    }\n  }\n\n  const selectYear = (year: string) => {\n    setSelectedYear(year)\n  }\n\n  return (\n    <header className=\"sticky top-0 z-40 flex h-16 items-center justify-between border-b border-slate-200 bg-white px-8\">\n      <div className=\"flex items-center gap-4\">\n        <h2 className=\"text-lg font-extrabold text-slate-800\">{title || 'Bảng điều khiển'}</h2>\n\n        {/* Year Slider - shown on admin dashboard */}\n        {showYearSlider && (\n          <div className=\"hidden items-center gap-2 rounded-full bg-slate-100 px-3 py-1.5 md:flex\">\n            <span className=\"h-2 w-2 animate-pulse rounded-full bg-green-500\" />\n\n            {/* Slider Button Left */}\n            <button\n              onClick={() => slideYear(-1)}\n              className=\"slider-btn flex h-6 w-6 items-center justify-center rounded-lg text-slate-500 transition-all hover:bg-slate-200 hover:text-slate-800\"\n            >\n              <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"3\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n                <polyline points=\"15 18 9 12 15 6\"></polyline>\n              </svg>\n            </button>\n\n            {/* Year Items Slider */}\n            <div\n              id=\"yearSlider\"\n              className=\"year-slider flex max-w-[400px] gap-2 flex-row-reverse overflow-x-auto scroll-smooth\"\n              style={{ scrollbarWidth: 'none', msOverflowStyle: 'none' }}\n            >\n              {years.map((year) => (\n                <button\n                  key={year}\n                  onClick={() => selectYear(year)}\n                  className={cn(\n                    'year-item whitespace-nowrap rounded-xl px-3 py-1 text-[11px] font-bold transition-all',\n                    selectedYear === year\n                      ? 'bg-gradient-to-br from-[#0284C7] to-[#0369a1] text-white shadow-lg shadow-blue-200'\n                      : 'text-slate-600 hover:-translate-y-0.5'\n                  )}\n                >\n                  {year}\n                </button>\n              ))}\n            </div>\n\n            {/* Slider Button Right */}\n            <button\n              onClick={() => slideYear(1)}\n              className=\"slider-btn flex h-6 w-6 items-center justify-center rounded-lg text-slate-500 transition-all hover:bg-slate-200 hover:text-slate-800\"\n            >\n              <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"3\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n                <polyline points=\"9 18 15 12 9 6\"></polyline>\n              </svg>\n            </button>\n          </div>\n        )}\n      </div>\n\n      <div className=\"flex items-center gap-6\">\n        {/* Search */}\n        <div className=\"relative hidden sm:block\">\n          <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-slate-400\" />\n          <input\n            type=\"text\"\n            placeholder=\"Tìm kiếm học sinh, giáo viên...\"\n            className=\"w-64 rounded-xl border-none bg-slate-50 py-2 pl-10 pr-4 text-sm focus:outline-none focus:ring-2 focus:ring-blue-100\"\n          />\n        </div>\n\n        {/* Notifications */}\n        <div className=\"flex items-center gap-3\">\n          <button className=\"relative rounded-lg p-2 text-slate-500 transition-colors hover:bg-slate-100\">\n            <Bell className=\"h-5 w-5\" />\n            <span className=\"absolute right-2 top-2 flex h-2 w-2\">\n              <span className=\"absolute inline-flex h-full w-full animate-ping rounded-full bg-red-400 opacity-75\"></span>\n              <span className=\"relative inline-flex h-2 w-2 rounded-full bg-red-500\"></span>\n            </span>\n          </button>\n          <button className=\"rounded-lg p-2 text-slate-500 transition-colors hover:bg-slate-100\">\n            <Settings className=\"h-5 w-5\" />\n          </button>\n        </div>\n      </div>\n\n      <style jsx>{`\n        .year-slider::-webkit-scrollbar {\n          display: none;\n        }\n        .year-slider {\n          -ms-overflow-style: none;\n          scrollbar-width: none;\n        }\n      `}</style>\n    </header>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\layout\\Sidebar.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'NavSection' is defined but never used.","line":19,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used.","line":153,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":153,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'idx' is defined but never used. Allowed unused args must match /^_/u.","line":188,"column":36,"nodeType":null,"messageId":"unusedVar","endLine":188,"endColumn":39},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":230,"column":13,"nodeType":"JSXOpeningElement","endLine":233,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport Link from 'next/link'\nimport { usePathname } from 'next/navigation'\nimport { cn } from '@/lib/utils'\nimport { useRouter } from 'next/navigation'\n\ninterface SidebarProps {\n  role: 'admin' | 'teacher'\n}\n\ninterface NavItem {\n  href: string\n  label: string\n  icon: string\n  badge?: number\n}\n\ninterface NavSection {\n  label: string\n  items: NavItem[]\n}\n\nconst adminNavSections = [\n  {\n    label: 'Chính',\n    items: [\n      { href: '/admin/dashboard', label: 'Tổng quan', icon: 'grid' },\n    ],\n  },\n  {\n    label: 'Quản trị',\n    items: [\n      { href: '/admin/users', label: 'Người dùng', icon: 'users' },\n      { href: '/admin/classes', label: 'Học thuật (Lớp/Môn)', icon: 'school' },\n    ],\n  },\n  {\n    label: 'Vận hành',\n    items: [\n      { href: '/admin/attendance', label: 'Chuyên cần', icon: 'calendar' },\n      { href: '/admin/grades', label: 'Quản lý Điểm số', icon: 'check' },\n      { href: '/admin/payments', label: 'Học phí & Tài chính', icon: 'card' },\n      { href: '/admin/notifications', label: 'Thông báo', icon: 'bell' },\n    ],\n  },\n]\n\nconst teacherNavSections = [\n  {\n    label: 'Cá nhân',\n    items: [\n      { href: '/teacher/dashboard', label: 'Tổng quan', icon: 'grid' },\n    ],\n  },\n  {\n    label: 'Giảng dạy',\n    items: [\n      { href: '/teacher/schedule', label: 'Lịch giảng dạy', icon: 'calendar' },\n      { href: '/teacher/attendance', label: 'Điểm danh', icon: 'calendar' },\n      { href: '/teacher/class-management', label: 'Quản lý lớp dạy', icon: 'users' },\n      { href: '/teacher/grades', label: 'Nhập điểm số', icon: 'edit' },\n      { href: '/teacher/regular-assessment', label: 'Đánh giá nhận xét', icon: 'star' },\n      { href: '/teacher/dashboard#grade-reviews', label: 'Phúc khảo điểm', icon: 'clipboard', badge: 2 },\n    ],\n  },\n  {\n    label: 'Chủ nhiệm',\n    items: [\n      { href: '/teacher/conduct', label: 'Học tập & Hạnh kiểm', icon: 'star' },\n      { href: '/teacher/homeroom', label: 'Quản lý lớp CN', icon: 'users' },\n      { href: '/teacher/leave-approval', label: 'Phê duyệt nghỉ phép', icon: 'check', badge: 3 },\n      { href: '/teacher/messages', label: 'Tin nhắn', icon: 'message' },\n    ],\n  },\n]\n\nconst icons: Record<string, JSX.Element> = {\n  grid: (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n      <rect x=\"3\" y=\"3\" width=\"7\" height=\"7\" />\n      <rect x=\"14\" y=\"3\" width=\"7\" height=\"7\" />\n      <rect x=\"14\" y=\"14\" width=\"7\" height=\"7\" />\n      <rect x=\"3\" y=\"14\" width=\"7\" height=\"7\" />\n    </svg>\n  ),\n  users: (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n      <path d=\"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2\" />\n      <circle cx=\"9\" cy=\"7\" r=\"4\" />\n      <path d=\"M23 21v-2a4 4 0 0 0-3-3.87\" />\n      <path d=\"M16 3.13a4 4 0 0 1 0 7.75\" />\n    </svg>\n  ),\n  school: (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n      <path d=\"M22 10v6M2 10l10-5 10 5-10 5z\" />\n      <path d=\"M6 12v5c3 3 9 3 12 0v-5\" />\n    </svg>\n  ),\n  calendar: (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n      <rect x=\"3\" y=\"4\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\" />\n      <line x1=\"16\" y1=\"2\" x2=\"16\" y2=\"6\" />\n      <line x1=\"8\" y1=\"2\" x2=\"8\" y2=\"6\" />\n      <line x1=\"3\" y1=\"10\" x2=\"21\" y2=\"10\" />\n    </svg>\n  ),\n  check: (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n      <path d=\"M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 1 1-7.6-10.6\" />\n      <polyline points=\"22 4 12 14.01 9 11.01\" />\n    </svg>\n  ),\n  card: (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n      <rect x=\"2\" y=\"5\" width=\"20\" height=\"14\" rx=\"2\" />\n      <line x1=\"2\" y1=\"10\" x2=\"22\" y2=\"10\" />\n    </svg>\n  ),\n  bell: (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n      <path d=\"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9\" />\n      <path d=\"M13.73 21a2 2 0 0 1-3.46 0\" />\n    </svg>\n  ),\n  edit: (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n      <path d=\"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\" />\n      <path d=\"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z\" />\n    </svg>\n  ),\n  clipboard: (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n      <path d=\"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2\" />\n      <rect x=\"8\" y=\"2\" width=\"8\" height=\"4\" rx=\"1\" ry=\"1\" />\n    </svg>\n  ),\n  message: (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n      <path d=\"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\" />\n    </svg>\n  ),\n  star: (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n      <polygon points=\"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2\" />\n    </svg>\n  ),\n}\n\nexport function Sidebar({ role }: SidebarProps) {\n  const pathname = usePathname()\n  const router = useRouter()\n  const navSections = role === 'admin' ? adminNavSections : teacherNavSections\n\n  const handleLogout = () => {\n    const form = document.createElement('form')\n    form.method = 'POST'\n    form.action = '/auth/logout'\n    document.body.appendChild(form)\n    form.submit()\n  }\n\n  // Get user display info from cookie or localStorage (simplified for demo)\n  const userName = role === 'admin' ? 'Admin123' : 'Giáo viên'\n  const userEmail = role === 'admin' ? 'ad001@econtact.vn' : 'gv001@econtact.vn'\n\n  return (\n    <aside className=\"flex h-screen w-[280px] flex-shrink-0 flex-col overflow-hidden border-r border-slate-200 bg-white sticky top-0\">\n      {/* Brand */}\n      <div className=\"flex items-center gap-3 border-b border-slate-100 p-6\">\n        <div className=\"rounded-xl bg-blue-50 p-2\">\n          <svg width=\"28\" height=\"28\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#0284C7\" strokeWidth=\"2.5\">\n            <path d=\"M12 2L2 7L12 12L22 7L12 2Z\" strokeLinecap=\"round\" strokeLinejoin=\"round\" />\n            <path d=\"M2 17L12 22L22 17\" strokeLinecap=\"round\" strokeLinejoin=\"round\" />\n          </svg>\n        </div>\n        <div>\n          <h1 className=\"text-xl font-black tracking-tight text-slate-800 leading-none\">ECONTACT</h1>\n          <span className=\"text-[10px] font-bold uppercase tracking-widest text-slate-400\">\n            {role === 'admin' ? 'Admin Portal' : 'Teacher Portal'}\n          </span>\n        </div>\n      </div>\n\n      {/* Navigation */}\n      <nav className=\"flex flex-1 flex-col overflow-y-auto overflow-x-hidden px-3 py-6\">\n        {navSections.map((section, idx) => (\n          <div key={section.label} className=\"w-full\">\n            <p className=\"mb-2 mt-6 px-4 text-[10px] font-black uppercase tracking-widest text-slate-400 first:mt-0\">\n              {section.label}\n            </p>\n            <div className=\"space-y-1\">\n              {section.items.map((item) => {\n                const isActive = pathname === item.href\n                return (\n                  <Link\n                    key={item.href}\n                    href={item.href}\n                    className={cn(\n                      'nav-item relative flex items-center gap-2 rounded-lg px-3 py-2 text-xs font-bold transition-all whitespace-nowrap overflow-hidden min-w-0 w-full',\n                      isActive\n                        ? 'bg-[rgba(2,132,199,0.1)] text-[#0284C7]'\n                        : 'text-slate-600 hover:bg-slate-50'\n                    )}\n                  >\n                    {/* Active indicator - positioned absolutely on the left, within bounds */}\n                    {isActive && (\n                      <span className=\"absolute left-0 top-1/2 -translate-y-1/2 h-6 w-0.5 rounded-r-full bg-[#0284C7] z-10\" />\n                    )}\n                    <span className=\"flex-shrink-0\">{icons[item.icon]}</span>\n                    <span className=\"truncate flex-1 min-w-0\">{item.label}</span>\n                    {'badge' in item && typeof item.badge === 'number' && (\n                      <span className=\"flex-shrink-0 ml-auto flex h-5 w-5 items-center justify-center rounded-full bg-red-500 text-[10px] font-bold text-white\">\n                        {item.badge}\n                      </span>\n                    )}\n                  </Link>\n                )\n              })}\n            </div>\n          </div>\n        ))}\n      </nav>\n\n      {/* User Profile Sidebar Bottom */}\n      <div className=\"border-t border-slate-100 bg-slate-50/50 p-4\">\n        <div className=\"flex items-center gap-3 p-2\">\n          <div className=\"h-10 w-10 overflow-hidden rounded-full border-2 border-white bg-slate-200\">\n            <img\n              src={`https://ui-avatars.com/api/?name=${encodeURIComponent(userName)}&background=0284C7&color=fff`}\n              alt=\"Avatar\"\n            />\n          </div>\n          <div className=\"min-w-0 flex-1\">\n            <p className=\"truncate text-xs font-bold text-slate-800\">{userName}</p>\n            <p className=\"truncate text-[10px] font-medium text-slate-400\">{userEmail}</p>\n          </div>\n          <button\n            onClick={handleLogout}\n            className=\"text-slate-400 transition-colors hover:text-red-500\"\n          >\n            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n              <path d=\"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4\" />\n              <polyline points=\"16 17 21 12 16 7\" />\n              <line x1=\"21\" y1=\"12\" x2=\"9\" y2=\"12\" />\n            </svg>\n          </button>\n        </div>\n      </div>\n    </aside>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\notifications\\NotificationInbox.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'NotificationCategory' is defined but never used.","line":6,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":53},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":31,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1179,1182],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1179,1182],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":32,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1229,1232],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1229,1232],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchNotifications'. Either include it or remove the dependency array.","line":44,"column":6,"nodeType":"ArrayExpression","endLine":44,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [fetchNotifications, userId]","fix":{"range":[1465,1473],"text":"[fetchNotifications, userId]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchNotifications'. Either include it or remove the dependency array.","line":49,"column":6,"nodeType":"ArrayExpression","endLine":49,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [fetchNotifications, filter]","fix":{"range":[1559,1567],"text":"[fetchNotifications, filter]"}}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect, useCallback } from 'react'\nimport { Bell, Check, CheckCheck, Filter } from 'lucide-react'\nimport { subscribeToNotifications } from '@/lib/supabase/realtime'\nimport type { UserNotification, NotificationCategory } from '@school-management/shared-types'\n\ninterface NotificationInboxProps {\n  userId: string\n}\n\nexport function NotificationInbox({ userId }: NotificationInboxProps) {\n  const [notifications, setNotifications] = useState<UserNotification[]>([])\n  const [filter, setFilter] = useState<'all' | 'unread'>('all')\n  const [unreadCount, setUnreadCount] = useState(0)\n\n  useEffect(() => {\n    fetchNotifications()\n\n    // Subscribe to real-time updates\n    const channel = subscribeToNotifications(userId, (notification) => {\n      setNotifications((prev) => {\n        // Avoid duplicates\n        if (prev.some((n) => n.id === notification.id)) return prev\n        // Add new notification with proper type\n        const newItem: UserNotification = {\n          id: notification.id,\n          title: notification.title,\n          content: notification.content,\n          type: 'general',\n          category: notification.category as any,\n          priority: notification.priority as any,\n          isRead: false,\n          createdAt: notification.created_at,\n        }\n        return [newItem, ...prev]\n      })\n      setUnreadCount((prev) => prev + 1)\n    })\n\n    return () => {\n      channel.unsubscribe()\n    }\n  }, [userId])\n\n  // Refetch when filter changes\n  useEffect(() => {\n    fetchNotifications()\n  }, [filter])\n\n  const fetchNotifications = async () => {\n    try {\n      const response = await fetch(`/api/notifications/my?unreadOnly=${filter === 'unread'}`)\n      const result = await response.json()\n      if (result.success) {\n        setNotifications(result.data || [])\n        setUnreadCount(\n          (result.data || []).filter((n: UserNotification) => !n.isRead).length\n        )\n      }\n    } catch (error) {\n      console.error('[NotificationInbox] Failed to fetch:', error)\n    }\n  }\n\n  const markAsRead = useCallback(\n    async (notificationId: string) => {\n      try {\n        await fetch('/api/notifications/my', {\n          method: 'PATCH',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ notificationIds: [notificationId] }),\n        })\n\n        setNotifications((prev) =>\n          prev.map((n) => (n.id === notificationId ? { ...n, isRead: true } : n))\n        )\n        setUnreadCount((prev) => Math.max(0, prev - 1))\n      } catch (error) {\n        console.error('[NotificationInbox] Failed to mark as read:', error)\n      }\n    },\n    []\n  )\n\n  const markAllAsRead = useCallback(async () => {\n    const unreadIds = notifications.filter((n) => !n.isRead).map((n) => n.id)\n\n    if (unreadIds.length === 0) return\n\n    try {\n      await fetch('/api/notifications/my', {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ notificationIds: unreadIds }),\n      })\n\n      setNotifications((prev) => prev.map((n) => ({ ...n, isRead: true })))\n      setUnreadCount(0)\n    } catch (error) {\n      console.error('[NotificationInbox] Failed to mark all as read:', error)\n    }\n  }, [notifications])\n\n  const filteredNotifications = filter === 'unread'\n    ? notifications.filter((n) => !n.isRead)\n    : notifications\n\n  return (\n    <div className=\"rounded-2xl border border-slate-200 bg-white shadow-sm\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between border-b border-slate-200 p-4\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"relative\">\n            <Bell className=\"h-5 w-5 text-[#0284C7]\" />\n            {unreadCount > 0 && (\n              <span className=\"absolute -right-2 -top-2 flex h-4 w-4 items-center justify-center rounded-full bg-red-500 text-[10px] font-bold text-white\">\n                {unreadCount > 9 ? '9+' : unreadCount}\n              </span>\n            )}\n          </div>\n          <h2 className=\"font-bold text-slate-800\">Thông báo</h2>\n        </div>\n\n        <div className=\"flex items-center gap-2\">\n          <button\n            onClick={() => setFilter(filter === 'all' ? 'unread' : 'all')}\n            className=\"rounded-lg p-2 text-slate-500 hover:bg-slate-100\"\n            title={filter === 'all' ? 'Chỉ chưa đọc' : 'Tất cả'}\n          >\n            <Filter className=\"h-4 w-4\" />\n          </button>\n          {unreadCount > 0 && (\n            <button\n              onClick={markAllAsRead}\n              className=\"flex items-center gap-1 rounded-lg px-3 py-2 text-sm text-slate-500 hover:bg-slate-100\"\n            >\n              <CheckCheck className=\"h-4 w-4\" />\n              Đọc tất cả\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* Notification List */}\n      <div className=\"divide-y divide-slate-100\">\n        {filteredNotifications.length === 0 ? (\n          <div className=\"flex flex-col items-center justify-center py-12\">\n            <Bell className=\"mb-4 h-12 w-12 text-slate-300\" />\n            <p className=\"text-sm font-medium text-slate-500\">\n              {filter === 'unread' ? 'Không có thông báo chưa đọc' : 'Chưa có thông báo nào'}\n            </p>\n          </div>\n        ) : (\n          filteredNotifications.map((notification) => (\n            <NotificationItem\n              key={notification.id}\n              notification={notification}\n              onMarkAsRead={() => markAsRead(notification.id)}\n            />\n          ))\n        )}\n      </div>\n    </div>\n  )\n}\n\nfunction NotificationItem({\n  notification,\n  onMarkAsRead,\n}: {\n  notification: UserNotification\n  onMarkAsRead: () => void\n}) {\n  const isEmergency = notification.category === 'emergency' || notification.priority === 'emergency'\n\n  return (\n    <div\n      className={`flex gap-3 p-4 transition-colors hover:bg-slate-50 ${!notification.isRead ? 'bg-blue-50/50' : ''}`}\n    >\n      <div\n        className={`mt-1 flex-shrink-0 rounded-full p-2 ${\n          isEmergency\n            ? 'bg-red-100'\n            : notification.priority === 'high'\n              ? 'bg-orange-100'\n              : 'bg-blue-100'\n        }`}\n      >\n        <Bell\n          className={`h-4 w-4 ${\n            isEmergency\n              ? 'text-red-600'\n              : notification.priority === 'high'\n                ? 'text-orange-600'\n                : 'text-blue-600'\n          }`}\n        />\n      </div>\n\n      <div className=\"flex-1\">\n        <div className=\"mb-1 flex items-start justify-between gap-2\">\n          <h3 className={`text-sm font-semibold ${!notification.isRead ? 'text-slate-900' : 'text-slate-600'}`}>\n            {notification.title}\n          </h3>\n          {!notification.isRead && (\n            <span className=\"flex-shrink-0 rounded-full bg-blue-500 px-2 py-0.5 text-[10px] font-medium text-white\">\n              Mới\n            </span>\n          )}\n        </div>\n        <p className={`text-sm ${!notification.isRead ? 'text-slate-700' : 'text-slate-500'}`}>\n          {notification.content}\n        </p>\n        <p className=\"mt-2 text-[10px] text-slate-400\">\n          {new Date(notification.createdAt).toLocaleString('vi-VN')}\n        </p>\n      </div>\n\n      {!notification.isRead && (\n        <button\n          onClick={onMarkAsRead}\n          className=\"flex-shrink-0 self-center rounded-lg p-2 text-slate-400 hover:bg-slate-100 hover:text-blue-600\"\n          title=\"Đánh dấu đã đọc\"\n        >\n          <Check className=\"h-4 w-4\" />\n        </button>\n      )}\n    </div>\n  )\n}\n\n// Export a badge component for showing unread count in navigation\nexport function NotificationBadge({ userId }: { userId: string }) {\n  const [unreadCount, setUnreadCount] = useState(0)\n\n  useEffect(() => {\n    // Fetch initial count\n    const fetchUnreadCount = async () => {\n      try {\n        const response = await fetch('/api/notifications/my?unreadOnly=true')\n        const result = await response.json()\n        if (result.success) {\n          setUnreadCount(result.data?.length || 0)\n        }\n      } catch (error) {\n        console.error('[NotificationBadge] Failed to fetch unread count:', error)\n      }\n    }\n\n    fetchUnreadCount()\n\n    // Subscribe to new notifications\n    const channel = subscribeToNotifications(userId, () => {\n      setUnreadCount((prev) => prev + 1)\n    })\n\n    return () => {\n      channel.unsubscribe()\n    }\n  }, [userId])\n\n  return (\n    <div className=\"relative\">\n      <Bell className=\"h-5 w-5 text-slate-600\" />\n      {unreadCount > 0 && (\n        <span className=\"absolute -right-2 -top-2 flex h-4 w-4 items-center justify-center rounded-full bg-red-500 text-[10px] font-bold text-white\">\n          {unreadCount > 9 ? '9+' : unreadCount}\n        </span>\n      )}\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\providers\\AuthProvider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\teacher\\AttendanceForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'statusToLabel' is assigned a value but never used.","line":19,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":20},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":78,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":78,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2318,2384],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":85,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":85,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2512,2587],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":91,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2729,2732],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2729,2732],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":92,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2800,2803],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2800,2803],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":93,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2871,2874],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2871,2874],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":94,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2942,2945],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2942,2945],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState } from 'react'\nimport type { AttendanceRecord } from '@/lib/types'\nimport { Button } from '@/components/ui/button'\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table'\nimport { Input } from '@/components/ui/input'\nimport { CheckCircle, XCircle, Clock, AlertCircle, Check } from 'lucide-react'\nimport { AttendanceStatusButton } from './AttendanceStatusButton'\n\ninterface AttendanceFormProps {\n  students: AttendanceRecord[]\n  date?: Date\n  classId?: string\n}\n\ntype AttendanceStatus = 'P' | 'A' | 'L' | 'E'\n\nconst statusToLabel: Record<AttendanceStatus, AttendanceRecord['status']> = {\n  P: 'present',\n  A: 'absent',\n  L: 'late',\n  E: 'excused',\n}\n\nconst labelToStatus: Record<AttendanceRecord['status'], AttendanceStatus> = {\n  present: 'P',\n  absent: 'A',\n  late: 'L',\n  excused: 'E',\n}\n\nexport function AttendanceForm({ students, date = new Date(), classId }: AttendanceFormProps) {\n  const [attendance, setAttendance] = useState<Record<string, AttendanceStatus>>(\n    students.reduce((acc, student) => {\n      acc[student.studentId] = labelToStatus[student.status]\n      return acc\n    }, {} as Record<string, AttendanceStatus>)\n  )\n\n  const [notes, setNotes] = useState<Record<string, string>>({})\n  const [hasChanges, setHasChanges] = useState(false)\n\n  const updateStatus = (studentId: string, status: AttendanceStatus) => {\n    setAttendance(prev => ({ ...prev, [studentId]: status }))\n    setHasChanges(true)\n  }\n\n  const updateNote = (studentId: string, note: string) => {\n    setNotes(prev => ({ ...prev, [studentId]: note }))\n    setHasChanges(true)\n  }\n\n  const markAllPresent = () => {\n    setAttendance(prev =>\n      Object.fromEntries(Object.keys(prev).map(id => [id, 'P' as AttendanceStatus]))\n    )\n    setHasChanges(true)\n  }\n\n  const autoFillExcused = () => {\n    // Fill E for students with approved leaves (mock logic)\n    setAttendance(prev => {\n      const updated = { ...prev }\n      // Mock: assume first 2 students have approved leaves\n      const studentIds = Object.keys(updated)\n      if (studentIds.length >= 2) {\n        updated[studentIds[0]] = 'E'\n        updated[studentIds[1]] = 'E'\n      }\n      return updated\n    })\n    setHasChanges(true)\n  }\n\n  const saveDraft = () => {\n    // Mock save draft\n    console.log('Saving draft:', { classId, date, attendance, notes })\n    setHasChanges(false)\n    alert('Đã lưu nháp thành công!')\n  }\n\n  const confirmAttendance = () => {\n    // Mock confirm\n    console.log('Confirming attendance:', { classId, date, attendance, notes })\n    setHasChanges(false)\n    alert('Đã xác nhận điểm danh thành công!')\n  }\n\n  const summary = {\n    P: Object.values(attendance).filter((s: any) => s === 'P').length,\n    A: Object.values(attendance).filter((s: any) => s === 'A').length,\n    L: Object.values(attendance).filter((s: any) => s === 'L').length,\n    E: Object.values(attendance).filter((s: any) => s === 'E').length,\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Bulk Actions */}\n      <div className=\"flex gap-2\">\n        <Button variant=\"outline\" onClick={markAllPresent} className=\"gap-2\">\n          <Check className=\"h-4 w-4\" />\n          Điểm danh tất cả có mặt\n        </Button>\n        <Button variant=\"outline\" onClick={autoFillExcused} className=\"gap-2\">\n          <AlertCircle className=\"h-4 w-4\" />\n          Tự động điền có phép\n        </Button>\n      </div>\n\n      {/* Status Legend */}\n      <div className=\"bg-gray-50 border border-gray-200 rounded-lg p-4\">\n        <div className=\"flex flex-wrap gap-6\">\n          <div className=\"flex items-center gap-2\">\n            <AttendanceStatusButton status=\"P\" active={false} onClick={() => {}} size=\"sm\" />\n            <span className=\"text-sm text-gray-600\">Có mặt</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <AttendanceStatusButton status=\"A\" active={false} onClick={() => {}} size=\"sm\" />\n            <span className=\"text-sm text-gray-600\">Vắng mặt</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <AttendanceStatusButton status=\"L\" active={false} onClick={() => {}} size=\"sm\" />\n            <span className=\"text-sm text-gray-600\">Muộn</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <AttendanceStatusButton status=\"E\" active={false} onClick={() => {}} size=\"sm\" />\n            <span className=\"text-sm text-gray-600\">Có phép</span>\n          </div>\n        </div>\n      </div>\n\n      {/* Summary Cards */}\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n        <div className=\"bg-green-50 border border-green-200 rounded-lg p-4\">\n          <div className=\"flex items-center gap-2\">\n            <CheckCircle className=\"h-5 w-5 text-green-600\" />\n            <div>\n              <p className=\"text-sm font-medium text-green-900\">Có mặt</p>\n              <p className=\"text-2xl font-bold text-green-700\">{summary.P}</p>\n            </div>\n          </div>\n        </div>\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\n          <div className=\"flex items-center gap-2\">\n            <XCircle className=\"h-5 w-5 text-red-600\" />\n            <div>\n              <p className=\"text-sm font-medium text-red-900\">Vắng</p>\n              <p className=\"text-2xl font-bold text-red-700\">{summary.A}</p>\n            </div>\n          </div>\n        </div>\n        <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-4\">\n          <div className=\"flex items-center gap-2\">\n            <Clock className=\"h-5 w-5 text-amber-600\" />\n            <div>\n              <p className=\"text-sm font-medium text-amber-900\">Trễ</p>\n              <p className=\"text-2xl font-bold text-amber-700\">{summary.L}</p>\n            </div>\n          </div>\n        </div>\n        <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n          <div className=\"flex items-center gap-2\">\n            <AlertCircle className=\"h-5 w-5 text-blue-600\" />\n            <div>\n              <p className=\"text-sm font-medium text-blue-900\">Vắng có phép</p>\n              <p className=\"text-2xl font-bold text-blue-700\">{summary.E}</p>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Attendance Table */}\n      <div className=\"bg-white border border-gray-200 rounded-lg\">\n        <Table>\n          <TableHeader>\n            <TableRow>\n              <TableHead className=\"w-12\">STT</TableHead>\n              <TableHead>Họ và tên</TableHead>\n              <TableHead>Trạng thái</TableHead>\n              <TableHead>Ghi chú</TableHead>\n            </TableRow>\n          </TableHeader>\n          <TableBody>\n            {students.map((student, index) => (\n              <TableRow key={student.studentId}>\n                <TableCell className=\"font-medium\">{index + 1}</TableCell>\n                <TableCell className=\"font-medium\">{student.studentName}</TableCell>\n                <TableCell>\n                  <div className=\"flex gap-2\">\n                    {(['P', 'A', 'L', 'E'] as AttendanceStatus[]).map((status) => (\n                      <AttendanceStatusButton\n                        key={status}\n                        status={status}\n                        active={attendance[student.studentId] === status}\n                        onClick={() => updateStatus(student.studentId, status)}\n                        size=\"sm\"\n                      />\n                    ))}\n                  </div>\n                </TableCell>\n                <TableCell>\n                  <Input\n                    placeholder=\"Ghi chú...\"\n                    value={notes[student.studentId] || ''}\n                    onChange={(e) => updateNote(student.studentId, e.target.value)}\n                    className=\"max-w-xs\"\n                  />\n                </TableCell>\n              </TableRow>\n            ))}\n          </TableBody>\n        </Table>\n      </div>\n\n      {/* Action Buttons */}\n      <div className=\"flex gap-3 justify-end\">\n        <Button variant=\"outline\" onClick={saveDraft} disabled={!hasChanges}>\n          Lưu nháp\n        </Button>\n        <Button onClick={confirmAttendance} disabled={!hasChanges}>\n          Xác nhận hoàn thành\n        </Button>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\teacher\\AttendanceStatusButton.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'sizeClasses' is assigned a value but never used.","line":66,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":66,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { Button } from '@/components/ui/button'\nimport { CheckCircle, XCircle, Clock, AlertCircle } from 'lucide-react'\nimport { cn } from '@/lib/utils'\n\ntype AttendanceStatus = 'P' | 'A' | 'L' | 'E'\n\ninterface AttendanceStatusButtonProps {\n  status: AttendanceStatus\n  active: boolean\n  onClick: () => void\n  label?: string\n  size?: 'sm' | 'md'\n}\n\nconst statusConfig = {\n  P: {\n    label: 'P',\n    fullLabel: 'Có mặt',\n    description: 'Present',\n    icon: CheckCircle,\n    activeClass: 'bg-green-500 text-white border-green-600',\n    inactiveClass: 'bg-white text-green-700 border-green-300 hover:bg-green-50',\n    dotClass: 'bg-green-500',\n  },\n  A: {\n    label: 'A',\n    fullLabel: 'Vắng',\n    description: 'Absent',\n    icon: XCircle,\n    activeClass: 'bg-red-500 text-white border-red-600',\n    inactiveClass: 'bg-white text-red-700 border-red-300 hover:bg-red-50',\n    dotClass: 'bg-red-500',\n  },\n  L: {\n    label: 'L',\n    fullLabel: 'Trễ',\n    description: 'Late',\n    icon: Clock,\n    activeClass: 'bg-amber-500 text-white border-amber-600',\n    inactiveClass: 'bg-white text-amber-700 border-amber-300 hover:bg-amber-50',\n    dotClass: 'bg-amber-500',\n  },\n  E: {\n    label: 'E',\n    fullLabel: 'Có phép',\n    description: 'Excused',\n    icon: AlertCircle,\n    activeClass: 'bg-blue-500 text-white border-blue-600',\n    inactiveClass: 'bg-white text-blue-700 border-blue-300 hover:bg-blue-50',\n    dotClass: 'bg-blue-500',\n  },\n}\n\nexport function AttendanceStatusButton({\n  status,\n  active,\n  onClick,\n  label,\n  size = 'md',\n}: AttendanceStatusButtonProps) {\n  const config = statusConfig[status]\n  const Icon = config.icon\n\n  const sizeClasses = {\n    sm: 'h-8 w-8 text-xs',\n    md: 'h-10 w-10 text-sm',\n  }\n\n  if (size === 'sm') {\n    return (\n      <Button\n        type=\"button\"\n        variant=\"outline\"\n        size=\"sm\"\n        onClick={onClick}\n        className={cn(\n          'h-8 w-8 p-0 font-bold transition-all',\n          active ? config.activeClass : config.inactiveClass\n        )}\n        title={config.fullLabel}\n      >\n        {label || config.label}\n      </Button>\n    )\n  }\n\n  return (\n    <button\n      type=\"button\"\n      onClick={onClick}\n      className={cn(\n        'flex items-center gap-2 px-4 py-2.5 rounded-lg border-2 font-bold text-sm transition-all',\n        'focus:outline-none focus:ring-2 focus:ring-offset-2',\n        active\n          ? `${config.activeClass} focus:ring-${status === 'P' ? 'green' : status === 'A' ? 'red' : status === 'L' ? 'amber' : 'blue'}-500`\n          : config.inactiveClass\n      )}\n    >\n      <Icon className={cn('h-4 w-4', !active && 'opacity-70')} />\n      <span>{label || config.fullLabel}</span>\n      {active && (\n        <span\n          className={cn(\n            'ml-auto h-2 w-2 rounded-full',\n            config.dotClass\n          )}\n        />\n      )}\n    </button>\n  )\n}\n\n// Helper function to get status configuration\nexport function getStatusConfig(status: AttendanceStatus) {\n  return statusConfig[status]\n}\n\n// Helper function to get all statuses\nexport function getAllStatuses(): AttendanceStatus[] {\n  return ['P', 'A', 'L', 'E']\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\teacher\\ChatWindow.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Info' is defined but never used.","line":7,"column":41,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":45}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect, useRef } from 'react'\nimport type { Message, Conversation } from '@/lib/types'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Send, Paperclip, Phone, Video, Info, MoreVertical } from 'lucide-react'\nimport { cn } from '@/lib/utils'\n\ninterface ChatWindowProps {\n  conversationId?: string\n  messages?: Message[]\n  conversation?: Conversation\n  onSendMessage?: (content: string) => void\n}\n\nexport function ChatWindow({\n  conversationId = '1',\n  messages: initialMessages,\n  conversation,\n  onSendMessage\n}: ChatWindowProps) {\n  const [messages, setMessages] = useState<Message[]>(initialMessages || [])\n  const [newMessage, setNewMessage] = useState('')\n  const [isTyping, setIsTyping] = useState(false)\n  const messagesEndRef = useRef<HTMLDivElement>(null)\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' })\n  }\n\n  useEffect(() => {\n    scrollToBottom()\n  }, [messages])\n\n  const handleSendMessage = () => {\n    if (!newMessage.trim()) return\n\n    const message: Message = {\n      id: Date.now().toString(),\n      conversationId,\n      senderId: '2',\n      senderName: 'Thầy Nguyễn Thanh T.',\n      content: newMessage,\n      timestamp: new Date().toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' }),\n      isFromTeacher: true,\n    }\n\n    setMessages(prev => [...prev, message])\n\n    if (onSendMessage) {\n      onSendMessage(newMessage)\n    }\n\n    setNewMessage('')\n\n    // Show typing indicator then reply\n    setIsTyping(true)\n    setTimeout(() => {\n      setIsTyping(false)\n      const reply: Message = {\n        id: (Date.now() + 1).toString(),\n        conversationId,\n        senderId: 'p1',\n        senderName: conversation?.parentName || 'Phụ huynh',\n        content: 'Cảm ơn thầy đã phản hồi!',\n        timestamp: new Date().toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' }),\n        isFromTeacher: false,\n      }\n      setMessages(prev => [...prev, reply])\n    }, 1500)\n  }\n\n  return (\n    <div className=\"flex flex-col h-full bg-gray-50\">\n      {/* Chat Header */}\n      <div className=\"p-4 bg-white border-b border-gray-200 flex items-center gap-4\">\n        <div>\n          <div className=\"font-bold text-gray-900\">{conversation?.parentName || 'Phụ huynh'}</div>\n          <div className=\"text-sm text-gray-500\">\n            Phụ huynh {conversation?.studentName} - {conversation?.className}\n          </div>\n        </div>\n        <div className=\"ml-auto flex gap-2\">\n          <Button size=\"sm\" variant=\"outline\" className=\"h-8 w-8 p-0\">\n            <Phone className=\"h-4 w-4\" />\n          </Button>\n          <Button size=\"sm\" variant=\"outline\" className=\"h-8 w-8 p-0\">\n            <Video className=\"h-4 w-4\" />\n          </Button>\n          <Button size=\"sm\" variant=\"outline\" className=\"h-8 w-8 p-0\">\n            <MoreVertical className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      </div>\n\n      {/* Messages Area */}\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\n        {messages.length === 0 ? (\n          <div className=\"flex items-center justify-center h-full text-gray-400\">\n            <div className=\"text-center\">\n              <p className=\"text-sm\">Chưa có tin nhắn nào</p>\n              <p className=\"text-xs mt-1\">Hãy bắt đầu cuộc trò chuyện!</p>\n            </div>\n          </div>\n        ) : (\n          <>\n            {messages.map((message) => (\n              <div\n                key={message.id}\n                className={cn('flex', message.isFromTeacher ? 'justify-end' : 'justify-start')}\n              >\n                <div\n                  className={cn(\n                    'max-w-[70%] px-4 py-2 rounded-2xl',\n                    message.isFromTeacher\n                      ? 'bg-gradient-to-br from-sky-600 to-sky-700 text-white rounded-br-sm'\n                      : 'bg-white text-gray-900 rounded-bl-sm border border-gray-200'\n                  )}\n                >\n                  <p className=\"text-sm whitespace-pre-wrap break-words\">{message.content}</p>\n                  <div\n                    className={cn(\n                      'text-xs mt-1 text-right',\n                      message.isFromTeacher ? 'text-sky-200' : 'text-gray-400'\n                    )}\n                  >\n                    {message.timestamp}\n                  </div>\n                </div>\n              </div>\n            ))}\n\n            {/* Typing Indicator */}\n            {isTyping && (\n              <div className=\"flex justify-start\">\n                <div className=\"bg-white px-4 py-3 rounded-2xl rounded-bl-sm border border-gray-200\">\n                  <div className=\"flex gap-1\">\n                    <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" />\n                    <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '0.1s' }} />\n                    <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '0.2s' }} />\n                  </div>\n                </div>\n              </div>\n            )}\n\n            <div ref={messagesEndRef} />\n          </>\n        )}\n      </div>\n\n      {/* Message Input */}\n      <div className=\"p-4 bg-white border-t border-gray-200\">\n        <div className=\"flex gap-3\">\n          <Button variant=\"outline\" size=\"icon\" className=\"shrink-0 h-10 w-10\" type=\"button\">\n            <Paperclip className=\"h-5 w-5\" />\n          </Button>\n          <Input\n            placeholder=\"Nhập tin nhắn...\"\n            value={newMessage}\n            onChange={(e) => setNewMessage(e.target.value)}\n            onKeyDown={(e) => {\n              if (e.key === 'Enter' && !e.shiftKey) {\n                e.preventDefault()\n                handleSendMessage()\n              }\n            }}\n            className=\"flex-1\"\n          />\n          <Button\n            onClick={handleSendMessage}\n            disabled={!newMessage.trim()}\n            type=\"button\"\n            className=\"h-10 px-4\"\n          >\n            <Send className=\"h-4 w-4 mr-2\" />\n            Gửi\n          </Button>\n        </div>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\teacher\\ContactInfoPanel.tsx","messages":[{"ruleId":"jsx-a11y/alt-text","severity":1,"message":"Image elements must have an alt prop, either with meaningful text, or an empty string for decorative images.","line":91,"column":77,"nodeType":"JSXOpeningElement","endLine":91,"endColumn":106}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport type { Conversation } from '@/lib/types'\nimport { FileText, Image, Phone, Mail, User } from 'lucide-react'\nimport { Card } from '@/components/ui/card'\n\ninterface ContactInfoPanelProps {\n  conversation?: Conversation\n}\n\nexport function ContactInfoPanel({ conversation }: ContactInfoPanelProps) {\n  if (!conversation) {\n    return (\n      <div className=\"p-4 flex items-center justify-center h-full\">\n        <div className=\"text-center text-gray-400\">\n          <p>Chọn một cuộc hội thoại</p>\n        </div>\n      </div>\n    )\n  }\n\n  const sharedFiles = [\n    { name: 'Bài tập về nhà.pdf', type: 'pdf' },\n    { name: 'Ảnh chụp bảng.jpg', type: 'image' },\n    { name: 'Thông báo nghỉ học.pdf', type: 'pdf' },\n  ]\n\n  return (\n    <div className=\"p-4 h-full overflow-y-auto\">\n      {/* Parent Info */}\n      <div className=\"mb-6\">\n        <h3 className=\"font-bold text-lg mb-4\">Thông tin phụ huynh</h3>\n        <div className=\"space-y-3\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-10 h-10 rounded-full bg-sky-100 flex items-center justify-center\">\n              <User className=\"h-5 w-5 text-sky-600\" />\n            </div>\n            <div>\n              <p className=\"text-sm text-gray-500\">Phụ huynh</p>\n              <p className=\"font-bold\">{conversation.parentName}</p>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-10 h-10 rounded-full bg-green-100 flex items-center justify-center\">\n              <Phone className=\"h-5 w-5 text-green-600\" />\n            </div>\n            <div>\n              <p className=\"text-sm text-gray-500\">Điện thoại</p>\n              <p className=\"font-bold\">0901234567</p>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center\">\n              <Mail className=\"h-5 w-5 text-blue-600\" />\n            </div>\n            <div>\n              <p className=\"text-sm text-gray-500\">Email</p>\n              <p className=\"font-bold text-sm\">parent@email.com</p>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Student Info */}\n      <div className=\"mb-6\">\n        <h3 className=\"font-bold text-lg mb-4\">Học sinh</h3>\n        <div className=\"space-y-3\">\n          <div>\n            <p className=\"text-sm text-gray-500\">Họ và tên</p>\n            <p className=\"font-bold\">{conversation.studentName}</p>\n          </div>\n          <div>\n            <p className=\"text-sm text-gray-500\">MSSV</p>\n            <p className=\"font-bold\">{conversation.studentId}</p>\n          </div>\n          <div>\n            <p className=\"text-sm text-gray-500\">Lớp</p>\n            <p className=\"font-bold\">{conversation.className}</p>\n          </div>\n        </div>\n      </div>\n\n      {/* Shared Files */}\n      <div>\n        <h3 className=\"font-bold text-lg mb-4\">Tài liệu chia sẻ</h3>\n        <div className=\"space-y-2\">\n          {sharedFiles.map((file, index) => (\n            <Card key={index} className=\"p-3 hover:shadow-md transition-shadow cursor-pointer\">\n              <div className=\"flex items-center gap-3\">\n                <div className={file.type === 'pdf' ? 'text-red-500' : 'text-blue-500'}>\n                  {file.type === 'pdf' ? <FileText className=\"h-5 w-5\" /> : <Image className=\"h-5 w-5\" />}\n                </div>\n                <div className=\"flex-1 min-w-0\">\n                  <p className=\"text-sm font-medium truncate\">{file.name}</p>\n                  <p className=\"text-xs text-gray-500\">2.5 MB</p>\n                </div>\n              </div>\n            </Card>\n          ))}\n        </div>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\teacher\\ConversationList.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState } from 'react'\nimport type { Conversation } from '@/lib/types'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport { Search, MessageCircle } from 'lucide-react'\nimport { cn } from '@/lib/utils'\n\ninterface ConversationListProps {\n  conversations: Conversation[]\n  selectedId?: string\n  onSelectConversation: (id: string) => void\n}\n\nexport function ConversationList({ conversations, selectedId, onSelectConversation }: ConversationListProps) {\n  const [searchQuery, setSearchQuery] = useState('')\n\n  const filteredConversations = conversations.filter(conv =>\n    conv.parentName.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    conv.studentName.toLowerCase().includes(searchQuery.toLowerCase())\n  )\n\n  const getAvatarInitials = (name: string) => {\n    return name\n      .split(' ')\n      .slice(-1)[0]\n      .substring(0, 2)\n      .toUpperCase()\n  }\n\n  return (\n    <div className=\"flex flex-col h-full bg-white\">\n      {/* Header */}\n      <div className=\"p-4 border-b border-gray-200\">\n        <h3 className=\"font-semibold text-gray-900 mb-3\">Tin nhắn</h3>\n        <div className=\"relative\">\n          <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400\" />\n          <input\n            type=\"text\"\n            placeholder=\"Tìm kiếm...\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            className=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-transparent\"\n          />\n        </div>\n      </div>\n\n      {/* Tabs */}\n      <div className=\"flex border-b border-gray-200\">\n        <button className=\"flex-1 py-3 text-sm font-medium text-sky-600 border-b-2 border-sky-600\">\n          Tất cả\n        </button>\n        <button className=\"flex-1 py-3 text-sm font-medium text-gray-500 hover:text-gray-700\">\n          Chưa đọc\n        </button>\n        <button className=\"flex-1 py-3 text-sm font-medium text-gray-500 hover:text-gray-700\">\n          Đánh dấu\n        </button>\n      </div>\n\n      {/* Conversation List */}\n      <div className=\"flex-1 overflow-y-auto\">\n        {filteredConversations.length === 0 ? (\n          <div className=\"flex flex-col items-center justify-center h-full text-gray-400 p-4\">\n            <MessageCircle className=\"h-12 w-12 mb-2\" />\n            <p className=\"text-sm text-center\">\n              {searchQuery ? 'Không tìm thấy cuộc trò chuyện nào' : 'Chưa có tin nhắn nào'}\n            </p>\n          </div>\n        ) : (\n          <div className=\"divide-y divide-gray-100\">\n            {filteredConversations.map((conversation) => (\n              <button\n                key={conversation.id}\n                onClick={() => onSelectConversation(conversation.id)}\n                className={cn(\n                  'w-full p-4 text-left hover:bg-gray-50 transition-colors',\n                  selectedId === conversation.id && 'bg-sky-50 border-l-4 border-sky-600'\n                )}\n              >\n                <div className=\"flex items-start gap-3\">\n                  {/* Avatar with Online Indicator */}\n                  <div className=\"relative shrink-0\">\n                    <div className=\"w-12 h-12 rounded-full bg-sky-100 flex items-center justify-center text-sky-600 font-bold\">\n                      {getAvatarInitials(conversation.parentName)}\n                    </div>\n                    {/* Online Indicator */}\n                    <div\n                      className={cn(\n                        'absolute bottom-0 right-0 w-3 h-3 rounded-full border-2 border-white',\n                        conversation.online ? 'bg-green-500' : 'bg-gray-400'\n                      )}\n                    ></div>\n                  </div>\n\n                  {/* Content */}\n                  <div className=\"flex-1 min-w-0\">\n                    <div className=\"flex items-center justify-between mb-1\">\n                      <h4 className=\"font-semibold text-gray-900 truncate\">{conversation.parentName}</h4>\n                      <span className=\"text-xs text-gray-500 shrink-0 ml-2\">{conversation.timestamp}</span>\n                    </div>\n                    <p className=\"text-sm text-gray-600 truncate mb-1\">{conversation.studentName}</p>\n                    <p className=\"text-sm text-gray-500 truncate\">{conversation.lastMessage}</p>\n                  </div>\n\n                  {/* Unread Badge */}\n                  {conversation.unreadCount > 0 && (\n                    <Badge\n                      variant=\"destructive\"\n                      className=\"shrink-0 ml-2 h-5 w-5 flex items-center justify-center p-0 rounded-full text-xs\"\n                    >\n                      {conversation.unreadCount}\n                    </Badge>\n                  )}\n                </div>\n              </button>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\teacher\\DualRatingBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\teacher\\GradeEntryForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'index' is defined but never used. Allowed unused args must match /^_/u.","line":27,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":37},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":76,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2431,2434],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2431,2434],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":77,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2488,2491],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2488,2491],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":78,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2523,2526],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2523,2526],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":81,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2597,2600],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2597,2600],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":82,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2655,2658],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2655,2658],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":83,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2727,2730],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2727,2730],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":84,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2796,2799],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2796,2799],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":86,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2892,2895],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2892,2895],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":86,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2900,2903],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2900,2903],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":105,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":105,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3307,3365],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":111,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":111,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3466,3525],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":223,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":223,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8476,8479],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8476,8479],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":223,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":223,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8488,8491],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8488,8491],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":233,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":233,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9058,9061],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9058,9061],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":12,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState } from 'react'\nimport type { GradeEntry } from '@/lib/types'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport { Save, Download, Upload, Lock, Unlock, AlertCircle } from 'lucide-react'\nimport { GradeInputCell } from './GradeInputCell'\n\ninterface GradeEntryFormProps {\n  students: GradeEntry[]\n  subject: string\n  classId?: string\n}\n\ninterface StudentGrades {\n  tx1?: number\n  tx2?: number\n  tx3?: number\n  gk?: number\n  ck?: number\n}\n\nexport function GradeEntryForm({ students, subject, classId }: GradeEntryFormProps) {\n  const [grades, setGrades] = useState<Record<string, StudentGrades>>(() => {\n    const initial: Record<string, StudentGrades> = {}\n    students.forEach((student, index) => {\n      initial[student.studentId] = {\n        tx1: student.oral[0] || student.oral[1] || undefined,\n        tx2: student.quiz[0] || undefined,\n        tx3: student.oral[2] || student.quiz[1] || undefined,\n        gk: student.midterm || undefined,\n        ck: student.final || undefined,\n      }\n    })\n    return initial\n  })\n\n  const [isLocked, setIsLocked] = useState(false)\n  const [hasChanges, setHasChanges] = useState(false)\n\n  // Calculate average: ĐTB = (TX1 + TX2 + TX3) × 1 + GK × 2 + CK × 3 ÷ 8\n  const calculateAverage = (studentId: string): string => {\n    const g = grades[studentId]\n    if (!g) return '--'\n\n    const tx1 = g.tx1 ?? 0\n    const tx2 = g.tx2 ?? 0\n    const tx3 = g.tx3 ?? 0\n    const gk = g.gk ?? 0\n    const ck = g.ck ?? 0\n\n    // Check if any required grades are missing\n    if (g.tx1 === undefined || g.tx2 === undefined || g.tx3 === undefined ||\n        g.gk === undefined || g.ck === undefined) {\n      return '--'\n    }\n\n    const avg = ((tx1 + tx2 + tx3) * 1 + gk * 2 + ck * 3) / 8\n    return avg.toFixed(2)\n  }\n\n  // Get color class for average\n  const getAverageColor = (avg: string) => {\n    if (avg === '--') return 'bg-gray-100 text-gray-400 border border-gray-300'\n    const num = parseFloat(avg)\n    if (num >= 8.0) return 'bg-green-100 text-green-700 border border-green-300'\n    if (num >= 6.5) return 'bg-blue-100 text-blue-700 border border-blue-300'\n    if (num >= 5.0) return 'bg-amber-100 text-amber-700 border border-amber-300'\n    return 'bg-red-100 text-red-700 border border-red-300'\n  }\n\n  // Calculate statistics\n  const calculateStatistics = () => {\n    const averages = students\n      .map((s: any) => calculateAverage(s.studentId))\n      .filter((a: any) => a !== '--')\n      .map((a: any) => parseFloat(a))\n\n    return {\n      excellent: averages.filter((a: any) => a >= 8.0).length,\n      good: averages.filter((a: any) => a >= 6.5 && a < 8.0).length,\n      average: averages.filter((a: any) => a >= 5.0 && a < 6.5).length,\n      poor: averages.filter((a: any) => a < 5.0).length,\n      classAverage: averages.length > 0\n        ? (averages.reduce((a: any, b: any) => a + b, 0) / averages.length).toFixed(2)\n        : '--',\n    }\n  }\n\n  const stats = calculateStatistics()\n\n  const updateGrade = (studentId: string, field: keyof StudentGrades, value: number | undefined) => {\n    setGrades(prev => ({\n      ...prev,\n      [studentId]: {\n        ...prev[studentId],\n        [field]: value,\n      },\n    }))\n    setHasChanges(true)\n  }\n\n  const saveDraft = () => {\n    console.log('Saving draft:', { classId, subject, grades })\n    setHasChanges(false)\n    alert('Đã lưu nháp thành công!')\n  }\n\n  const saveGrades = () => {\n    console.log('Saving grades:', { classId, subject, grades })\n    setHasChanges(false)\n    alert('Đã lưu điểm thành công!')\n  }\n\n  const downloadTemplate = () => {\n    alert('Tải xuống mẫu Excel...')\n  }\n\n  const importExcel = () => {\n    alert('Nhập điểm từ Excel...')\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Formula Display */}\n      <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n        <div className=\"flex items-start gap-3\">\n          <AlertCircle className=\"h-5 w-5 text-blue-600 mt-0.5\" />\n          <div>\n            <h4 className=\"font-semibold text-blue-900 text-sm\">CÔNG THỨC TÍNH ĐIỂM TRUNG BÌNH</h4>\n            <p className=\"text-base text-blue-800 mt-1 font-medium\">\n              ĐTB = (TX1 + TX2 + TX3) × 1 + GK × 2 + CK × 3 ÷ 8\n            </p>\n            <p className=\"text-xs text-blue-700 mt-2\">\n              • TX1, TX2, TX3: Điểm kiểm tra viết (hệ số 1) • GK: Giữa kỳ (hệ số 2) • CK: Cuối kỳ (hệ số 3)\n            </p>\n          </div>\n        </div>\n      </div>\n\n      {/* Class Statistics */}\n      <div className=\"grid grid-cols-2 md:grid-cols-5 gap-4\">\n        <div className=\"border-l-4 border-green-500 bg-white rounded-lg shadow-sm p-4\">\n          <div className=\"text-3xl font-bold text-green-600\">{stats.excellent}</div>\n          <div className=\"text-xs text-gray-500 mt-1\">Giỏi (≥8.0)</div>\n        </div>\n        <div className=\"border-l-4 border-blue-500 bg-white rounded-lg shadow-sm p-4\">\n          <div className=\"text-3xl font-bold text-blue-600\">{stats.good}</div>\n          <div className=\"text-xs text-gray-500 mt-1\">Khá (6.5-7.9)</div>\n        </div>\n        <div className=\"border-l-4 border-amber-500 bg-white rounded-lg shadow-sm p-4\">\n          <div className=\"text-3xl font-bold text-amber-600\">{stats.average}</div>\n          <div className=\"text-xs text-gray-500 mt-1\">Trung bình (5.0-6.4)</div>\n        </div>\n        <div className=\"border-l-4 border-red-500 bg-white rounded-lg shadow-sm p-4\">\n          <div className=\"text-3xl font-bold text-red-600\">{stats.poor}</div>\n          <div className=\"text-xs text-gray-500 mt-1\">Yếu (&lt;5.0)</div>\n        </div>\n        <div className=\"border-l-4 border-purple-500 bg-white rounded-lg shadow-sm p-4\">\n          <div className=\"text-3xl font-bold text-purple-600\">{stats.classAverage}</div>\n          <div className=\"text-xs text-gray-500 mt-1\">Điểm TB lớp</div>\n        </div>\n      </div>\n\n      {/* Lock Status */}\n      <div className=\"flex justify-between items-center bg-white rounded-lg p-4 border border-gray-200\">\n        <Badge variant={isLocked ? \"destructive\" : \"default\"} className=\"text-sm px-3 py-1\">\n          {isLocked ? 'Đã khóa điểm' : 'Chưa khóa điểm'}\n        </Badge>\n        <Button\n          variant={isLocked ? \"outline\" : \"default\"}\n          onClick={() => setIsLocked(!isLocked)}\n          className=\"gap-2\"\n        >\n          {isLocked ? (\n            <>\n              <Unlock className=\"h-4 w-4\" />\n              Mở khóa điểm\n            </>\n          ) : (\n            <>\n              <Lock className=\"h-4 w-4\" />\n              Khóa điểm\n            </>\n          )}\n        </Button>\n      </div>\n\n      {/* Grade Table */}\n      <div className=\"bg-white border border-gray-200 rounded-lg overflow-hidden\">\n        <div className=\"overflow-x-auto\">\n          <table className=\"w-full\">\n            <thead className=\"bg-gray-50 border-b border-gray-200\">\n              <tr>\n                <th className=\"px-4 py-3 text-left text-xs font-black text-gray-400 uppercase tracking-wider sticky left-0 bg-gray-50 z-10\">\n                  STT\n                </th>\n                <th className=\"px-4 py-3 text-left text-xs font-black text-gray-400 uppercase tracking-wider sticky left-12 bg-gray-50 z-10 min-w-[200px]\">\n                  Họ và tên\n                </th>\n                <th className=\"px-4 py-3 text-center text-xs font-black text-gray-400 uppercase tracking-wider min-w-[100px]\">\n                  TX1\n                </th>\n                <th className=\"px-4 py-3 text-center text-xs font-black text-gray-400 uppercase tracking-wider min-w-[100px]\">\n                  TX2\n                </th>\n                <th className=\"px-4 py-3 text-center text-xs font-black text-gray-400 uppercase tracking-wider min-w-[100px]\">\n                  TX3\n                </th>\n                <th className=\"px-4 py-3 text-center text-xs font-black text-gray-400 uppercase tracking-wider min-w-[100px]\">\n                  GK (x2)\n                </th>\n                <th className=\"px-4 py-3 text-center text-xs font-black text-gray-400 uppercase tracking-wider min-w-[100px]\">\n                  CK (x3)\n                </th>\n                <th className=\"px-4 py-3 text-center text-xs font-black text-gray-400 uppercase tracking-wider min-w-[100px]\">\n                  ĐTB\n                </th>\n              </tr>\n            </thead>\n            <tbody className=\"divide-y divide-gray-100\">\n              {students.map((student: any, index: any) => {\n                const avg = calculateAverage(student.studentId)\n                return (\n                  <tr key={student.studentId} className=\"hover:bg-gray-50\">\n                    <td className=\"px-4 py-4 text-sm font-bold sticky left-0 bg-white z-10\">\n                      {index + 1}\n                    </td>\n                    <td className=\"px-4 py-4 text-sm font-bold sticky left-12 bg-white z-10\">\n                      {student.studentName}\n                    </td>\n                    {(['tx1', 'tx2', 'tx3', 'gk', 'ck'] as const).map((field: any) => (\n                      <td key={field} className=\"px-2 py-4 text-center\">\n                        <GradeInputCell\n                          value={grades[student.studentId]?.[field as keyof StudentGrades]}\n                          onChange={(val) => updateGrade(student.studentId, field, val)}\n                          disabled={isLocked}\n                          locked={isLocked}\n                          min={0}\n                          max={10}\n                          step={0.25}\n                        />\n                      </td>\n                    ))}\n                    <td className=\"px-4 py-4 text-center\">\n                      <div className={`inline-block px-4 py-2 rounded-lg font-bold text-sm ${getAverageColor(avg)}`}>\n                        {avg}\n                      </div>\n                    </td>\n                  </tr>\n                )\n              })}\n            </tbody>\n          </table>\n        </div>\n      </div>\n\n      {/* Action Buttons */}\n      <div className=\"flex gap-3 justify-end\">\n        <Button variant=\"outline\" onClick={saveDraft} disabled={!hasChanges} className=\"gap-2\">\n          Lưu nháp\n        </Button>\n        <Button variant=\"outline\" onClick={downloadTemplate} className=\"gap-2\">\n          <Download className=\"h-4 w-4\" />\n          Tải mẫu\n        </Button>\n        <Button variant=\"outline\" onClick={importExcel} className=\"gap-2\">\n          <Upload className=\"h-4 w-4\" />\n          Nhập Excel\n        </Button>\n        <Button onClick={saveGrades} disabled={!hasChanges || isLocked} className=\"gap-2\">\n          <Save className=\"h-4 w-4\" />\n          Lưu điểm\n        </Button>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\teacher\\GradeInputCell.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\teacher\\RatingStars.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\teacher\\StudentAssessmentCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\ui\\badge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\ui\\button.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1742,1745],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1742,1745],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from 'react'\nimport { cn } from '@/lib/utils'\n\nexport interface ButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {\n  variant?: 'default' | 'destructive' | 'outline' | 'secondary' | 'ghost' | 'link'\n  size?: 'default' | 'sm' | 'lg' | 'icon'\n  asChild?: boolean\n  href?: string\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant = 'default', size = 'default', asChild = false, href, children, ...props }, ref) => {\n    // If asChild and href are provided, render as a Link component\n    if (asChild && href) {\n      return (\n        <a\n          href={href}\n          className={cn(\n            'inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50',\n            {\n              'bg-sky-600 text-white hover:bg-sky-700': variant === 'default',\n              'bg-red-600 text-white hover:bg-red-700': variant === 'destructive',\n              'border border-gray-300 bg-white hover:bg-gray-100': variant === 'outline',\n              'bg-gray-200 text-gray-900 hover:bg-gray-300': variant === 'secondary',\n              'hover:bg-gray-100 hover:text-gray-900': variant === 'ghost',\n              'text-sky-600 underline-offset-4 hover:underline': variant === 'link',\n              'h-10 px-4 py-2': size === 'default',\n              'h-9 rounded-md px-3': size === 'sm',\n              'h-11 rounded-md px-8': size === 'lg',\n              'h-10 w-10': size === 'icon',\n            },\n            className\n          )}\n          {...(props as any)}\n        >\n          {children}\n        </a>\n      )\n    }\n\n    return (\n      <button\n        className={cn(\n          'inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50',\n          {\n            'bg-sky-600 text-white hover:bg-sky-700': variant === 'default',\n            'bg-red-600 text-white hover:bg-red-700': variant === 'destructive',\n            'border border-gray-300 bg-white hover:bg-gray-100': variant === 'outline',\n            'bg-gray-200 text-gray-900 hover:bg-gray-300': variant === 'secondary',\n            'hover:bg-gray-100 hover:text-gray-900': variant === 'ghost',\n            'text-sky-600 underline-offset-4 hover:underline': variant === 'link',\n            'h-10 px-4 py-2': size === 'default',\n            'h-9 rounded-md px-3': size === 'sm',\n            'h-11 rounded-md px-8': size === 'lg',\n            'h-10 w-10': size === 'icon',\n          },\n          className\n        )}\n        ref={ref}\n        {...props}\n      >\n        {children}\n      </button>\n    )\n  }\n)\nButton.displayName = 'Button'\n\nexport { Button }\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\ui\\card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\ui\\input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\ui\\skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\ui\\table.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\components\\ui\\textarea.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\lib\\__tests__\\auth.csrf.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1285,1288],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1285,1288],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1651,1654],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1651,1654],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2055,2058],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2055,2058],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from 'vitest'\nimport { login } from '../auth'\n\nconst mockCookies = vi.hoisted(() => ({ set: vi.fn() }))\nvi.mock('next/headers', () => ({ cookies: () => mockCookies }))\nvi.mock('next/navigation', () => ({\n  redirect: vi.fn((url: string) => { throw new Error(`Redirect: ${url}`) }),\n}))\n\n// Create flexible mock that handles different query patterns\nconst createQueryBuilder = () => ({\n  select: vi.fn(() => createQueryBuilder()),\n  eq: vi.fn(() => createQueryBuilder()),\n  single: vi.fn(() => ({ data: { email: 'test@school.edu' }, error: null }))\n})\n\nconst mockSupabaseClient = {\n  from: vi.fn(() => createQueryBuilder()),\n  auth: {\n    signInWithPassword: vi.fn(() => Promise.resolve({\n      data: { user: { id: 'test-user-id' } },\n      error: null\n    }))\n  }\n}\n\nvi.mock('@/lib/supabase/server', () => ({\n  createClient: vi.fn(() => mockSupabaseClient)\n}))\n\ndescribe('login - CSRF Protection', () => {\n  beforeEach(() => {\n    vi.clearAllMocks()\n    mockCookies.set.mockReturnValue(undefined)\n  })\n\n  it('should set httpOnly cookie (prevents XSS token theft)', async () => {\n    const formData = new FormData()\n    formData.set('identifier', 'TC001')\n    formData.set('password', 'any')\n\n    try {\n      await login(null, formData as any)\n    } catch {\n      const cookieOptions = mockCookies.set.mock.calls[0]?.[2]\n      expect(cookieOptions?.httpOnly).toBe(true)\n    }\n  })\n\n  it('should set sameSite=lax (CSRF protection)', async () => {\n    const formData = new FormData()\n    formData.set('identifier', 'TC001')\n    formData.set('password', 'any')\n\n    try {\n      await login(null, formData as any)\n    } catch {\n      const cookieOptions = mockCookies.set.mock.calls[0]?.[2]\n      expect(cookieOptions?.sameSite).toBe('lax')\n    }\n  })\n\n  it('should set secure flag in production', async () => {\n    vi.stubEnv('NODE_ENV', 'production')\n\n    const formData = new FormData()\n    formData.set('identifier', 'TC001')\n    formData.set('password', 'any')\n\n    try {\n      await login(null, formData as any)\n    } catch {\n      const cookieOptions = mockCookies.set.mock.calls[0]?.[2]\n      expect(cookieOptions?.secure).toBe(true)\n    }\n\n    vi.unstubAllEnvs()\n  })\n})\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\lib\\__tests__\\auth.error-handling.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":50,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1377,1380],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1377,1380],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1563,1566],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1563,1566],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1605,1608],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1605,1608],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":59,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1654,1657],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1654,1657],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":70,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2059,2062],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2059,2062],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":80,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2402,2405],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2402,2405],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from 'vitest'\nimport { login, getUser, logout } from '../auth'\n\nconst mockCookies = vi.hoisted(() => ({\n  get: vi.fn(),\n  set: vi.fn(),\n  delete: vi.fn(),\n}))\n\nvi.mock('next/headers', () => ({ cookies: () => mockCookies }))\nvi.mock('next/navigation', () => ({\n  redirect: vi.fn((url: string) => { throw new Error(`Redirect: ${url}`) }),\n}))\n\nvi.mock('@/lib/supabase/server', () => ({\n  createClient: vi.fn(() => ({\n    from: vi.fn(() => ({\n      select: vi.fn(() => ({\n        eq: vi.fn(() => ({\n          eq: vi.fn(() => ({\n            eq: vi.fn(() => ({\n              single: vi.fn(() => ({ data: { email: 'test@school.edu' }, error: null }))\n            }))\n          }))\n        }))\n      }))\n    })),\n    auth: {\n      signInWithPassword: vi.fn(() => Promise.resolve({\n        data: { user: { id: 'test-user-id' } },\n        error: null\n      })),\n      getSession: vi.fn(() => Promise.resolve({\n        data: { session: { user: { id: 'test-user-id' } } }\n      })),\n      signOut: vi.fn(() => Promise.resolve({ error: null }))\n    }\n  }))\n}))\n\ndescribe('login - Error Handling', () => {\n  beforeEach(() => {\n    vi.clearAllMocks()\n  })\n\n  it('should handle missing identifier gracefully', async () => {\n    const formData = new FormData()\n    formData.set('password', 'test123')\n\n    const result = await login(formData as any)\n    expect(result).toHaveProperty('error')\n  })\n\n  it('should handle null FormData values', async () => {\n    const formData = new FormData()\n    formData.set('identifier', null as any)\n    formData.set('password', null as any)\n\n    const result = await login(formData as any)\n    expect(result).toHaveProperty('error')\n  })\n\n  it('should handle whitespace-only identifier', async () => {\n    const formData = new FormData()\n    formData.set('identifier', '   ')\n    formData.set('password', 'test')\n\n    // Whitespace gets trimmed to empty by sanitizeInput\n    // Empty string fails format validation (needs 1-20 alphanumeric chars)\n    const result = await login(formData as any)\n    expect(result).toHaveProperty('error')\n  })\n\n  it('should handle invalid code format', async () => {\n    const formData = new FormData()\n    formData.set('identifier', \"TC001' OR '1'='1\")\n    formData.set('password', 'test')\n\n    // Should fail format validation (special chars like quotes)\n    const result = await login(formData as any)\n    expect(result).toHaveProperty('error')\n  })\n})\n\ndescribe('getUser - Error Handling', () => {\n  beforeEach(() => {\n    vi.clearAllMocks()\n  })\n\n  it('should return null when no cookie exists', async () => {\n    mockCookies.get.mockReturnValue(undefined)\n\n    const user = await getUser()\n    expect(user).toBeNull()\n  })\n\n  it('should handle corrupted cookie JSON', async () => {\n    mockCookies.get.mockReturnValue({ value: 'invalid-json' })\n\n    const user = await getUser()\n    expect(user).toBeNull()\n  })\n\n  it('should handle empty cookie value', async () => {\n    mockCookies.get.mockReturnValue({ value: '' })\n\n    const user = await getUser()\n    expect(user).toBeNull()\n  })\n})\n\ndescribe('logout - Error Handling', () => {\n  beforeEach(() => {\n    vi.clearAllMocks()\n  })\n\n  it('should always redirect even if cookie missing', async () => {\n    mockCookies.delete.mockReturnValue(undefined)\n\n    await expect(logout()).rejects.toThrow('Redirect: /login')\n    expect(mockCookies.delete).toHaveBeenCalledWith('auth')\n  })\n})\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\lib\\__tests__\\auth.rate-limit.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\lib\\__tests__\\auth.security.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[421,424],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[421,424],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1379,1382],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1379,1382],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1637,1640],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1637,1640],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":69,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2140,2143],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2140,2143],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":79,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2515,2518],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2515,2518],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":90,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2902,2905],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2902,2905],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from 'vitest'\nimport { login } from '../auth'\n\nconst mockCookies = vi.hoisted(() => ({ set: vi.fn() }))\nvi.mock('next/headers', () => ({ cookies: () => mockCookies }))\nvi.mock('next/navigation', () => ({\n  redirect: vi.fn((url: string) => { throw new Error(`Redirect: ${url}`) }),\n}))\n\n// Mock Supabase client\nconst createQueryBuilder = () => ({\n  eq: vi.fn(function(this: any) {\n    // After first eq, return an object that has eq and single\n    return {\n      eq: vi.fn(() => createQueryBuilder()),\n      single: vi.fn(() => ({ data: null, error: { code: 'PGRST116' } }))\n    }\n  }),\n  single: vi.fn(() => ({ data: null, error: { code: 'PGRST116' } }))\n})\n\nvi.mock('@/lib/supabase/server', () => ({\n  createClient: vi.fn(() => ({\n    from: vi.fn(() => ({\n      select: vi.fn(() => createQueryBuilder())\n    })),\n    auth: {\n      signInWithPassword: vi.fn(() => Promise.resolve({\n        data: { user: { id: 'test-user-id' } },\n        error: null\n      }))\n    }\n  }))\n}))\n\ndescribe('login - Input Validation', () => {\n  beforeEach(() => {\n    vi.clearAllMocks()\n    mockCookies.set.mockReturnValue(undefined)\n  })\n\n  it('should reject empty identifier', async () => {\n    const formData = new FormData()\n    formData.set('identifier', '')\n    formData.set('password', 'password123')\n\n    const result = await login(formData as any)\n    expect(result).toHaveProperty('error')\n  })\n\n  it('should reject empty password', async () => {\n    const formData = new FormData()\n    formData.set('identifier', 'TC001')\n    formData.set('password', '')\n\n    const result = await login(formData as any)\n    expect(result).toHaveProperty('error')\n  })\n\n  // Note: With real Supabase auth, valid codes require actual database records\n  // These tests document expected behavior with real auth\n\n  it('should reject invalid identifier format (special chars)', async () => {\n    const formData = new FormData()\n    formData.set('identifier', \"TC001' OR '1'='1\")\n    formData.set('password', 'any')\n\n    // New auth validates code format and rejects special chars\n    const result = await login(formData as any)\n    expect(result).toHaveProperty('error')\n  })\n\n  it('should reject identifier with XSS attempts', async () => {\n    const formData = new FormData()\n    formData.set('identifier', '<script>alert(\"xss\")</script>')\n    formData.set('password', 'any')\n\n    // Sanitization removes script tags, then validation fails format check\n    const result = await login(formData as any)\n    expect(result).toHaveProperty('error')\n  })\n\n  it('should accept valid email format', async () => {\n    const formData = new FormData()\n    formData.set('identifier', 'admin@school.edu')\n    formData.set('password', 'any')\n\n    // With real Supabase, this will fail if user doesn't exist\n    // But email format validation should pass\n    const result = await login(formData as any)\n    // Either returns error object or redirects (throws)\n    if (result && typeof result === 'object' && 'error' in result) {\n      // Should NOT be format error (email is valid format)\n      expect(result.error).not.toContain('Invalid identifier format')\n    }\n  })\n})\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\lib\\__tests__\\auth.session.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getUser' is defined but never used.","line":2,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":52,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1511,1514],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1511,1514],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1933,1936],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1933,1936],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":90,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2760,2763],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2760,2763],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":98,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3110,3113],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3110,3113],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from 'vitest'\nimport { login, getUser, requireAuth, requireRole } from '../auth'\n\nconst mockCookies = vi.hoisted(() => ({\n  get: vi.fn(),\n  set: vi.fn(),\n  delete: vi.fn(),\n}))\n\nvi.mock('next/headers', () => ({ cookies: () => mockCookies }))\nvi.mock('next/navigation', () => ({\n  redirect: vi.fn((url: string) => { throw new Error(`Redirect: ${url}`) }),\n}))\n\n// Create flexible mock that handles different query patterns\nconst createQueryBuilder = () => ({\n  select: vi.fn(() => createQueryBuilder()),\n  eq: vi.fn(() => createQueryBuilder()),\n  single: vi.fn(() => ({ data: { email: 'test@school.edu' }, error: null }))\n})\n\nconst mockSupabaseClient = {\n  from: vi.fn(() => createQueryBuilder()),\n  auth: {\n    signInWithPassword: vi.fn(() => Promise.resolve({\n      data: { user: { id: 'test-user-id' } },\n      error: null\n    })),\n    getSession: vi.fn(() => Promise.resolve({\n      data: { session: { user: { id: 'test-user-id' } } }\n    })),\n    signOut: vi.fn(() => Promise.resolve({ error: null }))\n  }\n}\n\nvi.mock('@/lib/supabase/server', () => ({\n  createClient: vi.fn(() => mockSupabaseClient)\n}))\n\ndescribe('Session Management', () => {\n  beforeEach(() => {\n    vi.clearAllMocks()\n  })\n\n  it('should set cookie with 1 week max age', async () => {\n    mockCookies.set.mockReturnValue(undefined)\n    const formData = new FormData()\n    formData.set('identifier', 'TC001')\n    formData.set('password', 'any')\n\n    try {\n      await login(null, formData as any)\n    } catch {\n      const cookieOptions = mockCookies.set.mock.calls[0]?.[2]\n      expect(cookieOptions?.maxAge).toBe(60 * 60 * 24 * 7) // 1 week\n    }\n  })\n\n  it('should set cookie path to root', async () => {\n    mockCookies.set.mockReturnValue(undefined)\n    const formData = new FormData()\n    formData.set('identifier', 'TC001')\n    formData.set('password', 'any')\n\n    try {\n      await login(null, formData as any)\n    } catch {\n      const cookieOptions = mockCookies.set.mock.calls[0]?.[2]\n      expect(cookieOptions?.path).toBe('/')\n    }\n  })\n\n  it('requireAuth should redirect with default message', async () => {\n    mockCookies.get.mockReturnValue(undefined)\n\n    await expect(requireAuth()).rejects.toThrow('Redirect: /login')\n  })\n\n  it('requireAuth should redirect to clean login URL', async () => {\n    mockCookies.get.mockReturnValue(undefined)\n\n    await expect(requireAuth()).rejects.toThrow('Redirect: /login')\n  })\n\n  it('requireRole should reject unauthorized roles', async () => {\n    mockCookies.get.mockReturnValue({\n      value: JSON.stringify({ id: '1', role: 'teacher', email: 'test@school.edu', name: 'Test Teacher', createdAt: new Date(), updatedAt: new Date() })\n    })\n\n    await expect(requireRole('admin' as any)).rejects.toThrow('Redirect: /login')\n  })\n\n  it('requireRole should accept matching role', async () => {\n    mockCookies.get.mockReturnValue({\n      value: JSON.stringify({ id: '1', role: 'admin', email: 'test@school.edu', name: 'Test Admin', createdAt: new Date(), updatedAt: new Date() })\n    })\n\n    const user = await requireRole('admin' as any)\n    expect(user?.role).toBe('admin')\n  })\n})\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\lib\\__tests__\\auth.sql-injection.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":40,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1196,1199],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1196,1199],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1641,1644],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1641,1644],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2113,2116],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2113,2116],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from 'vitest'\nimport { login } from '../auth'\n\nconst mockCookies = vi.hoisted(() => ({ set: vi.fn() }))\nvi.mock('next/headers', () => ({ cookies: () => mockCookies }))\nvi.mock('next/navigation', () => ({\n  redirect: vi.fn((url: string) => { throw new Error(`Redirect: ${url}`) }),\n}))\n\nvi.mock('@/lib/supabase/server', () => ({\n  createClient: vi.fn(() => ({\n    from: vi.fn(() => ({\n      select: vi.fn(() => ({\n        eq: vi.fn(() => ({\n          single: vi.fn(() => ({ data: null, error: { code: 'PGRST116' } }))\n        }))\n      }))\n    })),\n    auth: {\n      signInWithPassword: vi.fn(() => Promise.resolve({\n        data: { user: { id: 'test-user-id' } },\n        error: null\n      }))\n    }\n  }))\n}))\n\ndescribe('login - SQL Injection Prevention', () => {\n  beforeEach(() => {\n    vi.clearAllMocks()\n    mockCookies.set.mockReturnValue(undefined)\n  })\n\n  it('should reject SQL injection with quotes', async () => {\n    const formData = new FormData()\n    formData.set('identifier', \"TC001' OR '1'='1\")\n    formData.set('password', 'any')\n\n    // New auth validates code format (alphanumeric only)\n    const result = await login(formData as any)\n    expect(result).toHaveProperty('error')\n  })\n\n  it('should reject SQL injection in password (handled by Supabase)', async () => {\n    const formData = new FormData()\n    formData.set('identifier', 'TC001')\n    formData.set('password', \"'; DROP TABLE users; --\")\n\n    // Valid code format, but Supabase auth will handle SQLi in password\n    // Format validation passes, then Supabase query runs\n    const result = await login(formData as any)\n    // Should NOT be format error\n    if (result && typeof result === 'object' && 'error' in result) {\n      expect(result.error).not.toContain('Invalid identifier format')\n    }\n  })\n\n  it('should reject UNION-based injection', async () => {\n    const formData = new FormData()\n    formData.set('identifier', \"TC001' UNION SELECT * FROM users --\")\n    formData.set('password', 'any')\n\n    // Code format validation rejects\n    const result = await login(formData as any)\n    expect(result).toHaveProperty('error')\n  })\n})\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\lib\\__tests__\\auth.xss.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":40,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1203,1206],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1203,1206],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":50,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1527,1530],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1527,1530],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":60,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1853,1856],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1853,1856],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from 'vitest'\nimport { login } from '../auth'\n\nconst mockCookies = vi.hoisted(() => ({ set: vi.fn() }))\nvi.mock('next/headers', () => ({ cookies: () => mockCookies }))\nvi.mock('next/navigation', () => ({\n  redirect: vi.fn((url: string) => { throw new Error(`Redirect: ${url}`) }),\n}))\n\nvi.mock('@/lib/supabase/server', () => ({\n  createClient: vi.fn(() => ({\n    from: vi.fn(() => ({\n      select: vi.fn(() => ({\n        eq: vi.fn(() => ({\n          single: vi.fn(() => ({ data: null, error: { code: 'PGRST116' } }))\n        }))\n      }))\n    })),\n    auth: {\n      signInWithPassword: vi.fn(() => Promise.resolve({\n        data: { user: { id: 'test-user-id' } },\n        error: null\n      }))\n    }\n  }))\n}))\n\ndescribe('login - XSS Prevention', () => {\n  beforeEach(() => {\n    vi.clearAllMocks()\n    mockCookies.set.mockReturnValue(undefined)\n  })\n\n  it('sanitizes script tags before validation', async () => {\n    const formData = new FormData()\n    formData.set('identifier', '<script>alert(\"xss\")</script>')\n    formData.set('password', 'any')\n\n    // Sanitization removes script tags, leaving empty string\n    const result = await login(formData as any)\n    expect(result).toHaveProperty('error')\n  })\n\n  it('sanitizes img tag with onerror', async () => {\n    const formData = new FormData()\n    formData.set('identifier', '<img src=x onerror=alert(1)>')\n    formData.set('password', 'any')\n\n    // Sanitization removes HTML tags\n    const result = await login(formData as any)\n    expect(result).toHaveProperty('error')\n  })\n\n  it('sanitizes javascript: protocol', async () => {\n    const formData = new FormData()\n    formData.set('identifier', 'javascript:alert(1)')\n    formData.set('password', 'any')\n\n    // Sanitization removes javascript: protocol\n    const result = await login(formData as any)\n    expect(result).toHaveProperty('error')\n  })\n})\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\lib\\auth.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used.","line":409,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":409,"endColumn":17},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":464,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":464,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"debug"},"fix":{"range":[12680,12761],"text":""},"desc":"Remove the console.debug()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Web Authentication Server Actions using Supabase\n *\n * REAL authentication using Supabase Auth + custom code/phone lookup\n *\n * Login identifiers:\n * - Admin: admin_code (AD001) or email\n * - Teacher: employee_code (TC001) or email\n * - Student: student_code (ST2024001) or email\n * - Parent: phone number or email\n */\n\n'use server';\n\nimport { cookies, headers as nextHeaders } from 'next/headers';\nimport { redirect } from 'next/navigation';\nimport type { User, UserRole } from '@school-management/shared-types';\nimport { createClient } from '@/lib/supabase/server';\nimport type { Database } from '@/types/supabase';\n\nconst AUTH_COOKIE_NAME = 'auth';\nconst SESSION_COOKIE_NAME = 'session_id';\nconst AUTH_COOKIE_MAX_AGE = 60 * 60 * 24 * 7; // 1 week\n\n// Type for user_sessions table insert\ntype UserSessionInsert = Database['public']['Tables']['user_sessions']['Insert'];\n// Type for RPC parameters\ntype TerminateSessionsParams = Database['public']['Functions']['terminate_user_sessions']['Args'];\n\n/**\n * Find user by identifier (code/phone/email)\n * Returns the user's email for Supabase Auth authentication\n */\nasync function findUserEmailByIdentifier(identifier: string): Promise<string | null> {\n  const supabase = await createClient();\n  const normalizedId = identifier.trim().toUpperCase();\n\n  // 1. Check admin_code (in admins table)\n  if (normalizedId.startsWith('AD')) {\n    const { data } = await supabase\n      .from('admins')\n      .select('profiles!inner(email)')\n      .eq('admin_code', normalizedId)\n      .single();\n\n    const result = data as { profiles: { email: string } } | null;\n    if (result?.profiles?.email) return result.profiles.email;\n  }\n\n  // 2. Check employee_code (in teachers table)\n  if (normalizedId.startsWith('TC')) {\n    const { data } = await supabase\n      .from('teachers')\n      .select('profiles!inner(email)')\n      .eq('employee_code', normalizedId)\n      .single();\n\n    const result = data as { profiles: { email: string } } | null;\n    if (result?.profiles?.email) return result.profiles.email;\n  }\n\n  // 3. Check student_code\n  if (normalizedId.startsWith('ST')) {\n    const { data } = await supabase\n      .from('students')\n      .select('profiles!inner(email)')\n      .eq('student_code', normalizedId)\n      .single();\n\n    const result = data as { profiles: { email: string } } | null;\n    if (result?.profiles?.email) return result.profiles.email;\n  }\n\n  // 4. Check phone number (for parents)\n  const cleanPhone = identifier.replace(/\\s/g, '');\n  if (/^\\d{10,11}$/.test(cleanPhone)) {\n    const { data } = await supabase\n      .from('profiles')\n      .select('email')\n      .eq('phone', cleanPhone)\n      .eq('role', 'parent')\n      .eq('status', 'active')\n      .single();\n\n    const result = data as { email: string } | null;\n    if (result?.email) return result.email;\n  }\n\n  // 5. Check email directly\n  if (identifier.includes('@')) {\n    const { data } = await supabase\n      .from('profiles')\n      .select('email')\n      .eq('email', identifier.toLowerCase())\n      .eq('status', 'active')\n      .single();\n\n    const result = data as { email: string } | null;\n    if (result?.email) return result.email;\n  }\n\n  return null;\n}\n\n/**\n * Get full user profile from Supabase\n */\nasync function getUserProfile(userId: string): Promise<User | null> {\n  const supabase = await createClient();\n\n  const { data, error } = await supabase\n    .from('profiles')\n    .select('id, email, role, full_name, status, avatar_url')\n    .eq('id', userId)\n    .single();\n\n  if (error || !data) {\n    return null;\n  }\n\n  const profile = data as { id: string; email: string; role: string; full_name?: string };\n\n  return {\n    id: profile.id,\n    email: profile.email,\n    name: profile.full_name || profile.email.split('@')[0],\n    role: profile.role as UserRole,\n    createdAt: new Date(),\n    updatedAt: new Date(),\n  };\n}\n\n/**\n * Generate random session token\n */\nfunction generateSessionToken(): string {\n  return Array.from(crypto.getRandomValues(new Uint8Array(32)))\n    .map(b => b.toString(16).padStart(2, '0'))\n    .join('');\n}\n\n/**\n * Get user agent from request headers\n */\nasync function getUserAgent(): Promise<string> {\n  const headersList = await nextHeaders();\n  return headersList.get('user-agent') || 'Unknown';\n}\n\n/**\n * Parse user agent to extract device info\n */\nfunction parseUserAgent(userAgent: string): {\n  type: 'web' | 'mobile_ios' | 'mobile_android' | 'desktop'\n  id: string\n} {\n  const ua = userAgent.toLowerCase();\n\n  // Simple device detection\n  if (ua.includes('iphone') || ua.includes('ipad')) {\n    return { type: 'mobile_ios', id: 'ios-device' };\n  }\n  if (ua.includes('android')) {\n    return { type: 'mobile_android', id: 'android-device' };\n  }\n  if (ua.includes('mobile')) {\n    return { type: 'web', id: 'mobile-web' };\n  }\n\n  // Generate simple fingerprint from user agent\n  const id = Buffer.from(userAgent).toString('base64').slice(0, 16);\n\n  return { type: 'desktop', id };\n}\n\n/**\n * Get client IP address\n */\nasync function getClientIP(): Promise<string | null> {\n  const headersList = await nextHeaders();\n\n  // Check various headers for IP\n  const ip = headersList.get('x-forwarded-for')?.split(',')[0]\n    || headersList.get('x-real-ip')\n    || headersList.get('cf-connecting-ip')\n    || null;\n\n  return ip;\n}\n\n/**\n * Terminate all active sessions for a user\n */\nasync function terminateUserSessions(\n  userId: string,\n  reason: string = 'new_login'\n): Promise<void> {\n  const supabase = await createClient();\n\n  const params: TerminateSessionsParams = {\n    p_user_id: userId,\n    p_reason: reason\n  };\n\n  await supabase.rpc('terminate_user_sessions', params);\n}\n\n/**\n * Broadcast session termination via Realtime\n */\nasync function broadcastSessionTermination(\n  userId: string,\n  reason: string\n): Promise<void> {\n  const supabase = await createClient();\n\n  await supabase.channel(`user:${userId}:session`)\n    .send({\n      type: 'broadcast',\n      event: 'session_terminated',\n      payload: { reason, timestamp: new Date().toISOString() }\n    });\n}\n\n/**\n * Sanitize user input to prevent XSS\n * Removes HTML tags and javascript: protocols\n */\nfunction sanitizeInput(input: string): string {\n  return input\n    .replace(/<script[^>]*>.*?<\\/script>/gi, '')\n    .replace(/<[^>]*>/g, '')\n    .replace(/javascript:/gi, '')\n    .replace(/onerror=/gi, '')\n    .trim();\n}\n\n/**\n * Validate code format (alphanumeric only, max length 20)\n */\nfunction isValidCode(code: string): boolean {\n  return /^[A-Za-z0-9]{1,20}$/.test(code);\n}\n\n/**\n * Login state for useFormState\n */\nexport type LoginState = {\n  error?: string;\n  success?: boolean;\n}\n\n/**\n * Internal login implementation - shared by both public APIs\n */\nasync function loginImpl(identifier: string, password: string): Promise<LoginState | void> {\n  if (!identifier || !password) {\n    return { error: 'Vui lòng nhập tài khoản và mật khẩu' };\n  }\n\n  // Sanitize input to prevent XSS\n  const sanitizedId = sanitizeInput(identifier);\n\n  // Validate code format for security\n  if (!isValidCode(sanitizedId) && !sanitizedId.includes('@')) {\n    return { error: 'Định dạng tài khoản không hợp lệ' };\n  }\n\n  // Find user email from identifier\n  const userEmail = await findUserEmailByIdentifier(sanitizedId);\n\n  if (!userEmail) {\n    return { error: 'Sai tài khoản hoặc mật khẩu' };\n  }\n\n  // Authenticate with Supabase\n  const supabase = await createClient();\n  const { data: authData, error: authError } = await supabase.auth.signInWithPassword({\n    email: userEmail,\n    password: password,\n  });\n\n  if (authError || !authData.user) {\n    return { error: 'Sai tài khoản hoặc mật khẩu' };\n  }\n\n  // Get user profile\n  const user = await getUserProfile(authData.user.id);\n\n  if (!user) {\n    return { error: 'Không tìm thấy thông tin người dùng' };\n  }\n\n  // === Session management ===\n  const sessionToken = authData.session?.access_token || generateSessionToken();\n\n  // Get device info\n  const userAgent = await getUserAgent();\n  const deviceInfo = parseUserAgent(userAgent);\n  const ipAddress = await getClientIP();\n\n  // Terminate existing sessions\n  await terminateUserSessions(user.id, 'new_login');\n\n  // Broadcast logout to old sessions\n  await broadcastSessionTermination(user.id, 'new_login');\n\n  // Create new session\n  const sessionInsert: UserSessionInsert = {\n    user_id: user.id,\n    session_token: sessionToken,\n    is_active: true,\n    device_type: deviceInfo.type,\n    device_id: deviceInfo.id,\n    user_agent: userAgent,\n    ip_address: ipAddress,\n  };\n\n  const { data: newSession, error: sessionError } = await supabase\n    .from('user_sessions')\n    .insert(sessionInsert)\n    .select('id')\n    .single();\n\n  if (sessionError) {\n    console.error('Failed to create session:', sessionError);\n    // Continue anyway - auth is valid\n  }\n\n  // Set auth cookies\n  const cookieStore = await cookies();\n  cookieStore.set(AUTH_COOKIE_NAME, JSON.stringify(user), {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === 'production',\n    sameSite: 'lax',\n    maxAge: AUTH_COOKIE_MAX_AGE,\n    path: '/',\n    priority: 'high',\n  });\n\n  cookieStore.set(SESSION_COOKIE_NAME, newSession?.id || '', {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === 'production',\n    sameSite: 'strict',\n    maxAge: AUTH_COOKIE_MAX_AGE,\n    path: '/',\n    priority: 'high',\n  });\n\n  // Role-based redirect\n  const redirectMap: Record<UserRole, string> = {\n    admin: '/admin/dashboard',\n    teacher: '/teacher/dashboard',\n    parent: '/student/dashboard',\n    student: '/student/dashboard',\n  };\n\n  redirect(redirectMap[user.role]);\n}\n\n/**\n * Login with identifier and password\n * For backward compatibility with tests\n */\nexport async function login(formData: FormData): Promise<LoginState | void>;\n\n/**\n * Login with identifier and password\n * For useFormState hook\n */\nexport async function login(prevState: LoginState | null, formData: FormData): Promise<LoginState | void>;\n\n/**\n * Login implementation with overload support\n */\nexport async function login(arg1: FormData | LoginState | null, arg2?: FormData): Promise<LoginState | void> {\n  // Handle useFormState signature: login(prevState, formData)\n  if (arg2 instanceof FormData) {\n    const formData = arg2;\n    const identifier = formData.get('identifier') as string;\n    const email = formData.get('email') as string;\n    const password = formData.get('password') as string;\n    return loginImpl(identifier || email, password);\n  }\n\n  // Handle direct/test signature: login(formData)\n  if (arg1 instanceof FormData) {\n    const formData = arg1;\n    const identifier = formData.get('identifier') as string;\n    const email = formData.get('email') as string;\n    const password = formData.get('password') as string;\n    return loginImpl(identifier || email, password);\n  }\n\n  // Should not reach here\n  return { error: 'Invalid login call' };\n}\n\n/**\n * Logout and clear session\n */\nexport async function logout() {\n  const cookieStore = await cookies();\n  const sessionId = cookieStore.get(SESSION_COOKIE_NAME)?.value;\n  const authCookie = cookieStore.get(AUTH_COOKIE_NAME)?.value;\n\n  if (authCookie) {\n    try {\n      const user = JSON.parse(authCookie);\n\n      // Deactivate session in database\n      if (sessionId) {\n        const supabase = await createClient();\n        await supabase\n          .from('user_sessions')\n          .update({\n            is_active: false,\n            terminated_at: new Date().toISOString(),\n            termination_reason: 'manual'\n          })\n          .eq('id', sessionId);\n      }\n    } catch {\n      // Ignore errors during logout\n    }\n  }\n\n  // Sign out from Supabase\n  const supabase = await createClient();\n  await supabase.auth.signOut();\n\n  // Clear cookies\n  cookieStore.delete(AUTH_COOKIE_NAME);\n  cookieStore.delete(SESSION_COOKIE_NAME);\n\n  redirect('/login');\n}\n\n/**\n * Get current authenticated user from cookie\n * Validates session with Supabase\n *\n * NOTE: Cannot delete cookies here - Next.js App Router forbids cookie mutations\n * during GET requests (page rendering). Invalid sessions return null and trigger\n * redirect via requireAuth(). Cookie cleanup happens in logout() Server Action.\n */\nexport async function getUser(): Promise<User | null> {\n  const cookieStore = await cookies();\n  const authCookie = cookieStore.get(AUTH_COOKIE_NAME);\n\n  if (!authCookie?.value) {\n    return null;\n  }\n\n  try {\n    const user = JSON.parse(authCookie.value) as User;\n\n    // Verify session is still valid with Supabase\n    const supabase = await createClient();\n    const { data: { session }, error } = await supabase.auth.getSession();\n\n    // Handle auth errors (invalid/refresh tokens)\n    if (error || !session) {\n      console.debug('[Auth] Session invalid or error:', error?.message || 'No session')\n      // Session expired or error - return null, let requireAuth handle redirect\n      return null;\n    }\n\n    return user;\n  } catch {\n    // Invalid cookie format - return null, let requireAuth handle redirect\n    return null;\n  }\n}\n\n/**\n * Require authentication - redirect to login if not authenticated\n */\nexport async function requireAuth(): Promise<User> {\n  const user = await getUser();\n\n  if (!user) {\n    redirect('/login');\n  }\n\n  return user;\n}\n\n/**\n * Require specific role - redirect if user doesn't have required role\n */\nexport async function requireRole(requiredRole: UserRole): Promise<User> {\n  const user = await requireAuth();\n\n  if (user.role !== requiredRole) {\n    redirect('/login');\n  }\n\n  return user;\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\lib\\constants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\lib\\hooks\\use-session-monitor.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\lib\\middleware\\session-validation.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[419,422],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[419,422],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Session Validation Middleware\n * Validates user sessions on each request\n */\n\nimport { NextResponse } from 'next/server'\nimport type { NextRequest } from 'next/server'\nimport { createClient } from '@/lib/supabase/server'\nimport type { User } from '@school-management/shared-types'\n\ninterface SessionValidationResult {\n  valid: boolean\n  reason?: 'no_session' | 'session_not_found' | 'invalid_cookie'\n  session?: any\n  user?: User\n}\n\n// Cache for last_active updates to prevent DB write spam\nconst lastActiveUpdateCache = new Map<string, number>();\nconst LAST_ACTIVE_THROTTLE_MS = 5 * 60 * 1000; // 5 minutes\n\n/**\n * Validate session middleware\n * Use in route handlers or as Next.js middleware\n */\nexport async function validateSession(request: NextRequest): Promise<SessionValidationResult> {\n  const sessionId = request.cookies.get('session_id')?.value\n  const authCookie = request.cookies.get('auth')?.value\n\n  if (!sessionId || !authCookie) {\n    return { valid: false, reason: 'no_session' }\n  }\n\n  try {\n    const user = JSON.parse(authCookie) as User\n    const supabase = await createClient()\n\n    // Check session exists and is active\n    const { data: session, error } = await supabase\n      .from('user_sessions')\n      .select('*')\n      .eq('id', sessionId)\n      .eq('user_id', user.id)\n      .eq('is_active', true)\n      .single()\n\n    if (error || !session) {\n      return { valid: false, reason: 'session_not_found' }\n    }\n\n    // Update last_active only if throttled (5 minute intervals)\n    const now = Date.now();\n    const lastUpdate = lastActiveUpdateCache.get(sessionId) || 0;\n\n    if (now - lastUpdate > LAST_ACTIVE_THROTTLE_MS) {\n      await supabase\n        .from('user_sessions')\n        // @ts-expect-error - user_sessions table exists in DB but not in generated types\n        .update({ last_active: new Date().toISOString() })\n        .eq('id', sessionId);\n      lastActiveUpdateCache.set(sessionId, now);\n    }\n\n    return { valid: true, session, user }\n\n  } catch {\n    return { valid: false, reason: 'invalid_cookie' }\n  }\n}\n\n/**\n * Redirect to login if session invalid\n */\nexport async function requireValidSession(request: NextRequest) {\n  const validation = await validateSession(request)\n\n  if (!validation.valid) {\n    const loginUrl = new URL('/login', request.url)\n    loginUrl.searchParams.set('reason', validation.reason || 'session_expired')\n    return NextResponse.redirect(loginUrl)\n  }\n\n  return validation\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\lib\\mock-data.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ScheduleItem' is defined but never used.","line":10,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'User' is defined but never used.","line":15,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":7},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'teacherId' is defined but never used. Allowed unused args must match /^_/u.","line":112,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":112,"endColumn":48},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'teacherId' is defined but never used. Allowed unused args must match /^_/u.","line":143,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":143,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'date' is defined but never used. Allowed unused args must match /^_/u.","line":144,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":144,"endColumn":7},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'teacherId' is defined but never used. Allowed unused args must match /^_/u.","line":171,"column":41,"nodeType":null,"messageId":"unusedVar","endLine":171,"endColumn":50},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'classId' is defined but never used. Allowed unused args must match /^_/u.","line":207,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":207,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'status' is defined but never used. Allowed unused args must match /^_/u.","line":208,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":208,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'teacherId' is defined but never used. Allowed unused args must match /^_/u.","line":234,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":234,"endColumn":47},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'period' is assigned a value but never used.","line":372,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":372,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'semester' is assigned a value but never used.","line":381,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":381,"endColumn":43},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'classId' is defined but never used. Allowed unused args must match /^_/u.","line":463,"column":40,"nodeType":null,"messageId":"unusedVar","endLine":463,"endColumn":47},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'filters' is defined but never used. Allowed unused args must match /^_/u.","line":478,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":478,"endColumn":42},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'teacherId' is defined but never used. Allowed unused args must match /^_/u.","line":535,"column":45,"nodeType":null,"messageId":"unusedVar","endLine":535,"endColumn":54},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'teacherId' is defined but never used. Allowed unused args must match /^_/u.","line":560,"column":41,"nodeType":null,"messageId":"unusedVar","endLine":560,"endColumn":50},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'teacherId' is defined but never used. Allowed unused args must match /^_/u.","line":585,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":585,"endColumn":55}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":16,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// @ts-nocheck\n// ==================== MOCK DATA ====================\n// Temporary mock data functions for components\n// TODO: Replace with real Supabase queries\n\nimport type {\n  Conversation,\n  Message,\n  TeacherStats,\n  ScheduleItem,\n  TeacherClass,\n  LeaveRequest,\n  DashboardStats,\n  Student,\n  User,\n  Class,\n  Invoice,\n  Notification,\n  AttendanceStats,\n  FeeStats,\n  ChartData,\n  GradeDistribution,\n  Activity,\n  Assessment,\n  GradeEntry,\n  AttendanceRecord,\n  ConductRating,\n  TeacherScheduleItem,\n  ClassManagementDetail,\n  RegularAssessment,\n  HomeroomClassDetail,\n  LeaveRequestApproval,\n  FeeItem,\n  FeeAssignment,\n  GradeData\n} from '@/lib/types'\n\n// ==================== MESSAGES ====================\n\nexport async function getConversations(): Promise<Conversation[]> {\n  return [\n    {\n      id: '1',\n      parentName: 'Nguyễn Văn A',\n      studentName: 'Nguyễn Văn B',\n      studentId: 'HS20260001',\n      className: '6A1',\n      lastMessage: 'Thầy cho em hỏi về bài tập hôm nay ạ...',\n      timestamp: new Date(Date.now() - 1000 * 60 * 5).toISOString(),\n      unreadCount: 2,\n      online: true\n    },\n    {\n      id: '2',\n      parentName: 'Trần Thị C',\n      studentName: 'Trần Văn D',\n      studentId: 'HS20260002',\n      className: '6A1',\n      lastMessage: 'Cảm ơn thầy đã thông báo',\n      timestamp: new Date(Date.now() - 1000 * 60 * 60 * 2).toISOString(),\n      unreadCount: 0,\n      online: false\n    },\n    {\n      id: '3',\n      parentName: 'Lê Văn E',\n      studentName: 'Lê Thị F',\n      studentId: 'HS20260003',\n      className: '6A2',\n      lastMessage: 'Con em ốm nên nghỉ học hôm nay ạ...',\n      timestamp: new Date(Date.now() - 1000 * 60 * 60 * 24).toISOString(),\n      unreadCount: 1,\n      online: false\n    }\n  ]\n}\n\nexport async function getMessages(conversationId: string): Promise<Message[]> {\n  return [\n    {\n      id: '1',\n      conversationId,\n      senderId: 'teacher-1',\n      senderName: 'Thầy Nguyễn Văn X',\n      content: 'Chào phụ huynh, thầy có gì muốn trao đổi ạ?',\n      timestamp: new Date(Date.now() - 1000 * 60 * 60).toISOString(),\n      isFromTeacher: true\n    },\n    {\n      id: '2',\n      conversationId,\n      senderId: 'parent-1',\n      senderName: 'Phụ huynh Nguyễn Văn A',\n      content: 'Thầy cho em hỏi về bài tập hôm nay ạ...',\n      timestamp: new Date(Date.now() - 1000 * 60 * 5).toISOString(),\n      isFromTeacher: false\n    }\n  ]\n}\n\n// Alias for teacher-specific conversations\nexport async function getTeacherConversations(): Promise<Conversation[]> {\n  return getConversations()\n}\n\nexport async function getConversationMessages(conversationId: string): Promise<Message[]> {\n  return getMessages(conversationId)\n}\n\n// ==================== TEACHER DATA ====================\n\nexport async function getTeacherStats(teacherId?: string): Promise<TeacherStats> {\n  return {\n    homeroom: 1,\n    teaching: 5,\n    students: 150,\n    pendingAttendance: 2,\n    pendingGrades: 3,\n    gradeReviewRequests: 1,\n    leaveRequests: 2,\n    todaySchedule: [\n      {\n        id: '1',\n        period: '1',\n        time: '7:30 - 8:15',\n        className: '6A1',\n        subject: 'Toán',\n        room: '101'\n      },\n      {\n        id: '2',\n        period: '2',\n        time: '8:15 - 9:00',\n        className: '6A2',\n        subject: 'Toán',\n        room: '102'\n      }\n    ]\n  }\n}\n\nexport async function getTeacherSchedule(\n  teacherId?: string,\n  date?: string\n): Promise<TeacherScheduleItem[]> {\n  return [\n    {\n      period: 1,\n      time: '7:30 - 8:15',\n      className: '6A1',\n      subject: 'Toán',\n      room: '101'\n    },\n    {\n      period: 2,\n      time: '8:15 - 9:00',\n      className: '6A2',\n      subject: 'Toán',\n      room: '102'\n    },\n    {\n      period: 3,\n      time: '9:15 - 10:00',\n      className: '7A1',\n      subject: 'Toán',\n      room: '201'\n    }\n  ]\n}\n\nexport async function getTeacherClasses(teacherId?: string): Promise<TeacherClass[]> {\n  return [\n    {\n      id: '6A1',\n      name: '6A1',\n      subject: 'Toán',\n      grade: '6',\n      room: '101',\n      studentCount: 35,\n      schedule: 'Thứ 2-4-6',\n      isHomeroom: true\n    },\n    {\n      id: '6A2',\n      name: '6A2',\n      subject: 'Toán',\n      grade: '6',\n      room: '102',\n      studentCount: 32,\n      schedule: 'Thứ 3-5-7',\n      isHomeroom: false\n    },\n    {\n      id: '7A1',\n      name: '7A1',\n      subject: 'Toán',\n      grade: '7',\n      room: '201',\n      studentCount: 30,\n      schedule: 'Thứ 2-4-6',\n      isHomeroom: false\n    }\n  ]\n}\n\nexport async function getLeaveRequests(\n  classId?: string,\n  status?: 'pending' | 'approved' | 'rejected'\n): Promise<LeaveRequest[]> {\n  return [\n    {\n      id: '1',\n      studentId: 'HS20260001',\n      studentName: 'Nguyễn Văn B',\n      startDate: '2026-01-25',\n      endDate: '2026-01-26',\n      reason: 'Con bị ốm sốt',\n      status: 'pending',\n      submittedDate: '2026-01-23'\n    },\n    {\n      id: '2',\n      studentId: 'HS20260003',\n      studentName: 'Lê Thị F',\n      startDate: '2026-01-24',\n      endDate: '2026-01-24',\n      reason: 'Đi việc gia đình',\n      status: 'approved',\n      submittedDate: '2026-01-22'\n    }\n  ]\n}\n\nexport async function getAssessments(teacherId?: string): Promise<Assessment[]> {\n  return [\n    {\n      id: '1',\n      classId: '6A1',\n      className: '6A1',\n      subject: 'Toán',\n      type: 'quiz',\n      name: 'Kiểm tra 15 phút số 1',\n      date: '2026-01-20',\n      maxScore: 10,\n      submittedCount: 33,\n      totalCount: 35,\n      status: 'published'\n    },\n    {\n      id: '2',\n      classId: '6A1',\n      className: '6A1',\n      subject: 'Toán',\n      type: 'midterm',\n      name: 'Giữa kỳ 1',\n      date: '2026-01-15',\n      maxScore: 10,\n      submittedCount: 35,\n      totalCount: 35,\n      status: 'graded'\n    }\n  ]\n}\n\n// ==================== DASHBOARD ====================\n\nexport async function getDashboardStats(): Promise<DashboardStats> {\n  return {\n    students: 450,\n    parents: 420,\n    teachers: 25,\n    attendance: '95%',\n    feesCollected: '85%',\n    revenue: 2500000000,\n    pendingPayments: 45\n  }\n}\n\nexport async function getStudents(): Promise<Student[]> {\n  return [\n    {\n      id: 'HS20260001',\n      name: 'Nguyễn Văn B',\n      grade: '6A1',\n      attendance: 95,\n      feesStatus: 'paid'\n    },\n    {\n      id: 'HS20260002',\n      name: 'Trần Văn D',\n      grade: '6A1',\n      attendance: 90,\n      feesStatus: 'pending'\n    },\n    {\n      id: 'HS20260003',\n      name: 'Lê Thị F',\n      grade: '6A2',\n      attendance: 98,\n      feesStatus: 'paid'\n    }\n  ]\n}\n\nexport async function getClasses(): Promise<Class[]> {\n  return [\n    {\n      id: '6A1',\n      name: '6A1',\n      grade: '6',\n      teacher: 'Thầy Nguyễn Văn X',\n      studentCount: 35,\n      room: '101'\n    },\n    {\n      id: '6A2',\n      name: '6A2',\n      grade: '6',\n      teacher: 'Cô Trần Thị Y',\n      studentCount: 32,\n      room: '102'\n    }\n  ]\n}\n\nexport async function getInvoices(): Promise<Invoice[]> {\n  return [\n    {\n      id: 'INV001',\n      studentId: 'HS20260001',\n      studentName: 'Nguyễn Văn B',\n      amount: 1500000,\n      status: 'paid',\n      dueDate: '2026-01-15',\n      paidDate: '2026-01-10'\n    },\n    {\n      id: 'INV002',\n      studentId: 'HS20260002',\n      studentName: 'Trần Văn D',\n      amount: 1500000,\n      status: 'pending',\n      dueDate: '2026-01-20'\n    }\n  ]\n}\n\nexport async function getNotifications(): Promise<Notification[]> {\n  return [\n    {\n      id: '1',\n      title: 'Họp phụ huynh',\n      message: 'Họp phụ huynh cuối kỳ vào ngày 25/01/2026',\n      type: 'info',\n      targetRole: 'all',\n      createdAt: '2026-01-20T10:00:00Z'\n    },\n    {\n      id: '2',\n      title: 'Nhắc nộp học phí',\n      message: 'Nhắc nhở các phụ huynh chưa nộp học phí',\n      type: 'warning',\n      targetRole: 'parent',\n      createdAt: '2026-01-19T14:00:00Z'\n    }\n  ]\n}\n\n// ==================== OTHER DATA ====================\n\nexport async function getAttendanceStats(\n  period: 'week' | 'month' | 'semester' = 'week'\n): Promise<AttendanceStats> {\n  return {\n    excused: 5,\n    unexcused: 2,\n    tardy: 8\n  }\n}\n\nexport async function getFeeStats(semester: '1' | '2' = '1'): Promise<FeeStats> {\n  return {\n    percentage: 85,\n    paidAmount: '2.125.000.000đ',\n    remainingAmount: '375.000.000đ',\n    totalAmount: '2.500.000.000đ',\n    paidStudents: 380,\n    totalStudents: 450\n  }\n}\n\nexport async function getAttendanceData(): Promise<ChartData[]> {\n  return [\n    { name: 'Có mặt', value: 95 },\n    { name: 'Vắng mặt', value: 3 },\n    { name: 'Muộn', value: 2 }\n  ]\n}\n\nexport async function getFeesData(): Promise<ChartData[]> {\n  return [\n    { name: 'Đã đóng', value: 380 },\n    { name: 'Chưa đóng', value: 45 },\n    { name: 'Quá hạn', value: 25 }\n  ]\n}\n\nexport async function getGradeDistribution(): Promise<GradeDistribution[]> {\n  return [\n    { grade: 'Giỏi', percentage: 32, color: 'bg-green-500' },\n    { grade: 'Khá', percentage: 45, color: 'bg-blue-500' },\n    { grade: 'Trung bình', percentage: 18, color: 'bg-orange-500' },\n    { grade: 'Yếu', percentage: 5, color: 'bg-red-500' }\n  ]\n}\n\nexport async function getActivities(): Promise<Activity[]> {\n  return [\n    {\n      id: '1',\n      user: 'Admin',\n      action: 'Đã thêm học sinh mới',\n      time: '5 phút trước',\n      note: 'Thêm Nguyễn Văn B vào lớp 6A1'\n    },\n    {\n      id: '2',\n      user: 'Thầy Nguyễn X',\n      action: 'Đã điểm danh',\n      time: '1 giờ trước',\n      note: 'Điểm danh lớp 6A1'\n    }\n  ]\n}\n\nexport async function getGradeEntrySheet(\n  classId: string,\n  subject?: string\n): Promise<{ students: GradeEntry[]; subject: string }> {\n  return {\n    subject: subject || 'Toán',\n    students: [\n      {\n        studentId: 'HS20260001',\n        studentName: 'Nguyễn Văn B',\n        oral: [8, 9],\n        quiz: [7, 8],\n        midterm: 8,\n        final: 0\n      },\n      {\n        studentId: 'HS20260002',\n        studentName: 'Trần Văn D',\n        oral: [7, 8],\n        quiz: [7, 7],\n        midterm: 7,\n        final: 0\n      }\n    ]\n  }\n}\n\nexport async function getClassStudents(classId: string): Promise<AttendanceRecord[]> {\n  return [\n    {\n      studentId: 'HS20260001',\n      studentName: 'Nguyễn Văn B',\n      status: 'present'\n    },\n    {\n      studentId: 'HS20260002',\n      studentName: 'Trần Văn D',\n      status: 'present'\n    }\n  ]\n}\n\nexport async function getFeeItems(filters?: {\n  semester?: string\n  type?: 'mandatory' | 'voluntary'\n}): Promise<FeeItem[]> {\n  return [\n    {\n      id: 'FI001',\n      name: 'Học phí',\n      code: 'HP',\n      type: 'mandatory',\n      amount: 1500000,\n      semester: '1',\n      status: 'active'\n    },\n    {\n      id: 'FI002',\n      name: 'Tiền ăn bán trú',\n      code: 'BT',\n      type: 'voluntary',\n      amount: 800000,\n      semester: '1',\n      status: 'active'\n    }\n  ]\n}\n\nexport async function getFeeAssignments(): Promise<FeeAssignment[]> {\n  return [\n    {\n      id: 'FA001',\n      name: 'Đóng học phí HK1',\n      targetGrades: ['6', '7', '8', '9'],\n      targetClasses: [],\n      feeItems: ['FI001'],\n      startDate: '2026-01-01',\n      dueDate: '2026-01-30',\n      reminderDays: 7,\n      reminderFrequency: 'weekly',\n      totalStudents: 450,\n      totalAmount: 675000000,\n      status: 'published',\n      createdAt: '2025-12-20'\n    }\n  ]\n}\n\nexport async function getGradeData(): Promise<GradeData[]> {\n  return [\n    { grade: '6', classes: ['6A1', '6A2', '6A3'], students: 120 },\n    { grade: '7', classes: ['7A1', '7A2', '7A3'], students: 115 },\n    { grade: '8', classes: ['8A1', '8A2'], students: 110 },\n    { grade: '9', classes: ['9A1', '9A2'], students: 105 }\n  ]\n}\n\n// ==================== ADDITIONAL MISSING EXPORTS ====================\n\nexport async function getRegularAssessments(teacherId?: string): Promise<RegularAssessment[]> {\n  return [\n    {\n      studentId: 'HS20260001',\n      studentName: 'Nguyễn Văn B',\n      classId: '6A1',\n      className: '6A1',\n      subject: 'Toán',\n      status: 'evaluated',\n      comment: { category: 'Học tập', content: 'Học tốt, cần chú ý phép tính' },\n      rating: 4,\n      createdAt: '2026-01-20T10:00:00Z'\n    },\n    {\n      studentId: 'HS20260002',\n      studentName: 'Trần Văn D',\n      classId: '6A1',\n      className: '6A1',\n      subject: 'Toán',\n      status: 'pending',\n      createdAt: '2026-01-20T10:00:00Z'\n    }\n  ]\n}\n\nexport async function getConductRatings(teacherId?: string): Promise<ConductRating[]> {\n  return [\n    {\n      studentId: 'HS20260001',\n      studentName: 'Nguyễn Văn B',\n      mssv: 'HS20260001',\n      academicRating: 'good',\n      academicScore: 85,\n      conductRating: 'good',\n      semester: '1',\n      notes: 'Học tập tốt, kỷ luật tốt'\n    },\n    {\n      studentId: 'HS20260002',\n      studentName: 'Trần Văn D',\n      mssv: 'HS20260002',\n      academicRating: 'average',\n      academicScore: 72,\n      conductRating: 'fair',\n      semester: '1',\n      notes: 'Cần cố gắng hơn nữa'\n    }\n  ]\n}\n\nexport async function getGradeReviewRequests(teacherId?: string): Promise<Array<{\n  id: string\n  studentName?: string\n  className?: string\n  assessmentType?: string\n  currentScore?: number\n  reason?: string\n  status?: string\n}>> {\n  return [\n    {\n      id: '1',\n      studentName: 'Trần Văn D',\n      className: '6A1',\n      assessmentType: 'quiz',\n      currentScore: 7,\n      reason: 'Em làm sai do nhầm đề',\n      status: 'pending'\n    }\n  ]\n}\n\nexport async function getClassManagementData(classId: string): Promise<ClassManagementDetail> {\n  return {\n    classId,\n    className: '6A1',\n    subject: 'Toán',\n    grade: '6',\n    room: '101',\n    schedule: await getTeacherSchedule(),\n    students: [\n      {\n        id: 'HS20260001',\n        name: 'Nguyễn Văn B',\n        code: 'HS20260001',\n        email: 'hs001@school.edu',\n        phone: '0901234567',\n        status: 'active'\n      },\n      {\n        id: 'HS20260002',\n        name: 'Trần Văn D',\n        code: 'HS20260002',\n        email: 'hs002@school.edu',\n        phone: '0901234568',\n        status: 'active'\n      }\n    ]\n  }\n}\n\nexport async function getHomeroomClassData(classId: string): Promise<HomeroomClassDetail> {\n  return {\n    classId,\n    className: '6A1',\n    grade: '6',\n    room: '101',\n    studentCount: 35,\n    maleCount: 18,\n    femaleCount: 17,\n    classMonitor: 'Nguyễn Văn B',\n    students: [\n      {\n        id: 'HS20260001',\n        name: 'Nguyễn Văn B',\n        code: 'HS20260001',\n        dob: '2013-05-15',\n        parentName: 'Nguyễn Văn A',\n        parentPhone: '0901234567',\n        address: '123 Đường ABC, Quận 1, TP.HCM'\n      },\n      {\n        id: 'HS20260003',\n        name: 'Lê Thị F',\n        code: 'HS20260003',\n        dob: '2013-08-20',\n        parentName: 'Lê Văn E',\n        parentPhone: '0901234569',\n        address: '456 Đường XYZ, Quận 2, TP.HCM'\n      }\n    ]\n  }\n}\n\nexport async function getLeaveApprovalRequests(): Promise<LeaveRequestApproval[]> {\n  return [\n    {\n      id: '1',\n      studentId: 'HS20260001',\n      studentName: 'Nguyễn Văn B',\n      classId: '6A1',\n      className: '6A1',\n      startDate: '2026-01-25',\n      endDate: '2026-01-26',\n      reason: 'Con bị ốm sốt',\n      status: 'pending',\n      submittedDate: '2026-01-23',\n      parentContact: '0901234567'\n    }\n  ]\n}\n\n// Mock class type for admin components\nexport interface MockClass {\n  id: string\n  name: string\n  grade: string\n  room: string\n  teacher: string\n  studentCount: number\n  status: 'active' | 'inactive'\n}\n\nexport const MockClass = {\n  create: (data: Omit<MockClass, 'id'>): MockClass => ({\n    id: `CLASS-${Date.now()}`,\n    ...data\n  }),\n\n  getAll: async (): Promise<MockClass[]> => [\n    {\n      id: '6A1',\n      name: '6A1',\n      grade: '6',\n      room: '101',\n      teacher: 'Thầy Nguyễn Văn X',\n      studentCount: 35,\n      status: 'active'\n    },\n    {\n      id: '6A2',\n      name: '6A2',\n      grade: '6',\n      room: '102',\n      teacher: 'Cô Trần Thị Y',\n      studentCount: 32,\n      status: 'active'\n    },\n    {\n      id: '7A1',\n      name: '7A1',\n      grade: '7',\n      room: '201',\n      teacher: 'Thầy Lê Văn Z',\n      studentCount: 30,\n      status: 'active'\n    }\n  ],\n\n  getById: async (id: string): Promise<MockClass | null> => {\n    const classes = await MockClass.getAll()\n    return classes.find(c => c.id === id) || null\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\lib\\security-utils.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'request' is defined but never used. Allowed unused args must match /^_/u.","line":161,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":161,"endColumn":45},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'request' is defined but never used. Allowed unused args must match /^_/u.","line":201,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":201,"endColumn":45},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'options' is defined but never used. Allowed unused args must match /^_/u.","line":201,"column":56,"nodeType":null,"messageId":"unusedVar","endLine":201,"endColumn":63}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Security utility functions for input validation and sanitization.\n *\n * IMPORTANT: This is a demo with mock authentication.\n * TODO: Add real authentication and security measures before production.\n */\n\n/**\n * Sanitizes user input to prevent XSS attacks.\n * Strips HTML tags and special characters.\n * For production: Use DOMPurify library for comprehensive sanitization.\n */\nexport function sanitizeInput(input: string): string {\n  if (!input) return ''\n\n  // Remove HTML tags and special characters\n  // Allow alphanumeric, spaces, and common Vietnamese characters\n  return input\n    .replace(/<[^>]*>/g, '') // Remove HTML tags\n    .replace(/[<>]/g, '') // Remove remaining < and >\n    .trim()\n}\n\n/**\n * Sanitizes search query parameters.\n * Allows alphanumeric, spaces, and Vietnamese characters.\n */\nexport function sanitizeSearch(search: string): string {\n  if (!search) return ''\n\n  // Allow word characters, spaces, and Vietnamese characters (À-ỹ)\n  return search.replace(/[^\\w\\sÀ-ỹà-ỹ]/gi, '').trim()\n}\n\n/**\n * Validates password strength.\n * Returns object with isValid flag and error message.\n *\n * Requirements:\n * - Minimum 8 characters\n * - At least one uppercase letter\n * - At least one lowercase letter\n * - At least one number\n */\nexport function validatePassword(password: string): {\n  isValid: boolean\n  error?: string\n} {\n  if (!password) {\n    return { isValid: false, error: 'Mật khẩu không được để trống' }\n  }\n\n  if (password.length < 8) {\n    return { isValid: false, error: 'Mật khẩu phải có ít nhất 8 ký tự' }\n  }\n\n  if (!/[A-Z]/.test(password)) {\n    return { isValid: false, error: 'Mật khẩu phải có ít nhất một chữ hoa' }\n  }\n\n  if (!/[a-z]/.test(password)) {\n    return { isValid: false, error: 'Mật khẩu phải có ít nhất một chữ thường' }\n  }\n\n  if (!/[0-9]/.test(password)) {\n    return { isValid: false, error: 'Mật khẩu phải có ít nhất một số' }\n  }\n\n  return { isValid: true }\n}\n\n/**\n * Validates date range for academic year and semesters.\n * Ensures:\n * - Semester dates are within year dates\n * - Semester 2 starts after Semester 1 ends\n * - No overlapping semesters\n */\nexport function validateDateRange(data: {\n  startDate: string\n  endDate: string\n  semester1Start: string\n  semester1End: string\n  semester2Start: string\n  semester2End: string\n}): { isValid: boolean; errors: string[] } {\n  const errors: string[] = []\n\n  const start = new Date(data.startDate)\n  const end = new Date(data.endDate)\n  const s1Start = new Date(data.semester1Start)\n  const s1End = new Date(data.semester1End)\n  const s2Start = new Date(data.semester2Start)\n  const s2End = new Date(data.semester2End)\n\n  // Check basic date validity\n  if (s1Start < start) {\n    errors.push('HK1 bắt đầu phải sau ngày bắt đầu năm học')\n  }\n\n  if (s1End > end) {\n    errors.push('HK1 kết thúc phải trước ngày kết thúc năm học')\n  }\n\n  if (s2Start < start) {\n    errors.push('HK2 bắt đầu phải sau ngày bắt đầu năm học')\n  }\n\n  if (s2End > end) {\n    errors.push('HK2 kết thúc phải trước ngày kết thúc năm học')\n  }\n\n  // Check semester ordering\n  if (s1End >= s2Start) {\n    errors.push('HK2 bắt đầu phải sau HK1 kết thúc')\n  }\n\n  // Check semester validity\n  if (s1Start >= s1End) {\n    errors.push('HK1 kết thúc phải sau ngày bắt đầu HK1')\n  }\n\n  if (s2Start >= s2End) {\n    errors.push('HK2 kết thúc phải sau ngày bắt đầu HK2')\n  }\n\n  return {\n    isValid: errors.length === 0,\n    errors\n  }\n}\n\n/**\n * Safe type assertion with fallback.\n * Prevents runtime errors from unsafe type assertions.\n */\nexport function safeTypeAssert<T>(\n  value: unknown,\n  fallback: T,\n  validator?: (value: unknown) => boolean\n): T {\n  if (validator) {\n    return validator(value) ? (value as T) : fallback\n  }\n\n  // Basic check: ensure value is not null/undefined\n  return value != null ? (value as T) : fallback\n}\n\n/**\n * Mock authentication check for demo purposes.\n *\n * IMPORTANT: This is a DEMO with MOCK authentication.\n * TODO: Replace with real authentication middleware before production.\n *\n * Real implementation should:\n * - Validate JWT token or session\n * - Check user permissions\n * - Verify role-based access\n */\nexport async function getCurrentUser(request: Request): Promise<{\n  user: { id: string; email: string; role: string } | null\n  error?: string\n}> {\n  // TODO: Implement real authentication\n  // For demo, always return admin user\n  return {\n    user: {\n      id: 'admin-1',\n      email: 'admin@school.edu',\n      role: 'admin'\n    }\n  }\n\n  /* Production implementation:\n  try {\n    const token = request.headers.get('authorization')?.replace('Bearer ', '')\n    if (!token) {\n      return { user: null, error: 'No token provided' }\n    }\n\n    const decoded = await verifyJWT(token)\n    return { user: decoded }\n  } catch (error) {\n    return { user: null, error: 'Invalid token' }\n  }\n  */\n}\n\n/**\n * Mock rate limiter for demo purposes.\n *\n * IMPORTANT: Rate limiting is not implemented in this demo.\n * TODO: Add real rate limiting before production (e.g., Redis-based, Upstash).\n *\n * Real implementation should:\n * - Track request count per IP/user\n * - Implement sliding window or token bucket\n * - Return 429 when limit exceeded\n */\nexport async function checkRateLimit(request: Request, options: {\n  windowMs: number\n  maxRequests: number\n}): Promise<{ allowed: boolean; error?: string }> {\n  // TODO: Implement real rate limiting\n  // For demo, always allow requests\n  return { allowed: true }\n\n  /* Production implementation:\n  const ip = request.headers.get('x-forwarded-for') || 'unknown'\n  const key = `rate-limit:${ip}`\n\n  const count = await redis.incr(key)\n  if (count === 1) {\n    await redis.expire(key, Math.ceil(options.windowMs / 1000))\n  }\n\n  if (count > options.maxRequests) {\n    return {\n      allowed: false,\n      error: 'Too many requests. Please try again later.'\n    }\n  }\n\n  return { allowed: true }\n  */\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\lib\\services\\notification-service.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Database' is defined but never used.","line":19,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SupabaseClient' is defined but never used.","line":20,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PostgrestError' is defined but never used.","line":28,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'completeNotification' is assigned a value but never used.","line":124,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":124,"endColumn":37},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":273,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":273,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8154,8157],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8154,8157],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":376,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":376,"endColumn":14,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[10963,11092],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":421,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":421,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12107,12110],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12107,12110],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":473,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":473,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[13349,13454],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":476,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":476,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13473,13476],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13473,13476],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":495,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":495,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13897,13900],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13897,13900],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":511,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":511,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14541,14544],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14541,14544],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":526,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":526,"endColumn":14,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[14980,15081],"text":""},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Multi-Channel Notification Service\n * Handles notification creation, delivery, and tracking\n *\n * Supports:\n * - Tiered delivery (emergency/announcement/reminder)\n * - Multiple channels (WebSocket, email, in-app, push)\n * - Delivery tracking and retry logic\n *\n * NOTE: @ts-nocheck is used due to TypeScript type inference issues with\n * Supabase client for notification tables. The types are correctly defined\n * in types/supabase.ts and the database schema matches. Runtime behavior is correct.\n */\n\n// @ts-nocheck\n'use server';\n\nimport { createClient } from '@/lib/supabase/server';\nimport type { Database } from '@/types/supabase';\nimport type { SupabaseClient } from '@supabase/supabase-js';\nimport type {\n  NotificationCreateInput,\n  NotificationWithRecipients,\n  NotificationListItem,\n  UserNotification,\n  DeliveryStatus,\n} from '@school-management/shared-types';\nimport type { PostgrestError } from '@supabase/supabase-js';\n\n/**\n * Create notification with recipients and trigger delivery\n * @param input Notification data from admin form\n * @param senderId ID of the admin creating the notification\n * @returns Created notification with recipients\n */\nexport async function createNotification(\n  input: NotificationCreateInput,\n  senderId: string\n): Promise<NotificationWithRecipients> {\n  const supabase = await createClient();\n\n  // 1. Validate input\n  if (!input.title?.trim() || !input.content?.trim()) {\n    throw new Error('Title and content are required');\n  }\n\n  // Sanitize input to prevent XSS\n  const sanitizedTitle = sanitizeHtml(input.title);\n  const sanitizedContent = sanitizeHtml(input.content);\n\n  // 2. Create notification\n  // @ts-expect-error - Supabase type inference issue with notifications table\n  const { data: notification, error: notifError } = await supabase\n    .from('notifications')\n    .insert({\n      sender_id: senderId,\n      recipient_id: senderId, // Temporary, will be replaced by recipients\n      title: sanitizedTitle,\n      content: sanitizedContent,\n      category: input.category,\n      priority: input.priority,\n      scheduled_for: input.scheduledFor || null,\n      type: getCategoryType(input.category),\n      is_read: false,\n    })\n    .select()\n    .single();\n\n  if (notifError) {\n    console.error('[Notification] Failed to create:', notifError);\n    throw new Error(`Failed to create notification: ${notifError.message}`);\n  }\n\n  // 3. Resolve recipients using database function\n  // @ts-expect-error - Supabase type inference issue with RPC functions\n  const { data: recipients, error: recipientsError } = await supabase.rpc(\n    'get_notification_recipients',\n    {\n      p_target_role: input.targetRole === 'all' ? null : input.targetRole,\n      p_target_grade_ids: input.targetGradeIds || null,\n      p_target_class_ids: input.targetClassIds || null,\n      p_specific_user_ids: input.targetUserIds || null,\n    }\n  );\n\n  if (recipientsError) {\n    console.error('[Notification] Failed to resolve recipients:', recipientsError);\n    throw new Error(`Failed to resolve recipients: ${recipientsError.message}`);\n  }\n\n  if (!recipients || recipients.length === 0) {\n    // Clean up notification if no recipients\n    // @ts-expect-error - Supabase type inference issue with notifications table\n    await supabase.from('notifications').delete().eq('id', notification.id);\n    throw new Error('No recipients found for the given criteria');\n  }\n\n  // 4. Create notification_recipients entries\n  const recipientEntries = recipients.map((r: { user_id: string; role: string }) => ({\n    notification_id: notification.id,\n    recipient_id: r.user_id,\n    role: r.role,\n  }));\n\n  // @ts-expect-error - Supabase type inference issue with notification_recipients table\n  const { error: insertError } = await supabase\n    .from('notification_recipients')\n    .insert(recipientEntries);\n\n  if (insertError) {\n    console.error('[Notification] Failed to create recipients:', insertError);\n    throw new Error(`Failed to add recipients: ${insertError.message}`);\n  }\n\n  // 5. Trigger delivery (non-blocking)\n  // Don't await - let it run in background\n  // @ts-expect-error - notification.id type inference issue\n  deliverNotification(notification.id, recipientEntries).catch((error) => {\n    console.error('[Notification] Delivery error:', error);\n  });\n\n  // 6. Fetch complete notification with recipients\n  // @ts-expect-error - Supabase type inference issue with notification_recipients table\n  const { data: completeNotification } = await supabase\n    .from('notification_recipients')\n    .select(`\n      id,\n      notification_id,\n      recipient_id,\n      role,\n      created_at,\n      notifications (\n        id,\n        sender_id,\n        title,\n        content,\n        type,\n        category,\n        priority,\n        scheduled_for,\n        expires_at,\n        is_read,\n        read_at,\n        created_at\n      )\n    `)\n    .eq('notification_id', notification.id)\n    .limit(1);\n\n  return {\n    id: notification.id,\n    senderId: notification.sender_id,\n    title: notification.title,\n    content: notification.content,\n    type: notification.type,\n    category: notification.category,\n    priority: notification.priority,\n    scheduledFor: notification.scheduled_for,\n    expiresAt: notification.expires_at,\n    isRead: notification.is_read,\n    readAt: notification.read_at,\n    createdAt: notification.created_at,\n    recipients: recipientEntries.map((r, i) => ({\n      id: `temp-${i}`,\n      notificationId: notification.id,\n      recipientId: r.recipient_id,\n      role: r.role,\n      createdAt: new Date().toISOString(),\n    })),\n    logs: [],\n  };\n}\n\n/**\n * Get notifications for admin (paginated)\n */\nexport async function getNotifications(options: {\n  page: number;\n  limit: number;\n}): Promise<{ data: NotificationListItem[]; total: number }> {\n  const supabase = await createClient();\n  const { page, limit } = options;\n  const from = (page - 1) * limit;\n  const to = from + limit - 1;\n\n  // Get count\n  const { count } = await supabase\n    .from('notifications')\n    .select('*', { count: 'exact', head: true });\n\n  // Get paginated data\n  const { data, error } = await supabase\n    .from('notifications')\n    .select('id, title, content, category, priority, is_read, created_at')\n    .order('created_at', { ascending: false })\n    .range(from, to);\n\n  if (error) {\n    throw new Error(`Failed to fetch notifications: ${error.message}`);\n  }\n\n  return {\n    data: (data || []).map((n) => ({\n      id: n.id,\n      title: n.title,\n      content: n.content,\n      category: n.category,\n      priority: n.priority,\n      isRead: n.is_read,\n      createdAt: n.created_at,\n    })),\n    total: count || 0,\n  };\n}\n\n/**\n * Get current user's notifications\n */\nexport async function getMyNotifications(\n  userId: string,\n  unreadOnly = false\n): Promise<UserNotification[]> {\n  const supabase = await createClient();\n\n  const query = supabase\n    .from('notification_recipients')\n    .select(`\n      notifications (\n        id,\n        title,\n        content,\n        type,\n        category,\n        priority,\n        is_read,\n        read_at,\n        created_at,\n        sender_id\n      )\n    `)\n    .eq('recipient_id', userId)\n    .order('created_at', { ascending: false, foreignTable: 'notifications' });\n\n  if (unreadOnly) {\n    // Filter for unread - need to use a different approach\n    const { data, error } = await supabase\n      .from('notifications')\n      .select('id, title, content, type, category, priority, is_read, read_at, created_at, sender_id')\n      .eq('recipient_id', userId)\n      .eq('is_read', false)\n      .order('created_at', { ascending: false });\n\n    if (error) throw new Error(`Failed to fetch notifications: ${error.message}`);\n\n    return (data || []).map((n) => ({\n      id: n.id,\n      title: n.title,\n      content: n.content,\n      type: n.type,\n      category: n.category,\n      priority: n.priority,\n      isRead: n.is_read,\n      readAt: n.read_at,\n      createdAt: n.created_at,\n    }));\n  }\n\n  const { data, error } = await query;\n\n  if (error) throw new Error(`Failed to fetch notifications: ${error.message}`);\n\n  return (\n    data?.map((item: any) => ({\n      id: item.notifications.id,\n      title: item.notifications.title,\n      content: item.notifications.content,\n      type: item.notifications.type,\n      category: item.notifications.category,\n      priority: item.notifications.priority,\n      isRead: item.notifications.is_read,\n      readAt: item.notifications.read_at,\n      createdAt: item.notifications.created_at,\n    })) || []\n  );\n}\n\n/**\n * Mark notifications as read\n */\nexport async function markAsRead(notificationIds: string[], userId: string): Promise<void> {\n  const supabase = await createClient();\n\n  const { error } = await supabase\n    .from('notifications')\n    .update({\n      is_read: true,\n      read_at: new Date().toISOString(),\n    })\n    .in('id', notificationIds)\n    .eq('recipient_id', userId);\n\n  if (error) {\n    throw new Error(`Failed to mark as read: ${error.message}`);\n  }\n}\n\n/**\n * Get delivery status for a notification\n */\nexport async function getDeliveryStatus(notificationId: string): Promise<DeliveryStatus> {\n  const supabase = await createClient();\n\n  // Get total recipients\n  const { count: totalRecipients } = await supabase\n    .from('notification_recipients')\n    .select('*', { count: 'exact', head: true })\n    .eq('notification_id', notificationId);\n\n  // Get logs by status\n  const { data: logs } = await supabase\n    .from('notification_logs')\n    .select('status, channel')\n    .eq('notification_id', notificationId);\n\n  const stats = {\n    total: totalRecipients || 0,\n    delivered: 0,\n    failed: 0,\n    pending: 0,\n    channels: [] as {\n      channel: 'websocket' | 'email' | 'in_app' | 'push';\n      sent: number;\n      delivered: number;\n      failed: number;\n    }[],\n  };\n\n  // Calculate stats\n  logs?.forEach((log) => {\n    if (log.status === 'delivered') stats.delivered++;\n    else if (log.status === 'failed') stats.failed++;\n    else if (log.status === 'pending') stats.pending++;\n  });\n\n  return stats;\n}\n\n// ============================================================================\n// INTERNAL FUNCTIONS\n// ============================================================================\n\n/**\n * Deliver notification via appropriate channels\n */\nasync function deliverNotification(\n  notificationId: string,\n  recipients: Array<{ notification_id: string; recipient_id: string; role: string }>\n): Promise<void> {\n  const supabase = await createClient();\n\n  // Get notification details\n  const { data: notification } = await supabase\n    .from('notifications')\n    .select('*')\n    .eq('id', notificationId)\n    .single();\n\n  if (!notification) {\n    console.error(`[Notification] Notification ${notificationId} not found`);\n    return;\n  }\n\n  // Determine channels based on priority\n  const channels = getChannelsForPriority(notification.priority, notification.category);\n\n  console.log(\n    `[Notification] Delivering ${notificationId} via ${channels.join(', ')} to ${recipients.length} recipients`\n  );\n\n  // Deliver to each recipient via each channel\n  for (const recipient of recipients) {\n    for (const channel of channels) {\n      try {\n        await deliverViaChannel(channel, notification, recipient.recipient_id);\n      } catch (error) {\n        console.error(\n          `[Notification] Delivery failed: ${channel} -> ${recipient.recipient_id}`,\n          error\n        );\n      }\n    }\n  }\n}\n\n/**\n * Determine delivery channels based on priority\n */\nfunction getChannelsForPriority(\n  priority: string,\n  category: string\n): Array<'websocket' | 'email' | 'in_app'> {\n  // Emergency: All channels\n  if (priority === 'emergency' || category === 'emergency') {\n    return ['websocket', 'email', 'in_app'];\n  }\n\n  // Announcement: WebSocket + email\n  if (category === 'announcement') {\n    return ['websocket', 'email'];\n  }\n\n  // Reminder: In-app only\n  return ['in_app'];\n}\n\n/**\n * Deliver via specific channel\n */\nasync function deliverViaChannel(\n  channel: 'websocket' | 'email' | 'in_app',\n  notification: any,\n  recipientId: string\n): Promise<void> {\n  const supabase = await createClient();\n\n  // Create log entry\n  const { data: log, error: logError } = await supabase\n    .from('notification_logs')\n    .insert({\n      notification_id: notification.id,\n      recipient_id: recipientId,\n      channel,\n      status: 'pending',\n    })\n    .select()\n    .single();\n\n  if (logError) {\n    console.error('[Notification] Failed to create log:', logError);\n    throw logError;\n  }\n\n  try {\n    let externalId: string | undefined;\n\n    switch (channel) {\n      case 'websocket':\n        // WebSocket broadcast via Supabase Realtime\n        externalId = await broadcastWebSocket(notification, recipientId);\n        break;\n\n      case 'email':\n        // Email delivery (placeholder for now - requires email service)\n        externalId = await sendEmail(notification, recipientId);\n        break;\n\n      case 'in_app':\n        // Already in notifications table\n        externalId = notification.id;\n        break;\n    }\n\n    // Update log as sent\n    await supabase\n      .from('notification_logs')\n      .update({\n        status: 'sent',\n        sent_at: new Date().toISOString(),\n        external_id: externalId,\n      })\n      .eq('id', log.id);\n\n    console.log(\n      `[Notification] Delivered via ${channel} to ${recipientId}: ${notification.id}`\n    );\n  } catch (error: any) {\n    // Update log as failed\n    await supabase\n      .from('notification_logs')\n      .update({\n        status: 'failed',\n        failed_at: new Date().toISOString(),\n        error_message: error.message?.substring(0, 500) || 'Unknown error',\n        retry_count: 1,\n      })\n      .eq('id', log.id);\n\n    throw error;\n  }\n}\n\n/**\n * Broadcast via Supabase Realtime\n */\nasync function broadcastWebSocket(notification: any, recipientId: string): Promise<string> {\n  // Note: This requires Supabase Realtime to be properly configured\n  // For now, we return a channel ID - actual broadcast will be handled\n  // by the client subscribing to postgres_changes on the notifications table\n  const channelName = `user:${recipientId}:notifications`;\n\n  // The actual broadcast happens automatically via Supabase Realtime\n  // when the notification is inserted into the notifications table\n  // Clients subscribe to postgres_changes events\n\n  return channelName;\n}\n\n/**\n * Send email (placeholder - requires email service setup)\n */\nasync function sendEmail(notification: any, recipientId: string): Promise<string> {\n  // Get recipient email\n  const supabase = await createClient();\n  const { data: profile } = await supabase\n    .from('profiles')\n    .select('email, full_name')\n    .eq('id', recipientId)\n    .single();\n\n  if (!profile?.email) {\n    throw new Error('Recipient email not found');\n  }\n\n  // TODO: Integrate with email service (Resend/SendGrid)\n  // For now, just log that email would be sent\n  console.log(\n    `[Notification] Email would be sent to ${profile.email}: ${notification.title}`\n  );\n\n  // Return placeholder ID\n  return `email-placeholder-${Date.now()}`;\n}\n\n/**\n * Map category to legacy type field\n */\nfunction getCategoryType(category: string): string {\n  switch (category) {\n    case 'emergency':\n      return 'error';\n    case 'reminder':\n      return 'info';\n    case 'announcement':\n      return 'success';\n    default:\n      return 'info';\n  }\n}\n\n/**\n * Sanitize HTML to prevent XSS attacks\n * Removes script tags, javascript: protocols, and event handlers\n */\nfunction sanitizeHtml(input: string): string {\n  return input\n    .replace(/<script[^>]*>.*?<\\/script>/gis, '')\n    .replace(/<[^>]*>/g, '')\n    .replace(/javascript:/gi, '')\n    .replace(/onerror=/gi, '')\n    .replace(/onload=/gi, '')\n    .replace(/onclick=/gi, '')\n    .trim();\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\lib\\supabase\\client-auth.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":33,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":33,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"debug"},"fix":{"range":[889,974],"text":""},"desc":"Remove the console.debug()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":52,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":52,"endColumn":24,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"debug"},"fix":{"range":[1492,1554],"text":""},"desc":"Remove the console.debug()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":59,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":59,"endColumn":24,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"debug"},"fix":{"range":[1793,1852],"text":""},"desc":"Remove the console.debug()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":159,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":159,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4576,4630],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":178,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":178,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"debug"},"fix":{"range":[5067,5140],"text":""},"desc":"Remove the console.debug()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Client-side Auth Utilities\n *\n * Handles auth state changes and errors on the browser side.\n * Use this in client components to detect auth failures and redirect to login.\n */\n\n'use client';\n\nimport { createClient } from './client';\nimport type { AuthError } from '@supabase/supabase-js';\n\nlet authListenersInitialized = false;\nlet redirecting = false;\n\n/**\n * Setup auth error handling listeners\n * Should be called once on app initialization (e.g., in root layout or a provider)\n */\nexport function setupAuthListeners() {\n  if (authListenersInitialized || typeof window === 'undefined') {\n    return;\n  }\n\n  const supabase = createClient();\n\n  // Track number of consecutive refresh errors\n  let refreshErrorCount = 0;\n  const MAX_REFRESH_ERRORS = 2; // Reduced to fail faster\n\n  const { data: { subscription } } = supabase.auth.onAuthStateChange(\n    (event, session) => {\n      console.debug('[Auth] State change:', event, session ? 'has session' : 'no session');\n\n      switch (event) {\n        case 'INITIAL_SESSION':\n          // Initial session loaded - check if valid\n          if (!session) {\n            console.warn('[Auth] No initial session, redirecting to login');\n            redirectToLogin();\n          }\n          break;\n\n        case 'SIGNED_IN':\n          // User signed in - reset error counter\n          refreshErrorCount = 0;\n          redirecting = false;\n          break;\n\n        case 'SIGNED_OUT':\n          // User signed out - redirect to login\n          console.debug('[Auth] User signed out, redirecting to login');\n          redirectToLogin();\n          break;\n\n        // @ts-expect-error - USER_DELETED is a valid Supabase auth event but not in type definitions\n        case 'USER_DELETED':\n          // User was deleted - redirect to login\n          console.debug('[Auth] User deleted, redirecting to login');\n          redirectToLogin();\n          break;\n\n        case 'TOKEN_REFRESHED':\n          // Token was refreshed successfully - reset error counter\n          if (session) {\n            refreshErrorCount = 0;\n          } else {\n            // Token refresh failed - session is null\n            refreshErrorCount++;\n            console.warn(`[Auth] Token refresh failed (${refreshErrorCount}/${MAX_REFRESH_ERRORS})`);\n\n            if (refreshErrorCount >= MAX_REFRESH_ERRORS) {\n              console.error('[Auth] Too many refresh failures, redirecting to login');\n              redirectToLogin();\n            }\n          }\n          break;\n\n        default:\n          break;\n      }\n    }\n  );\n\n  // Override console.error to catch auth errors globally\n  const originalError = console.error;\n  console.error = function (...args) {\n    // Call original first\n    originalError.apply(console, args);\n\n    // Prevent infinite redirect loop\n    if (redirecting) return;\n\n    // Check if this is a Supabase auth error\n    const firstArg = args[0];\n    if (isRefreshTokenError(firstArg)) {\n      console.error('[Auth] Critical auth error detected, redirecting to login');\n      redirectToLogin();\n    }\n  };\n\n  // Also check session validity immediately\n  checkSessionValidity().then(isValid => {\n    if (!isValid && !redirecting) {\n      console.warn('[Auth] Initial session check failed, redirecting to login');\n      redirectToLogin();\n    }\n  });\n\n  authListenersInitialized = true;\n\n  // Return cleanup function\n  return () => {\n    subscription.unsubscribe();\n    authListenersInitialized = false;\n    console.error = originalError;\n  };\n}\n\n/**\n * Check if an error is a refresh token error\n */\nfunction isRefreshTokenError(error: unknown): boolean {\n  if (!error) return false;\n\n  // Check for AuthError object with code\n  if (typeof error === 'object' && error !== null && 'code' in error) {\n    const code = (error as { code: string }).code;\n    return (\n      code === 'refresh_token_not_found' ||\n      code === 'invalid_refresh_token' ||\n      code === 'session_not_found'\n    );\n  }\n\n  // Check for error message string\n  if (typeof error === 'string') {\n    return error.includes('refresh_token_not_found') ||\n           error.includes('Invalid Refresh Token');\n  }\n\n  return false;\n}\n\n/**\n * Redirect to login page with current URL as return destination\n */\nfunction redirectToLogin() {\n  if (redirecting) return;\n  redirecting = true;\n\n  const currentPath = window.location.pathname + window.location.search;\n  const loginUrl = currentPath === '/login'\n    ? '/login'\n    : `/login?redirect=${encodeURIComponent(currentPath)}`;\n\n  // Avoid infinite redirect loops\n  if (window.location.pathname !== '/login') {\n    console.log('[Auth] Redirecting to login:', loginUrl);\n    window.location.href = loginUrl;\n  }\n}\n\n/**\n * Check if current session is valid\n * Returns true if session exists and is valid, false otherwise\n */\nexport async function checkSessionValidity(): Promise<boolean> {\n  if (typeof window === 'undefined') {\n    return false;\n  }\n\n  try {\n    const supabase = createClient();\n    const { data: { session }, error } = await supabase.auth.getSession();\n\n    if (error || !session) {\n      console.debug('[Auth] Session invalid:', error?.message || 'No session');\n      return false;\n    }\n\n    return true;\n  } catch (err) {\n    console.error('[Auth] Error checking session:', err);\n    return false;\n  }\n}\n\n/**\n * Handle auth errors from API calls\n * Use this in try/catch blocks when making authenticated requests\n */\nexport function handleAuthError(error: unknown): boolean {\n  // Returns true if error was an auth error that should trigger redirect\n  if (!error || redirecting) return false;\n\n  const authError = error as AuthError;\n\n  if (\n    authError?.status === 400 &&\n    (authError?.code === 'refresh_token_not_found' ||\n     authError?.code === 'invalid_refresh_token' ||\n     authError?.code === 'session_not_found')\n  ) {\n    console.error('[Auth] Auth error detected, redirecting to login:', authError.message);\n    redirectToLogin();\n    return true;\n  }\n\n  return false;\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\lib\\supabase\\client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\lib\\supabase\\queries.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Database' is defined but never used.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":109,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":109,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2374,2377],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2374,2377],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'homeroomCount' is assigned a value but never used.","line":325,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":325,"endColumn":31},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":371,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":371,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9735,9738],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9735,9738],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":439,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":439,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11811,11814],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11811,11814],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":469,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":469,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12806,12809],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12806,12809],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":505,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":505,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13638,13641],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13638,13641],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":575,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":575,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15104,15107],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15104,15107],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":846,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":846,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21879,21882],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21879,21882],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":900,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":900,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23407,23410],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23407,23410],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":943,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":943,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24497,24500],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24497,24500],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":983,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":983,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25450,25453],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25450,25453],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1032,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1032,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26657,26660],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26657,26660],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1078,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1078,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27743,27746],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27743,27746],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'semester' is assigned a value but never used.","line":1123,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":1123,"endColumn":43},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'supabase' is assigned a value but never used.","line":1233,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":1233,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'conversationId' is defined but never used. Allowed unused args must match /^_/u.","line":1243,"column":47,"nodeType":null,"messageId":"unusedVar","endLine":1243,"endColumn":61},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'supabase' is assigned a value but never used.","line":1244,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":1244,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1276,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1276,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[33209,33212],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[33209,33212],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1312,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1312,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[34018,34021],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[34018,34021],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'classIds' is assigned a value but never used.","line":1347,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":1347,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'supabase' is assigned a value but never used.","line":1359,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":1359,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'supabase' is assigned a value but never used.","line":1378,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":1378,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'supabase' is assigned a value but never used.","line":1398,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":1398,"endColumn":17}],"suppressedMessages":[],"errorCount":14,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// @ts-nocheck\n// ==================== SUPABASE DATA LAYER ====================\n// Real Supabase queries replacing all mock data functions\n// Uses server client for server components (async)\n// Performance: React cache() + Next.js fetch caching\n\nimport { cache } from 'react'\nimport { createClient as createServerClient } from './server'\nimport { Database } from '@/types/supabase'\nimport type {\n  DashboardStats,\n  Student,\n  User,\n  Class,\n  Invoice,\n  Notification,\n  AttendanceStats,\n  FeeStats,\n  ChartData,\n  GradeDistribution,\n  Activity,\n  TeacherClass,\n  TeacherStats,\n  ScheduleItem,\n  AttendanceRecord,\n  GradeEntry,\n  Assessment,\n  ConductRating,\n  Conversation,\n  Message,\n  LeaveRequest,\n  TeacherScheduleItem,\n  ClassManagementDetail,\n  RegularAssessment,\n  HomeroomClassDetail,\n  LeaveRequestApproval,\n  FeeItem,\n  FeeAssignment,\n  GradeData\n} from '@/lib/types'\n\n// Re-export types for convenience\nexport type {\n  DashboardStats,\n  Student,\n  User,\n  Class,\n  Invoice,\n  Notification,\n  AttendanceStats,\n  FeeStats,\n  ChartData,\n  GradeDistribution,\n  Activity,\n  TeacherClass,\n  TeacherStats,\n  ScheduleItem,\n  AttendanceRecord,\n  GradeEntry,\n  Assessment,\n  ConductRating,\n  Conversation,\n  Message,\n  LeaveRequest,\n  TeacherScheduleItem,\n  ClassManagementDetail,\n  RegularAssessment,\n  HomeroomClassDetail,\n  LeaveRequestApproval,\n  FeeItem,\n  FeeAssignment,\n  GradeData\n}\n\n// ==================== HELPER FUNCTIONS ====================\n\n/**\n * Get Supabase server client\n * Use this in all query functions\n */\nasync function getSupabase() {\n  return await createServerClient()\n}\n\n/**\n * Handle Supabase query errors gracefully\n */\nfunction handleQueryError(error: { message?: string; code?: string }, context: string): never {\n  console.error(`Supabase query error [${context}]:`, error)\n  throw new Error(`${context}: ${error.message || 'Unknown error'}`)\n}\n\n// ==================== USER MANAGEMENT ====================\n\n/**\n * Get all users with their profiles (cached)\n * Replaces: getUsers()\n */\nexport const getUsers = cache(async (): Promise<User[]> => {\n  const supabase = await getSupabase()\n\n  const { data, error } = await supabase\n    .from('profiles')\n    .select('id, email, role, full_name, status, avatar_url')\n    .order('created_at', { ascending: false })\n\n  if (error) handleQueryError(error, 'getUsers')\n\n  return (data || []).map((p: any) => ({\n    id: p.id,\n    name: p.full_name || p.email.split('@')[0],\n    email: p.email,\n    role: p.role as User['role'],\n    status: p.status as User['status'],\n    avatar: p.avatar_url || undefined\n  }))\n})\n\n/**\n * Get user by ID\n * Replaces: getUserById(id)\n */\nexport async function getUserById(id: string): Promise<User | null> {\n  const supabase = await getSupabase()\n\n  const { data, error } = await supabase\n    .from('profiles')\n    .select('id, email, role, full_name, status, avatar_url')\n    .eq('id', id)\n    .single()\n\n  if (error) {\n    if (error.code === 'PGRST116') return null // Not found\n    handleQueryError(error, 'getUserById')\n  }\n\n  if (!data) return null\n\n  return {\n    id: data.id,\n    name: data.full_name || data.email.split('@')[0],\n    email: data.email,\n    role: data.role as User['role'],\n    status: data.status as User['status'],\n    avatar: data.avatar_url || undefined\n  }\n}\n\n/**\n * Create new user profile\n * Note: Auth user is created separately via Supabase Auth\n */\nexport async function createUser(data: {\n  id: string\n  email: string\n  role: 'admin' | 'teacher' | 'parent' | 'student'\n  full_name?: string\n  phone?: string\n}): Promise<User> {\n  const supabase = await getSupabase()\n\n  const { data: profile, error } = await supabase\n    .from('profiles')\n    .insert({\n      id: data.id,\n      email: data.email,\n      role: data.role,\n      full_name: data.full_name,\n      phone: data.phone,\n      status: 'active'\n    })\n    .select('id, email, role, full_name, status, avatar_url')\n    .single()\n\n  if (error) handleQueryError(error, 'createUser')\n\n  return {\n    id: profile.id,\n    name: profile.full_name || profile.email.split('@')[0],\n    email: profile.email,\n    role: profile.role as User['role'],\n    status: profile.status as User['status']\n  }\n}\n\n/**\n * Update user profile\n */\nexport async function updateUser(\n  id: string,\n  updates: Partial<{\n    full_name: string\n    phone: string\n    avatar_url: string\n    status: 'active' | 'inactive'\n  }>\n): Promise<User> {\n  const supabase = await getSupabase()\n\n  const { data, error } = await supabase\n    .from('profiles')\n    .update(updates)\n    .eq('id', id)\n    .select('id, email, role, full_name, status, avatar_url')\n    .single()\n\n  if (error) handleQueryError(error, 'updateUser')\n\n  return {\n    id: data.id,\n    name: data.full_name || data.email.split('@')[0],\n    email: data.email,\n    role: data.role as User['role'],\n    status: data.status as User['status'],\n    avatar: data.avatar_url || undefined\n  }\n}\n\n/**\n * Delete user (sets status to inactive)\n */\nexport async function deleteUser(id: string): Promise<void> {\n  const supabase = await getSupabase()\n\n  const { error } = await supabase\n    .from('profiles')\n    .update({ status: 'inactive' })\n    .eq('id', id)\n\n  if (error) handleQueryError(error, 'deleteUser')\n}\n\n// ==================== DASHBOARD STATS ====================\n\n/**\n * Get dashboard statistics (cached, optimized with DB aggregations)\n * Replaces: getDashboardStats()\n */\nexport const getDashboardStats = cache(async (): Promise<DashboardStats> => {\n  const supabase = await getSupabase()\n\n  // Get counts in parallel\n  const [studentsResult, parentsResult, teachersResult] = await Promise.all([\n    supabase.from('profiles').select('id', { count: 'exact', head: true }).eq('role', 'student'),\n    supabase.from('profiles').select('id', { count: 'exact', head: true }).eq('role', 'parent'),\n    supabase.from('profiles').select('id', { count: 'exact', head: true }).eq('role', 'teacher'),\n  ])\n\n  // Calculate attendance using DB aggregation (instead of fetching all rows)\n  const today = new Date().toISOString().split('T')[0]\n\n  // Use RPC or aggregated queries for better performance\n  const [{ count: totalAttendance }, { count: presentCount }] = await Promise.all([\n    supabase\n      .from('attendance')\n      .select('id', { count: 'exact', head: true })\n      .eq('date', today),\n    supabase\n      .from('attendance')\n      .select('id', { count: 'exact', head: true })\n      .eq('date', today)\n      .eq('status', 'present')\n  ])\n\n  const attendanceRate = (totalAttendance || 0) > 0\n    ? Math.round(((presentCount || 0) / (totalAttendance || 1)) * 100)\n    : 100\n\n  // Calculate payment stats using DB aggregation (SUM + COUNT)\n  const [\n    { data: totalAmountData },\n    { data: collectedAmountData },\n    { count: pendingCount },\n    { count: overdueCount }\n  ] = await Promise.all([\n    // SUM of all invoice amounts\n    supabase\n      .from('invoices')\n      .select('total_amount')\n      .eq('status', 'paid'), // Only count paid invoices for revenue\n    // SUM of collected amounts\n    supabase\n      .from('invoices')\n      .select('paid_amount')\n      .eq('status', 'paid'),\n    // COUNT of pending/partial invoices\n    supabase\n      .from('invoices')\n      .select('id', { count: 'exact', head: true })\n      .in('status', ['pending', 'partial']),\n    // COUNT of overdue invoices\n    supabase\n      .from('invoices')\n      .select('id', { count: 'exact', head: true })\n      .eq('status', 'overdue')\n  ])\n\n  // Calculate totals from aggregated data\n  const collectedAmount = (collectedAmountData || [])\n    .reduce((sum: number, inv) => sum + (inv.paid_amount || 0), 0)\n  const totalAmount = (totalAmountData || [])\n    .reduce((sum: number, inv) => sum + (inv.total_amount || 0), 0)\n\n  const collectionRate = totalAmount > 0 ? Math.round((collectedAmount / totalAmount) * 100) : 0\n\n  return {\n    students: studentsResult.count || 0,\n    parents: parentsResult.count || 0,\n    teachers: teachersResult.count || 0,\n    attendance: `${attendanceRate}%`,\n    feesCollected: `${collectionRate}%`,\n    revenue: collectedAmount,\n    pendingPayments: (pendingCount || 0) + (overdueCount || 0)\n  }\n})\n\n/**\n * Get teacher-specific statistics (cached)\n * Replaces: getTeacherStats(teacherId)\n */\nexport const getTeacherStats = cache(async (teacherId: string): Promise<TeacherStats> => {\n  const supabase = await getSupabase()\n\n  // Get homeroom class count\n  const { count: homeroomCount } = await supabase\n    .from('enrollments')\n    .select('id', { count: 'exact', head: true })\n\n  // Get teaching classes count\n  const { count: teachingCount } = await supabase\n    .from('schedules')\n    .select('id', { count: 'exact', head: true })\n    .eq('teacher_id', teacherId)\n\n  // Get student count (unique students in all classes)\n  const { data: classData } = await supabase\n    .from('schedules')\n    .select('class_id')\n    .eq('teacher_id', teacherId)\n\n  const classIds = [...new Set(classData?.map((c) => c.class_id) || [])]\n  let studentCount = 0\n\n  if (classIds.length > 0) {\n    const { count } = await supabase\n      .from('enrollments')\n      .select('id', { count: 'exact', head: true })\n      .in('class_id', classIds)\n      .eq('status', 'active')\n    studentCount = count || 0\n  }\n\n  // Get today's schedule\n  const dayOfWeek = new Date().getDay()\n  const { data: scheduleData } = await supabase\n    .from('schedules')\n    .select(`\n      id,\n      period_id,\n      room,\n      class_id,\n      subject_id,\n      day_of_week,\n      periods(id, name, start_time, end_time),\n      classes(id, name, grade_id),\n      subjects(id, name, code)\n    `)\n    .eq('teacher_id', teacherId)\n    .eq('day_of_week', dayOfWeek)\n\n  const todaySchedule: ScheduleItem[] = (scheduleData || []).map((s: any) => ({\n    id: s.id,\n    period: s.periods?.name || `${s.period_id}`,\n    time: `${s.periods?.start_time} - ${s.periods?.end_time}`,\n    className: s.classes?.name || '',\n    subject: s.subjects?.name || '',\n    room: s.room || ''\n  }))\n\n  // Get pending counts (simplified - actual implementation would query real data)\n  const todayDate = new Date().toISOString().split('T')[0]\n  const { count: pendingAttendance } = await supabase\n    .from('attendance')\n    .select('id', { count: 'exact', head: true })\n    .eq('recorded_by', teacherId)\n    .eq('date', todayDate)\n    .is('recorded_by', null)\n\n  const { count: pendingGrades } = await supabase\n    .from('grade_entries')\n    .select('id', { count: 'exact', head: true })\n    .eq('graded_by', teacherId)\n    .eq('status', 'pending')\n\n  const { count: gradeReviewRequests } = await supabase\n    .from('grade_entries')\n    .select('id', { count: 'exact', head: true })\n    .eq('status', 'pending')\n\n  const { count: leaveRequests } = await supabase\n    .from('leave_requests')\n    .select('id', { count: 'exact', head: true })\n    .eq('status', 'pending')\n\n  return {\n    homeroom: 0, // Would need to query homeroom_assignments table\n    teaching: teachingCount || 0,\n    students: studentCount,\n    pendingAttendance: pendingAttendance || 0,\n    pendingGrades: pendingGrades || 0,\n    gradeReviewRequests: gradeReviewRequests || 0,\n    leaveRequests: leaveRequests || 0,\n    todaySchedule\n  }\n})\n\n// ==================== STUDENTS ====================\n\n/**\n * Get all students with enrollment info\n * Replaces: getStudents()\n */\nexport async function getStudents(): Promise<Student[]> {\n  const supabase = await getSupabase()\n\n  const { data, error } = await supabase\n    .from('students')\n    .select(`\n      id,\n      student_code,\n      profiles!inner(id, full_name, email, status),\n      enrollments!inner(class_id, status)\n    `)\n    .eq('enrollments.status', 'active')\n\n  if (error) handleQueryError(error, 'getStudents')\n\n  // Get attendance percentage for each student\n  const studentIds = (data || []).map((s: any) => s.id)\n  const attendanceMap = new Map<string, number>()\n\n  if (studentIds.length > 0) {\n    const { data: attendanceData } = await supabase\n      .from('attendance')\n      .select('student_id, status')\n      .in('student_id', studentIds)\n\n    attendanceData?.forEach((record) => {\n      const current = attendanceMap.get(record.student_id) || 0\n      attendanceMap.set(record.student_id, current + (record.status === 'present' ? 1 : 0))\n    })\n  }\n\n  // Get fee status from latest invoice\n  const { data: invoiceData } = await supabase\n    .from('invoices')\n    .select('student_id, status')\n    .in('student_id', studentIds)\n    .order('due_date', { ascending: false })\n\n  const feeStatusMap = new Map<string, Student['feesStatus']>()\n  invoiceData?.forEach((inv) => {\n    if (!feeStatusMap.has(inv.student_id)) {\n      feeStatusMap.set(inv.student_id, inv.status === 'paid' ? 'paid' :\n        inv.status === 'overdue' ? 'overdue' : 'pending')\n    }\n  })\n\n  return (data || []).map((s: any) => {\n    const enrollment = s.enrollments[0]\n    return {\n      id: s.id,\n      name: s.profiles.full_name || 'Unknown',\n      grade: enrollment.class_id,\n      attendance: Math.round((attendanceMap.get(s.id) || 0) * 100),\n      feesStatus: feeStatusMap.get(s.id) || 'pending'\n    }\n  })\n}\n\n// ==================== CLASSES ====================\n\n/**\n * Get all classes (cached)\n * Replaces: getClasses()\n */\nexport const getClasses = cache(async (): Promise<Class[]> => {\n  const supabase = await getSupabase()\n\n  const { data, error } = await supabase\n    .from('classes')\n    .select(`\n      id,\n      name,\n      grade_id,\n      room,\n      current_students,\n      grades!inner(id, name)\n    `)\n    .eq('status', 'active')\n    .order('name')\n\n  if (error) handleQueryError(error, 'getClasses')\n\n  return (data || []).map((c: any) => ({\n    id: c.id,\n    name: c.name,\n    grade: c.grades.name,\n    teacher: '', // Would need to join with assignments\n    studentCount: c.current_students,\n    room: c.room || ''\n  }))\n})\n\n/**\n * Get class by ID\n * Replaces: getClassById(id)\n */\nexport async function getClassById(id: string): Promise<Class | null> {\n  const supabase = await getSupabase()\n\n  const { data, error } = await supabase\n    .from('classes')\n    .select(`\n      id,\n      name,\n      grade_id,\n      room,\n      current_students,\n      grades!inner(id, name)\n    `)\n    .eq('id', id)\n    .single()\n\n  if (error) {\n    if (error.code === 'PGRST116') return null\n    handleQueryError(error, 'getClassById')\n  }\n\n  if (!data) return null\n\n  return {\n    id: data.id,\n    name: data.name,\n    grade: data.grades.name,\n    teacher: '',\n    studentCount: data.current_students,\n    room: data.room || ''\n  }\n}\n\n/**\n * Get students by class\n * Replaces: getStudentsByClass(classId)\n */\nexport async function getStudentsByClass(classId: string): Promise<Student[]> {\n  const supabase = await getSupabase()\n\n  const { data, error } = await supabase\n    .from('enrollments')\n    .select(`\n      student_id,\n      classes!inner(id, name),\n      students!inner(\n        id,\n        student_code,\n        profiles!inner(full_name)\n      )\n    `)\n    .eq('class_id', classId)\n    .eq('status', 'active')\n\n  if (error) handleQueryError(error, 'getStudentsByClass')\n\n  return (data || []).map((e: any) => ({\n    id: e.students.id,\n    name: e.students.profiles.full_name || 'Unknown',\n    grade: e.classes.name,\n    attendance: 95,\n    feesStatus: 'pending'\n  }))\n}\n\n// ==================== PAYMENTS & INVOICES ====================\n\n/**\n * Get all invoices (cached)\n * Replaces: getInvoices()\n */\nexport const getInvoices = cache(async (): Promise<Invoice[]> => {\n  const supabase = await getSupabase()\n\n  const { data, error } = await supabase\n    .from('invoice_summary')\n    .select('*')\n    .order('due_date', { ascending: false })\n\n  if (error) handleQueryError(error, 'getInvoices')\n\n  return (data || []).map((inv) => ({\n    id: inv.id,\n    studentId: inv.student_id,\n    studentName: inv.student_name,\n    amount: inv.total_amount,\n    status: inv.status as Invoice['status'],\n    dueDate: inv.due_date || undefined,\n    paidDate: inv.paid_date || undefined\n  }))\n})\n\n/**\n * Get invoice by ID\n * Replaces: getInvoiceById(id)\n */\nexport async function getInvoiceById(id: string): Promise<Invoice | null> {\n  const supabase = await getSupabase()\n\n  const { data, error } = await supabase\n    .from('invoice_summary')\n    .select('*')\n    .eq('id', id)\n    .single()\n\n  if (error) {\n    if (error.code === 'PGRST116') return null\n    handleQueryError(error, 'getInvoiceById')\n  }\n\n  if (!data) return null\n\n  return {\n    id: data.id,\n    studentId: data.student_id,\n    studentName: data.student_name,\n    amount: data.total_amount,\n    status: data.status as Invoice['status'],\n    dueDate: data.due_date,\n    paidDate: data.paid_date || undefined\n  }\n}\n\n/**\n * Get fee assignments (cached)\n * Replaces: getFeeAssignments()\n */\nexport const getFeeAssignments = cache(async (): Promise<FeeAssignment[]> => {\n  const supabase = await getSupabase()\n\n  const { data, error } = await supabase\n    .from('fee_assignments')\n    .select('*')\n    .order('created_at', { ascending: false })\n\n  if (error) handleQueryError(error, 'getFeeAssignments')\n\n  return (data || []).map((fa) => ({\n    id: fa.id,\n    name: fa.name,\n    targetGrades: fa.target_grades,\n    targetClasses: fa.target_classes || [],\n    feeItems: fa.fee_items,\n    startDate: fa.start_date,\n    dueDate: fa.due_date,\n    reminderDays: fa.reminder_days,\n    reminderFrequency: fa.reminder_frequency,\n    totalStudents: fa.total_students,\n    totalAmount: fa.total_amount,\n    status: fa.status as FeeAssignment['status'],\n    createdAt: fa.created_at\n  }))\n})\n\n/**\n * Get fee items (cached)\n * Replaces: getFeeItems(filters)\n */\nexport const getFeeItems = cache(async (filters?: {\n  semester?: string\n  type?: 'mandatory' | 'voluntary'\n}): Promise<FeeItem[]> => {\n  const supabase = await getSupabase()\n\n  let query = supabase\n    .from('fee_items')\n    .select('*')\n    .eq('status', 'active')\n\n  if (filters?.semester && filters.semester !== 'all') {\n    query = query.eq('semester', filters.semester as '1' | '2')\n  }\n\n  if (filters?.type) {\n    query = query.eq('fee_type', filters.type)\n  }\n\n  const { data, error } = await query.order('name')\n\n  if (error) handleQueryError(error, 'getFeeItems')\n\n  return (data || []).map((fi) => ({\n    id: fi.id,\n    name: fi.name,\n    code: fi.code,\n    type: fi.fee_type as FeeItem['type'],\n    amount: fi.amount,\n    semester: fi.semester as FeeItem['semester'],\n    status: fi.status as FeeItem['status']\n  }))\n})\n\n/**\n * Get payment statistics (cached)\n * Replaces: getPaymentStats()\n */\nexport const getPaymentStats = cache(async (): Promise<{\n  totalAmount: number\n  collectedAmount: number\n  pendingCount: number\n  overdueCount: number\n  collectionRate: number\n}> => {\n  const supabase = await getSupabase()\n\n  const { data: invoices } = await supabase\n    .from('invoices')\n    .select('total_amount, paid_amount, status')\n\n  if (!invoices) {\n    return { totalAmount: 0, collectedAmount: 0, pendingCount: 0, overdueCount: 0, collectionRate: 0 }\n  }\n\n  const totalAmount = invoices.reduce((sum: number, inv) => sum + inv.total_amount, 0)\n  const collectedAmount = invoices.reduce((sum: number, inv) => sum + inv.paid_amount, 0)\n  const pendingCount = invoices.filter((inv) => ['pending', 'partial'].includes(inv.status)).length\n  const overdueCount = invoices.filter((inv) => inv.status === 'overdue').length\n  const collectionRate = totalAmount > 0 ? Math.round((collectedAmount / totalAmount) * 100) : 0\n\n  return {\n    totalAmount,\n    collectedAmount,\n    pendingCount,\n    overdueCount,\n    collectionRate\n  }\n})\n\n// ==================== ATTENDANCE ====================\n\n/**\n * Get attendance statistics\n * Replaces: getAttendanceStats(period)\n */\nexport async function getAttendanceStats(\n  period: 'week' | 'month' | 'semester' = 'week'\n): Promise<AttendanceStats> {\n  const supabase = await getSupabase()\n\n  // Calculate date range\n  const now = new Date()\n  const startDate = new Date()\n\n  switch (period) {\n    case 'week':\n      startDate.setDate(now.getDate() - 7)\n      break\n    case 'month':\n      startDate.setMonth(now.getMonth() - 1)\n      break\n    case 'semester':\n      startDate.setMonth(now.getMonth() - 6)\n      break\n  }\n\n  const { data, error } = await supabase\n    .from('attendance')\n    .select('status')\n    .gte('date', startDate.toISOString().split('T')[0])\n\n  if (error) handleQueryError(error, 'getAttendanceStats')\n\n  const stats = {\n    excused: 0,\n    unexcused: 0,\n    tardy: 0\n  }\n\n  data?.forEach((record) => {\n    if (record.status === 'excused') stats.excused++\n    else if (record.status === 'absent') stats.unexcused++\n    else if (record.status === 'late') stats.tardy++\n  })\n\n  return stats\n}\n\n/**\n * Get attendance data for charts\n * Replaces: getAttendanceData()\n */\nexport async function getAttendanceData(): Promise<ChartData[]> {\n  const supabase = await getSupabase()\n\n  const { data } = await supabase\n    .from('attendance')\n    .select('status')\n\n  const counts = {\n    present: 0,\n    absent: 0,\n    late: 0\n  }\n\n  data?.forEach((record) => {\n    if (record.status === 'present') counts.present++\n    else if (record.status === 'absent') counts.absent++\n    else if (record.status === 'late') counts.late++\n  })\n\n  return [\n    { name: 'Present', value: counts.present },\n    { name: 'Absent', value: counts.absent },\n    { name: 'Late', value: counts.late }\n  ]\n}\n\n/**\n * Get class students for attendance marking\n * Replaces: getClassStudents(classId)\n */\nexport async function getClassStudents(classId: string): Promise<AttendanceRecord[]> {\n  const supabase = await getSupabase()\n\n  const { data, error } = await supabase\n    .from('enrollments')\n    .select(`\n      student_id,\n      students!inner(\n        profiles!inner(full_name)\n      )\n    `)\n    .eq('class_id', classId)\n    .eq('status', 'active')\n\n  if (error) handleQueryError(error, 'getClassStudents')\n\n  return (data || []).map((e: any) => ({\n    studentId: e.student_id,\n    studentName: e.students.profiles.full_name || 'Unknown',\n    status: 'present' as const\n  }))\n}\n\n// ==================== ACADEMICS ====================\n\n/**\n * Get assessments for a teacher (cached)\n * Replaces: getAssessments(teacherId)\n */\nexport const getAssessments = cache(async (teacherId: string): Promise<Assessment[]> => {\n  const supabase = await getSupabase()\n\n  const { data, error } = await supabase\n    .from('assessments')\n    .select(`\n      id,\n      name,\n      assessment_type,\n      date,\n      max_score,\n      semester,\n      class_id,\n      subject_id,\n      classes!inner(id, name),\n      subjects!inner(id, name)\n    `)\n    .eq('teacher_id', teacherId)\n    .order('date', { ascending: false })\n\n  if (error) handleQueryError(error, 'getAssessments')\n\n  // Get submission counts\n  const assessmentIds = (data || []).map((a) => a.id)\n  const submissionMap = new Map<string, { submitted: number; total: number }>()\n\n  if (assessmentIds.length > 0) {\n    const { data: gradeEntries } = await supabase\n      .from('grade_entries')\n      .select('assessment_id, status')\n      .in('assessment_id', assessmentIds)\n\n    gradeEntries?.forEach((entry) => {\n      const current = submissionMap.get(entry.assessment_id) || { submitted: 0, total: 0 }\n      submissionMap.set(entry.assessment_id, {\n        submitted: entry.status === 'graded' ? current.submitted + 1 : current.submitted,\n        total: current.total + 1\n      })\n    })\n  }\n\n  return (data || []).map((a: any) => {\n    const submissions = submissionMap.get(a.id) || { submitted: 0, total: 0 }\n    return {\n      id: a.id,\n      classId: a.class_id,\n      className: a.classes.name,\n      subject: a.subjects.name,\n      type: a.assessment_type as Assessment['type'],\n      name: a.name,\n      date: a.date,\n      maxScore: a.max_score,\n      submittedCount: submissions.submitted,\n      totalCount: submissions.total,\n      status: 'published' as const\n    }\n  })\n})\n\n/**\n * Get grade entry sheet for a class\n * Replaces: getGradeEntrySheet(classId, subject)\n */\nexport async function getGradeEntrySheet(\n  classId: string,\n  subject: string = 'Toán'\n): Promise<{ students: GradeEntry[]; subject: string }> {\n  const supabase = await getSupabase()\n\n  const { data, error } = await supabase\n    .from('enrollments')\n    .select(`\n      student_id,\n      students!inner(\n        profiles!inner(full_name)\n      )\n    `)\n    .eq('class_id', classId)\n    .eq('status', 'active')\n\n  if (error) handleQueryError(error, 'getGradeEntrySheet')\n\n  return {\n    subject,\n    students: (data || []).map((e: any) => ({\n      studentId: e.student_id,\n      studentName: e.students.profiles.full_name || 'Unknown',\n      oral: [],\n      quiz: [],\n      midterm: 0,\n      final: 0\n    }))\n  }\n}\n\n// ==================== TEACHER DATA ====================\n\n/**\n * Get teacher's classes (cached)\n * Replaces: getTeacherClasses(teacherId)\n */\nexport const getTeacherClasses = cache(async (teacherId?: string): Promise<TeacherClass[]> => {\n  const supabase = await getSupabase()\n\n  let query = supabase\n    .from('schedules')\n    .select(`\n      class_id,\n      room,\n      subjects!inner(id, name),\n      classes!inner(id, name, grade_id, current_students, grades!inner(name))\n    `)\n\n  if (teacherId) {\n    query = query.eq('teacher_id', teacherId)\n  }\n\n  const { data, error } = await query\n\n  if (error) handleQueryError(error, 'getTeacherClasses')\n\n  // Group by class and get unique classes\n  const classMap = new Map<string, TeacherClass>()\n\n  data?.forEach((s: any) => {\n    if (!classMap.has(s.class_id)) {\n      classMap.set(s.class_id, {\n        id: s.class_id,\n        name: s.classes.name,\n        subject: s.subjects.name,\n        grade: s.classes.grades.name,\n        room: s.room || '',\n        studentCount: s.classes.current_students,\n        schedule: '',\n        isHomeroom: false\n      })\n    }\n  })\n\n  return Array.from(classMap.values())\n})\n\n/**\n * Get teacher schedule (cached)\n * Replaces: getTeacherSchedule(teacherId, date)\n */\nexport const getTeacherSchedule = cache(async (\n  teacherId?: string,\n  date?: string\n): Promise<TeacherScheduleItem[]> => {\n  if (!teacherId) return []\n\n  const supabase = await getSupabase()\n\n  const targetDate = date ? new Date(date) : new Date()\n  const dayOfWeek = targetDate.getDay()\n\n  const { data, error } = await supabase\n    .from('schedules')\n    .select(`\n      period_id,\n      room,\n      day_of_week,\n      periods!inner(id, name, start_time, end_time),\n      classes!inner(id, name),\n      subjects!inner(id, name)\n    `)\n    .eq('teacher_id', teacherId)\n    .eq('day_of_week', dayOfWeek)\n    .order('period_id')\n\n  if (error) handleQueryError(error, 'getTeacherSchedule')\n\n  return (data || []).map((s: any) => ({\n    period: s.period_id,\n    time: `${s.periods.start_time} - ${s.periods.end_time}`,\n    className: s.classes.name,\n    subject: s.subjects.name,\n    room: s.room || '',\n    date: targetDate.toISOString().split('T')[0]\n  }))\n})\n\n// ==================== LEAVE REQUESTS ====================\n\n/**\n * Get leave requests for a class (cached)\n * Replaces: getLeaveRequests(classId, status)\n */\nexport const getLeaveRequests = cache(async (\n  classId: string,\n  status?: 'pending' | 'approved' | 'rejected'\n): Promise<LeaveRequest[]> => {\n  const supabase = await getSupabase()\n\n  let query = supabase\n    .from('leave_requests')\n    .select(`\n      id,\n      start_date,\n      end_date,\n      reason,\n      status,\n      created_at,\n      students!inner(\n        profiles!students_id_fkey(full_name)\n      )\n    `)\n    .eq('class_id', classId)\n    .order('created_at', { ascending: false })\n\n  if (status) {\n    query = query.eq('status', status)\n  }\n\n  const { data, error } = await query\n\n  if (error) handleQueryError(error, 'getLeaveRequests')\n\n  return (data || []).map((lr: any) => ({\n    id: lr.id,\n    studentId: lr.students.id,\n    studentName: lr.students.profiles.full_name || 'Unknown',\n    startDate: lr.start_date,\n    endDate: lr.end_date,\n    reason: lr.reason,\n    status: lr.status as LeaveRequest['status'],\n    submittedDate: lr.created_at\n  }))\n})\n\n// ==================== NOTIFICATIONS ====================\n\n/**\n * Get notifications (cached)\n * Replaces: getNotifications()\n */\nexport const getNotifications = cache(async (): Promise<Notification[]> => {\n  const supabase = await getSupabase()\n\n  const { data, error } = await supabase\n    .from('notifications')\n    .select('*')\n    .order('created_at', { ascending: false })\n    .limit(20)\n\n  if (error) handleQueryError(error, 'getNotifications')\n\n  return (data || []).map((n) => ({\n    id: n.id,\n    title: n.title,\n    message: n.content,\n    type: n.type as Notification['type'],\n    targetRole: 'all' as const, // Would need to map from recipient\n    createdAt: n.created_at\n  }))\n})\n\n// ==================== FEE STATS ====================\n\n/**\n * Get fee statistics by semester\n * Replaces: getFeeStats(semester)\n */\nexport async function getFeeStats(semester: '1' | '2' = '1'): Promise<FeeStats> {\n  const supabase = await getSupabase()\n\n  const { data: invoices } = await supabase\n    .from('invoices')\n    .select('total_amount, paid_amount')\n    .eq('status', 'paid')\n\n  const totalAmount = invoices?.reduce((sum: number, inv) => sum + inv.total_amount, 0) || 0\n  const paidAmount = invoices?.reduce((sum: number, inv) => sum + inv.paid_amount, 0) || 0\n  const remainingAmount = totalAmount - paidAmount\n\n  const { count: totalStudents } = await supabase\n    .from('profiles')\n    .select('id', { count: 'exact', head: true })\n    .eq('role', 'student')\n\n  return {\n    percentage: totalAmount > 0 ? Math.round((paidAmount / totalAmount) * 100) : 0,\n    paidAmount: formatCurrency(paidAmount),\n    remainingAmount: formatCurrency(remainingAmount),\n    totalAmount: formatCurrency(totalAmount),\n    paidStudents: invoices?.length || 0,\n    totalStudents: totalStudents || 0\n  }\n}\n\n/**\n * Get fees chart data\n * Replaces: getFeesData()\n */\nexport async function getFeesData(): Promise<ChartData[]> {\n  const supabase = await getSupabase()\n\n  const { data } = await supabase\n    .from('invoices')\n    .select('status, total_amount')\n\n  const counts = {\n    paid: { count: 0, amount: 0 },\n    pending: { count: 0, amount: 0 },\n    overdue: { count: 0, amount: 0 }\n  }\n\n  data?.forEach((inv) => {\n    if (inv.status === 'paid') counts.paid.count++\n    else if (inv.status === 'pending' || inv.status === 'partial') counts.pending.count++\n    else if (inv.status === 'overdue') counts.overdue.count++\n  })\n\n  return [\n    { name: 'Paid', value: counts.paid.count },\n    { name: 'Pending', value: counts.pending.count },\n    { name: 'Overdue', value: counts.overdue.count }\n  ]\n}\n\n// ==================== HELPER FUNCTIONS ====================\n\n/**\n * Format number to Vietnamese currency\n */\nfunction formatCurrency(amount: number): string {\n  return new Intl.NumberFormat('vi-VN', {\n    style: 'currency',\n    currency: 'VND',\n    maximumFractionDigits: 0\n  }).format(amount)\n}\n\n// ==================== ADDITIONAL FUNCTIONS ====================\n\n/**\n * Get activities (mock implementation for now)\n * Replaces: getActivities()\n */\nexport async function getActivities(): Promise<Activity[]> {\n  // TODO: Implement with real activity logging\n  return [\n    {\n      id: '1',\n      user: 'System',\n      action: 'Database migrated',\n      time: 'Just now',\n      note: 'Switched to Supabase data layer'\n    }\n  ]\n}\n\n/**\n * Get grade distribution (mock implementation for now)\n * Replaces: getGradeDistribution()\n */\nexport async function getGradeDistribution(): Promise<GradeDistribution[]> {\n  // TODO: Implement with real grade data\n  return [\n    { grade: 'Giỏi', percentage: 32, color: 'bg-green-500' },\n    { grade: 'Khá', percentage: 45, color: 'bg-blue-500' },\n    { grade: 'Trung bình', percentage: 18, color: 'bg-orange-500' },\n    { grade: 'Yếu', percentage: 5, color: 'bg-red-500' },\n  ]\n}\n\n// ==================== ADDITIONAL EXPORTS ====================\n\n/**\n * Get teacher conversations (messages)\n * Replaces: getTeacherConversations()\n */\nexport async function getTeacherConversations(): Promise<Conversation[]> {\n  const supabase = await getSupabase()\n\n  // TODO: Implement real query\n  return []\n}\n\n/**\n * Get conversation messages\n * Replaces: getConversationMessages()\n */\nexport async function getConversationMessages(conversationId: string): Promise<Message[]> {\n  const supabase = await getSupabase()\n\n  // TODO: Implement real query\n  return []\n}\n\n/**\n * Get regular assessments for teacher (cached)\n * Replaces: getRegularAssessments()\n */\nexport const getRegularAssessments = cache(async (teacherId?: string): Promise<RegularAssessment[]> => {\n  const supabase = await getSupabase()\n\n  if (!teacherId) return []\n\n  // Get classes taught by this teacher\n  const { data: classData } = await supabase\n    .from('schedules')\n    .select('class_id')\n    .eq('teacher_id', teacherId)\n\n  const classIds = [...new Set(classData?.map((c) => c.class_id) || [])]\n\n  if (classIds.length === 0) return []\n\n  // Get students in these classes\n  const { data: studentData } = await supabase\n    .from('enrollments')\n    .select('student_id, classes!inner(name)')\n    .in('class_id', classIds)\n    .eq('status', 'active')\n\n  const students = studentData?.map((s: any) => ({\n    studentId: s.student_id,\n    studentName: s.classes?.name || 'Unknown',\n    classId: s.class_id,\n    className: s.classes?.name || '',\n    subject: 'N/A',\n    status: 'pending' as const,\n    createdAt: new Date().toISOString()\n  })) || []\n\n  return students\n})\n\n/**\n * Get conduct ratings\n * Replaces: getConductRatings()\n */\nexport async function getConductRatings(classId?: string): Promise<ConductRating[]> {\n  const supabase = await getSupabase()\n\n  let query = supabase\n    .from('students')\n    .select(`\n      id,\n      student_code,\n      profiles!inner(full_name),\n      enrollments!inner(class_id)\n    `)\n    .eq('enrollments.status', 'active')\n\n  if (classId) {\n    query = query.eq('enrollments.class_id', classId)\n  }\n\n  const { data } = await query\n\n  return (data || []).map((s: any) => ({\n    studentId: s.id,\n    studentName: s.profiles?.full_name || 'Unknown',\n    mssv: s.student_code,\n    academicRating: 'good' as const,\n    academicScore: 80,\n    conductRating: 'good' as const,\n    semester: '1' as const,\n    notes: ''\n  }))\n}\n\n/**\n * Get grade review requests\n * Replaces: getGradeReviewRequests()\n */\nexport async function getGradeReviewRequests(teacherId?: string): Promise<Array<{\n  id: string\n  studentName?: string\n  className?: string\n  assessmentType?: string\n  currentScore?: number\n  reason?: string\n  status?: string\n}>> {\n  const supabase = await getSupabase()\n\n  if (!teacherId) return []\n\n  // Get grade review requests for this teacher's classes\n  const { data: classData } = await supabase\n    .from('schedules')\n    .select('class_id')\n    .eq('teacher_id', teacherId)\n\n  const classIds = [...new Set(classData?.map((c) => c.class_id) || [])]\n\n  // For now, return mock data since grade_reviews table may not exist\n  // In production, this would query a grade_reviews table\n  return []\n}\n\n/**\n * Get class management detail\n * Replaces: getClassManagementData()\n */\nexport async function getClassManagementData(classId: string): Promise<ClassManagementDetail> {\n  const supabase = await getSupabase()\n\n  // TODO: Implement real query\n  return {\n    classId,\n    className: '',\n    subject: '',\n    grade: '',\n    room: '',\n    schedule: [],\n    students: []\n  }\n}\n\n/**\n * Get homeroom class detail\n * Replaces: getHomeroomClassData()\n */\nexport async function getHomeroomClassData(classId: string): Promise<HomeroomClassDetail> {\n  const supabase = await getSupabase()\n\n  // TODO: Implement real query\n  return {\n    classId,\n    className: '',\n    grade: '',\n    room: '',\n    studentCount: 0,\n    maleCount: 0,\n    femaleCount: 0,\n    students: []\n  }\n}\n\n/**\n * Get leave approval requests\n * Replaces: getLeaveApprovalRequests()\n */\nexport async function getLeaveApprovalRequests(): Promise<LeaveRequestApproval[]> {\n  const supabase = await getSupabase()\n\n  // TODO: Implement real query\n  return []\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\lib\\supabase\\realtime.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'NotificationRecipient' is defined but never used.","line":16,"column":6,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":27},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":64,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":64,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2133,2205],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":180,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":180,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5240,5243],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5240,5243],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Supabase Realtime Subscription Helpers\n * Client-side utilities for subscribing to notification updates\n *\n * NOTE: @ts-nocheck is used due to RealtimePostgresChangesPayload including\n * empty object {} in union type. The types are correctly defined in types/supabase.ts.\n */\n\n// @ts-nocheck\nimport { createClient } from './client';\nimport type { RealtimeChannel, RealtimePostgresChangesPayload } from '@supabase/supabase-js';\nimport type { Database } from '@/types/supabase';\n\n// Notification types from database\ntype Notification = Database['public']['Tables']['notifications']['Row'];\ntype NotificationRecipient = Database['public']['Tables']['notification_recipients']['Row'];\n\n/**\n * Subscribe to user's notification channel via Realtime\n * @param userId Current user's ID\n * @param callback Function to call when new notification arrives\n * @returns RealtimeChannel (call .unsubscribe() to cleanup)\n */\nexport function subscribeToNotifications(\n  userId: string,\n  callback: (notification: {\n    id: string;\n    title: string;\n    content: string;\n    category: string;\n    priority: string;\n    created_at: string;\n  }) => void\n): RealtimeChannel {\n  const supabase = createClient();\n  const channelName = `user:${userId}:notifications`;\n\n  const channel = supabase\n    .channel(channelName)\n    .on(\n      'postgres_changes',\n      {\n        event: 'INSERT',\n        schema: 'public',\n        table: 'notifications',\n        filter: `recipient_id=eq.${userId}`,\n      },\n      (payload: RealtimePostgresChangesPayload<Notification>) => {\n        const newNotification = payload.new;\n        callback({\n          id: newNotification.id,\n          title: newNotification.title,\n          content: newNotification.content,\n          category: newNotification.category || 'announcement',\n          priority: newNotification.priority || 'normal',\n          created_at: newNotification.created_at,\n        });\n      }\n    )\n    .subscribe((status) => {\n      if (status === 'SUBSCRIPTION_ERROR') {\n        console.error('[Realtime] Failed to subscribe to notifications');\n      } else if (status === 'SUBSCRIBED') {\n        console.log('[Realtime] Subscribed to notifications for user:', userId);\n      }\n    });\n\n  return channel;\n}\n\n/**\n * Subscribe to notification read status updates\n * @param userId Current user's ID\n * @param callback Function to call when notification status changes\n * @returns RealtimeChannel (call .unsubscribe() to cleanup)\n */\nexport function subscribeToNotificationUpdates(\n  userId: string,\n  callback: (payload: {\n    id: string;\n    isRead: boolean;\n    readAt: string | null;\n  }) => void\n): RealtimeChannel {\n  const supabase = createClient();\n\n  const channel = supabase\n    .channel(`notifications_updates_${userId}`)\n    .on(\n      'postgres_changes',\n      {\n        event: 'UPDATE',\n        schema: 'public',\n        table: 'notifications',\n        filter: `recipient_id=eq.${userId}`,\n      },\n      (payload: RealtimePostgresChangesPayload<Notification>) => {\n        callback({\n          id: payload.new.id,\n          isRead: payload.new.is_read,\n          readAt: payload.new.read_at,\n        });\n      }\n    )\n    .subscribe((status) => {\n      if (status === 'SUBSCRIPTION_ERROR') {\n        console.error('[Realtime] Failed to subscribe to notification updates');\n      }\n    });\n\n  return channel;\n}\n\n/**\n * Subscribe to all notification changes for admin\n * @param callback Function to call when any notification changes\n * @returns RealtimeChannel (call .unsubscribe() to cleanup)\n */\nexport function subscribeToAllNotifications(\n  callback: (payload: {\n    event: 'INSERT' | 'UPDATE' | 'DELETE';\n    notification?: Notification;\n    oldNotification?: Notification;\n  }) => void\n): RealtimeChannel {\n  const supabase = createClient();\n\n  const channel = supabase\n    .channel('all_notifications_admin')\n    .on(\n      'postgres_changes',\n      {\n        event: '*',\n        schema: 'public',\n        table: 'notifications',\n      },\n      (payload: RealtimePostgresChangesPayload<Notification>) => {\n        callback({\n          event: payload.eventType as 'INSERT' | 'UPDATE' | 'DELETE',\n          notification: payload.new,\n          oldNotification: payload.old,\n        });\n      }\n    )\n    .subscribe((status) => {\n      if (status === 'SUBSCRIPTION_ERROR') {\n        console.error('[Realtime] Failed to subscribe to all notifications');\n      }\n    });\n\n  return channel;\n}\n\n/**\n * Subscribe to delivery status updates for a specific notification\n * @param notificationId Notification ID to track\n * @param callback Function to call when delivery status changes\n * @returns RealtimeChannel (call .unsubscribe() to cleanup)\n */\nexport function subscribeToDeliveryStatus(\n  notificationId: string,\n  callback: (status: {\n    channel: string;\n    status: string;\n    recipientId: string;\n  }) => void\n): RealtimeChannel {\n  const supabase = createClient();\n\n  const channel = supabase\n    .channel(`delivery_status_${notificationId}`)\n    .on(\n      'postgres_changes',\n      {\n        event: 'INSERT',\n        schema: 'public',\n        table: 'notification_logs',\n        filter: `notification_id=eq.${notificationId}`,\n      },\n      (payload: RealtimePostgresChangesPayload<any>) => {\n        callback({\n          channel: payload.new.channel,\n          status: payload.new.status,\n          recipientId: payload.new.recipient_id,\n        });\n      }\n    )\n    .subscribe((status) => {\n      if (status === 'SUBSCRIPTION_ERROR') {\n        console.error('[Realtime] Failed to subscribe to delivery status');\n      }\n    });\n\n  return channel;\n}\n\n/**\n * Unsubscribe from a realtime channel\n * @param channel The channel to unsubscribe from\n */\nexport function unsubscribeChannel(channel: RealtimeChannel): void {\n  const supabase = createClient();\n  supabase.removeChannel(channel);\n}\n\n/**\n * React hook for subscribing to user notifications\n * @param userId Current user's ID\n * @param onNewNotification Callback for new notifications\n * @returns Cleanup function\n */\nexport function useNotificationSubscription(\n  userId: string | undefined,\n  onNewNotification: (notification: {\n    id: string;\n    title: string;\n    content: string;\n    category: string;\n    priority: string;\n    created_at: string;\n  }) => void\n): () => void {\n  if (!userId) {\n    return () => {};\n  }\n\n  const channel = subscribeToNotifications(userId, onNewNotification);\n\n  // Return cleanup function\n  return () => {\n    channel.unsubscribe();\n  };\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\lib\\supabase\\server.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\lib\\supabase\\wrapper.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\lib\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\middleware.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\next-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\next.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\postcss.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\tailwind.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\types\\supabase.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\vitest.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Project\\electric_contact_book\\apps\\web\\vitest.setup.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
