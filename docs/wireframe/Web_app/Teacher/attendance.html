<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECONTACT Teacher - Điểm danh</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');

        :root {
            --primary: #0284C7;
            --sidebar-width: 280px;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }

        .sidebar {
            width: var(--sidebar-width);
            transition: all 0.3s ease;
        }

        .nav-item {
            transition: all 0.2s ease;
        }

        .nav-item.active {
            background-color: rgba(2, 132, 199, 0.1);
            color: var(--primary);
            border-right: 4px solid var(--primary);
        }

        .card-shadow {
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }

        /* Status Button Styles */
        .status-btn {
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }

        .status-btn:hover {
            transform: scale(1.1);
        }

        .status-btn.selected {
            border-color: #0284C7;
            box-shadow: 0 0 0 3px rgba(2, 132, 199, 0.2);
            transform: scale(1.15);
        }

        /* Status Colors */
        .status-btn.P {
            background-color: #dcfce7;
            color: #16a34a;
        }
        .status-btn.P.selected {
            background-color: #16a34a;
            color: white;
        }

        .status-btn.A {
            background-color: #fee2e2;
            color: #dc2626;
        }
        .status-btn.A.selected {
            background-color: #dc2626;
            color: white;
        }

        .status-btn.L {
            background-color: #fef9c3;
            color: #ca8a04;
        }
        .status-btn.L.selected {
            background-color: #ca8a04;
            color: white;
        }

        .status-btn.E {
            background-color: #dbeafe;
            color: #2563eb;
        }
        .status-btn.E.selected {
            background-color: #2563eb;
            color: white;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Attendance Status Indicator */
        .attendance-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
    </style>
</head>

<body class="flex">

    <!-- SIDEBAR NAVIGATION -->
    <aside class="sidebar h-screen bg-white border-r border-slate-200 flex flex-col sticky top-0 shrink-0">
        <!-- Brand -->
        <div class="p-6 border-b border-slate-100 flex items-center gap-3">
            <div class="p-2 bg-blue-50 rounded-xl">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#0284C7" stroke-width="2.5">
                    <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke-linecap="round" stroke-linejoin="round" />
                    <path d="M2 17L12 22L22 17" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </div>
            <div>
                <h1 class="text-xl font-black text-slate-800 tracking-tight leading-none">ECONTACT</h1>
                <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Teacher Portal</span>
            </div>
        </div>

        <!-- Navigation -->
        <nav class="flex-1 overflow-y-auto py-6 px-3 space-y-1">
            <p class="px-4 text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2">Cá nhân</p>

            <a href="dashboard.html" class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl font-bold text-sm text-slate-600 hover:bg-slate-50">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="7" height="7" />
                    <rect x="14" y="3" width="7" height="7" />
                    <rect x="14" y="14" width="7" height="7" />
                    <rect x="3" y="14" width="7" height="7" />
                </svg>
                Tổng quan
            </a>

            <p class="px-4 text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 mt-6">Giảng dạy (GVBM)
            </p>

            <a href="#"
                class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl font-bold text-sm text-slate-600 hover:bg-slate-50">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                    <line x1="16" y1="2" x2="16" y2="6" />
                    <line x1="8" y1="2" x2="8" y2="6" />
                    <line x1="3" y1="10" x2="21" y2="10" />
                </svg>
                Lịch giảng dạy
            </a>

            <a href="attendance.html" class="nav-item active flex items-center gap-3 px-4 py-3 rounded-xl font-bold text-sm">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
                </svg>
                Điểm danh
            </a>

            <a href="class-management.html"
                class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl font-bold text-sm text-slate-600 hover:bg-slate-50">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <path d="M22 10v6M2 10l10-5 10 5-10 5z" />
                    <path d="M6 12v5c3 3 9 3 12 0v-5" />
                </svg>
                Quản lý lớp dạy
            </a>

            <a href="grade-entry.html"
                class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl font-bold text-sm text-slate-600 hover:bg-slate-50">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <path d="M12 20h9" />
                    <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z" />
                </svg>
                Nhập điểm số
            </a>

            <a href="regular-assessment.html"
                class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl font-bold text-sm text-slate-600 hover:bg-slate-50">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path>
                </svg>
                Đánh giá nhận xét
            </a>

            <a href="#"
                class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl font-bold text-sm text-slate-600 hover:bg-slate-50 relative">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                    <polyline points="14 2 14 8 20 8" />
                    <line x1="16" y1="13" x2="8" y2="13" />
                    <line x1="16" y1="17" x2="8" y2="17" />
                    <polyline points="10 9 9 9 8 9" />
                </svg>
                Phúc khảo điểm
                <span
                    class="absolute right-4 top-3 w-5 h-5 bg-red-500 text-white text-[10px] flex items-center justify-center rounded-full border-2 border-white">2</span>
            </a>

            <p class="px-4 text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 mt-6">Chủ nhiệm (GVCN)
            </p>

            <a href="academic-conduct-rating.html"
                class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl font-bold text-sm text-slate-600 hover:bg-slate-50">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <path d="M22 10v6M2 10l10-5 10 5-10 5z" />
                    <path d="M6 12v5c3 3 9 3 12 0v-5" />
                </svg>
                Học tập & Hạnh kiểm
            </a>

            <a href="#"
                class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl font-bold text-sm text-slate-600 hover:bg-slate-50">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                    <circle cx="9" cy="7" r="4" />
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
                    <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                </svg>
                Quản lý lớp CN
            </a>

            <a href="#"
                class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl font-bold text-sm text-slate-600 hover:bg-slate-50 relative">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                    <line x1="16" y1="2" x2="16" y2="6" />
                    <line x1="8" y1="2" x2="8" y2="6" />
                    <line x1="3" y1="10" x2="21" y2="10" />
                </svg>
                Phê duyệt nghỉ phép
                <span
                    class="absolute right-4 top-3 w-5 h-5 bg-orange-500 text-white text-[10px] flex items-center justify-center rounded-full border-2 border-white">3</span>
            </a>
        </nav>

        <!-- User Profile Sidebar Bottom -->
        <div class="p-4 border-t border-slate-100 bg-slate-50/50">
            <div class="flex items-center gap-3 p-2">
                <div class="w-10 h-10 rounded-full bg-slate-200 border-2 border-white overflow-hidden">
                    <img src="https://ui-avatars.com/api/?name=Thanh+Tung&background=0284C7&color=fff" alt="Avatar">
                </div>
                <div class="flex-1 min-w-0">
                    <p class="text-xs font-bold text-slate-800 truncate">Nguyễn Thanh T.</p>
                    <p class="text-[10px] text-slate-400 font-medium truncate">Giáo viên</p>
                </div>
            </div>
        </div>
    </aside>

    <!-- MAIN CONTENT AREA -->
    <main class="flex-1 min-w-0 h-screen overflow-y-auto bg-slate-50">

        <!-- TOP HEADER -->
        <header
            class="h-16 bg-white border-b border-slate-200 flex items-center justify-between px-8 sticky top-0 z-40">
            <div class="flex items-center gap-4">
                <h2 class="text-lg font-extrabold text-slate-800">Quản lý Điểm danh</h2>
            </div>

            <div class="flex items-center gap-4">
                <div id="attendanceStatusBadge"
                    class="hidden sm:flex items-center gap-2 bg-green-100 px-4 py-2 rounded-xl text-xs font-bold text-green-700">
                    <div class="attendance-indicator bg-green-500"></div>
                    <span id="statusText">Chưa điểm danh</span>
                </div>
                <button class="p-2 text-slate-500 hover:bg-slate-100 rounded-lg relative" title="Tin nhắn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                    <span class="absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full border-2 border-white"></span>
                    <span class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-[10px] flex items-center justify-center rounded-full border-2 border-white font-black">5</span>
                </button>
                <button class="p-2 text-slate-500 hover:bg-slate-100 rounded-lg relative" title="Thông báo">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" />
                        <path d="M13.73 21a2 2 0 0 1-3.46 0" />
                    </svg>
                    <span class="absolute top-2 right-2 w-2 h-2 bg-orange-500 rounded-full border-2 border-white"></span>
                </button>
                <div class="w-10 h-10 rounded-full bg-slate-200 border-2 border-white overflow-hidden cursor-pointer hover:ring-2 hover:ring-blue-200 transition-all">
                    <img src="https://ui-avatars.com/api/?name=Thanh+Tung&background=0284C7&color=fff" alt="Avatar">
                </div>
            </div>
        </header>

        <!-- CONTENT BODY -->
        <div class="p-8">

            <!-- FILTERS CARD -->
            <div class="bg-white rounded-[32px] card-shadow border border-slate-100 p-6 mb-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <!-- Class Selection -->
                    <div>
                        <label class="block text-sm font-black text-slate-700 mb-2">Lớp học</label>
                        <select id="classSelect" onchange="loadStudents()"
                            class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm font-bold focus:ring-2 focus:ring-blue-100 outline-none">
                            <option value="">Chọn lớp</option>
                            <option value="6A" selected>6A - Giáo viên chủ nhiệm: Nguyễn Thanh T.</option>
                            <option value="7A">7A - Giáo viên chủ nhiệm: Trần Thị M.</option>
                            <option value="8A">8A - Giáo viên chủ nhiệm: Lê Văn N.</option>
                            <option value="9A1">9A1 - Giáo viên chủ nhiệm: Nguyễn Thanh T.</option>
                            <option value="9A3">9A3 - Giáo viên chủ nhiệm: Nguyễn Thanh T.</option>
                        </select>
                    </div>

                    <!-- Date Selection -->
                    <div>
                        <label class="block text-sm font-black text-slate-700 mb-2">Ngày điểm danh</label>
                        <input type="date" id="attendanceDate" onchange="checkExistingAttendance()"
                            class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm font-bold focus:ring-2 focus:ring-blue-100 outline-none">
                    </div>

                    <!-- Session Selection -->
                    <div>
                        <label class="block text-sm font-black text-slate-700 mb-2">Buổi</label>
                        <select id="sessionSelect" onchange="checkExistingAttendance()"
                            class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm font-bold focus:ring-2 focus:ring-blue-100 outline-none">
                            <option value="morning">Buổi Sáng</option>
                            <option value="afternoon">Buổi Chiều</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- ATTENDANCE TABLE -->
            <div class="bg-white rounded-[32px] card-shadow border border-slate-100 overflow-hidden">
                <!-- Table Header -->
                <div class="p-6 border-b border-slate-100 flex items-center justify-between">
                    <div>
                        <h4 class="text-lg font-black text-slate-800 tracking-tight">Danh sách học sinh</h4>
                        <p class="text-slate-400 text-xs font-medium uppercase tracking-widest mt-1">
                            <span id="studentCount">0</span> học sinh • <span id="presentCount">0</span> có mặt • <span id="absentCount">0</span> vắng
                        </p>
                    </div>
                    <div class="flex gap-3">
                        <button onclick="markAllPresent()"
                            class="px-4 py-2 bg-green-50 text-green-700 rounded-xl text-xs font-bold hover:bg-green-100 flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                                <polyline points="22 4 12 14.01 9 11.01" />
                            </svg>
                            Đánh dấu tất cả có mặt
                        </button>
                        <button onclick="autoFillExcused()"
                            class="px-4 py-2 bg-blue-50 text-blue-700 rounded-xl text-xs font-bold hover:bg-blue-100 flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                                <polyline points="14 2 14 8 20 8" />
                                <path d="M12 18v-6" />
                                <path d="M8 15h8" />
                            </svg>
                            Tự động điền đơn nghỉ phép
                        </button>
                    </div>
                </div>

                <!-- Status Legend -->
                <div class="px-6 py-3 bg-slate-50 border-b border-slate-100 flex items-center gap-6 text-xs">
                    <span class="font-black text-slate-400 uppercase tracking-wider">Chú thích:</span>
                    <div class="flex items-center gap-2">
                        <span class="w-6 h-6 rounded-lg bg-green-100 text-green-700 flex items-center justify-center font-bold text-xs">P</span>
                        <span class="text-slate-600">Có mặt</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="w-6 h-6 rounded-lg bg-red-100 text-red-700 flex items-center justify-center font-bold text-xs">A</span>
                        <span class="text-slate-600">Vắng không phép</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="w-6 h-6 rounded-lg bg-yellow-100 text-yellow-700 flex items-center justify-center font-bold text-xs">L</span>
                        <span class="text-slate-600">Muộn</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="w-6 h-6 rounded-lg bg-blue-100 text-blue-700 flex items-center justify-center font-bold text-xs">E</span>
                        <span class="text-slate-600">Vắng có phép</span>
                    </div>
                </div>

                <!-- Table -->
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead class="bg-slate-50">
                            <tr>
                                <th class="px-6 py-4 text-[10px] font-black text-slate-400 uppercase tracking-widest w-20">STT</th>
                                <th class="px-6 py-4 text-[10px] font-black text-slate-400 uppercase tracking-widest">Họ và tên</th>
                                <th class="px-6 py-4 text-[10px] font-black text-slate-400 uppercase tracking-widest w-64">Trạng thái</th>
                                <th class="px-6 py-4 text-[10px] font-black text-slate-400 uppercase tracking-widest">Ghi chú</th>
                            </tr>
                        </thead>
                        <tbody id="attendanceTableBody" class="divide-y divide-slate-100">
                            <!-- Students will be rendered here -->
                        </tbody>
                    </table>
                </div>

                <!-- Empty State -->
                <div id="emptyState" class="p-12 text-center">
                    <div class="w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" class="text-slate-400">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                            <circle cx="9" cy="7" r="4" />
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
                            <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                        </svg>
                    </div>
                    <p class="text-slate-400 font-bold">Chọn lớp để bắt đầu điểm danh</p>
                </div>
            </div>

            <!-- ACTION BUTTONS -->
            <div class="mt-6 flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <button onclick="saveDraft()"
                        class="px-6 py-3 bg-white border border-slate-200 rounded-xl font-bold text-sm text-slate-700 hover:bg-slate-50 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
                            <polyline points="17 21 17 13 7 13 7 21" />
                            <polyline points="7 3 7 8 15 8" />
                        </svg>
                        Lưu nháp
                    </button>
                    <button id="confirmBtn" onclick="confirmAttendance()" disabled
                        class="px-6 py-3 bg-[#0284C7] text-white rounded-xl font-bold text-sm hover:bg-[#0369a1] disabled:bg-slate-300 disabled:cursor-not-allowed flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                            <polyline points="22 4 12 14.01 9 11.01" />
                        </svg>
                        Xác nhận hoàn thành
                    </button>
                </div>
                <div id="lastSavedInfo" class="hidden text-xs text-slate-400">
                    Lưu lần cuối: <span id="lastSavedTime">--</span>
                </div>
            </div>

        </div>
    </main>

    <!-- TOAST NOTIFICATION -->
    <div id="toast"
        class="fixed bottom-8 right-8 bg-slate-900 text-white px-8 py-4 rounded-2xl shadow-2xl transition-all transform translate-y-20 opacity-0 font-bold z-50">
        Thông báo hệ thống
    </div>

    <script>
        // Mock student data (15 học sinh)
        const studentsData = [
            { id: 1, name: 'Nguyễn Văn An', code: 'HS2024001', seat: 1, approvedLeave: false },
            { id: 2, name: 'Trần Thị Bình', code: 'HS2024002', seat: 2, approvedLeave: true },
            { id: 3, name: 'Lê Văn Cường', code: 'HS2024003', seat: 3, approvedLeave: false },
            { id: 4, name: 'Phạm Minh Dung', code: 'HS2024004', seat: 4, approvedLeave: false },
            { id: 5, name: 'Hoàng Thị Emma', code: 'HS2024005', seat: 5, approvedLeave: true },
            { id: 6, name: 'Vũ Quốc F', code: 'HS2024006', seat: 6, approvedLeave: false },
            { id: 7, name: 'Đặng Thị Giang', code: 'HS2024007', seat: 7, approvedLeave: false },
            { id: 8, name: 'Bùi Văn Hùng', code: 'HS2024008', seat: 8, approvedLeave: false },
            { id: 9, name: 'Đỗ Thị Irene', code: 'HS2024009', seat: 9, approvedLeave: false },
            { id: 10, name: 'Huỳnh Văn Jack', code: 'HS2024010', seat: 10, approvedLeave: false },
            { id: 11, name: 'Lý Thị Khanh', code: 'HS2024011', seat: 11, approvedLeave: true },
            { id: 12, name: 'Ngô Văn Long', code: 'HS2024012', seat: 12, approvedLeave: false },
            { id: 13, name: 'Mai Thị My', code: 'HS2024013', seat: 13, approvedLeave: false },
            { id: 14, name: 'Trương Văn Nam', code: 'HS2024014', seat: 14, approvedLeave: false },
            { id: 15, name: 'Võ Thị Olivia', code: 'HS2024015', seat: 15, approvedLeave: false },
        ];

        // Attendance records storage
        let attendanceRecords = {};
        let currentClass = '';
        let currentDate = '';
        let currentSession = '';

        // Initialize
        window.addEventListener('load', () => {
            // Set default date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('attendanceDate').value = today;
            currentDate = today;

            // Check session based on time
            const hour = new Date().getHours();
            const sessionSelect = document.getElementById('sessionSelect');
            if (hour < 12) {
                sessionSelect.value = 'morning';
            } else {
                sessionSelect.value = 'afternoon';
            }
            currentSession = sessionSelect.value;

            console.log('ECONTACT Teacher Attendance Loaded');
        });

        // Load students into table
        function loadStudents() {
            const classSelect = document.getElementById('classSelect');
            currentClass = classSelect.value;

            const tbody = document.getElementById('attendanceTableBody');
            const emptyState = document.getElementById('emptyState');

            if (!currentClass) {
                tbody.innerHTML = '';
                emptyState.classList.remove('hidden');
                updateStats(0, 0, 0);
                return;
            }

            emptyState.classList.add('hidden');

            // Render student rows
            tbody.innerHTML = studentsData.map(student => `
                <tr data-student-id="${student.id}" class="hover:bg-slate-50 transition-colors">
                    <td class="px-6 py-4">
                        <span class="inline-flex items-center justify-center w-8 h-8 bg-slate-100 rounded-lg font-bold text-slate-600 text-sm">
                            ${student.seat}
                        </span>
                    </td>
                    <td class="px-6 py-4">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-blue-50 text-blue-600 rounded-full flex items-center justify-center font-bold text-sm">
                                ${getInitials(student.name)}
                            </div>
                            <div>
                                <p class="text-sm font-bold text-slate-800">${student.name}</p>
                                <p class="text-xs text-slate-400">${student.code}</p>
                                ${student.approvedLeave ? '<span class="inline-block mt-1 px-2 py-0.5 bg-blue-100 text-blue-700 text-[10px] font-bold rounded">Đã duyệt đơn nghỉ</span>' : ''}
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="flex gap-2">
                            <button onclick="setStatus(${student.id}, 'P')" class="status-btn P w-10 h-10 rounded-lg font-bold text-sm" id="status-${student.id}-P">P</button>
                            <button onclick="setStatus(${student.id}, 'A')" class="status-btn A w-10 h-10 rounded-lg font-bold text-sm" id="status-${student.id}-A">A</button>
                            <button onclick="setStatus(${student.id}, 'L')" class="status-btn L w-10 h-10 rounded-lg font-bold text-sm" id="status-${student.id}-L">L</button>
                            <button onclick="setStatus(${student.id}, 'E')" class="status-btn E w-10 h-10 rounded-lg font-bold text-sm" id="status-${student.id}-E">E</button>
                        </div>
                    </td>
                    <td class="px-6 py-4">
                        <input type="text" id="note-${student.id}"
                            class="w-full px-3 py-2 bg-slate-50 border border-slate-200 rounded-lg text-xs font-medium focus:ring-2 focus:ring-blue-100 outline-none"
                            placeholder="Ghi chú...">
                    </td>
                </tr>
            `).join('');

            // Initialize attendance records for this class
            const key = getAttendanceKey();
            if (!attendanceRecords[key]) {
                attendanceRecords[key] = {};
            }

            // Check if there's existing attendance
            checkExistingAttendance();
        }

        // Set attendance status for a student
        function setStatus(studentId, status) {
            // Remove selected class from all status buttons for this student
            ['P', 'A', 'L', 'E'].forEach(s => {
                const btn = document.getElementById(`status-${studentId}-${s}`);
                if (btn) btn.classList.remove('selected');
            });

            // Add selected class to clicked button
            const selectedBtn = document.getElementById(`status-${studentId}-${status}`);
            if (selectedBtn) selectedBtn.classList.add('selected');

            // Save to records
            const key = getAttendanceKey();
            if (!attendanceRecords[key]) attendanceRecords[key] = {};
            attendanceRecords[key][studentId] = {
                status: status,
                note: document.getElementById(`note-${studentId}`).value
            };

            // Update stats and enable confirm button
            updateStatsUI();
            document.getElementById('confirmBtn').disabled = false;
        }

        // Mark all students as Present
        function markAllPresent() {
            studentsData.forEach(student => {
                setStatus(student.id, 'P');
            });
            showToast('Đã đánh dấu tất cả học sinh có mặt');
        }

        // Auto-fill excused absences
        function autoFillExcused() {
            let count = 0;
            studentsData.forEach(student => {
                if (student.approvedLeave) {
                    setStatus(student.id, 'E');
                    const noteInput = document.getElementById(`note-${student.id}`);
                    if (noteInput) noteInput.value = 'Đơn nghỉ phép đã duyệt';
                    count++;
                }
            });
            if (count > 0) {
                showToast(`Đã tự động điền ${count} học sinh có đơn nghỉ phép`);
            } else {
                showToast('Không có học sinh nào có đơn nghỉ phép');
            }
        }

        // Save draft
        function saveDraft() {
            const key = getAttendanceKey();
            if (!attendanceRecords[key] || Object.keys(attendanceRecords[key]).length === 0) {
                showToast('Chưa có dữ liệu điểm danh để lưu');
                return;
            }

            // Mock save
            const now = new Date();
            const timeStr = now.toLocaleString('vi-VN');
            document.getElementById('lastSavedTime').textContent = timeStr;
            document.getElementById('lastSavedInfo').classList.remove('hidden');

            showToast('Đã lưu nháp thành công');
        }

        // Confirm attendance
        function confirmAttendance() {
            const key = getAttendanceKey();
            if (!attendanceRecords[key] || Object.keys(attendanceRecords[key]).length === 0) {
                showToast('Vui lòng điểm danh trước khi xác nhận');
                return;
            }

            if (confirm('Xác nhận hoàn thành điểm danh? Hành động này sẽ gửi thông báo đến phụ huynh của học sinh vắng mặt.')) {
                // Mock confirm and send notifications
                const absentStudents = studentsData.filter(s => {
                    const record = attendanceRecords[key][s.id];
                    return record && (record.status === 'A' || record.status === 'L');
                });

                if (absentStudents.length > 0) {
                    showToast(`Đã xác nhận. Đã gửi thông báo đến ${absentStudents.length} phụ huynh.`);
                } else {
                    showToast('Đã xác nhận hoàn thành điểm danh');
                }

                // Update status badge
                updateStatusBadge('completed');
            }
        }

        // Check existing attendance
        function checkExistingAttendance() {
            // Mock implementation - in real app, would check database
            currentDate = document.getElementById('attendanceDate').value;
            currentSession = document.getElementById('sessionSelect').value;
            updateStatusBadge('pending');
        }

        // Update statistics
        function updateStatsUI() {
            const key = getAttendanceKey();
            const records = attendanceRecords[key] || {};

            let present = 0, absent = 0;
            studentsData.forEach(student => {
                const record = records[student.id];
                if (record) {
                    if (record.status === 'P') present++;
                    else if (record.status === 'A' || record.status === 'L' || record.status === 'E') absent++;
                }
            });

            updateStats(studentsData.length, present, absent);
        }

        function updateStats(total, present, absent) {
            document.getElementById('studentCount').textContent = total;
            document.getElementById('presentCount').textContent = present;
            document.getElementById('absentCount').textContent = absent;
        }

        // Update status badge
        function updateStatusBadge(status) {
            const badge = document.getElementById('attendanceStatusBadge');
            const text = document.getElementById('statusText');

            if (status === 'completed') {
                badge.className = 'hidden sm:flex items-center gap-2 bg-green-100 px-4 py-2 rounded-xl text-xs font-bold text-green-700';
                badge.querySelector('.attendance-indicator').className = 'attendance-indicator bg-green-500';
                text.textContent = 'Đã hoàn thành';
            } else {
                badge.className = 'hidden sm:flex items-center gap-2 bg-yellow-100 px-4 py-2 rounded-xl text-xs font-bold text-yellow-700';
                badge.querySelector('.attendance-indicator').className = 'attendance-indicator bg-yellow-500';
                text.textContent = 'Chưa hoàn thành';
            }
        }

        // Helper functions
        function getAttendanceKey() {
            return `${currentClass}_${currentDate}_${currentSession}`;
        }

        function getInitials(name) {
            return name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => {
                toast.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }
    </script>

</body>

</html>
